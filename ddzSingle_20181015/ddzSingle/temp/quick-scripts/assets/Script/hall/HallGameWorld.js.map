{"version":3,"sources":["HallGameWorld.js"],"names":["cc","Class","ctor","_TAG","model","m_coinList","m_itemList","m_diamondList","m_jewelList","m_msgPrivateVec","m_msgGlobalVec","m_ledList","m_ledIndex","m_ledTableList","m_ledLast","m_ledTableLast","m_ledCapacity","m_ledBeWork","m_storeConfig","m_normalRooms","m_onlineInfos","personInfo","normal","isSelectedPic","avatarPicIndex","m_matchWait","firstChargeItem","hall","LOGD","destroy","parsePersonInfo","result","LOGW","JSON","stringify","userInfo","PersonInfo","parseUserInfo","parseMatchStore","items","tabs","coinItems","diamondItems","jewelItems","i","list","item","length","tab","sub","StoreItemInfo","parseStoreItemInfo","push","ty","NotificationCenter","trigger","ddz","EventType","UPDATE_MATCH_STORE","parseNormalRooms","rooms","sessions","len","ConfigRoomSession","getRoomsByType","type","room","GlobalFuncs","FindInArrayBuFun","element","m_type","m_rooms","getRoomOnlineInfo","id","online","onlineNum","parseLed","newMessage","text","indexOf","_text","startIndex","endIndex","str","substring","_string","replace","SliceStringToLength","color","parseGameLed","_arr","split","grade","tips"],"mappings":"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","file":"HallGameWorld.js","sourceRoot":"../../../../../assets/Script/hall","sourcesContent":["\n\ncc.Class({\n\n    ctor: function() {\n        this._TAG = 'hall.GameWorld';\n        this.model = {\n\n            m_coinList: [], // 金币商品列表,存放StoreItemInfo类对象\n            m_itemList: [], // 道具商品列表,存放StoreItemInfo类对象\n            m_diamondList: [], // 钻石商城列表\n            m_jewelList: [], // 宝石列表\n            m_msgPrivateVec: null, // 消息集合\n            m_msgGlobalVec: null, // 消息集合\n            m_ledList: [], // ledInfo信息列表\n            m_ledIndex: -1, // 当前播放的led消息\n            m_ledTableList: [], // 牌桌内ledInfo信息列表\n            m_ledLast: 0,  // 新到消息的放置位置\n            m_ledTableLast: 0,  // 新到消息的放置位置\n            m_ledCapacity: 20,  //消息最大总量\n            m_ledBeWork: false,  //消息是否正在播放\n            m_storeConfig: [],\n            m_normalRooms: [],\n            m_onlineInfos: [],\n            personInfo:null,\n        };\n\n        this.normal = {\n            isSelectedPic: false, //个人中心是否选择头像了\n            avatarPicIndex: 0, //用户选择的图片的索引\n            m_matchWait: null // 比赛暂存信息，赋值在大厅页，在牌桌内使用过后置空，用于比赛的断线重连\n        };\n\n        this.firstChargeItem = null;\n\n        hall.LOGD(this._TAG, \"ctor in hall._GameWorld\");\n    },\n\n    // 默认的析构函数\n    destroy: function() {\n        this.model = null;\n        this.normal = null;\n        hall.LOGD(this._TAG, \"destroy in hall._GameWorld\");\n    },\n\n    //处理个人信息\n    parsePersonInfo:function(result){\n        hall.LOGW(\"\",\"file = [HallGameWorld] fun = [parsePersonInfo] userInfo = \" + JSON.stringify(result.userInfo));\n        if (!this.model.personInfo) {\n            this.model.personInfo = new hall.PersonInfo();\n        }\n        if (result.userInfo) {\n            this.model.personInfo.parseUserInfo(result.userInfo);\n        }\n    },\n\n    // 处理商品信息\n    parseMatchStore: function(result) {\n        // 金币商品信息\n        var items;\n        var tabs = result[\"tabs\"];\n        var coinItems;\n        var diamondItems;\n        var jewelItems;\n        if (result[\"conf\"]) {\n            this.model.m_storeConfig = result[\"conf\"];\n        }\n        var i, list, item;\n        for (i = 0; i < tabs.length; i++) {\n            var tab = tabs[i];\n            var sub = tab[\"subStore\"];\n            if (sub == \"coin\") {\n                coinItems = tab[\"items\"];\n            } else if (sub == \"diamond\") {\n                diamondItems = tab[\"items\"];\n            } else if (sub == \"jewel\") {\n                jewelItems = tab[\"items\"];\n            }\n        }\n        if (coinItems) {\n            list = [];\n            for (i = 0; i < coinItems.length; i++) {\n                item = new hall.StoreItemInfo();\n                item.parseStoreItemInfo(coinItems[i]);\n                list.push(item);\n            }\n            this.model.m_coinList = list;\n\n\n        }\n        if (diamondItems) {\n            list = [];\n            for (i = 0; i < diamondItems.length; i++) {\n                item = new hall.StoreItemInfo();\n                item.parseStoreItemInfo(diamondItems[i]);\n                list.push(item);\n            }\n            this.model.m_diamondList = list;\n        }\n\n        if (jewelItems) {\n            list = [];\n            for (i = 0; i < jewelItems.length; i++) {\n                item = new hall.StoreItemInfo();\n                item.parseStoreItemInfo(jewelItems[i]);\n                list.push(item);\n            }\n            this.model.m_jewelList = list;\n        }\n        ty.NotificationCenter.trigger(ddz.EventType.UPDATE_MATCH_STORE);\n    },\n\n    parseNormalRooms: function(result) {\n        var rooms = [];\n        var sessions = result[\"sessions\"] || [];\n        for (var i = 0, len = sessions.length; i < len; i++) {\n            rooms.push(new ddz.ConfigRoomSession(sessions[i]));\n        }\n        this.model.m_normalRooms = rooms;\n        this.model.m_onlineInfos = result['onlineInfos'];\n    },\n\n    getRoomsByType: function(type) {\n        var room = hall.GlobalFuncs.FindInArrayBuFun(this.model.m_normalRooms, function(element) {\n            return element.m_type == type;\n        });\n        if (room) {\n            return room.m_rooms;\n        }\n        return [];\n    },\n\n    getRoomOnlineInfo:function(id) {\n        var online = this.model.m_onlineInfos[1];\n        if (typeof(online) != 'undefined') {\n            if (online[id + \"\"] != null) {\n                var onlineNum = online[id];\n                return onlineNum;\n            }\n        }\n        return -1;\n    },\n\n    parseLed: function(result) {\n        var newMessage = [];\n        for (var i = 0; i < result.length; i++) {\n            if (result[i].text.indexOf(\"通关奖励\") > 0) {\n                var _text = result[i].text;\n                var startIndex = _text.indexOf('[')+1;\n                var endIndex = _text.indexOf(']');\n                var str = _text.substring(startIndex,endIndex);\n                var _string = _text.replace(str, hall.GlobalFuncs.SliceStringToLength(str, 8));\n                newMessage.push({\n                    \"text\": _string,\n                    \"color\": result[i].color,\n                    \"size\": 28\n                });\n            }\n        }\n        var model = this.model;\n        model.m_ledList[model.m_ledLast] = newMessage;\n        model.m_ledLast = (model.m_ledLast + 1) % model.m_ledCapacity;\n    },\n\n    parseGameLed: function(result){\n        var newMessage = [];\n        for (var i = 0; i < result.length; i++) {\n            if(result[i].text.indexOf(\"||\") > 0){\n                var _text = result[i].text;\n                var _arr = _text.split(\"||\");\n                var grade = _arr[0];\n                var tips =  _arr[1];\n                var startIndex = tips.indexOf('[')+1;\n                var endIndex = tips.indexOf(']');\n                var str = tips.substring(startIndex,endIndex);\n                var _string = tips.replace(str, hall.GlobalFuncs.SliceStringToLength(str, 10));\n                newMessage.push({\n                    \"text\": _string,\n                    \"color\": result[i].color,\n                    \"size\": 28,\n                    \"grade\": grade\n                });\n            }\n        }\n        var model = this.model;\n        model.m_ledTableList.push(newMessage);\n    }\n\n});"]}