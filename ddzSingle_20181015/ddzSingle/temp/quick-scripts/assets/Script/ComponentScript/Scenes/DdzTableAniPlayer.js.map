{"version":3,"sources":["DdzTableAniPlayer.js"],"names":["cc","Class","extends","Component","ctor","_tableScene","arguments","_aniMap","properties","playAniByPrefab","preFabPath","finish_func","start_func","that","showAni","aniNode","parentNode","ddz","LOGD","addChild","preFabNode","ani","getComponent","Animation","clipName","getClips","name","anim","getAnimationState","once","removeFromParent","putAni","play","getAniFromCache","loader","loadRes","err","prefab","instantiate","_parentNode","bind","aniList","length","pop","push","playBomb","pt","playPlane","playRocket","playShunZi","playLianDui","playChunTian","playWin","playLose","playGameFlow","playLaiZi","shut"],"mappings":"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","file":"DdzTableAniPlayer.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/Scenes","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    ctor:function () {\n        this._tableScene = arguments[0];\n        this._aniMap = {};\n    },\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n    },\n\n    /**\n     * 从预制件加载动画\n     * @param preFabPath 路径\n     * @param finish_func 播放完成后的回调\n     * @param start_func 播放开始时的回调\n     */\n    playAniByPrefab:function (preFabPath, finish_func, start_func) {\n\n        var that = this;\n        var showAni = function (aniNode, parentNode, finish_func, start_func) {\n            ddz.LOGD(null, \"播放动画:\" + preFabPath);\n            parentNode.addChild(preFabNode);\n\n            var ani = preFabNode.getComponent(cc.Animation);\n            var clipName = ani.getClips()[0].name;\n            var anim = ani.getAnimationState(clipName);\n            anim.once(\"finished\", function () {\n                if (finish_func){\n                    finish_func(preFabNode);\n                }\n                preFabNode.removeFromParent(false);\n                ddz.LOGD(null, \"牌桌动画回收:\" + preFabPath);\n                that.putAni(preFabPath, preFabNode);//播放完成,放回池里\n            });\n            anim.play();\n\n            if (start_func){\n                start_func(preFabNode);\n            }\n        };\n\n        var preFabNode = this.getAniFromCache(preFabPath);\n        if (preFabNode){\n            showAni(preFabNode, this._tableScene.aniNode, finish_func, start_func);\n        }\n        else{\n            cc.loader.loadRes(preFabPath, function (err, prefab) {\n\n                preFabNode = cc.instantiate(prefab);\n                if (!preFabNode){\n                    ddz.LOGD(null, \"动画实例化失败:\" + preFabPath);\n                    return;\n                }\n\n                if(!this._tableScene){\n                    return;\n                }\n                var _parentNode = this._tableScene.aniNode;\n\n                showAni(preFabNode, _parentNode, finish_func, start_func);\n            }.bind(this));\n        }\n\n    },\n\n    getAniFromCache:function (preFabPath) {\n        var aniList = this._aniMap[preFabPath];\n        if (aniList){\n            if (aniList.length > 0){\n                return aniList.pop();\n            }\n            else{\n                return null;\n            }\n        }\n\n        return null;\n    },\n\n    putAni:function (preFabPath, preFabNode) {\n        var aniList = this._aniMap[preFabPath];\n        if (!aniList){\n            aniList = [];\n            this._aniMap[preFabPath] = aniList;\n        }\n        aniList.push(preFabNode);\n    },\n\n    /**\n     * 播放炸弹动画\n     * @param pt 炸弹被扔出来的点\n     */\n    playBomb:function (pt) {\n        this.playAniByPrefab('ani/doudizhu/ddz_table_ani_bomb_blast_action/ddz_table_ani_bomb_blast');\n    },\n\n    /**\n     * 播放飞机动画\n     */\n    playPlane:function () {\n        this.playAniByPrefab('ani/doudizhu/ddz_table_ani_plane_action/ddz_table_ani_plane');\n    },\n\n    /**\n     * 播放火箭动画\n     */\n    playRocket:function () {\n        this.playAniByPrefab('ani/doudizhu/ddz_table_ani_rocket_fly_action/ddz_table_ani_rocket_fly');\n        this.playAniByPrefab('ani/doudizhu/ddz_table_ani_rocket_blast_action/ddz_table_ani_rocket_blast');\n    },\n\n    /**\n     * 播放顺子\n     */\n    playShunZi:function () {\n        this.playAniByPrefab('ani/doudizhu/ddz_table_ani_shunzi_action/ddz_table_shunzi');\n    },\n\n    /**\n     * 播放连对\n     */\n    playLianDui:function () {\n        this.playAniByPrefab('ani/doudizhu/ddz_table_liandui_action/ddz_table_liandui');\n    },\n\n    /**\n     * 播放春天\n     */\n    playChunTian:function () {\n        this.playAniByPrefab('ani/doudizhu/ddz_table_result_title_chuntian_action/ddz_table_result_title_chuntian');\n    },\n\n    /**\n     * 播放胜利\n     */\n    playWin:function () {\n        this.playAniByPrefab('ani/winorlose/win1');\n    },\n\n    /**\n     * 播放失败\n     */\n    playLose:function () {\n        this.playAniByPrefab('ani/winorlose/shibai');\n    },\n\n    /**\n     * 播放流局\n     */\n    playGameFlow:function () {\n        this.playAniByPrefab('ani/winorlose/gameFlow');\n    },\n\n    /**\n     * 播放癞子确定动画\n     */\n    playLaiZi:function () {\n        this.playAniByPrefab('ani/laizi/laizi');\n    },\n    \n    shut:function () {\n        this._tableScene = null;\n    }\n\n\n\n});"]}