{"version":3,"sources":["DdzTableChatAni.js"],"names":["cc","Class","extends","Component","ctor","_tableScene","arguments","_aniMap","properties","playAniByPrefab","preFabPath","start_func","finish_func","isForver","that","showAni","chatNode","parentNode","ddz","LOGD","addChild","preFabNode","callF","ani","getComponent","Animation","clipName","getClips","name","anim","getAnimationState","removeFromParent","putAni","once","play","getAniFromCache","loader","loadRes","err","prefab","instantiate","_parentNode","bind","aniList","length","pop","push","playFlowerFly","playFlower","AudioHelper","playEffect","SmiliesPath_mp3","playDiamondFly","playDiamond","playEggFly","playEgg","playBrickFly","playBrick","shut"],"mappings":"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","file":"DdzTableChatAni.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/Scenes","sourcesContent":["/**\n * Created by tuyoo on 2018/5/9.\n */\ncc.Class({\n    extends: cc.Component,\n\n    ctor:function () {\n        this._tableScene = arguments[0];\n        this._aniMap = {};\n    },\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n    },\n\n    /**\n     * 从预制件加载动画\n     * @param preFabPath 路径\n     * @param finish_func 播放完成后的回调\n     * @param start_func 播放开始时的回调\n     */\n    playAniByPrefab:function (preFabPath, start_func,finish_func,isForver) {\n\n        var that = this;\n        var showAni = function (chatNode, parentNode, finish_func, start_func) {\n            ddz.LOGD(null, \"播放动画:\" + preFabPath);\n            parentNode.addChild(preFabNode);\n            var callF;\n            var ani = preFabNode.getComponent(cc.Animation);\n            var clipName = ani.getClips()[0].name;\n            var anim = ani.getAnimationState(clipName);\n            if (isForver) {\n                callF = function () {\n                    if (finish_func){\n                        finish_func(preFabNode);\n                    }\n                    preFabNode.removeFromParent(false);\n                    ddz.LOGD(null, \"牌桌动画回收:\" + preFabPath);\n                    that.putAni(preFabPath, preFabNode);//播放完成,放回池里\n                };\n\n            }else {\n                anim.once(\"finished\", function () {\n                    if (finish_func){\n                        finish_func(preFabNode);\n                    }\n                    preFabNode.removeFromParent(false);\n                    ddz.LOGD(null, \"牌桌动画回收:\" + preFabPath);\n                    that.putAni(preFabPath, preFabNode);//播放完成,放回池里\n                });\n\n            }\n\n            anim.play();\n\n            if (start_func){\n                start_func(preFabNode,callF);\n            }\n        };\n\n        var preFabNode = this.getAniFromCache(preFabPath);\n        if (preFabNode){\n            showAni(preFabNode, this._tableScene.chatNode, finish_func, start_func);\n        }\n        else{\n            cc.loader.loadRes(preFabPath, function (err, prefab) {\n\n                preFabNode = cc.instantiate(prefab);\n                if (!preFabNode){\n                    ddz.LOGD(null, \"动画实例化失败:\" + preFabPath);\n                    return;\n                }\n\n                if(!this._tableScene){\n                    return;\n                }\n                var _parentNode = this._tableScene.chatNode;\n                // this.putAni(preFabPath, preFabNode);\n\n                showAni(preFabNode, _parentNode, finish_func, start_func);\n            }.bind(this));\n        }\n\n    },\n\n    getAniFromCache:function (preFabPath) {\n        var aniList = this._aniMap[preFabPath];\n        if (aniList){\n            if (aniList.length > 0){\n                return aniList.pop();\n            }\n            else{\n                return null;\n            }\n        }\n\n        return null;\n    },\n\n    putAni:function (preFabPath, preFabNode) {\n        var aniList = this._aniMap[preFabPath];\n        if (!aniList){\n            aniList = [];\n            this._aniMap[preFabPath] = aniList;\n        }\n        aniList.push(preFabNode);\n    },\n    \n    // switch (emoId){\n    // case 'flower': // 花\n    //     str = 'ani/ddz_bq/ddz_table_interactive_emotion3_1_action/meigui2';\n    //     gStr = 'ani/ddz_bq/ddz_table_interactive_emotion3_0_action/meigui';\n    //     break;\n    // case 'diamond': // 钻石\n    //     str = 'ani/ddz_bq/ddz_table_interactive_emotion1_1_action/zuanjie2';\n    //     gStr = 'ani/ddz_bq/ddz_table_interactive_emotion1_1_action/zuanjie2';\n    //     // gStr = 'ani/ddz_bq/ddz_table_interactive_emotion1_0_action/zuanjie';\n    //     break;\n    // case 'egg': // 鸡蛋\n    //     str = 'ani/ddz_bq/ddz_table_interactive_emotion2_1_action/jidan2';\n    //     gStr = 'ani/ddz_bq/ddz_table_interactive_emotion2_0_action/jidan';\n    //     break;\n    // case 'brick': // 板砖\n    //     str = 'ani/ddz_bq/ddz_table_interactive_emotion4_1_action/banzhuan2';\n    //     gStr = 'ani/ddz_bq/ddz_table_interactive_emotion4_0_action/banzhuan1';\n    //     break;\n    // };\n\n    /**\n     * 播放花飞过去的动画\n     */\n    playFlowerFly:function (start_func,finish_func) {\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion3_0_action/meigui',start_func,finish_func,true);\n    },\n\n    /**\n     * 播放花动画\n     */\n    playFlower:function (start_func,finish_func) {\n        ddz.AudioHelper.playEffect(ddz.SmiliesPath_mp3['flower'], false);\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion3_1_action/meigui2',start_func,finish_func);\n    },\n\n    /**\n     * 播放钻石飞过去动画\n     */\n    playDiamondFly:function (start_func,finish_func) {\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion1_1_action/zuanjie2',start_func,finish_func,true);\n        // this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion1_0_action/zuanjie',start_func,finish_func,true);\n    },\n\n    /**\n     * 播放钻石动画\n     */\n    playDiamond:function (start_func,finish_func) {\n        ddz.AudioHelper.playEffect(ddz.SmiliesPath_mp3['diamond'], false);\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion1_1_action/zuanjie2',start_func,finish_func);\n    },\n\n    /**\n     * 播放鸡蛋飞过去动画\n     */\n    playEggFly:function (start_func,finish_func) {\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion2_0_action/jidan',start_func,finish_func,true);\n    },\n\n    /**\n     * 播放鸡蛋动画\n     */\n    playEgg:function (start_func,finish_func) {\n        ddz.AudioHelper.playEffect(ddz.SmiliesPath_mp3['egg'], false);\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion2_1_action/jidan2',start_func,finish_func);\n    },\n\n    /**\n     * 播放板砖飞过去动画\n     */\n    playBrickFly:function (start_func,finish_func) {\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion4_0_action/banzhuan1',start_func,finish_func,true);\n    },\n\n    /**\n     * 播放板砖动画\n     */\n    playBrick:function (start_func,finish_func) {\n        ddz.AudioHelper.playEffect(ddz.SmiliesPath_mp3['brick'], false);\n        this.playAniByPrefab('ani/ddz_bq/ddz_table_interactive_emotion4_1_action/banzhuan2',start_func,finish_func);\n    },\n\n    shut:function () {\n        this._tableScene = null;\n    }\n\n});"]}