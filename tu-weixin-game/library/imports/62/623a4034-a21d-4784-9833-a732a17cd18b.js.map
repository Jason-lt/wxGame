{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/window/assets/Script/ComponentScript/window/ddz_personInfoEdit.js"],"names":["cc","Class","extends","Component","properties","signatureEditBox","default","type","EditBox","avatar","Node","wechatEditBox","personInfoNode_1","personInfoNode_2","personInfoNode_3","personInfoNode_4","onLoad","personInfo","hall","gameWorld","model","node","on","editChangeInfo","editEndInfo","wechatEditChangeInfo","wechatEditEndInfo","microSignalString","signatureString","signature","getSignature","string","micro_signal","getMicroSignal","wechatVisible","getSignalIsVisible","constellationString","getConstellation","provinceString","getProvince","districtString","getDistrict","sex","getSex","i","com","getComponent","setParentCom","setAvatar","wimdow","ty","UserInfo","userPic","ddz","gameModel","isLimit","setAvatarUrl","hideNameDisplay","event","changedString","detail","length","NaN","MsgBoxManager","showToast","title","reg","fuBen","chinese","match","onClickWeChatVisible","onClickBgBtn","NotificationCenter","trigger","EventType","CLOSE_XIA_LA_VIEW","onClose","isDiff","setPersonInfo","destroy"],"mappings":"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","file":"ddz_personInfoEdit.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        signatureEditBox : {\n            default : null,\n            type : cc.EditBox\n        },\n\n        avatar:cc.Node,\n\n        wechatEditBox : {\n            default : null,\n            type : cc.EditBox\n        },\n\n        personInfoNode_1:cc.Node,\n        personInfoNode_2:cc.Node,\n        personInfoNode_3:cc.Node,\n        personInfoNode_4:cc.Node,\n\n    },\n\n    onLoad:function(){\n\n        var personInfo = hall.gameWorld.model.personInfo;\n        \n        this.signatureEditBox.node.on(\"text-changed\",this.editChangeInfo,this);\n        this.signatureEditBox.node.on(\"editing-did-ended\",this.editEndInfo,this);\n\n        this.wechatEditBox.node.on(\"text-changed\",this.wechatEditChangeInfo,this);\n        this.wechatEditBox.node.on(\"editing-did-ended\",this.wechatEditEndInfo,this);\n        this.microSignalString = \"\";\n        this.signatureString = \"\";\n        if (personInfo) {\n            var signature = personInfo.getSignature();\n            if (signature != \"\" && signature != \"未设置\"){\n                this.signatureEditBox.string = signature;\n                this.signatureString = signature;\n            }\n            var micro_signal = personInfo.getMicroSignal();\n            if (micro_signal != \"\" && micro_signal != \"未设置\"){\n                this.wechatEditBox.string = micro_signal;\n                this.microSignalString = micro_signal;\n            }\n\n            this.wechatVisible = personInfo.getSignalIsVisible();\n\n            this.constellationString = personInfo.getConstellation();\n            this.provinceString = personInfo.getProvince();\n            this.districtString = personInfo.getDistrict();\n            this.sex = personInfo.getSex();\n        }\n\n        for (var i = 1; i < 5; i++){\n            var com = this[\"personInfoNode_\" + i].getComponent(\"personDataEdit\");\n            com.setParentCom(this);\n        }\n        this.setAvatar();\n    },\n    \n    setAvatar:function(){\n        var wimdow = this.avatar.getComponent(\"Avatar\");\n        if(ty.UserInfo.userPic && ddz.gameModel.isLimit){\n            wimdow.setAvatarUrl(ty.UserInfo.userPic);\n            wimdow.hideNameDisplay();\n        }\n    },\n\n    editChangeInfo:function(event){\n        var changedString = event.detail.string;\n\n        if(!changedString || changedString.length <1 || changedString == NaN){\n            changedString = \"\";\n        }\n\n        if (changedString && changedString.length > 20) {\n            hall.MsgBoxManager.showToast({title : '长度不能超出20个字符!'});\n        }\n        var signatureString = changedString + \"\";\n        this.signatureEditBox.string = signatureString;\n    },\n\n    editEndInfo:function(event){\n        var changedString = event.detail.string;\n\n        if(!changedString || changedString.length <1 || changedString == NaN){\n            changedString = \"\";\n        }\n\n        if (changedString && changedString.length > 20) {\n            hall.MsgBoxManager.showToast({title : '长度不能超出20个字符!'});\n        }\n\n        this.signatureString = changedString + \"\";\n        this.signatureEditBox.string = this.signatureString;\n    },\n\n    wechatEditChangeInfo:function(event){\n        var changedString = event.detail.string;\n        if(!changedString || changedString.length <1 || changedString == NaN){\n            changedString = \"\";\n        }\n\n        var microSignalString = changedString + \"\";\n        if (microSignalString && microSignalString.length > 20){\n            hall.MsgBoxManager.showToast({title : '长度不能超出20个字符!'});\n        }\n        // var reg = new RegExp(key,\"g\");\n        var reg = /[\\u4e00-\\u9fa5]/g;\n        var fuBen = \"\";\n        fuBen = microSignalString;\n        var chinese = fuBen.match(reg);\n        if (chinese && chinese.length > 0) {\n            hall.MsgBoxManager.showToast({title : '微信号不能输入汉字!'});\n            microSignalString = \"\";\n        }\n        \n        this.wechatEditBox.string = microSignalString;\n    },\n\n    wechatEditEndInfo:function(event){\n        var changedString = event.detail.string;\n\n        if(!changedString || changedString.length <1 || changedString == NaN){\n            changedString = \"\";\n        }\n\n        if(changedString && changedString.length <= 20){\n\n        }else if (changedString && changedString.length > 20) {\n            hall.MsgBoxManager.showToast({title : '长度不能超出20个字符!'});\n        }\n\n        var reg = /[\\u4e00-\\u9fa5]/g;\n        var fuBen = \"\";\n        fuBen = changedString + \"\";\n        var chinese = fuBen.match(reg);\n        if (chinese && chinese.length > 0) {\n            hall.MsgBoxManager.showToast({title : '微信号不能输入汉字!'});\n            changedString = \"\";\n        }\n        this.microSignalString = changedString + \"\";\n        this.wechatEditBox.string = this.microSignalString + \"\";\n    },\n\n    onClickWeChatVisible:function(){\n        this.wechatVisible = !this.wechatVisible;\n        // this.selectGou.active = this.wechatVisible;\n    },\n\n    onClickBgBtn:function(){\n        ty.NotificationCenter.trigger(ddz.EventType.CLOSE_XIA_LA_VIEW);\n    },\n\n    onClose:function(){\n        // setPersonInfo: function(micro_signal,isVisible,signature,constellation,province,district)\n        var isDiff= false;\n        var personInfo = hall.gameWorld.model.personInfo;\n        if (!personInfo) {\n            isDiff = true;\n        }else {\n            if (this.microSignalString != personInfo.getMicroSignal()) {\n                isDiff = true;\n            }\n            if (this.signatureString != personInfo.getSignature()) {\n                isDiff = true;\n            }\n\n            if (this.constellationString != personInfo.getConstellation()){\n                isDiff = true;\n            }\n\n            if (this.provinceString != personInfo.getProvince()){\n                isDiff = true;\n            }\n\n            if (this.districtString != personInfo.getDistrict()){\n                isDiff = true;\n            }\n        }\n        if (isDiff) {\n            ddz.gameModel.setPersonInfo(this.microSignalString,true,this.signatureString,this.constellationString,this.provinceString,this.districtString);\n        }\n        this.node.destroy();\n    },\n});\n"]}