{"version":3,"sources":["../../../../../../assets/Script/ddz/msg_handler/assets/Script/ddz/msg_handler/DdzMsgFactory.js"],"names":["ddz","MsgFactory","getQuickStart","roomId","apiver","sessionIndex","params","EventType","CMD_TABLE_QUICKSTART","ty","SystemInfo","gameId","hall","_sendCmd","getTableLeave","tableId","seatId","mixId","MSG_TABLE_LEAVE","getRoomLeave","_mixedRoomId","CMD_ROOM_LEAVE","getTableCall","action","param","subparams","key","CMD_TABLE_CALL","getReady","ACTION_READY","GameId","getCradNote","toComplain","otherPlayerId1","otherPlayerId2","gameNum","cmd","CMD_COMPLAIN","sendTableChat","from","to","emoTag","send10","LOGD","JSON","stringify","getTboxReward","CMD_DIZHU","saveMatch","waitInfo","matchModel","getCurWaitInfo","friendModel","isEnterTable","enterFTTable","Share","shareKeywordReplace","inviteFriendID","LOGW","state","MsgBoxManager","showToast","title","CMD_ROOM","ACTION_SAVE","resumeMatch","records","gameModel","getCurMatchRecords","length","ACTION_RESUME","getMatchRecords","MSG_GAME","ACTION_RECORDS","sendRewardMsgToFriends","friendIds","moneyVal","msgType","UserInfo","userName"],"mappings":"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","file":"DdzMsgFactory.js","sourceRoot":"../../../../../../assets/Script/ddz/msg_handler","sourcesContent":["//斗地主专用消息发送\n\nddz.MsgFactory = {\n\n\t//进入经典场，某个房间，返回的是table_info...有3种情况，带roomid（选定房间进入）, 带sessionIndex（快速进入）, 都不带（断线重练）\n\tgetQuickStart: function(roomId, apiver, sessionIndex) {\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.CMD_TABLE_QUICKSTART,\n\t\t\t'params': {\n\t\t\t\t'apiver': apiver,\n\t\t\t\t'gameId' : ty.SystemInfo.gameId\n\t\t\t}\n\t\t};\n\t\tif (typeof(sessionIndex) != 'undefined' && sessionIndex != null) { //如果没有sessionIndex这个参数，则传roomId， 否则传sessionIndex\n\t\t\tparams[\"params\"][\"sessionIndex\"] = sessionIndex;\n\t\t}\n\t\tif (typeof(roomId) != 'undefined' && roomId != null) {\n\t\t\tparams[\"params\"][\"roomId\"] = roomId;\n\t\t}\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t/**\n\t * 离开某个牌桌\n\t * @param roomId 房间号\n\t * @param tableId 桌号\n\t * @param seatId 坐位号\n     * @param mixId 混房号\n     */\n\tgetTableLeave: function(roomId,tableId,seatId,mixId) {\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.MSG_TABLE_LEAVE,\n\t\t\t'params': {\n\t\t\t\t'gameId' : ty.SystemInfo.gameId,\n\t\t\t\t'roomId': roomId,\n\t\t\t\t\"seatId\": seatId,\n\t\t\t\t\"tableId\": tableId\n\t\t\t}\n\t\t};\n\n\t\tif (mixId){\n\t\t\tparams.params['mixId'] = mixId;\n\t\t}\n\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t/**\n\t * 离开某个房间\n\t * @param roomId 房间号\n\t * @param tableId 桌号\n\t * @param seatId 坐位号\n\t * @param mixId 混房号\n\t */\n\tgetRoomLeave: function(roomId,tableId,seatId,mixId,_mixedRoomId) {\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.CMD_ROOM_LEAVE,\n\t\t\t'params': {\n\t\t\t\t'gameId' : ty.SystemInfo.gameId,\n\t\t\t\t'roomId': roomId\n\t\t\t}\n\t\t};\n\n\t\tif (tableId) {\n\t\t\tparams.params['tableId'] = tableId;\n\t\t}\n\n\t\tif (seatId) {\n\t\t\tparams.params['seatId'] = seatId;\n\t\t}\n\n\t\tif (mixId){\n\t\t\tparams.params['mixId'] = mixId;\n\t\t}\n\n\t\tif (_mixedRoomId){\n\t\t\tparams.params['mixedRoomId'] = _mixedRoomId;\n\t\t}\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t//param是一个map数组\n\t//所有的cmd都是table_call，不懂如何传参，详情请看unitTest.js的testOnClassicTableReady函数\n\tgetTableCall: function(action, param) {\n\t\tvar subparams = {\n\t\t\t'action': action,\n\t\t\t'gameId' : ty.SystemInfo.gameId\n\t\t};\n\n\t\tfor (var key in param) {\n\t\t\tsubparams[key] = param[key];\n\t\t}\n\t\t\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.CMD_TABLE_CALL,\n\t\t\t'params': subparams\n\t\t};\n\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\tgetReady: function (roomId, tableId, seatId) {\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.CMD_TABLE_CALL,\n\t\t\t'params': {\n\t\t\t\t'action': ddz.EventType.ACTION_READY,\n\t\t\t\t'gameId': ddz.GameId,\n\t\t\t\t'roomId' : roomId,\n\t\t\t\t'tableId': tableId,\n\t\t\t\t'seatId' : seatId\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t// 获取记牌器\n\tgetCradNote: function (roomId, tableId, seatId) {\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.CMD_TABLE_CALL,\n\t\t\t'params': {\n\t\t\t\t'action': \"newCardNote\",\n\t\t\t\t'gameId': ddz.GameId,\n\t\t\t\t'roomId' : roomId,\n\t\t\t\t'tableId': tableId,\n\t\t\t\t'seatId' : seatId\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\ttoComplain: function(roomId, tableId, otherPlayerId1, otherPlayerId2, gameNum) {\n\t\tvar cmd = {\n\t\t\t'cmd': ddz.EventType.CMD_COMPLAIN,\n\t\t\tparams: {\n\t\t\t\t'action': \"complain\",\n\t\t\t\t'roomId': roomId,\n\t\t\t\t'tableId': tableId,\n\t\t\t\t'otherPlayerId1': otherPlayerId1,\n\t\t\t\t'otherPlayerId2': otherPlayerId2,\n\t\t\t\t'gameNum': gameNum\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(cmd);\n\t},\n\n\t//发送互动表情\n\tsendTableChat: function(roomId, tableId, from, to, emoTag, send10) {\n\t\t// if (isFace) {\n\t\t// \t//兼容老版本\n\t\t// \tmsg = \"expression\" + msg + \".png\";\n\t\t// \thall.LOGD(this._TAG, \"chat msg is = \" + msg);\n\t\t// }\n\t\t// ['bomb', \"diamond\", \"egg\", \"flower\", \"brick\"]\n\t\tvar params = {\n\t\t\t'cmd': \"table\",\n\t\t\t'params': {\n\t\t\t\t'action': \"smilies\",\n\t\t\t\t'roomId': roomId,\n\t\t\t\t'tableId': tableId,\n\t\t\t\t'seatId': from,\n\t\t\t\t\"smilies\":emoTag,\n\t\t\t\t'toseat': to,\n\t\t\t\t'gameId' : ty.SystemInfo.gameId,\n\t\t\t\t'number': send10 ? 1 : 1\n\t\t\t}\n\t\t};\n\n\t\tddz.LOGD(null, \"sendTableChat params = \" + JSON.stringify(params));\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\t/**\n\t * 完成玩几局任务请求获取奖励\n\t */\n\tgetTboxReward: function(roomId) {\n\t\tvar params = {\n\t\t\t'cmd': ddz.EventType.CMD_DIZHU,\n\t\t\t'params': {\n\t\t\t\t'action': \"tbox_getReward\",\n\t\t\t\t'gameId': ty.SystemInfo.gameId,\n\t\t\t\t'roomId': roomId,\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t/**\n\t * 保存比赛进程\n     */\n\tsaveMatch:function () {\n\t\tvar waitInfo = ddz.matchModel.getCurWaitInfo();\n\t\tif (!waitInfo){\n\t\t\tif(ddz.friendModel.isEnterTable){\n\t\t\t\tddz.friendModel.enterFTTable(ddz.Share.shareKeywordReplace.inviteFriendID);\n\t\t\t}\n\t\t\thall.LOGW(null, \"当前没有wait信息,无需保存!\");\n\t\t\treturn;\n\t\t}\n\t\tif(waitInfo.state != 2 && waitInfo.state != 4){\n\t\t\tddz.friendModel.isEnterTable = false;\n\t\t\thall.MsgBoxManager.showToast({title:\"当前在比赛中,不可进入好友桌\"});\n\t\t\t// hall.LOGW(null, \"当前在比赛中,不可进入好友桌\");\n\t\t\treturn;\n\t\t}\n\t\tvar roomId = waitInfo.roomId;\n\t\tvar params = {\n\t\t\t\"cmd\":ddz.EventType.CMD_ROOM,\n\t\t\t\"params\":{\n\t\t\t\t\"action\": ddz.EventType.ACTION_SAVE,\n\t\t\t\t\"gameId\": ty.SystemInfo.gameId,\n\t\t\t\t\"roomId\" : roomId\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t/**\n\t * 恢复比赛\n     */\n\tresumeMatch:function () {\n\t\tvar roomId;\n\t\tvar records = ddz.gameModel.getCurMatchRecords();\n\t\tif (records && records.length > 0){\n\t\t\troomId = records[0].roomId;\n\t\t}\n\t\tvar params = {\n\t\t\t\"cmd\":ddz.EventType.CMD_ROOM,\n\t\t\t\"params\":{\n\t\t\t\t\"action\": ddz.EventType.ACTION_RESUME,\n\t\t\t\t\"gameId\": ty.SystemInfo.gameId,\n\t\t\t\t\"roomId\": roomId\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t/**\n\t * 请求被保存的比赛记录\n\t */\n\tgetMatchRecords:function () {\n\t\tvar params = {\n\t\t\t\"cmd\":ddz.EventType.MSG_GAME,\n\t\t\t\"params\":{\n\t\t\t\t\"action\": ddz.EventType.ACTION_RECORDS,\n\t\t\t\t\"gameId\": ty.SystemInfo.gameId\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t},\n\n\t/**\n\t * 获奖后通知通过公众号通知好友\n\t * @param friendIds 好友的UID\n\t * @param moneyVal 得了多少钱\n\t * @param msgType 消息类型， hero 代表闯关成功消息， arena 代表比赛第一消息\n     */\n\tsendRewardMsgToFriends:function (friendIds, moneyVal, msgType) {\n\t\tif(!friendIds) {\n\t\t\treturn\n\t\t}\n\t\tvar params = {\n\t\t\t\"cmd\":ddz.EventType.CMD_DIZHU,\n\t\t\t\"params\":{\n\t\t\t\t\"action\": 'wx_public_msg',\n\t\t\t\t\"gameId\": ty.SystemInfo.gameId,\n\t\t\t\t\"friendIds\" : friendIds,\n\t\t\t\t// \"friendIds\" : [382886,15389],\n\t\t\t\t\"msgType\" : msgType,\n\t\t\t\t\"data\": {'money' : moneyVal, 'name': ty.UserInfo.userName}     // 额外参数，字典类型 {'money':1.45}\n\t\t\t}\n\t\t};\n\t\thall.MsgFactory._sendCmd(params);\n\t}\n};"]}