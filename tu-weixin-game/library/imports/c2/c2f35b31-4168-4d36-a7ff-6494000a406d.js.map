{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/component/assets/Script/ComponentScript/component/ddz_item_shareMoments.js"],"names":["cc","Class","extends","Component","properties","backButton","default","type","Button","backSprite","Sprite","texture","Texture2D","spriteFrame","SpriteFrame","shareButton","ShowySaveButton","ShowyShareButton","loadingNode","Node","backImageUrl","shareBackImageUrl","baseUrl","exWidth","exHeight","windowHeight","shareType","layoutData","bottomType","cardInfoArray","backAction","node","destroy","onLoad","backButtonH","ddz","GlobalFuncs","getBackButtonPositionY","y","wx","env","USER_DATA_PATH","winSize","director","getWinSize","height","width","hall","adManager","destroyWidthBannerAd","setShareImageType","data","active","ty","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeShowWindow","momentsConfig","gameModel","shareMoments","Share","typeConfigList","typeNumberString","ReadStringFromLocalStorage","SHARE_MOMENTS_NUMBER","countDic","JSON","parse","count","length","setInLocalStorage","stringify","tempBackUrl","replace","backUrl","SystemInfo","cdnPath","changeBackSprite","number","chips","counts","multi","setTitleImage","percent","shareKeywordReplace","goldWinReward","surpassPercent","tempCanvas","createCanvas","context","getContext","image","createImage","src","that","onload","event","img","target","drawImage","initWithElement","handleLoadedTexture","_refreshTexture","showySaveToPhone","clickStatEventTypeButtonClick","saveToPhoneAddQRAndAvatar","showyShareToFriend","shareWithType","onShareType","clickStatShareTypeGoldHighPower","clickStatShareTypeGoldSpring","clickStatShareTypeGoldWinStreak","clickStatShareTypeGoldHighTotal","saveToPhone","pers","font","fillStyle","textAlign","word","formatGold","stokeWord","fillText","tempFilePath","toTempFilePathSync","x","destWidth","destHeight","setCardsInformation","addCardsWithImage","cardNumbers","cardNow","originX","originY","gapX","gapY","breakLine","originWidth","originHeight","exX","addCards","imageUrlList","toX","toY","toWidth","toHeight","sunEvent","colorU","sunImage","subImg","cardCallBack","i","cardIn","imageList","numberUrl","colorUrl","push","LOGW","bottomHeight","qrX","qrCenterX","qrY","qrCenterY","qrR","qrRadius","r","avatarRadius","bottomUrl","seImage","beginPath","arc","Math","PI","clip","local_uuid","getLocalUuid","sdkPath","loginUrl","pars","appId","wxAppId","clientId","imei","uuid","b64","scene","userId","LOGD","request","url","header","method","success","params","b64Str","result","fs","getFileSystemManager","filePath","writeFile","encoding","qrImage","stroke","avatarPic","saveImageToPhoneWithUrl","userPic","onerror","arguments","fail","complete","saveImageToPhone","saveImageToPhotosAlbum","res","showNormalTipsWindow","title","callFunc","getSetting","authSetting","authorize","scope","MsgBoxManager","showToast","Timer","setTimer","openSetting","saveCardsString","ORIGINCARDS","saveCardsDic","cards","myCards","cardNumber","cardInfo","CardInfo","refreshInfoFromNum","_point","colorType","_color","numberType","sort","SortCardFuncForInfo","getQRImage","writeFileSync"],"mappings":"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","file":"ddz_item_shareMoments.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        backButton : {\n            default : null,\n            type : cc.Button\n        },\n        backSprite : {\n            default : null,\n            type : cc.Sprite\n        },\n        texture:cc.Texture2D,\n        spriteFrame:{\n            default : null,\n            type : cc.SpriteFrame\n        },\n        shareButton : {\n            default : null,\n            type : cc.Button\n        },\n        ShowySaveButton : {\n            default : null,\n            type : cc.Button\n        },\n        ShowyShareButton : {\n            default : null,\n            type : cc.Button\n        },\n        loadingNode : {\n            default : null,\n            type : cc.Node\n        },\n\n        backImageUrl : \"\",\n        shareBackImageUrl : \"\",\n        baseUrl : \"\",\n        exWidth : 0,\n        exHeight : 0,\n        windowHeight : 1136,\n        shareType : \"\",\n        // showData : {},\n        layoutData : {},\n        bottomType : {},\n        cardInfoArray : []\n        // QRImageUrl : \"\"\n    },\n\n    backAction : function () {\n      this.node.destroy();\n    },\n\n    onLoad : function () {\n        var backButtonH = ddz.GlobalFuncs.getBackButtonPositionY();\n        if (backButtonH){\n            this.backButton.node.y = backButtonH;\n        }\n\n        this.baseUrl = wx.env.USER_DATA_PATH + \"/res/raw-assets/resources/table/\";\n        var winSize = cc.director.getWinSize();\n        if(winSize.height/1136 > winSize.width/640){\n            this.exWidth = ((winSize.height*640/1136)-640)/2;\n            this.exHeight = (winSize.height-1136)/2;\n            this.windowHeight = winSize.height;\n        }\n        hall.adManager.destroyWidthBannerAd();\n    },\n\n    //type:\n    //invite\n    // showy_highPower\n    // showy_hughTotal//showy_highTotal\n    // showy_spring\n    // showy_winningStreak\n    setShareImageType : function (type,data) {\n        this.loadingNode.active = true;\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShowWindow, [type]);\n        this.shareType = type;\n        // this.showData = data;\n\n        //取对应数值\n        this.layoutData = {};\n        var momentsConfig = ddz.gameModel.shareMoments;\n        if(!momentsConfig){\n            momentsConfig = ddz.Share.shareMoments;\n        }\n        var typeConfigList = momentsConfig[type];\n        var bottomType = momentsConfig.bottomType;\n\n        var typeNumberString = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.gameModel.SHARE_MOMENTS_NUMBER, \"\");\n        var countDic = {};\n        if(typeNumberString != \"\"){\n            countDic = JSON.parse(typeNumberString);\n        }\n        var count = 0;\n        if(countDic[type] || countDic[type] == 0){\n            count = countDic[type];\n            count ++;\n            if(count >= typeConfigList.length){\n                count = 0;\n            }\n        }\n        countDic[type] = count;\n        this.layoutData = typeConfigList[count];\n        hall.GlobalFuncs.setInLocalStorage(ddz.gameModel.SHARE_MOMENTS_NUMBER, JSON.stringify(countDic));\n        this.bottomType = bottomType[this.layoutData.bottomType];\n\n        var tempBackUrl =  this.baseUrl+\"shareBackImage/share_moments_invite.jpg\";\n        this.backImageUrl = tempBackUrl.replace(\"invite\",type);\n        // var tempBackUrl;\n        if(this.layoutData && this.layoutData.backUrl){\n            tempBackUrl = ty.SystemInfo.cdnPath + this.layoutData.backUrl;\n            this.backImageUrl = tempBackUrl;\n        }\n\n\n        this.shareBackImageUrl = this.backImageUrl;\n        if(type == \"invite\"){\n            // var index = hall.GlobalFuncs.getRandomNumberBefore(4);\n            // this.backImageUrl =  this.baseUrl+\"shareBackImage/share_moments_invite\"+index+\".jpg\";\n            this.changeBackSprite(this.backImageUrl);\n        }else {\n            this.shareButton.node.active = false;\n            this.ShowySaveButton.node.active = true;\n            this.ShowyShareButton.node.active = true;\n            var number = type == \"showy_highTotal\" ? data.chips : type == \"showy_winningStreak\" ?  data.counts : data.multi;\n            this.setTitleImage(number,data.percent);\n            // var number = type == \"showy_highTotal\"? 9625000 : 1024;\n            // this.setTitleImage(number,99);\n\n            ddz.Share.shareKeywordReplace.goldWinReward = number;\n            ddz.Share.shareKeywordReplace.surpassPercent = data.percent;\n        }\n    },\n\n    changeBackSprite : function (backUrl) {\n        this.shareBackImageUrl = backUrl;\n        var tempCanvas = wx.createCanvas();\n        tempCanvas.width = 640;\n        tempCanvas.height = this.windowHeight;\n        var context = tempCanvas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = backUrl;\n        var that = this;\n        image.onload = function (event) {\n            var img = event.target;\n            if(that.shareType == \"invite\"){\n                context.drawImage(img,-that.exWidth,0,640+that.exWidth*2,that.windowHeight);\n            }else {\n                context.drawImage(img,0,0,640,that.windowHeight);\n            }\n            that.texture = new cc.Texture2D();\n            that.spriteFrame = new cc.SpriteFrame(that.texture);\n            that.texture.initWithElement(tempCanvas);\n            that.texture.handleLoadedTexture();\n            that.backSprite.spriteFrame = that.spriteFrame;\n            that.backSprite.spriteFrame._refreshTexture(that.texture);\n            that.backSprite.node.height = that.windowHeight;\n            that.loadingNode.active = false;\n        };\n    },\n\n    showySaveToPhone : function () {\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeButtonClick, [\"saveToPhone\",this.shareType]);\n        this.saveToPhoneAddQRAndAvatar(this.shareBackImageUrl);\n    },\n\n    showyShareToFriend : function () {\n        switch (this.shareType){\n            case \"showy_highPower\":\n                ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeGoldHighPower);\n                break;\n            case \"showy_spring\":\n                ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeGoldSpring);\n                break;\n            case \"showy_winningStreak\":\n                ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeGoldWinStreak);\n                break;\n            case \"showy_highTotal\":\n                ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeGoldHighTotal);\n                break;\n            default:break;\n        }\n    },\n\n    //邀请好友保存到手机分享\n    saveToPhone : function () {\n        this.saveToPhoneAddQRAndAvatar(this.shareBackImageUrl);\n        // this.setTitleImage(125,\"94%\",\"showy_winningStreak\");\n    },\n    //添加宣传标题\n    setTitleImage : function (number,pers) {\n        var tempCanvas = wx.createCanvas();\n        tempCanvas.width = 640;\n        tempCanvas.height = this.windowHeight;\n        var context = tempCanvas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = this.backImageUrl;\n        var that = this;\n        image.onload = function (event) {\n            var img = event.target;\n            context.drawImage(img,-that.exWidth,0,640+that.exWidth*2,that.windowHeight);\n\n            context.font = \"bold 92px arial\";\n            // var grd=context.createLinearGradient(0,0,0,88);\n            // grd.addColorStop(0,\"#f1fffe\");\n            // grd.addColorStop(0.64,\"#f1fffe\");\n            // grd.addColorStop(0.66,\"#bafffb\");\n            // grd.addColorStop(1,\"#bafffb\");\n            // context.fillStyle=grd;\n            context.fillStyle=\"#FFFFFF\";\n            context.textAlign = \"center\";\n            var word = that.shareType == \"showy_highTotal\" ? \"总奖金\"+hall.GlobalFuncs.formatGold(number) :\n                that.shareType == \"showy_winningStreak\" ? \"连胜\" : \"倍\";\n            var stokeWord = that.shareType == \"showy_highTotal\" ? word : \"打出\"+ number+word;\n            // context.fillText(stokeWord,320,88+that.exHeight+55);\n            context.fillText(stokeWord,320,143);\n\n            context.font = \"50px Arial\";\n            // context.fillStyle = \"#FFFFFF\";\n            // context.textAlign = \"center\";\n            // context.fillText(\"超越全国\"+pers+\"%玩家\",320,173+that.exHeight+55);\n            context.fillText(\"超越全国\"+pers+\"%玩家\",320,228);\n            var tempFilePath = tempCanvas.toTempFilePathSync({\n                x: 0,\n                y: 0,\n                width: 640,\n                height:that.windowHeight,\n                destWidth: 640,\n                destHeight:that.windowHeight\n\n            });\n            that.setCardsInformation(tempFilePath);\n        };\n    },\n    //添加手牌\n    addCardsWithImage : function (backImageUrl) {\n        var tempCanvas = wx.createCanvas();\n        tempCanvas.width = 640;\n        tempCanvas.height = this.windowHeight;\n        var context = tempCanvas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = backImageUrl;\n        var that = this;\n        image.onload = function (event) {\n            var img = event.target;\n            // context.drawImage(img, 0, 0, 640, 1136);\n            context.drawImage(img,0,0,640,that.windowHeight);\n\n            var cardNumbers = that.cardInfoArray.length;\n            // var cardNumbers = 17;\n            var cardNow = 0;\n\n            var originX = 34;\n            var originY = 656+that.exHeight*2;\n            var gapX = 46;\n            var gapY = 94;\n            var breakLine = 10;\n            var originWidth = [116,34.5,26,72,74,26];\n            var originHeight = [168,36,26,72,62,79.5];\n            var exX = 0;\n            if(cardNumbers == 17){\n                gapX = 49;\n                breakLine = 9;\n                exX = gapX/2;\n            }\n\n            var addCards = function (imageUrlList,toX,toY) {\n                var image = wx.createImage();\n                image.toX = toX;\n                image.toY = toY;\n                image.toWidth = originWidth[0];\n                image.toHeight = originHeight[0];\n                image.onload = function (sunEvent) {\n                    var img = sunEvent.target;\n                    context.drawImage(img, img.toX,  img.toY, img.toWidth, img.toHeight);\n                    var colorU = imageUrlList[2];\n                    if(colorU == \"\"){\n                        var sunImage = wx.createImage();\n                        sunImage.toX =  toX+8;\n                        sunImage.toY =  toY+8;\n                        sunImage.toWidth = originWidth[5];\n                        sunImage.toHeight = originHeight[5];\n                        sunImage.onload = function (event) {\n                            var subImg = event.target;\n                            context.drawImage(subImg, subImg.toX, subImg.toY, subImg.toWidth, subImg.toHeight);\n                            cardCallBack();\n                        };\n                        sunImage.src = imageUrlList[1];\n                    }else {\n                        var number = 0;\n                        for (var i = 1 ; i < imageUrlList.length ; i ++ ){\n                            var sunImage = wx.createImage();\n                            sunImage.toX = i == 1 ? toX+8 : i == 2 ? toX+14 : i == 3 ? toX+36 : toX+42;\n                            sunImage.toY = i == 1 ? toY+12 : i == 2 ? toY+57 : i == 3 ? toY+84 : toY+0;\n                            sunImage.toWidth = originWidth[i];\n                            sunImage.toHeight = originHeight[i];\n                            sunImage.onload = function (event) {\n                                number ++;\n                                var subImg = event.target;\n                                context.drawImage(subImg, subImg.toX, subImg.toY, subImg.toWidth, subImg.toHeight);\n                                if (number == imageUrlList.length-1){\n                                    cardCallBack();\n                                }\n                            };\n                            sunImage.src = imageUrlList[i];\n                        }\n                    }\n                };\n                // image.src = \"res/raw-assets/resources/table/ddz_poker/ddz_card_fore_back.png\";\n                image.src = imageUrlList[0];\n            };\n            var cardCallBack = function () {\n                cardNow ++;\n                if(cardNow < cardNumbers){\n                    var toY = cardNow > breakLine ? originY+gapY : originY;\n                    var toX = cardNow > breakLine ? originX+gapX*(cardNow-breakLine)+exX : originX+gapX*cardNow;\n                    // addCards(\"res/raw-assets/resources/table/ddz_poker/ddz_card_fore_back.png\",toX,toY);\n                    var cardIn = that.cardInfoArray[cardNow];\n                    var imageList = [that.baseUrl+\"ddz_poker/ddz_card_fore_back.png\",\n                        cardIn.numberUrl,\n                        cardIn.colorUrl];\n                    if (cardNow == breakLine || cardNow == cardNumbers-1){\n                        imageList.push(cardIn.colorUrl);\n                        if(cardNumbers == 20){\n                            imageList.push(that.baseUrl+\"ddz_poker/ddz_dizhutag.png\");\n                        }\n                    }\n                    addCards(imageList,toX,toY);\n\n                }else {\n                    var tempFilePath = tempCanvas.toTempFilePathSync({\n                        x: 0,\n                        y: 0,\n                        width: 640,\n                        height:that.windowHeight,\n                        destWidth: 640,\n                        destHeight:that.windowHeight\n\n                        // x: 0,\n                        // y: 0,\n                        // width: 640,\n                        // height:1136,\n                        // destWidth: 640,\n                        // destHeight: 1136\n                    });\n                    that.changeBackSprite(tempFilePath);\n                    // that.saveToPhoneAddQRAndAvatar(tempFilePath);\n                    hall.LOGW(\"========\",\"===============\"+tempFilePath);\n                }\n            };\n\n            var cardIn = that.cardInfoArray[0];\n            addCards([that.baseUrl+\"ddz_poker/ddz_card_fore_back.png\",\n                cardIn.numberUrl,\n                cardIn.colorUrl],originX,originY);\n        };\n    },\n    //添加微信二维码和个人头像\n    saveToPhoneAddQRAndAvatar : function (shareBackImageUrl) {\n        var bottomHeight = this.bottomType.bottomHeight || 182;\n        var qrX = this.bottomType.qrCenterX || 530 ;\n        var qrY = this.bottomType.qrCenterY || 1028;\n        var qrR = this.bottomType.qrRadius || 72;\n        var r = this.bottomType.avatarRadius || 32;\n        // var bottomHeight = 182;\n        // var qrX = 530 ;\n        // var qrY =  1028;\n        // var qrR =  72;\n        // var r = 32;\n        var tempBackUrl;\n        if(this.bottomType && this.bottomType.bottomUrl){\n            tempBackUrl = ty.SystemInfo.cdnPath+this.bottomType.bottomUrl ;\n        }else {\n            tempBackUrl = wx.env.USER_DATA_PATH +  \"/res/raw-assets/resources/table/shareBackImage/shareTo_moments_bottom.jpg\";\n        }\n        var tempCanvas = wx.createCanvas();\n        tempCanvas.width = 640;\n        tempCanvas.height = this.windowHeight;\n        var context = tempCanvas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = shareBackImageUrl;\n        var that = this;\n        image.onload = function (event) {\n            var img = event.target;\n            if(that.shareType == \"invite\"){\n                context.drawImage(img,-that.exWidth,0,640+that.exWidth*2,that.windowHeight);\n                // tempBackUrl = wx.env.USER_DATA_PATH +  \"/res/raw-assets/resources/table/shareBackImage/shareTo_moments_bottom2.png\";\n                // bottomHeight = 254;\n                // qrX = 508;\n                // qrY = 987;\n                // qrR = 87;\n                // r = 39;\n            }else {\n                context.drawImage(img,0,0,640,that.windowHeight);\n            }\n            //添加白色底图\n            var seImage = wx.createImage();\n            seImage.src = tempBackUrl;\n            seImage.onload = function (event) {\n                var img = event.target;\n                context.drawImage(img,0,1136-bottomHeight+that.exHeight*2,640,bottomHeight);\n                context.beginPath();\n                context.arc(qrX,qrY+that.exHeight*2,qrR+5,0,2*Math.PI);\n                // context.stroke();\n                context.clip();\n                var local_uuid = hall.GlobalFuncs.getLocalUuid();\n                var sdkPath = ty.SystemInfo.loginUrl;\n                var pars = {\n                    appId: ty.SystemInfo.appId,\n                    wxAppId: ty.SystemInfo.wxAppId,\n                    clientId: ty.SystemInfo.clientId,\n                    imei: 'null',\n                    uuid : local_uuid,\n                    width : 280,\n                    b64 : true,\n                    scene : '1,' + ty.UserInfo.userId\n                };\n                hall.LOGD(null, 'qrcode,params:' + JSON.stringify(pars));\n                wx.request({\n                    url: sdkPath + 'open/v6/user/Getwxacodeunlimit',\n                    header: {\n                        'content-type': 'application/x-www-form-urlencoded'\n                    },\n                    data: pars,\n                    method:'POST',\n                    success: function(params) {\n                        // hall.LOGW(\"===\",\"=========\"+JSON.stringify(params));\n                        var b64Str =  params.data.result.img;\n                        var fs = wx.getFileSystemManager();\n                        var filePath = wx.env.USER_DATA_PATH + '/qr.png';\n                        // fs.writeFileSync(filePath ,b64Str , 'base64');\n                        fs.writeFile({\n                            filePath : filePath,\n                            data : b64Str,\n                            encoding : 'base64',\n                            success : function () {\n                                var qrImage = wx.createImage();\n                                qrImage.onload = function (event) {\n                                    var img = event.target;\n                                    context.drawImage(img,qrX-qrR,qrY-qrR+that.exHeight*2,qrR*2,qrR*2);\n                                    context.beginPath();\n                                    context.arc(qrX,qrY+that.exHeight*2,r,0,2*Math.PI);\n                                    context.stroke();\n                                    context.clip();\n                                    var avatarPic = wx.createImage();\n                                    avatarPic.onload = function (event) {\n                                        var img = event.target;\n                                        context.drawImage(img,qrX-r,qrY-r+that.exHeight*2,r*2,r*2);\n                                        var tempFilePath = tempCanvas.toTempFilePathSync({\n                                            x: 0,\n                                            y: 0,\n                                            width: 640,\n                                            height:that.windowHeight,\n                                            destWidth: 640,\n                                            destHeight: that.windowHeight\n                                        });\n                                        hall.LOGW(\"========\",\"===============\"+tempFilePath);\n                                        that.saveImageToPhoneWithUrl(tempFilePath);\n                                    };\n                                    avatarPic.src = ty.UserInfo.userPic;\n                                };\n                                qrImage.onerror = function (event) {\n                                    hall.LOGW(\"========\",\"========qrImage.onerror=======\"+JSON.stringify(arguments));\n                                };\n                                qrImage.src = filePath;\n                            },\n                            fail: function(params) {\n                            },\n                            complete: function(params) {\n                            }\n                        });},\n                    fail: function(params) {\n                    },\n                    complete: function(params) {\n                    }\n                });\n            };\n        };\n    },\n    //保存到相册\n    saveImageToPhoneWithUrl : function (tempFilePath) {\n        var that = this;\n        var saveImageToPhone = function () {\n            wx.saveImageToPhotosAlbum({\n                filePath : tempFilePath,\n                success:function(res) {\n                    ddz.GlobalFuncs.showNormalTipsWindow(\"图片已保存到手机相册\\n快去朋友圈分享吧\",[{title:\"确定\",callFunc:function () {\n                        if(that.shareType == \"invite\"){\n                            that.node.destroy();\n                        }\n                    }}]);\n                    hall.LOGW(\"========\",\"=======success========\"+JSON.stringify(res));\n                },\n                fail: function(params) {\n                    hall.LOGW(\"========\",\"=======fail========\"+JSON.stringify(params));\n                },\n                complete: function(params) {\n                }\n            });\n        };\n        wx.getSetting({\n            success:function(res) {\n                if (!res.authSetting['scope.writePhotosAlbum']) {\n                    wx.authorize({\n                        scope : \"scope.writePhotosAlbum\",\n                        success : function () {\n                            saveImageToPhone();\n                        },\n                        fail:function () {\n                            hall.MsgBoxManager.showToast({title : '授权失败,相册功能不可用,请手动进行授权!'});\n                            ty.Timer.setTimer(cc.director, function () {\n                                wx.openSetting();\n                            }, 2, 0);\n                        },\n                        complete:function () {\n                        }\n                    });\n                }\n                else{\n                    saveImageToPhone();\n                }\n            }\n        });\n    },\n\n    setCardsInformation : function (backImageUrl) {\n        var saveCardsString =  hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.gameModel.ORIGINCARDS, \"{}\");\n        var saveCardsDic = JSON.parse(saveCardsString);\n        var cards = saveCardsDic.myCards;\n        if(!cards || !cards.length || cards.length < 17){\n            //TODO: 测试\n            cards = [52,6,19,8,21,0,13,51,43,42,37,29,25,24,49,23,2,39,15,53];\n        }\n        // cards = [52,6,19,8,21,0,13,51,43,42,37,29,25,24,49,23,2,39,15,53];\n        var cardInfoArray = [];\n        if(cards && cards.length && cards.length != 0){\n            // var sortedCards =  cards.sort(ddz.GlobalFuncs.SortCardFuncForInfo);\n            for (var number in cards){\n                var cardNumber = cards[number];\n                var cardInfo = new ddz.CardInfo();\n                cardInfo.refreshInfoFromNum(cardNumber);\n                if(cardInfo._point > 12){\n                    cardInfo.colorUrl = \"\";\n                    var colorType = cardInfo._point == 13 ? \"ddz_poker/ddz_s_0001.png\" : \"ddz_poker/ddz_s_0000.png\";\n                    cardInfo.numberUrl = this.baseUrl + colorType;\n                }else {\n                    cardInfo.colorUrl = this.baseUrl +\"ddz_poker/ddz_big_\"+(cardInfo._color-1)+\".png\";\n                    var numberType ;\n                    if (cardInfo._color == 1 || cardInfo._color == 3){\n                        numberType = \"ddz_poker/ddz_b_red_\";\n                    }else {\n                        numberType = \"ddz_poker/ddz_b_black_\";\n                    }\n                    cardInfo.numberUrl = this.baseUrl + numberType + cardInfo._point+\".png\";\n                }\n                cardInfoArray.push(cardInfo);\n            }\n            this.cardInfoArray = cardInfoArray.sort(ddz.GlobalFuncs.SortCardFuncForInfo);\n            this.addCardsWithImage(backImageUrl);\n        }\n    },\n\n    //获取二维码\n    getQRImage : function () {\n        var local_uuid = hall.GlobalFuncs.getLocalUuid();\n        var sdkPath = ty.SystemInfo.loginUrl;\n        var pars = {\n            appId: ty.SystemInfo.appId,\n            wxAppId: ty.SystemInfo.wxAppId,\n            clientId: ty.SystemInfo.clientId,\n            imei: 'null',\n            uuid : local_uuid,\n            width : 280,\n            b64 : true,\n            scene : '1,' + ty.UserInfo.userId\n        };\n        var that = this;\n        // hall.LOGD(null, 'qrcode,params:' + JSON.stringify(pars));\n        wx.request({\n            url: sdkPath + 'open/v6/user/Getwxacodeunlimit',\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: pars,\n            method: 'POST',\n            success: function (params) {\n                // hall.LOGW(\"===\", \"=========\" + JSON.stringify(params));\n                var b64Str = params.data.result.img;\n                var fs = wx.getFileSystemManager();\n                var filePath = wx.env.USER_DATA_PATH + '/qr.png';\n                fs.writeFileSync(filePath, b64Str, 'base64');\n                // that.QRImageUrl = filePath;\n            },\n            fail: function(params) {\n            },\n            complete: function(params) {\n            }\n        });\n    }\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    // start () {\n    //\n    // },\n\n    // update (dt) {},\n});\n"]}