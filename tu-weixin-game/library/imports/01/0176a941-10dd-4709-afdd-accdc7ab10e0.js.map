{"version":3,"sources":["../../../../../../assets/Script/hall/utils/assets/Script/hall/utils/BuyCenter.js"],"names":["cc","Class","ctor","_TAG","hall","LOGD","ty","NotificationCenter","listen","ddz","EventType","UPDATE_PAY_FAIL","onBuyFailed","UPDATE_PAY_SUCCESS","onBuySuccess","UPDATE_PAY_CANCEL","onBuyCancel","destroy","ignore","_onBuyCoinFailed","LOGW","_onBuyCoinSuccess","params","result","JSON","stringify","trigger","CONVERSION_SUCCESS","tips","str","GlobalFuncs","playShareZuanShi","param","BUY_MSG_BACK","h5","globalFunc","removeLoadingLayer","ToastLayer","create","runPayOrder","productId","productName","count","price","buyType","MainInterface","payDiamond","GameId","consumeDiamond","buyCoinDirect","runPayOrderByParam"],"mappings":"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","file":"BuyCenter.js","sourceRoot":"../../../../../../assets/Script/hall/utils","sourcesContent":["\ncc.Class({\n\n    ctor: function () {\n        this._TAG = 'hall.BuyCenter';\n        hall.LOGD(this._TAG, \" in ctor\");\n\n        // 注册支付回调\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_PAY_FAIL, this.onBuyFailed, this);\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_PAY_SUCCESS, this.onBuySuccess, this);\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_PAY_CANCEL, this.onBuyCancel, this);\n\n        // ty.NotificationCenter.listen(ty.EventType.MSG_BUY_COIN_FAIL, this._onBuyCoinFailed, this);\n        // ty.NotificationCenter.listen(ty.EventType.MSG_BUY_COIN_SUCCESS, this._onBuyCoinSuccess, this);\n    },\n\n    // 默认的析构函数\n    destroy: function () {\n\n        hall.LOGD(this._TAG, \" destroy\");\n        ty.NotificationCenter.ignore(ddz.EventType.UPDATE_PAY_FAIL, this.onBuyFailed, this);\n        ty.NotificationCenter.ignore(ddz.EventType.UPDATE_PAY_SUCCESS, this.onBuySuccess, this);\n        ty.NotificationCenter.ignore(ddz.EventType.UPDATE_PAY_CANCEL, this.onBuyCancel, this);\n\n        // ty.NotificationCenter.ignore(ty.EventType.MSG_BUY_COIN_FAIL, this._onBuyCoinFailed, this);\n        // ty.NotificationCenter.ignore(ty.EventType.MSG_BUY_COIN_SUCCESS, this._onBuyCoinSuccess, this);\n    },\n\n    _onBuyCoinFailed: function () {\n        hall.LOGW(this._TAG, \"buy coin failed from server........\");\n        //test\n        // hall.gameWorld.firstChargeItem = null;\n        // ty.NotificationCenter.trigger(hall.EventType.HALL_FIRSTCHARGE);\n        this.onBuyFailed();\n    },\n\n    _onBuyCoinSuccess: function () {\n        hall.LOGD(this._TAG, \"buy coin success from server........\");\n    },\n\n    /**\n     * 购买成功回调\n     * @param param\n     */\n    onBuySuccess: function (params) {\n        // this.isDoOrder = false;\n        // ty.NotificationCenter.trigger(ddz.EventType.BUY_MSG_BACK);\n        // if (typeof(params[0]) != 'undefined' && typeof(params[0][\"result\"]) != 'undefined') {\n        //     var result = params[0][\"result\"];\n        //     var tipstr = \"你购买的\" + result[\"prodName\"] + \"已经到账\";\n        //     var config = {\n        //         \"bgColor\": cc.color.BLACK,\n        //         \"isCenter\": true\n        //     };\n        //     h5.ToastLayer.create(tipstr, config);\n        // }\n        // hall.gameWorld.firstChargeItem = null;\n        // ty.NotificationCenter.trigger(hall.EventType.HALL_FIRSTCHARGE);\n        // // 从服务器获取最新的UserInfo\n        // hall.MsgFactory.getUserInfo(hall.AccountInfo.userID, hall.AccountInfo.authorCode, ddz.GameId, hall.AccountInfo.clientId);\n\n        var result = params[\"result\"];\n        hall.LOGW(\"\",\"file = [ByCenter] fun = [onBuySuccess] result = \" + JSON.stringify(result));\n        ty.NotificationCenter.trigger(ddz.EventType.CONVERSION_SUCCESS,result[\"prodName\"]);\n        var tips = \"兑换成功\";\n        var str = \"<img src='ddz_coin_white'/><color=#FFFFFF> \" + result[\"prodName\"] + \"</c>\";\n        ddz.GlobalFuncs.playShareZuanShi(result[\"prodName\"],tips,str);\n\n    },\n\n    /**\n     * 购买失败回调\n     * @param param\n     */\n    onBuyFailed: function (param) {\n        //this.isDoOrder = false;\n        //hall.LOGD(this._TAG, 'Buy Failed Product ' - JSON.stringify(this.model.productObj.name));\n        ty.NotificationCenter.trigger(ddz.EventType.BUY_MSG_BACK);\n    },\n\n    /**\n     * 取消购买回调\n     * @param param\n     */\n    onBuyCancel: function (param) {\n        //this.isDoOrder = false;\n        //hall.LOGD(this._TAG, 'Buy Cancel Product ' - JSON.stringify(this.model.productObj.name));\n        h5.globalFunc.removeLoadingLayer();\n        h5.ToastLayer.create(\"取消支付\");\n        ty.NotificationCenter.trigger(ddz.EventType.BUY_MSG_BACK);\n    },\n\n    /**\n     * productId - 商品ID\n     * productName - 商品名称\n     * buyType - 购买方式 charge - 充值；consume - 消费； direct - 直冲\n     * price - 购买方式为charge和direct时，为人民币；consume为钻石\n     * 特殊说明\n     * 1）   购买钻石，price为人民币\n     *       直冲和消费钻石，price为钻石\n     * 2）   钻石换金币，count值有意义，其他时候count为1即可\n     */\n    runPayOrder: function (productId, productName, count, price, buyType) {\n        hall.LOGD(this._TAG, \" run runPayOrder-----------------------ID:\" + productId + \"--ProductName:\" + productName + \"price = \" + price + \" buytype = \" + buyType);\n        if (buyType == \"charge\") {\n            // 购买钻石\n            h5.MainInterface.payDiamond(productId, count, productName, price, ddz.GameId, false);\n        } else if (buyType == \"consume\") {\n            // 消费钻石\n            h5.MainInterface.consumeDiamond(productId, productName, count, price, ddz.GameId);\n        } else if (buyType == \"direct\") {\n            h5.MainInterface.buyCoinDirect(productId, productName, count, price, ddz.GameId);\n        }\n    },\n\n    runPayOrderByParam: function (param) {\n\n        if (typeof(param['productId']) != 'undefined' && param['productId'] != null && typeof(param['productName']) != 'undefined' && param['productName'] != null && typeof(param['count']) != 'undefined' && param['count'] != null && typeof(param['price']) != 'undefined' && param['price'] != null && typeof(param['buyType']) != 'undefined' && param['buyType'] != null) {\n            this.runPayOrder(param['productId'], param['productName'], param['count'], param['price_diamond'], param['buyType']);\n        }\n\n    }\n});"]}