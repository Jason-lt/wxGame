{"version":3,"sources":["../../../../../assets/Script/CommonFrame/assets/Script/CommonFrame/PropagateInterface.js"],"names":["ty","PropagateInterface","getShareConfigInfo","reqObj","timeStamp","Date","getTime","act","time","game_mark","SystemInfo","cloudid","gameId","debugMode","ext_type","signStr","getConfigSignStr","paramStrList","key","push","finalUrl","shareManagerUrl","join","successcb","ret","ddz","gameModel","saveShareConfigFromHttp","retmsg","NotificationCenter","trigger","EventType","GET_SHARE_CONFIG_SUCCESS","failcb","GET_SHARE_CONFIG_FAIL","HttpUtil","httpGet","getSingleShareConfigInfo","shareObj","GET_SHARE_SINGLE_CONFIG_SUCCESS","GET_SHARE_SINGLE_CONFIG_FAIL","getUserFeatureInfo","_url","wx","request","url","success","res","statusCode","GET_USER_FEATURE_SUCCESS","fail","getShareValueConfig","cloud_id","game_id","user_id","hall","LOGE","JSON","stringify","GET_USER_FEATURE_FAIL","sortedKeys","Object","keys","sort","i","length","finalSign","hex_md5"],"mappings":";;;;;;;;AAAA;;;;;AAMAA,GAAGC,kBAAH,GAAwB;AACpB;;;;;;;;;;AAUAC,wBAAoB,4BAASC,MAAT,EAAiB;AACjC,YAAG,QAAOA,MAAP,yCAAOA,MAAP,MAAkB,QAArB,EAA+B;AAC3BA,qBAAS,EAAT;AACH;;AAED,YAAIC,YAAY,IAAIC,IAAJ,GAAWC,OAAX,EAAhB;AACAH,eAAOI,GAAP,GAAa,oBAAb;AACAJ,eAAOK,IAAP,GAAcJ,SAAd;AACAD,eAAOM,SAAP,GAAmBT,GAAGU,UAAH,CAAcC,OAAd,GAAwB,GAAxB,GAA8BX,GAAGU,UAAH,CAAcE,MAA/D;AACA,YAAIC,SAAJ,EAAc;AACVV,mBAAOW,QAAP,GAAkB,MAAlB;AACH;AACD,YAAIC,UAAU,KAAKC,gBAAL,CAAsBb,MAAtB,CAAd;AACA,YAAIc,eAAe,EAAnB;AACA,aAAI,IAAIC,GAAR,IAAef,MAAf,EAAuB;AACnBc,yBAAaE,IAAb,CAAkBD,MAAM,GAAN,GAAYf,OAAOe,GAAP,CAA9B;AACH;AACDD,qBAAaE,IAAb,CAAkB,UAAUJ,OAA5B;AACA,YAAIK,WAAWpB,GAAGU,UAAH,CAAcW,eAAd,GAAgC,GAAhC,GAAsCJ,aAAaK,IAAb,CAAkB,GAAlB,CAArD;AACA,YAAIC,YAAY,SAAZA,SAAY,CAASC,GAAT,EAAc;AAC1BC,gBAAIC,SAAJ,CAAcC,uBAAd,CAAsCH,IAAII,MAA1C;AACA5B,eAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAaC,wBAA3C,EAAqER,GAArE;AACH,SAHD;;AAKA,YAAIS,SAAS,SAATA,MAAS,CAAST,GAAT,EAAc;AACvBxB,eAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAaG,qBAA3C,EAAkEV,GAAlE;AACH,SAFD;AAGAxB,WAAGmC,QAAH,CAAYC,OAAZ,CAAoB,EAAC,OAAMhB,QAAP,EAApB,EAAsCG,SAAtC,EAAiDU,MAAjD;AACH,KAvCmB;;AA0CpB;;;;;;;;;;AAUAI,8BAA0B,kCAASlC,MAAT,EAAiB;AACvC,YAAG,QAAOA,MAAP,yCAAOA,MAAP,MAAkB,QAArB,EAA+B;AAC3BA,qBAAS,EAAT;AACH;;AAED,YAAIC,YAAY,IAAIC,IAAJ,GAAWC,OAAX,EAAhB;AACAH,eAAOI,GAAP,GAAa,oBAAb;AACAJ,eAAOK,IAAP,GAAcJ,SAAd;AACAD,eAAOM,SAAP,GAAmBT,GAAGU,UAAH,CAAcC,OAAd,GAAwB,GAAxB,GAA8BX,GAAGU,UAAH,CAAcE,MAA/D;AACA,YAAIC,SAAJ,EAAc;AACVV,mBAAOW,QAAP,GAAkB,MAAlB;AACH;;AAED,YAAIC,UAAU,KAAKC,gBAAL,CAAsBb,MAAtB,CAAd;AACA,YAAIc,eAAe,EAAnB;AACA,aAAI,IAAIC,GAAR,IAAef,MAAf,EAAuB;AACnBc,yBAAaE,IAAb,CAAkBD,MAAM,GAAN,GAAYf,OAAOe,GAAP,CAA9B;AACH;AACDD,qBAAaE,IAAb,CAAkB,UAAUJ,OAA5B;AACA,YAAIK,WAAWpB,GAAGU,UAAH,CAAcW,eAAd,GAAgC,GAAhC,GAAsCJ,aAAaK,IAAb,CAAkB,GAAlB,CAArD;;AAEA,YAAIC,YAAY,SAAZA,SAAY,CAASC,GAAT,EAAc;AAC1B,gBAAIc,WAAWd,IAAII,MAAnB;AACA,mBAAOU,SAAS,UAAT,CAAP;AACAtC,eAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAaQ,+BAA3C,EAA4ED,QAA5E;AACH,SAJD;;AAMA,YAAIL,SAAS,SAATA,MAAS,CAAST,GAAT,EAAc;AACvBxB,eAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAaS,4BAA3C,EAAyEhB,GAAzE;AACH,SAFD;AAGAxB,WAAGmC,QAAH,CAAYC,OAAZ,CAAoB,EAAC,OAAMhB,QAAP,EAApB,EAAsCG,SAAtC,EAAiDU,MAAjD;AACH,KAnFmB;;AAsFpB;;;;AAIAQ,wBAAoB,8BAAW;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAIC,OAAO,iDAAX;AACAC,WAAGC,OAAH,CAAW;AACPC,iBAAKH,IADE;AAEPI,qBAAS,iBAAUC,GAAV,EAAe;AACpB,oBAAIA,IAAIC,UAAJ,IAAkB,GAAtB,EAA2B;AACvBhD,uBAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAakB,wBAA3C,EAAqEF,GAArE;AACH;AACJ,aANM;AAOPG,kBAAM,cAAUH,GAAV,EAAe;AACjB/C,mBAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAakB,wBAA3C,EAAqEF,GAArE;AACH;AATM,SAAX;AAWH,KA/HmB;;AAiIpB;;AAEAI,yBAAoB,+BAAU;AAC1B,YAAI/C,YAAY,IAAIC,IAAJ,GAAWC,OAAX,EAAhB;AACA;;AAEA,YAAIH,SAAS,EAAb;AACAA,eAAOI,GAAP,GAAa,oBAAb;AACA;AACAJ,eAAOK,IAAP,GAAc,SAAd;AACAL,eAAOiD,QAAP,GAAkBpD,GAAGU,UAAH,CAAcC,OAAhC;AACAR,eAAOkD,OAAP,GAAiBrD,GAAGU,UAAH,CAAcE,MAA/B;AACA;AACAT,eAAOmD,OAAP,GAAiB,KAAjB;AACA,YAAIvC,UAAU,KAAKC,gBAAL,CAAsBb,MAAtB,CAAd;AACAoD,aAAKC,IAAL,CAAU,EAAV,EAAa,qEAAqEC,KAAKC,SAAL,CAAe3C,OAAf,CAAlF;AACA,YAAIE,eAAe,EAAnB;AACA,aAAI,IAAIC,GAAR,IAAef,MAAf,EAAuB;AACnBc,yBAAaE,IAAb,CAAkBD,MAAM,GAAN,GAAYf,OAAOe,GAAP,CAA9B;AACH;AACDD,qBAAaE,IAAb,CAAkB,UAAUJ,OAA5B;AACA,YAAIK,WAAW,8BAA8B,GAA9B,GAAoCH,aAAaK,IAAb,CAAkB,GAAlB,CAAnD;AACA,YAAIC,YAAY,SAAZA,SAAY,CAASC,GAAT,EAAc;AAC1BxB,eAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAakB,wBAA3C,EAAqEzB,GAArE;AACH,SAFD;;AAIA,YAAIS,SAAS,SAATA,MAAS,CAAST,GAAT,EAAc;AACvBxB,eAAG6B,kBAAH,CAAsBC,OAAtB,CAA8B9B,GAAG+B,SAAH,CAAa4B,qBAA3C,EAAkEnC,GAAlE;AACH,SAFD;AAGAxB,WAAGmC,QAAH,CAAYC,OAAZ,CAAoB,EAAC,OAAMhB,QAAP,EAApB,EAAsCG,SAAtC,EAAiDU,MAAjD;AACH,KA/JmB;;AAiKpB;;;;;AAKAjB,sBAAkB,0BAASb,MAAT,EAAiB;AAC/B,YAAIyD,aAAaC,OAAOC,IAAP,CAAY3D,MAAZ,EAAoB4D,IAApB,EAAjB;AACA,YAAIhD,UAAU,EAAd;AACA,aAAI,IAAIiD,IAAE,CAAV,EAAYA,IAAEJ,WAAWK,MAAzB,EAAgCD,GAAhC,EAAoC;AAChC,gBAAI9C,MAAM0C,WAAWI,CAAX,CAAV;AACA,gBAAG9C,OAAO,KAAP,IAAgBA,OAAO,MAA1B,EAAkC;AAC9B;AACH,aAFD,MAEO;AACHH,2BAAWG,MAAM,GAAN,GAAYf,OAAOe,GAAP,CAAvB;AACH;AACJ;AACD,YAAIgD,YAAYX,KAAKY,OAAL,CAAa,0BAA0BpD,OAA1B,GAAoC,mBAAjD,KAAyE,EAAzF;AACA,eAAOmD,SAAP;AACH;AAnLmB,CAAxB","file":"PropagateInterface.js","sourceRoot":"../../../../../assets/Script/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/25.\n * 营销传播智能管理系统对应数据获取接口\n */\n\n\nty.PropagateInterface = {\n    /**\n     * 通过http获取分享相关信息\n     * http://market.touch4.me/?act=api.getShareConfig&time=1421755384&game_mark=richddz&sign=a30ab1292aa5929e7f913ceed795f78c\n     test demo\n     var param = {\n                 share_type:\"hyyq2\",      //获取分享点相关参数,可不传,传则代表获取单个分享点,不传表示获取all\n                 config_id:\"002003003\"    //获取方案对应数据,不论该方案是否已发布,内部测试接口参数,代码发布上线时请删除\n             };\n     tywx.PropagateInterface.getShareConfigInfo(param);\n     */\n    getShareConfigInfo: function(reqObj) {\n        if(typeof(reqObj) != 'object') {\n            reqObj = {};\n        }\n\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getShareConfig';\n        reqObj.time = timeStamp;\n        reqObj.game_mark = ty.SystemInfo.cloudid + \"-\" + ty.SystemInfo.gameId;\n        if (debugMode){\n            reqObj.ext_type = 'test';\n        }\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = ty.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n        var successcb = function(ret) {\n            ddz.gameModel.saveShareConfigFromHttp(ret.retmsg);\n            ty.NotificationCenter.trigger(ty.EventType.GET_SHARE_CONFIG_SUCCESS, ret);\n        };\n\n        var failcb = function(ret) {\n            ty.NotificationCenter.trigger(ty.EventType.GET_SHARE_CONFIG_FAIL, ret);\n        };\n        ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n\n    /**\n     * 通过http获取分享相关信息\n     * http://market.touch4.me/?act=api.getShareConfig&time=1421755384&game_mark=richddz&sign=a30ab1292aa5929e7f913ceed795f78c\n     test demo\n     var param = {\n                 share_type:\"hyyq2\",      //获取分享点相关参数,可不传,传则代表获取单个分享点,不传表示获取all\n                 config_id:\"002003003\"    //获取方案对应数据,不论该方案是否已发布,内部测试接口参数,代码发布上线时请删除\n             };\n     tywx.PropagateInterface.getShareConfigInfo(param);\n     */\n    getSingleShareConfigInfo: function(reqObj) {\n        if(typeof(reqObj) != 'object') {\n            reqObj = {};\n        }\n\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getShareConfig';\n        reqObj.time = timeStamp;\n        reqObj.game_mark = ty.SystemInfo.cloudid + \"-\" + ty.SystemInfo.gameId;\n        if (debugMode){\n            reqObj.ext_type = 'test';\n        }\n\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = ty.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n\n        var successcb = function(ret) {\n            var shareObj = ret.retmsg;\n            delete shareObj['shareExt'];\n            ty.NotificationCenter.trigger(ty.EventType.GET_SHARE_SINGLE_CONFIG_SUCCESS, shareObj);\n        };\n\n        var failcb = function(ret) {\n            ty.NotificationCenter.trigger(ty.EventType.GET_SHARE_SINGLE_CONFIG_FAIL, ret);\n        };\n        ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n\n    /**\n     * 获取用户特征值接口\n     * http://market.touch4.me/?act=api.getUserFeature&cloud_id=24&game_id=6&time=1527235026&user_id=1404248&sign=a2b6938904ac3759fe6404ea8ed49267\n     */\n    getUserFeatureInfo: function() {\n        // var reqObj = {};\n        // var timeStamp = new Date().getTime();\n        // reqObj.act = 'api.getUserFeature';\n        // reqObj.cloud_id = ty.SystemInfo.cloudid;\n        // reqObj.game_id = ty.SystemInfo.gameId;\n        // reqObj.user_id = ty.UserInfo.userId;\n        // reqObj.time = timeStamp;\n        //\n        // var signStr = this.getConfigSignStr(reqObj);\n        // var paramStrList = [];\n        // for(var key in reqObj) {\n        //     paramStrList.push(key + '=' + reqObj[key]);\n        // }\n        // paramStrList.push('sign=' + signStr);\n        // var finalUrl = 'https://analy.ywdier.com/' + '?' + paramStrList.join('&');\n        // var successcb = function(ret) {\n        //     ty.NotificationCenter.trigger(ty.EventType.GET_USER_FEATURE_SUCCESS, ret);\n        // };\n        //\n        // var failcb = function(ret) {\n        //     ty.NotificationCenter.trigger(ty.EventType.GET_USER_FEATURE_FAIL, ret);\n        // };\n        // ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n\n        var _url = 'https://iploc.ywdier.com/api/iploc5/search/city';\n        wx.request({\n            url: _url,\n            success: function (res) {\n                if (res.statusCode == 200) {\n                    ty.NotificationCenter.trigger(ty.EventType.GET_USER_FEATURE_SUCCESS, res);\n                }\n            },\n            fail: function (res) {\n                ty.NotificationCenter.trigger(ty.EventType.GET_USER_FEATURE_SUCCESS, res);\n            }\n        });\n    },\n\n    /*\n    * 获取用户分享价值*/\n    getShareValueConfig:function(){\n        var timeStamp = new Date().getTime();\n        // var _url = \"http://analy.ywdier.com/?act=api.getUserFeature&time=xxx&cloud_id=xxx&game_id=xxx &user_id=xxx &sign=xxx\"\n\n        var reqObj = {};\n        reqObj.act = \"api.getUserFeature\";\n        // reqObj.time = timeStamp\n        reqObj.time = 153248531\n        reqObj.cloud_id = ty.SystemInfo.cloudid;\n        reqObj.game_id = ty.SystemInfo.gameId;\n        // reqObj.user_id = ty.UserInfo.userId;\n        reqObj.user_id = 10003;\n        var signStr = this.getConfigSignStr(reqObj);\n        hall.LOGE(\"\",\"file = [PropagateInterface] fun = [getShareValueConfig] _sign = \" + JSON.stringify(signStr));\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = 'https://analy.ywdier.com/' + '?' + paramStrList.join('&');\n        var successcb = function(ret) {\n            ty.NotificationCenter.trigger(ty.EventType.GET_USER_FEATURE_SUCCESS, ret);\n        };\n\n        var failcb = function(ret) {\n            ty.NotificationCenter.trigger(ty.EventType.GET_USER_FEATURE_FAIL, ret);\n        };\n        ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n    /**\n     * 计算签名字符串\n     * @param reqObj\n     * @returns {string}\n     */\n    getConfigSignStr: function(reqObj) {\n        var sortedKeys = Object.keys(reqObj).sort();\n        var signStr = '';\n        for(var i=0;i<sortedKeys.length;i++){\n            var key = sortedKeys[i];\n            if(key == 'act' || key == 'sign') {\n                continue;\n            } else {\n                signStr += key + '=' + reqObj[key];\n            }\n        }\n        var finalSign = hall.hex_md5('market.tuyoo.com-api-' + signStr + '-market.tuyoo-api') || '';\n        return finalSign;\n    },\n};"]}