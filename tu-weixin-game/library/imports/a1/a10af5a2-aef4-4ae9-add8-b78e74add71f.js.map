{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/window/assets/Script/ComponentScript/window/ddz_bannerResurgence.js"],"names":["cc","Class","extends","Component","properties","btnText","Label","closeAdBtn","Button","yindao","Node","onLoad","interactable","backButtonH","ddz","GlobalFuncs","getBackButtonPositionY","node","y","updateBtnTextTimer","hall","adManager","showResurgenceBannerAd","ani","getComponent","Animation","clipName","getClips","name","anim","getAnimationState","once","play","bc","gameModel","getBannerResurgenceConfigJson","timer","delay","setBtnSize","that","callBack","ty","Timer","cancelTimer","setTimer","_string","string","size","getContentSize","width","setContentSize","x","onClickCenterBtn","matchCondition","getFailCondition","checkFailCount","_toNext","resurgenceCondition","toNext","matchModel","matchBackNextLevel","onClose","needCount","getDiamondCountNeeded","waitGetRevial","type","curCount","needCountR","i","shareToGetreward","sharePoint","Share","SharePointType","firstFail","bannerResurgenceWindow","stop","removeFromParent","destroy","onDestroy","destroyWidthBannerAd"],"mappings":"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","file":"ddz_bannerResurgence.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        btnText:cc.Label,\n        closeAdBtn:cc.Button,\n        yindao:cc.Node,\n    },\n\n    onLoad:function(){\n        this.closeAdBtn.interactable = false;\n        var backButtonH = ddz.GlobalFuncs.getBackButtonPositionY();\n        if (backButtonH){\n            this.closeAdBtn.node.y = backButtonH;\n        }\n        this.updateBtnTextTimer();\n\n        // if (!ddz.resurgenceBannerAd){\n        //     hall.adManager.showResurgenceBannerAd('adunit-811cc4e234425489');\n        // }\n        hall.adManager.showResurgenceBannerAd('adunit-811cc4e234425489');\n        var ani = this.yindao.getComponent(cc.Animation);\n        var clipName = ani.getClips()[0].name;\n        var anim = ani.getAnimationState(clipName);\n        anim.once(\"finished\", function () {\n\n        });\n        anim.play();\n    },\n\n    updateBtnTextTimer:function(){\n        var bc = ddz.gameModel.getBannerResurgenceConfigJson();\n        var timer = 15;\n        if (bc){\n            if (bc.delay) {\n                timer = bc.delay;\n            }\n        }\n        this.setBtnSize(timer);\n        var that = this;\n        var callBack = function(){\n            timer--;\n            if (timer <=0) {\n                ty.Timer.cancelTimer(that, function(){\n\n                });\n                that.closeAdBtn.interactable = true;\n                that.setBtnSize(\"关闭广告\");\n            }else {\n                that.setBtnSize(timer);\n            }\n        };\n        ty.Timer.setTimer(this, callBack, 1);\n    },\n\n    setBtnSize:function(_string){\n        this.btnText.string = _string;\n        var size = this.closeAdBtn.node.getContentSize();\n\n        if (_string == \"关闭广告\") {\n            size.width = 160;\n        }else {\n            size.width = 80;\n        }\n        this.closeAdBtn.node.setContentSize(size);\n        this.btnText.node.x = size.width/2;\n    },\n\n    onClickCenterBtn:function(){\n        var matchCondition = ddz.GlobalFuncs.getFailCondition(\"match\",ddz.GlobalFuncs.checkFailCount(\"match\"));\n        if (matchCondition) {\n            var _toNext = matchCondition.resurgenceCondition.toNext;\n            if (_toNext){\n                ddz.matchModel.matchBackNextLevel();\n                this.onClose();\n                return;\n            }\n            else{\n                var needCount = ddz.matchModel.getDiamondCountNeeded();\n                ddz.waitGetRevial = {\n                    type : 'waitRecive',\n                    curCount : 0,\n                    needCount : needCount\n                };\n            }\n            var needCountR = ddz.waitGetRevial.needCount;\n            //发送得钻石的消息\n            for (var i = 0; i < needCountR; i++){\n                ddz.gameModel.shareToGetreward(ddz.waitGetRevial.sharePoint || ddz.Share.SharePointType.firstFail);\n            }\n            this.onClose();\n        }else {\n            this.onClose();\n        }\n    },\n\n    onClose:function(){\n        ddz.bannerResurgenceWindow = null;\n        var ani = this.yindao.getComponent(cc.Animation);\n        ani.stop();\n        this.yindao.removeFromParent();\n        this.node.destroy();\n    },\n\n    onDestroy:function () {\n        // hall.adManager.destroyResurgenceBannerAd();\n        hall.adManager.destroyWidthBannerAd();\n    }\n\n});\n"]}