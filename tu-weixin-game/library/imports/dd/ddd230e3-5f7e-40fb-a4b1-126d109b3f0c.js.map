{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/window/assets/Script/ComponentScript/window/ddz_window_gameDetail.js"],"names":["cc","Class","extends","Component","ctor","_TAG","properties","bgBtn","default","type","Button","closeBtn","whileBottom","Node","player_1","player_2","player_3","scrollView","ScrollView","infoItem","Prefab","contentWidth","itemHeight","noRecordTips","Label","btnList","btnList_1","loadingSpr","initContentY","onLoad","ddz","LOGD","node","active","_isHistory","detailsModel","getIsHisTory","content","on","closeGameDetail","setParentScene","parentScene","tableScene","isActionState","createDetail","updateAcatar","updateInfo","isOver","getIsOver","updatePos","isDuijuOver","topBtnCallFunc","Share","shareResults","bottomBtnCallFunc","ty","NotificationCenter","trigger","EventType","REMOVE_TABLE_ANI","hall","GlobalFuncs","gotoDdz","index","y","myIndex","_mySeatIndex","getMySeatIndex","leftindex","getPreIndex","rightindex","GetNextIndex","com","getComponent","setInfo","_seatId","isWhoWin","getWhoWin","nickNames","getNickNames","avatars","getAvatars","sumScore","getSumScore","slice_name","SliceStringToLength","setPlayerInfo","userInfo","HallUserInfo","_mySeatinfo","model","user_info","_rightSeatinfo","_leftSeatinfo","udataInfo","m_name","url","m_purl","setSumScore","setFirstSpr","resultList","resuslts","JSON","stringify","length","totalRound","getTotalRound","width","height","i","item","instantiate","updateinfo","addChild","isGameOver","destroy"],"mappings":"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","file":"ddz_window_gameDetail.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["/**\n * 战绩\n */\ncc.Class({\n    extends: cc.Component,\n    ctor : function () {\n        this._TAG = \"ddz_window_gameDetail\";\n\n    },\n\n    properties: {\n\n        bgBtn: {\n            default : null,\n            type : cc.Button\n        },\n\n        closeBtn : {\n            default : null,\n            type : cc.Button\n        },\n\n        whileBottom:cc.Node,\n\n        player_1 : cc.Node,\n        player_2 : cc.Node,\n        player_3 : cc.Node,\n\n        scrollView : {\n            default : null,\n            type : cc.ScrollView\n        },\n\n        infoItem:cc.Prefab,\n\n        contentWidth:550,\n        itemHeight : 60,\n\n        noRecordTips:cc.Label,\n\n        btnList:cc.Node,\n\n        btnList_1:cc.Node,\n\n        loadingSpr:cc.Node,\n\n        initContentY:175,\n    },\n\n    onLoad :function() {\n        ddz.LOGD(\"\", \"file = [ddz_window_gameDetail] fun = [onLoad] \");\n        this.bgBtn.node.active = true;\n        var _isHistory = ddz.detailsModel.getIsHisTory();\n        if (_isHistory) {\n            this.bgBtn.node.active = false;\n        }\n        this.closeBtn.node.active = true;\n        this.content = this.scrollView.content;\n        this.bgBtn.node.on(\"click\",this.closeGameDetail,this);\n        this.closeBtn.node.on(\"click\",this.closeGameDetail,this);\n    },\n\n    setParentScene:function(parentScene){\n        if (parentScene) {\n            this.tableScene = parentScene;\n        }\n        this.isActionState = true;\n    },\n\n    createDetail:function(parentScene){\n        this.isActionState = false;\n        this.loadingSpr.active = false;\n        this.updateAcatar();\n\n        this.updateInfo();\n\n        var isOver = ddz.detailsModel.getIsOver();\n        var _isHistory = ddz.detailsModel.getIsHisTory();\n        if (_isHistory){\n            this.updatePos(3);\n        }else {\n            this.isDuijuOver(isOver);\n        }\n    },\n    \n    // 对局流水 分享战绩\n    topBtnCallFunc:function(){\n        ddz.LOGD(\"\", \"file = [ddz_window_gameDetail] fun = [topBtnCallFunc] \");\n        ddz.Share.shareResults();\n    },\n    // 对局流水 返回首页\n    bottomBtnCallFunc:function(){\n        ddz.LOGD(\"\", \"file = [ddz_window_gameDetail] fun = [bottomBtnCallFunc] \");\n        ty.NotificationCenter.trigger(ddz.EventType.REMOVE_TABLE_ANI);\n        hall.GlobalFuncs.gotoDdz();\n    },\n\n    updatePos: function(index) {  // 1,不存在分享按钮  2, 存在分享按钮\n        if (index == 1) {\n            this.whileBottom.y = -10;\n            this.btnList.active = false;\n        }else if (index == 2) {\n            this.whileBottom.y = 118;\n            this.btnList_1.active = false;\n            this.btnList.active = true;\n            this.closeBtn.node.active = false;\n\n        }else if (index == 3) {\n            this.whileBottom.y = -10;\n            this.btnList_1.active = true;\n            this.btnList.active = false;\n            this.closeBtn.node.active = true;\n        }\n    },\n    //\n    updateAcatar:function(){\n        var myIndex = 0;\n        if (this.tableScene) {\n            myIndex = this.tableScene._mySeatIndex;\n        }else {\n            myIndex = ddz.detailsModel.getMySeatIndex();\n        }\n        var leftindex = ddz.GlobalFuncs.getPreIndex(myIndex);\n        var rightindex = ddz.GlobalFuncs.GetNextIndex(myIndex);\n\n        var com = this['player_1'].getComponent('ddz_avatar_window');\n        this.setInfo(com,myIndex - 1,true);\n\n        com = this['player_2'].getComponent('ddz_avatar_window');\n        this.setInfo(com,rightindex - 1);\n\n        com = this['player_3'].getComponent('ddz_avatar_window');\n        this.setInfo(com,leftindex - 1);\n    },\n\n    setInfo:function(com,_seatId,myIndex){\n        var isWhoWin = ddz.detailsModel.getWhoWin();\n        var nickNames = ddz.detailsModel.getNickNames();\n        var avatars = ddz.detailsModel.getAvatars();\n        var sumScore = ddz.detailsModel.getSumScore();\n\n        if (avatars[_seatId] && nickNames[_seatId]) {\n            var slice_name = hall.GlobalFuncs.SliceStringToLength(nickNames[_seatId], 8);\n            com.setPlayerInfo(avatars[_seatId],slice_name,myIndex);\n        }else {\n            var userInfo = new hall.HallUserInfo();\n            if (this.tableScene && this.tableScene._mySeatinfo){\n                var myIndex = this.tableScene._mySeatIndex;\n                var leftindex = ddz.GlobalFuncs.getPreIndex(myIndex);\n                var rightindex = ddz.GlobalFuncs.GetNextIndex(myIndex);\n                switch (_seatId){\n                    case myIndex-1:\n                        userInfo = this.tableScene._mySeatinfo.model.user_info;\n                        break;\n                    case rightindex-1:\n                        userInfo = this.tableScene._rightSeatinfo.model.user_info;\n                        break;\n                    case leftindex - 1:\n                        userInfo = this.tableScene._leftSeatinfo.model.user_info;\n                        break;\n                }\n                var slice_name = hall.GlobalFuncs.SliceStringToLength(userInfo.udataInfo.m_name, 8); //最多显示 8 个字符\n                var url = userInfo.udataInfo.m_purl;\n                com.setPlayerInfo(url,slice_name,myIndex);\n            }\n        }\n\n        com.setSumScore(sumScore[_seatId]);\n\n        if (isWhoWin == _seatId){\n            com.setFirstSpr(true);\n        }\n    },\n\n    updateInfo: function(){\n        var resultList = ddz.detailsModel.resuslts;\n        hall.LOGD(null,\"file = [ddz_window_gameDetail] fun = [updateInfo] resultList = \" + JSON.stringify(resultList));\n        if (resultList.length <= 0) {\n            this.noRecordTips.node.active = true;\n            return;\n        }\n        var myIndex = 0;\n        if (this.tableScene) {\n            myIndex = this.tableScene._mySeatIndex;\n        }else {\n            myIndex = ddz.detailsModel.getMySeatIndex();\n        }\n        var totalRound = ddz.detailsModel.getTotalRound();\n\n        this.noRecordTips.node.active = false;\n        this.scrollView.content.width = this.contentWidth;\n        this.scrollView.content.height = totalRound * this.itemHeight;\n        if (resultList.length > 0) {\n            for(var i = 0; i < totalRound; i++ ){\n                var item = cc.instantiate(this.infoItem);\n                var com = item.getComponent('ddz_gameDetail_cell');\n                com.updateinfo(i + 1,myIndex,resultList[i]);\n                this.content.addChild(item);\n                item.y = - i * this.itemHeight - (this.itemHeight / 2);\n            }\n        }\n        if(resultList.length >= 6){\n            this.content.y = (resultList.length - 5) * this.itemHeight + this.initContentY;\n        }\n    },\n    \n    isDuijuOver:function(isGameOver){\n        if (isGameOver){\n            this.updatePos(2);\n        }else {\n            this.updatePos(1);\n        }\n    },\n    //\n    closeGameDetail:function(){\n        ddz.LOGD(\"\", \"file = [ddz_window_gameDetail] fun = [closeGameDetail] \");\n        // this.bgBtn.node.active = false;\n        // this.btnList.active = false;\n        if (this.isActionState) {\n            return\n        }\n\n        var isOver = ddz.detailsModel.getIsOver();\n        if (!isOver) {\n            this.isActionState = false;\n            this.node.destroy();\n        }\n    },\n\n\n});"]}