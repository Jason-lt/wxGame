{"version":3,"sources":["ddz_arena_levelup.js"],"names":["cc","Class","extends","Component","ctor","properties","continueBtn","Button","continueBtnLabel","RichText","rankLabel","rankBaseLabel","saveBtn","aniNode","Node","progressNode","onLoad","actionCount","timeLeft","string","ty","Timer","setTimer","timeCount","ani","getComponent","Animation","play","NotificationCenter","listen","ddz","EventType","GAME_HIDE","shutSelf","ACTION_CHALLENGE","SAVE_MATCH_SUCCESS","saveMatchSuccess","ARENA_BACK_TO_SCENE","setRankString","rankString","ret","split","showArenaStageProgress","curStage","stages","playani","scr","initWithPars","setMatchDes","matchDes","value","saveInfo","matchId","hall","ME","matchInfo","getMatchDesByMatchId","stageString","stageIndex","length","scoreString","mscore","preFabPath","AudioHelper","playMusic","MusicPath_mp3","table_background_music","SystemInfo","tableBgMusicVolume","GlobalFuncs","showPopWinByPreFab","preFabNode","com","updateByMatchInfo","trigger","HIDE_DDZ_MAIN","cancelTimer","ignoreScope","node","removeFromParent","onContinueClick","onButtonClick","event","type","onSaveClick","interactable","matchModel","matchChallenge","roomId","matchSave","shut","destroy","onDestroy"],"mappings":"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","file":"ddz_arena_levelup.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["\n// var ddz_main = cc.instantiate(this.tipsWindow);\n// this.node.addChild(ddz_main);\n// var window = ddz_main.getComponent('ddz_fail');\n// window.setDiamondCount(\"五\",\"56\");\ncc.Class({\n    extends: cc.Component,\n    ctor:function () {\n\n    },\n\n    properties: {\n        continueBtn: cc.Button,\n        continueBtnLabel: cc.RichText,\n        rankLabel: cc.RichText,\n        rankBaseLabel: cc.RichText,\n        saveBtn: cc.Button,\n        aniNode: cc.Node,\n        progressNode: cc.Node,\n    },\n\n    onLoad:function () {\n        //当前的progress展示\n        //var backButtonH = ddz.GlobalFuncs.getBackButtonPositionY();\n        //if (backButtonH){\n        //    this.backButton.node.y = backButtonH;\n        //}\n        this.actionCount = 1; //防止用户行为与定时器行为相冲突\n        this.timeLeft = 5;\n        this.continueBtnLabel.string = \"<color=#FFFFFF>进入下一轮（\" + this.timeLeft + \"）</c>\";\n        ty.Timer.setTimer(this, this.timeCount, 1, 5, 0);\n        var ani = this.aniNode.getComponent(cc.Animation);\n        ani.play('chenggongjinji');\n        //ty.NotificationCenter.listen(ddz.EventType.RECIVE_TABLE_INFO, this.newTableInfo, this);\n        ty.NotificationCenter.listen(ddz.EventType.GAME_HIDE,this.shutSelf,this);\n        ty.NotificationCenter.listen(ddz.EventType.ACTION_CHALLENGE, this.shutSelf, this);\n        ty.NotificationCenter.listen(ddz.EventType.SAVE_MATCH_SUCCESS, this.saveMatchSuccess, this);\n        ty.NotificationCenter.listen(ddz.EventType.ARENA_BACK_TO_SCENE, this.shutSelf, this);\n    },\n\n    setRankString: function(rankString) {\n        var ret = rankString.split('/');\n        this.rankLabel.string = \"<color=#FDE755>\" + ret[0] + \"</color>\";\n        this.rankBaseLabel.string = '<color=#FFFDDA>/' + ret[1] + '</color>';\n\n    },\n\n    showArenaStageProgress: function(curStage, stages, playani) {\n        ty.Timer.setTimer(this, function(){\n            var scr = this.progressNode.getComponent(\"MatchRankProgressScript\");\n            scr.initWithPars(curStage - 1, stages, playani);\n        }, 0.36, 0, 0);\n    },\n\n    setMatchDes: function(matchDes) {\n        this.matchDes = matchDes;\n    },\n\n    saveMatchSuccess: function(value) {\n        var saveInfo = value.saveInfo;\n        var matchId = value.matchId;\n        var matchDes = hall.ME.matchInfo.getMatchDesByMatchId(matchId);\n        var stageString = \"轮次: \" + saveInfo.stageIndex + '/' + matchDes.stages.length;\n        var scoreString = \"积分: \" + saveInfo.mscore;\n        var preFabPath = \"prefabs/ddz_window_save_match_result\";\n        ddz.AudioHelper.playMusic(ddz.MusicPath_mp3.table_background_music, true, ty.SystemInfo.tableBgMusicVolume);\n        hall.GlobalFuncs.showPopWinByPreFab(preFabPath, function (preFabNode) {\n            var com = preFabNode.getComponent(\"ddz_window_save_match_result\");\n            com.updateByMatchInfo([stageString, scoreString]);\n        });\n    },\n\n    shutSelf: function() {\n        ty.NotificationCenter.trigger(ddz.EventType.HIDE_DDZ_MAIN);\n        ty.Timer.cancelTimer(this, this.timeCount);\n        ty.NotificationCenter.ignoreScope(this);\n        this.node.removeFromParent();\n    },\n\n    timeCount: function() {\n        this.timeLeft--;\n        if(this.timeLeft <= 0) {\n            this.continueBtnLabel.string = \"<color=#FFFFFF>进入下一轮</c>\";\n            this.onContinueClick();\n        } else {\n            this.continueBtnLabel.string = \"<color=#FFFFFF>进入下一轮（\" + this.timeLeft + \"）</c>\";\n        }\n    },\n\n    onButtonClick: function(event, type) {\n        ty.Timer.cancelTimer(this, this.timeCount);\n        if(type == 'continue') {\n            this.onContinueClick();\n        } else if(type == \"save\") {\n            this.onSaveClick();\n        }\n        this.continueBtn.interactable = false;\n        this.saveBtn.interactable = false;\n    },\n\n    onContinueClick: function() {\n        this.continueBtnLabel.string = \"<color=#FFFFFF>进入下一轮</c>\";\n        if(this.matchDes) {\n            ddz.matchModel.matchChallenge(this.matchDes.roomId, this.matchDes.matchId);\n            this.matchDes = null;\n        }\n    },\n\n    onSaveClick: function() {\n        this.continueBtnLabel.string = \"<color=#FFFFFF>进入下一轮</c>\";\n        if(this.matchDes) {\n            ddz.matchModel.matchSave(this.matchDes.roomId, this.matchDes.matchId);\n            this.matchDes = null;\n        }\n    },\n\n    shut:function () {\n        ty.Timer.cancelTimer(this, this.timeCount);\n        ty.NotificationCenter.ignoreScope(this);\n        this.node.destroy();\n    },\n\n    onDestroy: function() {\n        ty.NotificationCenter.ignoreScope(this);\n    },\n    // update (dt) {},\n});\n"]}