{"version":3,"sources":["ddz_window_revive.js"],"names":["cc","Class","extends","Component","properties","titleLable","default","type","Label","tipDes1","tipDesRich2","RichText","closeButton","Button","cancelButton","OKButton","cancelButtonLable","okButtonLable","onLoad","ddz","matchModel","isShowingRevive","ty","NotificationCenter","listen","EventType","ACTION_CHALLENGE","close","ARENA_SEND_MATCH_BACK","showTips","arenaMatchBack","SHOW_MATCH_REVIVE","showSelf","node","active","setMatchInfo","matchDes","stageIndex","curArenaConfig","gameModel","getArenaMatchConfigJson","matchId","toString","sharePointValue","sharePoint","leftCount","ShareRecord","i","stages","index","stage","canBack","feeCount","backFeeCount","shareRewardOnceCount","getRewardCount","Math","ceil","feeType","updateByReviveType","hall","LOGD","string","LOGE","onClickClose","matchGiveUp","roomId","onClickCancel","onClickOK","that","matchBack","Share","shareWithType","onShareType","clickStatShareTypeRevial","result","hasOwnProperty","waitGetRevial","matchType","needCount","trigger","msg","MsgBoxManager","showToast","title","ignoreScope","removeFromParent","onDestroy","value","error","tipsString","info","preFabPath","comName","GlobalFuncs","showPopWinByPreFab","preFabNode","window","getComponent","tiString","setTitleContentAndButtonsString","callFunc","clickStatShareTypeGetDiamondHall"],"mappings":"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","file":"ddz_window_revive.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        titleLable: {\n            default: null,\n            type: cc.Label\n        },\n        tipDes1: {\n            default: null,\n            type: cc.Label\n        },\n        tipDesRich2: {\n            default: null,\n            type: cc.RichText\n        },\n        closeButton: {\n            default: null,\n            type: cc.Button\n        },\n        cancelButton: {\n            default: null,\n            type: cc.Button\n        },\n        OKButton: {\n            default: null,\n            type: cc.Button\n        },\n        cancelButtonLable: {\n            default: null,\n            type: cc.RichText\n        },\n        okButtonLable: {\n            default: null,\n            type: cc.RichText\n        }\n    },\n\n    onLoad: function() {\n        ddz.matchModel.isShowingRevive = true;\n        ty.NotificationCenter.listen(ddz.EventType.ACTION_CHALLENGE, this.close, this);\n        ty.NotificationCenter.listen(ddz.EventType.ARENA_SEND_MATCH_BACK, this.close, this);\n        ty.NotificationCenter.listen(\"arena_revive_share_person\", this.showTips, this);\n        ty.NotificationCenter.listen(\"arena_match_back\", this.arenaMatchBack, this);\n        ty.NotificationCenter.listen(ddz.EventType.SHOW_MATCH_REVIVE, this.showSelf, this);\n    },\n\n    showSelf:function () {\n        this.node.active = true;\n    },\n\n    /**\n     {\"index\":1,\"name\":\"90进75\",\"riseUserCount\":75,\"totalUserCount\":90,\"canBack\":0,\"backFee\":\"1个钻石\",\"backFeeCount\":1}\n\n     * @param matchDes\n     * @param stageIndex\n     */\n    setMatchInfo: function(matchDes, stageIndex) {\n        this.matchDes = matchDes;\n        this.stageIndex = stageIndex;\n        var curArenaConfig = ddz.gameModel.getArenaMatchConfigJson()[this.matchDes.matchId.toString()];\n        var sharePointValue = curArenaConfig[\"reviveSharePoint\"];\n        this.sharePoint = sharePointValue;\n        var leftCount = ddz.ShareRecord[this.sharePoint.toString()] && ddz.ShareRecord[this.sharePoint.toString()].leftCount;\n        for(var i in this.matchDes.stages) {\n            if(this.matchDes.stages[i].index == this.stageIndex) {\n                var stage = this.matchDes.stages[i];\n                if(stage.canBack == 1) {\n                    this.feeCount = stage.backFeeCount;\n                    this.shareRewardOnceCount = 1;\n                    if(curArenaConfig[\"shareRewardOnce\"][\"type\"] == 'diamond') {\n                        this.shareRewardOnceCount = curArenaConfig[\"shareRewardOnce\"][\"count\"];\n                    }\n                    this.getRewardCount = Math.ceil(this.feeCount/this.shareRewardOnceCount);\n                    if(stageIndex <= curArenaConfig[\"maxStageForReviveShare\"] && this.getRewardCount <= leftCount) {\n                        //\n                        this.feeType = 'share';\n                    } else {\n                        //钻石复活\n                        this.feeType = 'diamond';\n                    }\n                    this.updateByReviveType();\n                } else {\n                    hall.LOGD(\"arena revive\",\"something error\");\n                }\n            }\n        }\n    },\n\n    updateByReviveType: function() {\n        if(this.feeType == 'share') {\n            this.tipDesRich2.node.active = false;\n            this.okButtonLable.string = \"<color=#ffffff>邀请好友</color>\";\n            this.cancelButtonLable.string = \"<color=#ffffff>放弃</c>\";\n        } else if(this.feeType == 'diamond') {\n            this.tipDesRich2.node.active = true;\n            this.tipDesRich2.string = \"<color=#1A6951>使用 </c><img src='dda_button_diamond_black' height=30 width=34/><color=#1A6951> \"+ this.feeCount + \"可以继续挑战</c>\";\n            this.okButtonLable.string = \"<color=#ffffff>使用</c><img src='dda_button_diamond' height=34 width=43/>\";\n            this.cancelButtonLable.string = \"<color=#ffffff>放弃</c>\";\n        } else {\n            hall.LOGE(\"something error\",\"fix it\");\n        }\n    },\n\n    onClickClose: function() {\n        ddz.matchModel.matchGiveUp(this.matchDes.roomId, this.matchDes.matchId);\n        this.close();\n    },\n\n    onClickCancel: function() {\n        ddz.matchModel.matchGiveUp(this.matchDes.roomId, this.matchDes.matchId);\n        this.close();\n    },\n\n    onClickOK: function() {\n        var that = this;\n        if(this.feeType == 'diamond') {\n            ddz.matchModel.matchBack(this.matchDes.roomId, this.matchDes.matchId);\n        }\n        else if(this.feeType == 'share') {\n            ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeRevial, function (result) {\n                //分享成功\n                if (result.hasOwnProperty('shareTickets')){\n                    //分享到了群\n                    ddz.LOGD(\"ddz_revivalWindow\", \"分享到了群!\");\n                    ddz.waitGetRevial = {\n                        sharePoint: that.sharePoint,\n                        matchType: 'arena',\n                        matchDes : that.matchDes,\n                        type : 'send',\n                        needCount : that.getRewardCount\n                    };\n                }\n                else{\n                    ddz.LOGD(\"ddz_revivalWindow\", \"分享到了个人!\");\n                    ddz.waitGetRevial = null;\n                    ty.NotificationCenter.trigger(\"arena_revive_share_person\");\n                }\n\n            });\n        }\n        this.node.active = false;//这里不能删除,因为钻石不足的弹窗监听在这窗口上\n    },\n\n    showTips: function() {\n        var msg = \"只有分享到微信群才有效哦~\";\n        hall.MsgBoxManager.showToast({title : msg});\n    },\n    \n\n    close: function() {\n        ddz.matchModel.isShowingRevive = false;\n        ty.NotificationCenter.ignoreScope(this);\n        this.node.removeFromParent();\n    },\n\n    onDestroy: function() {\n        ddz.matchModel.isShowingRevive = false;\n        ty.NotificationCenter.ignoreScope(this);\n    },\n\n    arenaMatchBack: function(value) {\n        if(this.matchDes.matchId == value.result.matchId) {\n            if(value.error) {\n                var tipsString = value.error.info;\n                var preFabPath = \"prefabs/ddz_window_normal\";\n                var  comName = \"ddz_window_normal\";\n                var that = this;\n                hall.GlobalFuncs.showPopWinByPreFab(preFabPath, function (preFabNode) {\n                    var window = preFabNode.getComponent(comName);\n                    var tiString = \"邀请好友\";\n\n                    window.setTitleContentAndButtonsString(\"提示\",\"<color=#1A6951>\" + tipsString + \"</c>\",[{title:tiString,callFunc : function () {\n                        ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeGetDiamondHall);\n                    }}], function () {\n                        ddz.matchModel.matchGiveUp(that.matchDes.roomId, that.matchDes.matchId);\n                    });\n                });\n            }\n        }\n    },\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n\n    // update (dt) {},\n});"]}