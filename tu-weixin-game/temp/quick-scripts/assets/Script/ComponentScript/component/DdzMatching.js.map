{"version":3,"sources":["DdzMatching.js"],"names":["cc","Class","extends","Component","ctor","_TAG","isPlaying","properties","bgBtn","default","type","Button","tipsLabel","Label","tipsLabel2","bgSprite","Sprite","backBtn","feeText","RichText","nowIndex","massageList","onLoad","ty","NotificationCenter","listen","ddz","EventType","REMOVE_MATCHING","shutSelf","GAME_HIDE","gameModel","matchingMassage","GameWorld","backButtonH","GlobalFuncs","getBackButtonPositionY","node","y","active","setTxet","Timer","setTimer","changeTxet","macro","REPEAT_FOREVER","size","director","getWinSize","setContentSize","hall","AdManagerTYWX","getAdNodeByTag","hideAdNode","adManager","canShowTableBanner","hideBannerAd","bc","getRoomListBannerConfigJson","winnerCount","matchModel","getCurWinnerCount","start","showAllWidthBannerAd","LOGD","trigger","REMOVE_TREASURE_BOX","zuanshiBoxCom","onClose","clearMessageList","string","cancelTimer","enterQueue","_queueInfo","getCurQueueInfo","roomFee","backAction","REMOVE_TABLE_ANI","AudioHelper","playEffect","EffectPath_mp3","back_button_click_sound","_mixID","mixId","_mixedRoomId","mixedRoomId","MsgFactory","getRoomLeave","roomId","getShowText","ani","getComponent","Animation","opacity","anim","getAnimationState","play","massageIndex","getRandomNumberBefore","length","textS","playAni","value","isValid","stop","ignoreScope","removeFromParent","isInAtScene","canShowTableTopBanner","SHOW_TABLE_BANNER","onDestroy","destroyWidthBannerAd"],"mappings":"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","file":"DdzMatching.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["/**\n * Created by tuyoo on 2018/2/23.\n */\ncc.Class({\n    extends: cc.Component,\n    ctor : function () {\n        this._TAG = \"DdzMatching\";\n        this.isPlaying = false;\n    },\n\n    properties: {\n        bgBtn: {\n            default : null,\n            type : cc.Button\n        },\n        tipsLabel: {\n            default : null,\n            type : cc.Label\n        },\n        tipsLabel2: {\n            default : null,\n            type : cc.Label\n        },\n        bgSprite: {\n            default : null,\n            type : cc.Sprite\n        },\n        backBtn: {\n            default : null,\n            type : cc.Button\n        },\n        feeText: {\n            default : null,\n            type : cc.RichText\n        },\n        nowIndex : 1,\n        massageList :null\n    },\n\n    onLoad :function() {\n        ty.NotificationCenter.listen(ddz.EventType.REMOVE_MATCHING, this.shutSelf, this);\n        ty.NotificationCenter.listen(ddz.EventType.GAME_HIDE,this.shutSelf,this);\n        this.massageList = ddz.gameModel.matchingMassage;\n        if (!this.massageList){\n            this.massageList = ddz.GameWorld.matchingMassage;\n        }\n\n        var backButtonH = ddz.GlobalFuncs.getBackButtonPositionY();\n        if (backButtonH){\n            this.backBtn.node.y = backButtonH;\n        }\n\n        this.backBtn.node.active = false;\n        this.setTxet();\n        ty.Timer.setTimer(this, this.changeTxet,3,cc.macro.REPEAT_FOREVER,-1);\n\n        var size = cc.director.getWinSize();\n        if(this.bgBtn){\n            this.bgBtn.node.setContentSize(size);\n        }\n        // hall.adManager.hideAdIco();\n        if (hall.AdManagerTYWX && hall.AdManagerTYWX.getAdNodeByTag(\"myFirstAdNode\")) {\n            hall.AdManagerTYWX.getAdNodeByTag(\"myFirstAdNode\").hideAdNode();\n        }\n\n        hall.adManager.canShowTableBanner = false;\n        hall.adManager.hideBannerAd();\n        \n        var bc = ddz.gameModel.getRoomListBannerConfigJson();\n        if (bc) {\n            var winnerCount = ddz.matchModel.getCurWinnerCount();\n            if (bc.start) {\n                if (winnerCount >= bc.start) {\n                    // if (!ddz.curAllWidthBannerAd){\n                    //     hall.adManager.showAllWidthBannerAd('adunit-811cc4e234425489');\n                    //     this.feeText.node.y = -200;\n                    // }\n                    hall.adManager.showAllWidthBannerAd('adunit-811cc4e234425489');\n                    this.feeText.node.y = -200;\n                }\n            }else {\n                // if (!ddz.curAllWidthBannerAd){\n                //     hall.adManager.showAllWidthBannerAd('adunit-811cc4e234425489');\n                //     this.feeText.node.y = -200;\n                // }\n                hall.adManager.showAllWidthBannerAd('adunit-811cc4e234425489');\n                this.feeText.node.y = -200;\n            }\n        }\n        ddz.LOGD(\"\",\"file = [DdzMatching] fun = [onLoad] \");\n        ty.NotificationCenter.trigger(ddz.EventType.REMOVE_TREASURE_BOX);\n\n        if (ddz.zuanshiBoxCom && ddz.zuanshiBoxCom.onClose) {\n            ddz.zuanshiBoxCom.onClose();\n        }\n\n        // hall.adManager.hideAd()\n        if (hall.AdManagerTYWX && hall.AdManagerTYWX.getAdNodeByTag(\"myFirstAdNode\")) {\n            hall.AdManagerTYWX.getAdNodeByTag(\"myFirstAdNode\").hideAdNode();\n        }\n    },\n\n    clearMessageList: function() {\n        this.massageList = [''];\n        this.tipsLabel.string = '匹配中...';\n        this.tipsLabel2.string = '';\n        this.bgSprite.node.active = true;\n        ty.Timer.cancelTimer(this, this.changeTxet);\n    },\n\n    enterQueue:function(){\n        this.backBtn.node.active = true;\n        this.massageList = [''];\n        this.tipsLabel.string = '匹配中...';\n        this.tipsLabel2.string = '';\n        this.bgSprite.node.active = true;\n        ty.Timer.cancelTimer(this, this.changeTxet);\n        var _queueInfo = ddz.matchModel.getCurQueueInfo();\n        if (_queueInfo.roomFee && _queueInfo.roomFee > 0) {\n\n            if (this.feeText) {\n                this.feeText.node.active = true;\n                this.feeText.string = \"<color=#ffffff>本局服务费</color><img src='ddz_coin_white'/><color=#FFFFFF> \" + _queueInfo.roomFee + \"</c>\";\n            }\n\n        }\n    },\n\n    backAction:function(){\n        var _queueInfo = ddz.matchModel.getCurQueueInfo();\n        this.shutSelf();\n        ty.NotificationCenter.trigger(ddz.EventType.REMOVE_TABLE_ANI);\n        ddz.AudioHelper.playEffect(ddz.EffectPath_mp3.back_button_click_sound, false);\n        var _mixID = _queueInfo.mixId;\n        var _mixedRoomId = _queueInfo.mixedRoomId;\n        ddz.MsgFactory.getRoomLeave(_queueInfo.roomId, null, null, _mixID,_mixedRoomId);\n    },\n\n    setTxet : function () {\n        this.tipsLabel.string = this.getShowText();\n    },\n\n    changeTxet : function () {\n        var ani = this.node.getComponent(cc.Animation);\n        if(this.nowIndex == 1){\n            this.tipsLabel2.opacity = 0;\n            this.tipsLabel2.string = this.getShowText();\n            if(this.tipsLabel2.string == null){\n                return;\n            }\n            var anim = ani.getAnimationState('changeTips');\n            anim.play();\n            this.nowIndex = 2;\n        }else {\n            this.tipsLabel.string = this.getShowText();\n            if(this.tipsLabel.string == null){\n                return;\n            }\n            var anim = ani.getAnimationState('changeTips2');\n            anim.play();\n            this.nowIndex = 1;\n        }\n    },\n    // completeAniChange : function () {\n    // },\n\n    getShowText : function () {\n        var massageIndex = hall.GlobalFuncs.getRandomNumberBefore(this.massageList.length);\n        var textS = this.massageList[massageIndex];\n        return textS;\n    },\n\n    /**\n     * 播放动画\n     * @param value\n     */\n    playAni : function (value) {\n        if (this.node && cc.isValid(this.node)){\n            var ani = this.node.getComponent(cc.Animation);\n            var anim = ani.getAnimationState('ddz_matching');\n            if (value){\n                anim.play();\n            }\n            else{\n                anim.stop();\n            }\n            this.isPlaying = value;\n        }\n    },\n\n    shutSelf:function () {\n        ddz.LOGD(this._TAG, \"shutSelf\");\n        if (this.isPlaying){\n            this.playAni(false);\n        }\n        ty.NotificationCenter.ignoreScope(this);\n        ty.Timer.cancelTimer(this, this.changeTxet);\n\n        if (this.node) {\n            var ani = this.node.getComponent(cc.Animation);\n            if (ani) {\n                ani.stop();\n                this.node.removeFromParent();\n            }\n        }\n\n        if (hall.GlobalFuncs.isInAtScene(\"TableScene\")) {\n            hall.adManager.canShowTableBanner = true;\n            hall.adManager.canShowTableTopBanner = true;\n            ty.NotificationCenter.trigger(ddz.EventType.SHOW_TABLE_BANNER);\n        }\n    },\n\n    onDestroy:function () {\n        hall.adManager.destroyWidthBannerAd();\n    }\n\n\n    // start () {\n    //\n    // },\n\n    // update (dt) {},\n});"]}