{"version":3,"sources":["MallScene.js"],"names":["cc","Class","extends","Component","properties","backButton","default","type","Button","tableView","Node","personalAssets","conversionSuccess","Prefab","onLoad","ddz","GlobalFuncs","drawGameCanvas","backButtonH","getBackButtonPositionY","node","y","updateMallData","ty","NotificationCenter","listen","EventType","CONVERSION_SUCCESS","onConversionSuccess","DIAMOND_INSUFFICIENT","diamondInsufficient","_m_coinList","hall","gameWorld","model","m_coinList","wimdow","getComponent","updateInfo","resultArr","length","i","addMap","coin","m_price_diamond","m_price","diamond","m_id","push","window","setDataArray","num","that","Timer","setTimer","trigger","UPDATE_CONVERSION_STATE","onClickCenterButton","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeButtonClick","shareType","Share","onShareType","clickStatShareTypeGetDiamondHall","shareWithType","backAction","LOGD","AudioHelper","playEffect","EffectPath_mp3","back_button_click_sound","sceneName","popScene","onDestroy","ignoreScope"],"mappings":"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","file":"MallScene.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/Scenes","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        backButton : {\n            default : null,\n            type : cc.Button\n        },\n        tableView : {\n            default : null,\n            type : cc.Node\n        },\n\n        personalAssets : {\n            default : null,\n            type : cc.Node\n        },\n\n        conversionSuccess : {\n            default : null,\n            type : cc.Prefab\n        }\n\n    },\n\n    onLoad : function () {\n        ddz.GlobalFuncs.drawGameCanvas();\n        var backButtonH = ddz.GlobalFuncs.getBackButtonPositionY();\n        if (backButtonH){\n            this.backButton.node.y = backButtonH;\n        }\n\n        this.updateMallData();\n\n        ty.NotificationCenter.listen(ddz.EventType.CONVERSION_SUCCESS,this.onConversionSuccess,this);\n        ty.NotificationCenter.listen(ddz.EventType.DIAMOND_INSUFFICIENT,this.diamondInsufficient,this);\n    },\n\n    updateMallData:function(){\n        var _m_coinList = hall.gameWorld.model.m_coinList;\n        // hall.LOGD(\"\",\"file = [MallScene] fun = [updateMallData] _m_coinList = \" + JSON.stringify(_m_coinList));\n\n        // 个人财产信息\n        var wimdow = this.personalAssets.getComponent(\"personalAssets\");\n        wimdow.updateInfo();\n\n        var resultArr = [];\n        if (_m_coinList.length <= 0) {\n            return\n        }\n        for (var i = 0; i < _m_coinList.length; i++){\n            var addMap = {};\n            addMap.coin = _m_coinList[i].m_price_diamond * _m_coinList[i].m_price;\n            addMap.diamond = _m_coinList[i].m_price;\n            addMap.m_id = _m_coinList[i].m_id;\n            // addMap.radio = 0;\n            resultArr.push(addMap);\n        }\n        var window = this.tableView.getComponent('ddz_tableView');\n        window.setDataArray(resultArr);\n\n    },\n\n    onConversionSuccess : function (num) {\n        var that = this;\n        // if (this._success) {\n        //     ty.Timer.cancelTimer(this,function(){\n        //         ddz.LOGD(null,\"file = [MallScene] fun = [onConversionSuccess] canceTimer\");addTipsAssets\n        //         ty.NotificationCenter.trigger(ddz.EventType.UPDATE_CONVERSION_STATE,false);\n        //         that._success.removeFromParent();\n        //         that._success = null;\n        //     });\n        // }\n        // this._success = cc.instantiate(this.conversionSuccess);\n        //\n        //       var winSize = cc.director.getWinSize();\n        // this._success.x = winSize.width/2;\n        // this._success.y = winSize.height/2 + 103;\n        //\n        // cc.director.getScene().addChild(this._success);\n        // var window = this._success.getComponent('conversionSuccess');\n        // var str = \"<img src='ddz_coin_white'/><color=#FFFFFF> \" + num + \"</c>\";\n        // window.updateCoinText(str);\n        // var tips = \"兑换成功\";\n        // window.updateTipsText(tips);\n\n        ty.Timer.setTimer(this, function(){\n            // if (that._success) {\n            //     that._success.removeFromParent();\n            //     that._success = null;\n            // }\n            ty.NotificationCenter.trigger(ddz.EventType.UPDATE_CONVERSION_STATE,true);\n        }, 1.5, 0, 0);\n    },\n\n    // 钻石不够\n    diamondInsufficient : function () {\n        // ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShowWindow,\n        //     [\"mallDiamondInsufficient\"]);\n        // ddz.LOGD(null,\"file = [MallScene] fun = [diamondInsufficient] _tips = \" + JSON.stringify(_tips));\n        // var preFabPath = \"prefabs/ddz_window_tips\";\n        // var  comName = \"ddz_tipsWindow\";\n        // var that = this;\n        // hall.GlobalFuncs.showPopWinByPreFab(preFabPath, function (preFabNode) {\n        //     var window = preFabNode.getComponent(comName);\n        //     window.parentScene = that;\n        //     var testArray = [\n        //         {\n        //             title :\"邀请好友\",\n        //             bottomType : 0\n        //         }\n        //     ];\n        //     var tips = _tips;\n        //     window.setTitleContentAndButtons(\"提示\",tips, testArray);\n        // });\n        ty.NotificationCenter.trigger(ddz.EventType.UPDATE_CONVERSION_STATE,true);\n    },\n\n    // 点击tips 邀请好友按钮\n    onClickCenterButton:function(){\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeButtonClick,\n            [\"mallInvite\"]);\n        var shareType = ddz.Share.onShareType.clickStatShareTypeGetDiamondHall;\n        ddz.Share.shareWithType(shareType);\n    },\n\n    backAction : function () {\n        ddz.LOGD(null, \"file = [MallScene] fun = [backAction]\");\n        ddz.AudioHelper.playEffect(ddz.EffectPath_mp3.back_button_click_sound, false);\n        var sceneName = 'Ddz';\n        // cc.director.loadScene(sceneName);\n        hall.GlobalFuncs.popScene();\n    },\n\n    onDestroy : function () {\n        ty.NotificationCenter.ignoreScope(this);\n    },\n\n});\n"]}