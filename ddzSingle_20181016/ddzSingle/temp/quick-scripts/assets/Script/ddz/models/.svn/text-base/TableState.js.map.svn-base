{"version":3,"sources":["TableState.js"],"names":["ddz","_TableState","cc","Class","ctor","normalInfo","m_state","Enums","TableState","TABLEDSTAT_IDLE","m_matchpcnt","m_nowop","m_banker","m_ccrc","m_dizhu","m_topseat","m_call","m_bomb","m_chuntian","m_show","m_super","m_bcmulti","m_cardLaizi","m_grabCard","m_rangpaiMulti","m_rangpai","m_kickoutCard","objectInfo","m_baseCard","m_topCard","m_laiziNumber","m_bUpdatebcMulti","hall","LOGD","setLaizi","lz_point","GlobalFuncs","getLaiziNumByPoint","destroy","parseTableState","result","tmp","oldCall","oldBomb","oldShow","oldSuper","oldbcmulti","anim","updateMulti","params","ty","NotificationCenter","trigger","EventType","UPDATE_MULTI","TABLEDSTAT_PLAYING","hasOwnProperty","Reset","calcMulti","multi","info","dipai","mingpai","zhadan","b","Math","pow","chuntian"],"mappings":"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","file":"TableState.js","sourceRoot":"../../../../../../assets/Script/ddz/models","sourcesContent":["// Create by Zhanghaibin\n// 桌子状态\nddz._TableState = cc.Class({\n\n    ctor: function() {\n        // 普通信息\n        this.normalInfo = {\n            m_state: ddz.Enums.TableState.TABLEDSTAT_IDLE, //桌子当前状态\n            m_matchpcnt: 0, //已进行的局数，只用于比赛场。\n            m_nowop: 0, //当前操作玩家\n            m_banker: 0, //当前庄家\n            m_ccrc: 0, //出牌序列校验\n            m_dizhu: 0, //地主的座位号\n            m_topseat: 0, // 上次出牌的ID\n            m_call: -1, //叫的倍数\n            m_bomb: 0, //炸弹次数，用于算分加倍\n            m_chuntian: 0, //春天\n            m_show: 1, //明牌倍数\n            m_super: 1, //超级加倍\n            m_bcmulti: 1, //底牌加倍\n            m_cardLaizi: -1, // 癞子的点数， 对应card_info里面的point - 1\n            m_grabCard: -1, //二斗明牌id\n            m_rangpaiMulti: -1, //二斗让牌加倍方式（1为加1，2为乘2）\n            m_rangpai: 0, //二斗让牌个数\n            m_kickoutCard:[]\n        };\n        // 对象信息\n        this.objectInfo = {\n            m_baseCard: [], //三张底牌，长度为3\n            m_topCard: [] //最后出的牌，用于校验，长度为20\n        };\n        this.m_laiziNumber = -1;\n        this.m_bUpdatebcMulti = false;\n        hall.LOGD(null, \"ctor in new ddz._TableState\");\n    },\n\n    setLaizi: function(lz_point) {\n        hall.LOGD(null, \"in table state, set lz value \" + lz_point);\n        this.normalInfo.m_cardLaizi = lz_point;\n        this.m_laiziNumber = ddz.GlobalFuncs.getLaiziNumByPoint(lz_point);\n    },\n\n    destroy: function() {\n        this.normalInfo = null;\n        this.objectInfo = null;\n        hall.LOGD(null, \"destroy in ddz._TableState\");\n    },\n\n    parseTableState: function(result) {\n        if(!result) {\n            return;\n        }\n        var tmp = this.normalInfo;\n        // 先存储一下之前的状态\n        //叫的倍数\n        var oldCall = tmp.m_call;\n        //炸弹倍数\n        var oldBomb = tmp.m_bomb;\n        //明牌倍数\n        var oldShow = tmp.m_show;\n        //超级加倍\n        var oldSuper = tmp.m_super;\n        //底牌加倍\n        var oldbcmulti = tmp.m_bcmulti;\n\n        //更新其他信息\n        tmp.m_state = result[\"state\"];\n        tmp.m_nowop = result[\"nowop\"];\n        tmp.m_ccrc = result[\"ccrc\"];\n        tmp.m_dizhu = result[\"dizhu\"];\n        tmp.m_topseat = result[\"topseat\"];\n        tmp.m_call = result[\"call\"];\n        tmp.m_bomb = result[\"bomb\"];\n        tmp.m_show = result[\"show\"];\n        tmp.m_super = result[\"super\"];\n        tmp.m_bcmulti = result[\"bcmulti\"];\n        tmp.m_chuntian = result[\"chuntian\"];\n        tmp.m_grabCard = result[\"grabCard\"];\n        tmp.m_rangpaiMulti = result[\"rangpaiMulti\"];\n        tmp.m_rangpai = result[\"rangpai\"];\n        if (tmp.m_bcmulti != oldbcmulti) {\n            this.m_bUpdatebcMulti = true;\n        }\n        tmp.m_kickoutCard = result[\"kickoutCard\"] || [];\n        ////////////////////////////////////////////////////////////////////更新倍数\n        //叫地主和抢地主倍数\n\n        var anim, updateMulti, params;\n        if (tmp.m_call != oldCall && tmp.m_call >= 1) {\n            anim = true;\n            updateMulti = true;\n            params = [anim, updateMulti];\n            ty.NotificationCenter.trigger(ddz.EventType.UPDATE_MULTI, params);\n        }\n        if (tmp.m_bomb != oldBomb) {\n            hall.LOGD(null, \"倍数改变 炸弹\");\n            anim = true;\n            updateMulti = true;\n            params = [anim, updateMulti];\n            ty.NotificationCenter.trigger(ddz.EventType.UPDATE_MULTI, params);\n        }\n        if (tmp.m_show != oldShow) {\n            hall.LOGD(null, \"倍数改变 明牌\");\n            anim = true;\n            updateMulti = true;\n            params = [anim, updateMulti];\n            ty.NotificationCenter.trigger(ddz.EventType.UPDATE_MULTI, params);\n        }\n        if (tmp.m_super != oldSuper) {\n            hall.LOGD(null, \"倍数改变 超级加倍\");\n            anim = true;\n            updateMulti = true;\n            params = [anim, updateMulti];\n            ty.NotificationCenter.trigger(ddz.EventType.UPDATE_MULTI, params);\n        }\n        if (this.m_bUpdatebcMulti == true && tmp.m_state == ddz.Enums.TableState.TABLEDSTAT_PLAYING) {\n            hall.LOGD(null, \"倍数改变 底牌加倍\");\n            anim = true;\n            updateMulti = true;\n            params = [anim, updateMulti];\n            ty.NotificationCenter.trigger(ddz.EventType.UPDATE_MULTI, params);\n        }\n\n        // 设置癞子牌点数\n        if (result.hasOwnProperty(\"wildcard\")) {\n            this.setLaizi(result[\"wildcard\"]);\n        }\n        //三张底牌，长度为3     //用不上，暂时不管\n        if (result.hasOwnProperty(\"basecard\")) {\n            this.objectInfo.m_baseCard = result[\"basecard\"];\n        }\n        //上把所出的牌\n        if (result.hasOwnProperty(\"topcard\")) {\n            this.objectInfo.m_topCard = result[\"topcard\"];\n        }\n        hall.LOGD(null, \"parseTableState in ddz._TableState\");\n    },\n\n    Reset: function() {\n        var tmp = this.normalInfo;\n        tmp.m_state = ddz.Enums.TableState.TABLEDSTAT_IDLE;\n        tmp.m_matchpcnt = 0;\n        tmp.m_nowop = 0;\n        tmp.m_banker = 0;\n        tmp.m_ccrc = 0;\n        tmp.m_dizhu = -1;\n        tmp.m_topseat = 0;\n        tmp.m_call = -1;\n        tmp.m_bomb = 0;\n        tmp.m_chuntian = 1;\n        tmp.m_show = 1;\n        tmp.m_super = 1;\n        tmp.m_bcmulti = 1;\n        tmp.m_grabCard = -1;\n        tmp.m_rangpaiMulti = -1;\n        tmp.m_rangpai = 0;\n\n        tmp.m_cardLaizi = -1;\n        this.objectInfo.m_baseCard = [];\n        this.objectInfo.m_topCard = [];\n        this.m_laiziNumber = -1;\n        hall.LOGD(null, \"Reset in ddz._TableState\");\n    },\n\n    calcMulti: function() {\n        var multi = 1;\n        var info = this.normalInfo;\n        //叫分\n        multi *= info.m_call;\n\n        //底牌\n        var dipai = info.m_bcmulti;\n        if (dipai > 1) {\n            multi *= dipai;\n        }\n\n        //明牌\n        var mingpai = info.m_show;\n        if (mingpai > 1) {\n            multi *= 2;\n        }\n\n        //炸弹\n        var zhadan = info.m_bomb;\n        var b;\n        if (zhadan >= 1) {\n            b = Math.pow(2, zhadan);\n            multi *= b;\n        }\n\n        //春天\n        var chuntian = info.m_chuntian;\n        if (chuntian > 1) {\n            multi *= chuntian;\n        }\n\n        return multi;\n    }\n});"]}