{"version":3,"sources":["ddzsingle_game_result.js"],"names":["ddz","GameResultKind","Invalid","NoWin","Lose","DaManGuan","ChunTian","LianSheng","NormalWin","GameResult","result","tag","setResult","val","gameResultObj","reset","parseResult","bIamDizhu","mySeatIndex","cc","log","JSON","stringify","nowin","dzwin","win","is","not","Set","get","isWin","getResultController","parent","PlayChuntianController","PlayGameFailedController","PlayNormalWinController"],"mappings":"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","file":"ddzsingle_game_result.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/singleAI","sourcesContent":["/*\n  * File : game_result.js\n  * Author : WangHp\n  * Fucntion : 封装游戏结果相关信息\n  * Date : 2015/2/10\n*/\n\n// 游戏结果种类\n(function() {\n\tddz.GameResultKind = {\n\t\tInvalid : 'invalid',\n\t\tNoWin : 'nowin',\n\t\tLose : 'lose',\n\t\tDaManGuan : 'damanguan',\n\t\tChunTian : 'chuntian',\n\t\tLianSheng : 'liansheng',\n\t\tNormalWin : 'normalwin',\n\t};\n})();\n\nddz.GameResult = function() {\n\tvar result = ddz.GameResultKind.Invalid;\n\tvar tag = 'ddz.GameResult'; \n\tvar setResult = function(val) {\n\t\tresult = val;\n\t}\n\n\t// 返给外部使用的对象\n\tvar gameResultObj = {};\n\tgameResultObj.reset = function() {\n\t\tsetResult(ddz.GameResultKind.Invalid);\n\t}\n\n\t// 根据服务器返回的结果判断游戏结果\n\t/*  result，服务器返回的结果; \n\t     bIamDizhu : 当前玩家是不是地主\n\t     mySeatIndex : 当前玩家座位id\n\t*/\n\tgameResultObj.parseResult = function(result, bIamDizhu, mySeatIndex) {\n\t\t//游戏结果\n\t\tcc.log('parseResult = ' + JSON.stringify(result));\n\t\t\n\t\tsetResult(ddz.GameResultKind.Invalid);\n\t\tif (typeof(result) == 'undefined' || result == null) {\n\t\t\tsetResult(ddz.GameResultKind.Invalid);\n\t\t\treturn;\n\t\t}\n\n\t\t// 首先判断是否是流局\n\t\tvar nowin = result['nowin'];\n\n\t\tif( typeof(nowin) !='undefined' && null!=result && 1==nowin ){\n\t\t\tsetResult(ddz.GameResultKind.NoWin);\n\t\t\treturn;\n\t\t}\n\n\t\t//地主是否胜利？\n\t\tvar dzwin = result[\"dizhuwin\"];\n\t\tvar win = (bIamDizhu && dzwin) || (!bIamDizhu && !dzwin);\n\n\t\t//失败\n\t\tif (!win) {\n\t\t\tsetResult(ddz.GameResultKind.Lose);\n\t\t\treturn;\n\t\t}\n\n\t\t//大满贯\n\t\tif (result['stat']['slam'] == 1) {\n\t\t\tsetResult(ddz.GameResultKind.DaManGuan);\n\t\t}\n\t\t//春天\n\t\telse if(result['stat']['chuntian']>1){\n\t\t\tsetResult(ddz.GameResultKind.ChunTian);\n\t\t}\n\t\t//连胜\n\t\telse if(result['winStreak'][mySeatIndex-1]>=3){\n\t\t\tsetResult(ddz.GameResultKind.LianSheng);\n\t\t}\n\t\t//普通胜利\n\t\telse{\n\t\t\tsetResult(ddz.GameResultKind.NormalWin);\n\t\t}\n\t}\n\n\tgameResultObj.is = function(val) {\n\t\tcc.log('test gameResultObj.is come in result = ' + result + ' val = ' + val);\n\t\treturn result === val;\n\t}\n\tgameResultObj.not = function(val) {\n\t\treturn result != val;\n\t}\n\tgameResultObj.Set = function(val) {\n\t\tcc.log('test gameResultObj.Set val = ' + val);\n\t\tsetResult(val);\n\t}\n\tgameResultObj.get = function() {\n\t\treturn result;\n\t}\n\tgameResultObj.isWin = function() {\n\t\treturn !gameResultObj.is(ddz.GameResultKind.Lose);\n\t}\n\n\t// 获取结算控件\n\tgameResultObj.getResultController = function(result, parent) {\n\t\tcc.log('gameResultObj.getResultController come in 0000');\n\t\t// setResult(ddz.GameResultKind.Lose); // for test\n\t\t// setResult(ddz.GameResultKind.NormalWin); // for test\n\t\tif (gameResultObj.is(ddz.GameResultKind.ChunTian)) {\n\t\t\t//播放春天动画\n\t\t\treturn new ddz.PlayChuntianController(result, parent);\n\t\t}\n\t\telse if (gameResultObj.is(ddz.GameResultKind.Lose)) {\n\t\t\treturn new ddz.PlayGameFailedController(result, parent);\n\t\t}\n\t\telse if (gameResultObj.is(ddz.GameResultKind.NormalWin) || gameResultObj.is(ddz.GameResultKind.DaManGuan) || gameResultObj.is(ddz.GameResultKind.LianSheng)) {\n\t\t\treturn new ddz.PlayNormalWinController(result, parent);\n\t\t} \n\t\t// 单机里没有nowin\n\t\t// else if (gameResultObj.is(ddz.GameResultKind.NoWin)) {\n\t\t// \treturn new ddz.PlayLiujuController(null, parent);\n\t\t// }\n\n\t\t// if (gameResultObj.is(ddz.GameResultKind.Lose)) {\n\t\t// \treturn new ddz.PlayGameFailedController(result, parent);\n\t\t// }\n\t\t// else if (gameResultObj.is(ddz.GameResultKind.NormalWin)) {\n\t\t// \treturn new ddz.PlayNormalWinController(result, parent);\n\t\t// }\n\t\t// else if (gameResultObj.is(ddz.GameResultKind.DaManGuan) || gameResultObj.is(ddz.GameResultKind.ChunTian) || gameResultObj.is(ddz.GameResultKind.LianSheng)) {\n\t\t// \treturn new ddz.PlayResultSpecialController(result, parent);\n\t\t// }\n\n\t\treturn null;\n\t}\n\n\treturn gameResultObj;\n};\n"]}