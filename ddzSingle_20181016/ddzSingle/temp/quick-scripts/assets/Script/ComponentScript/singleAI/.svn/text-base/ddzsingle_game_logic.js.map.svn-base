{"version":3,"sources":["ddzsingle_game_logic.js"],"names":["ddz","offLineGameLogic","meWin","dzWin","bIamDizhu","dzIndex","mySeatId","chuntianNum","coinNumArray","currentSilverCoinNum","multiNum","winStreak","GlobalFuncs","getWinStreak","petSkillAddSliverCnt","updateTableState","tableState","normalInfo","m_bomb","AIRobots","bombCount","m_chuntian","chuntian","m_bcmulti","bcmulti","m_show","showmulti","judgeEnding","result","dizhuPos","judgeChunTian","assembleGreatMasterInfo","isWin","info","addScore","curGreatMasterScore","databaseDriver","getMasterScore","lv","greatMasterHelper","calLvByScore","preMaxScore","lvTotalScore","curScore","addMasterScore","curGreatMasterScore2","cc","log","farmerPlayCardCnt","i","seatPlayCardCount","statisticsCoins","isSingleBreak","doubleGain","avoidLose","silverCoinNum","SINGLE_SCORE_BASE","breakBase","parseInt","GameWorld","singleBreakWorld","setCoinNumWhenDzWin","setCoinNumWheFramerWin","propEffectOnStatistics","petSkillGain","index","doubleGainStatistics","avoidLoseStatistics","petId","getMeselfShowPetId","res","petSkillMgr","winningStreakAddition","updateBreakThroughData","killBossRoundNum","runningChapter","runningLevel","count","addGameCount","killBossRoundNumBack","isPassCurStage","singleWorld","breakthroughDataMgr","setMyCoin","runningBigStageId","runningSmallStageId","updateWhenNotPass","starNumbers","getMaxStar","event","SingleEvent","PlayerTableLevelPassEvent","ty","NotificationCenter","trigger","eventName","updateWhenPass","chapter","level","updateMaxStar","isGameRewardGot","propInfo","getRewardProp","params","SingleEventType","SINGLE_EVT_UPDATE_LOCAL_PROP_CNT","setGameRewardmGot","updateBossData","nextBossData","offlineData","levels","games","life","coin","star","maxStar","base","name","type","toNextLevel","hall","EventType","HALL_POP_COMMON_MSG_BOX_SMALL","text","STRING","DDZ_OFFLINE_GAME_LOGIC_STRING_1000","duration","prizeInfo","prize","itemInfoArray","itemId","itemCount","hintUserPassInfo","itemsArray","config","items","itemName","length","id","str","DDZ_OFFLINE_GAME_LOGIC_STRING_1001","DDZ_OFFLINE_GAME_LOGIC_STRING_1002","openNewLevel","writeWordArray","curObj","bigGameId","smallGameId","setBossCurLife","setStageState","setStageStarCnt","prizeArray","nextBigGameId1","nextSmallGameId1","setStageStateOpen","starRangeNum1","starRangeNum2","gamecount","getGameCount","setCurBigGame","setCurSmallGame","obj","PetSkillAddSliverCnt","offlineGameEndProcess","getWinstreak","remouldResult","slamNum","winStreakNum","windoublesNum","greatMasterScoreNum","m_call","updateGameData","coinNode","getString","DDZ_OFFLINE_GAME_LOGIC_STRING_1003","DDZ_OFFLINE_GAME_LOGIC_STRING_1004","setString","updateBreakThroughDataWhenStaticOver","offlingGameMarch","gameObj","currentIndex","currentPlayPos","_mySeatIndex","_resetTopCardType","_clearPlayedCards","LOGD","_operateController","showPlay","_isUserInteractive","_isInTrust","cards","genOneStep","_tableState","m_topseat","objectInfo","m_topCard","GetNextIndex","_leftPlayerController","clearCards","_rightSeatinfo","playCards","_rightPlayerController","node","runAction","sequence","delayTime","callFunc","_PlayInSingle","_leftSeatinfo","setMultiNum","num","getMultiNum","refreshWhenPassGate","_type","getPlayTypeOfEnums","container","_extraCard","reAddIntoNode"],"mappings":"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","file":"ddzsingle_game_logic.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/singleAI","sourcesContent":["//\n//File : offline_game_play.js\n//\n//Function : 单机游戏逻辑\n// \n// Author : WangHp\n// \n// Date : 2015/2/11\n// \n\nddz.offLineGameLogic = function() {\n\n\tvar meWin = false; //我是不是赢了\n\tvar dzWin = false; //地主是不是赢了\n\tvar bIamDizhu = false; //我是不是地主\n\tvar dzIndex = 0; //地主的位置\n\tvar mySeatId = 1; //单机下我的座位号为1\n\tvar chuntianNum = 1; //春天倍数，1时不是春天；2时是春天\n\t// 单机玩家结算银币\n\tvar coinNumArray = [];\n\tvar currentSilverCoinNum = 0; //当前玩家银币数\n\tvar multiNum = 0;\n\tvar winStreak = ddz.GlobalFuncs.getWinStreak();\n\tvar petSkillAddSliverCnt = 0;\n\n\t// 游戏结束后更新tableState\n\tvar updateTableState = function(tableState) {\n\t\ttableState.normalInfo.m_bomb = ddz.AIRobots.bombCount;\n\t\ttableState.normalInfo.m_chuntian = ddz.AIRobots.chuntian;\n\t\ttableState.normalInfo.m_bcmulti = ddz.AIRobots.bcmulti;\n\t\ttableState.normalInfo.m_show = ddz.AIRobots.showmulti;\n\t}\n\n\t// 判断游戏结果\n\tvar judgeEnding = function(result) {\n\t\tdzWin = result['dizhuwin'];\n\t\tdzIndex = ddz.AIRobots.dizhuPos;\n\t\tif (dzIndex === mySeatId) {\n\t\t\tbIamDizhu = true;\n\t\t}\n\t\tmeWin = (bIamDizhu && dzWin) || (!bIamDizhu && !dzWin);\n\t\tif (meWin) {\n\t\t\twinStreak++;\n\t\t}else{\n\t\t\twinStreak = 0;\n\t\t}\n\t\t// 判断是否是春天状态\n\t\tjudgeChunTian()\n\n\t\t// result['greatMasterInfo'] = assembleGreatMasterInfo(meWin);\n\t}\n\n\t// 拼装大师分信息\n\tvar assembleGreatMasterInfo = function(isWin) {\n\t\t// old_maxscore: _greatMasterInfo[\"premaxscore\"] || 0, // 之前的大师段位总分\n\t\t// level: _greatMasterInfo[\"level\"] || 0, // 大师段位\n\t\t// score: _greatMasterInfo[\"score\"] || 0, // 当前大师分\n\t\t// maxscore: _greatMasterInfo[\"curmaxscore\"] || 0,// 当前段位大师总分\n\t\t// addScore: _greatMasterInfo['addScore'] || 0, // 赢得的大师分\n\t\tvar info = {};\n\t\tvar addScore = 0;\n\t\tif (isWin) {\n\t\t\taddScore = 1;\n\t\t}\n\t\t// 当前大师分\n\t\tvar curGreatMasterScore = ddz.databaseDriver.getMasterScore();\n\t\tvar lv = ddz.greatMasterHelper.calLvByScore(curGreatMasterScore);\n\t\tinfo['oldGreatMasterLevel'] = lv;\n\n\t\t// 前一级大师分段位\n\t\tvar preMaxScore = ddz.greatMasterHelper.lvTotalScore(lv);\n\t\tinfo['premaxscore'] = preMaxScore;\n\t\t\n\t\tvar curScore = curGreatMasterScore + addScore;\n\t\tinfo['level'] = ddz.greatMasterHelper.calLvByScore(curScore);\n\t\tinfo['newGreatMasterLevel'] = info['level'];\n\t\tinfo['score'] = curScore;\n\t\tinfo['curmaxscore'] = ddz.greatMasterHelper.lvTotalScore(info['level']+1);\n\t\tinfo['addScore'] = addScore;\n\n\t\t// 增加大师分\n\t\tif (addScore != 0) {\n\t\t\tddz.databaseDriver.addMasterScore(addScore);\n\t\t\tvar curGreatMasterScore2 = ddz.databaseDriver.getMasterScore();\n\t\t\tcc.log('test 111112 curGreatMasterScore2 = ' + curGreatMasterScore2);\n\t\t}\n\t\treturn info;\n\t}\n\n\t// 判断春天状态\n\tvar judgeChunTian = function() {\n\t\tif (dzWin) {\n\t\t\tvar farmerPlayCardCnt = 0;\n\t\t\tfor(var i=0; i<3; i++) {\n\t\t\t\tif (i+1 === dzIndex) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfarmerPlayCardCnt += ddz.AIRobots.seatPlayCardCount[i];\n\t\t\t}\n\t\t\tif (farmerPlayCardCnt > 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tchuntianNum = 2;\n\t\t\tmultiNum *= 2;\n\t\t\treturn;\n\t\t}\n\t\t// 农民胜利了\n\t\tif(ddz.AIRobots.seatPlayCardCount[dzIndex-1] >1){\n\t\t\treturn;\n\t\t}\n\t\tmultiNum *= 2;\n\t\tchuntianNum = 2;\n\t}\n\n\t// 统计计算各个玩家的银币结算数目\n\tvar statisticsCoins = function(isSingleBreak, doubleGain, avoidLose) {\n\t\tvar silverCoinNum = ddz.SINGLE_SCORE_BASE * multiNum;\n\t\tif (isSingleBreak) {\n\t\t\tvar breakBase = parseInt(ddz.GameWorld.singleBreakWorld[\"curLevelBase\"]);\n\t\t\tsilverCoinNum =  breakBase * multiNum;\n\t\t}\n\n\t\tcc.log('test over 001 dzWin = ' + dzWin);\n\t\tfor (var i=1; i<4; i++) {\n\t\t\tif (dzWin) {\n\t\t\t\tsetCoinNumWhenDzWin(i, silverCoinNum);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tsetCoinNumWheFramerWin(i, silverCoinNum);\n\t\t}\n\n\t\tpropEffectOnStatistics(doubleGain, avoidLose);\n\t\tpetSkillGain();\n\t}\n\t// 地主胜利时设置银币结算量\n\tvar setCoinNumWhenDzWin = function(index, silverCoinNum) {\n\t\tif (index === dzIndex) {\n\t\t\tcoinNumArray[index] = 2 * silverCoinNum;\n\t\t\treturn;\n\t\t}\n\t\tcoinNumArray[index] = -silverCoinNum;\n\t}\n\t// 农民胜利时设置银币结算量\n\tvar setCoinNumWheFramerWin = function(index, silverCoinNum) {\n\t\tif (index === dzIndex) {\n\t\t\tcoinNumArray[index] = -(2*silverCoinNum);\n\t\t\treturn;\n\t\t}\n\t\tcoinNumArray[index] = silverCoinNum;\n\t}\n\n\t// 道具结算相关逻辑\n\tvar propEffectOnStatistics = function(doubleGain, avoidLose) {\n\t\tif (doubleGain) {\n\t\t\tdoubleGainStatistics();\n\t\t}\n\t\tif (avoidLose) {\n\t\t\tavoidLoseStatistics();\t\t\n\t\t}\n\t}\n\n\t// 宠物技能的作用\n\tvar petSkillGain = function() {\n\t\tif (!meWin) {\n\t\t\treturn;\n\t\t}\n\t\tpetSkillAddSliverCnt = 0;\n\n\t\tvar petId = ddz.GlobalFuncs.getMeselfShowPetId();\n\t\tvar res = ddz.petSkillMgr.winningStreakAddition(petId, winStreak);\n\t\tif (!res || typeof(res)=='undefined' || res<0) {\n\t\t\treturn;\n\t\t}\n\t\tcoinNumArray[1] += res;\n\t\tpetSkillAddSliverCnt = res;\n\t}\n\n\t// 使用双倍卡后的统计结算\n\tvar doubleGainStatistics = function() {\n\t\tif (!meWin) {\n\t\t\treturn;\n\t\t}\n\t\tif (bIamDizhu) {\n\t\t\t// 我是地主，所有的结算都翻倍\n\t\t\tcoinNumArray[1] *= 2;\n\t\t\tcoinNumArray[2] *= 2;\n\t\t\tcoinNumArray[3] *= 2;\n\t\t\treturn;\n\t\t}\n\t\t// 我是农民，地主再赔我\n\t\tcoinNumArray[dzIndex] -= coinNumArray[1];\n\t\tcoinNumArray[1] *= 2;\n\t}\n\t// 保护卡的统计结算\n\tvar avoidLoseStatistics = function() {\n\t\tif (meWin) {\n\t\t\treturn;\n\t\t}\n\t\tif (bIamDizhu) {\n\t\t\t// 谁也得不到啊～～～～\t\n\t\t\tcoinNumArray[1] = 0;\n\t\t\tcoinNumArray[2] = 0;\n\t\t\tcoinNumArray[3] = 0;\n\t\t\treturn;\n\t\t}\n\t\t// 地主的收获减少\n\t\tcoinNumArray[dzIndex] -= coinNumArray[1];\n\t\tcoinNumArray[1] = 0;\n\t}\n\n\t//闯关数据更新\n\tvar updateBreakThroughData = function() {\n\t\t// 干掉boss所用的回合数增1\n\t\tddz.AIRobots.killBossRoundNum += 1;\n\t\t// 增加游戏次数\n\t\tvar runningChapter = ddz.GameWorld.singleBreakWorld['bigGameId'] + 1;\n\t\tvar runningLevel = ddz.GameWorld.singleBreakWorld['smallGameId'] + 1;\n\t\tvar count = ddz.databaseDriver.addGameCount(runningChapter, runningLevel);\n\t\tddz.AIRobots.killBossRoundNumBack = count;\n\t\tddz.AIRobots.isPassCurStage = false;\n\n\t\tcc.log('obj.offlineGameEndProcess', runningChapter, runningLevel, count)\n\n\t\tvar singleWorld = ddz.GameWorld.singleBreakWorld;\n\t\t// 更新自己的银币数\n\t\tddz.breakthroughDataMgr.setMyCoin(currentSilverCoinNum, true);\n\n\t\t// 更新当前boss的银币数\n\t\tsingleWorld[\"curBossCoin\"] = parseInt(singleWorld[\"curBossCoin\"]) + coinNumArray[2];\n\t\tif (singleWorld[\"curBossCoin\"] < 0) {\n\t\t\tsingleWorld[\"curBossCoin\"] = 0;\n\t\t};\n\t\tcc.log('boss coin singleWorld[\"curBossCoin\"] = ' + singleWorld[\"curBossCoin\"]);\n\n\t\tddz.AIRobots.runningBigStageId = singleWorld[\"bigGameId\"];\n\t\tddz.AIRobots.runningSmallStageId = singleWorld[\"smallGameId\"];\n\t\t\n\t\t// singleWorld[\"curBossCoin\"] = 0; // @TEST for test\n\t\t// ddz.AIRobots.killBossRoundNum = 20;\n\n\t\tif (singleWorld[\"curBossCoin\"] > 0) {\n\t\t\tupdateWhenNotPass(singleWorld);\n\t\t\treturn;\n\t\t}\n\t\tvar starNumbers = getMaxStar(singleWorld)\n\n\t\t// 过关事件\n\t\tcc.log('ddz.SingleEvent.PlayerTableLevelPassEvent', runningChapter, runningLevel, starNumbers);\n\t\tvar event = new ddz.SingleEvent.PlayerTableLevelPassEvent(runningChapter, runningLevel, starNumbers);\n\t\tty.NotificationCenter.trigger(ddz.SingleEvent.PlayerTableLevelPassEvent.eventName, event);\n\n\t\tupdateWhenPass(singleWorld);\n\t}\n\n\t// 过关时的更新\n\tvar updateWhenPass = function(singleWorld) {\n\t\tcc.log('updateWhenPass', singleWorld['bigGameId'], singleWorld['smallGameId'])\n\t\tvar chapter = singleWorld['bigGameId'] + 1;\n\t\tvar level = singleWorld['smallGameId'] + 1;\n\n\t\tsingleWorld[\"isEnterNextBoss\"] = true;\n\t\tupdateMaxStar(singleWorld);\n\n\t\t// 已过关\n\t\tddz.AIRobots.isPassCurStage = true;\n\t\t\n\t\t// 标识本关通关\n\t\tsingleWorld[\"curBossState\"] = 2;\n\n\t\t// 是否已经领取过道具，若已经领取则不再次领取\n\t\tif (!ddz.databaseDriver.isGameRewardGot(chapter, level)) {\n\t\t\t// 获取关卡奖励道具\n\t\t\tvar propInfo = getRewardProp(singleWorld);\n\t\t\t// 更新道具信息\n\t\t\tvar params = [{'propId':propInfo['propId'], 'cnt':propInfo['cnt']}];\n\t\t\tty.NotificationCenter.trigger(ddz.SingleEventType.SINGLE_EVT_UPDATE_LOCAL_PROP_CNT, params);\n\t\t\t// 记录领取奖励\n\t\t\tddz.databaseDriver.setGameRewardmGot(chapter, level);\n\n\t\t\t// 通知用户获取了哪些道具及哪关解锁了\n\t\t\t// hintUserPassInfo(propInfo['propId'], propInfo['cnt'], singleWorld);\n\t\t}\n\n\t\t// // 开启新关卡\n\t\t// openNewLevel(singleWorld);\n\n\t\t// // 进入下一关卡的处理\n\t\t// toNextLevel(singleWorld);\n\t\t// // 更新下一关boss数据\n\t\t// updateBossData(singleWorld);\n\t}\n\n\t// 更新下一关boss数据\n\tvar updateBossData = function(singleWorld) {\n\t\tvar nextBossData = ddz.GameWorld.offlineData.levels[singleWorld[\"bigGameId\"]].games[singleWorld[\"smallGameId\"]];\n\t\t// 刷新boss的生命值为下一关卡的boss生命\n\t\tsingleWorld[\"curBossLife\"] = nextBossData.life;\n\t\t// 刷新boss的coin值为下一关的boss值\n\t\tsingleWorld[\"curBossCoin\"] = nextBossData.coin;\n\t\t// 刷新下一关卡的星级\n\t\tsingleWorld[\"curStarRangeNum1\"] = nextBossData.star[0];\n\t\tsingleWorld[\"curStarRangeNum2\"] = nextBossData.star[1];\n\t\tsingleWorld[\"curMaxStar\"] = nextBossData.maxStar;\n\t\t// 重置下一关的底倍数\n\t\tsingleWorld[\"curLevelBase\"] = nextBossData.base;\n\t\t// 重置下一关的boss的名字\n\t\tsingleWorld[\"curBossName\"] = nextBossData.name;\n\t\t// 重置下一关的玩法\n\t\tsingleWorld[\"curPlayType\"] = nextBossData.type;\n\t\t// 重置战胜boss所用的局数\n\t\tddz.AIRobots.killBossRoundNum = 0;\n\t}\n\n\t// 跳转关卡处理\n\tvar toNextLevel = function(singleWorld) {\n\t\tif(singleWorld[\"smallGameId\"] == 5){\n\t\t\tif(singleWorld[\"bigGameId\"] == 5){\n\t\t\t\t//弹提示信息\n\t\t\t\tty.NotificationCenter.trigger(hall.EventType.HALL_POP_COMMON_MSG_BOX_SMALL, \n\t\t\t\t\t{\n\t\t\t\t\t\ttext:ddz.STRING.DDZ_OFFLINE_GAME_LOGIC_STRING_1000,\n\t\t\t\t\t\tduration:1\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}else{\n\t\t\t\tsingleWorld[\"bigGameId\"] += 1;\n\t\t\t\tsingleWorld[\"smallGameId\"] = 0;\n\t\t\t}\n\t\t}else{\n\t\t\tsingleWorld[\"smallGameId\"] += 1;\n\t\t}\n\t} \n\n\t// 获取关卡奖励道具\n\tvar getRewardProp = function(singleWorld) {\n\t\t// 更新道具信息\n\t\tvar prizeInfo = ddz.GameWorld.offlineData.levels[singleWorld[\"bigGameId\"]].games[singleWorld[\"smallGameId\"]].prize;\n\t\tvar itemInfoArray = prizeInfo[0];\n\t\tvar itemId = itemInfoArray[1];\n\t\tvar itemCount = itemInfoArray[2];\n\t\treturn {'propId':itemId, 'cnt':itemCount};\n\t}\n\n\t// 提示用户\n\tvar hintUserPassInfo = function(itemId, itemCount, singleWorld) {\n\t\tcc.log('hintUserPassInfo', itemId, itemCount)\n\t\t// 给予道具获取的提示\n\t\tvar itemsArray = ddz.GameWorld.offlineData.config.items;\n\t\tvar itemName = \"\";\n\t\tfor(var i = 0;i < itemsArray.length;i++){\n\t\t\tif(itemsArray[i].id == itemId){\n\t\t\t\titemName = itemsArray[i].name;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(itemName.length <= 1){\n\t\t\treturn;\n\t\t}\n\n\t\tvar str = ddz.STRING.DDZ_OFFLINE_GAME_LOGIC_STRING_1001 + itemName + \"x\" + itemCount + \",\" + singleWorld[\"curBossName\"] + ddz.STRING.DDZ_OFFLINE_GAME_LOGIC_STRING_1002;\n\t\t\t//弹提示信息\n\t\tty.NotificationCenter.trigger(hall.EventType.HALL_POP_COMMON_MSG_BOX_SMALL, \n\t\t\t{text:str,duration:3});\n\t}\n\n\t// 开启新关卡\n\tvar openNewLevel = function(singleWorld) {\n\t\t// 还原local.json中该关卡的银币值\n\t\tsingleWorld[\"curBossCoin\"] = singleWorld[\"curBossLife\"];\n\n\t\t// 更新local.json中bigGameId、smallGameId对应的关卡的coin、state、next、maxStar值及自己的银币值\n\t\tvar writeWordArray = [\n\t\t\t\"bigGameId\",\n\t\t\t\"smallGameId\",\n\t\t\t\"curBossCoin\",\n\t\t\t\"curBossState\",\n\t\t\t\"curMaxStar\",\n\t\t];\n\t\tvar curObj = {};\n\t\tfor(var i = 0;i < writeWordArray.length;i++){\n\t\t\tcurObj[writeWordArray[i]] = singleWorld[writeWordArray[i]];\n\t\t}\n\n\t\t// 更新BOSS血量\n\t\tvar bigGameId = singleWorld['bigGameId'];\n\t\tvar smallGameId = singleWorld['smallGameId'];\n\t\tddz.breakthroughDataMgr.setBossCurLife(bigGameId, smallGameId, singleWorld['curBossCoin']);\n\t\t// 更新关卡状态\n\t\tddz.breakthroughDataMgr.setStageState(bigGameId, smallGameId, singleWorld['curBossState']);\n\t\t// 更新星级\n\t\tddz.breakthroughDataMgr.setStageStarCnt(bigGameId, smallGameId, singleWorld['curMaxStar']);\n\n\t\t// 标识本关通过后有哪些关卡就可以玩了\n\t\tvar prizeInfo = ddz.GameWorld.offlineData.levels[singleWorld[\"bigGameId\"]].games[singleWorld[\"smallGameId\"]].prize;\n\t\tvar prizeArray = prizeInfo[1];\n\t\tif(prizeArray[0] == 1){// 不处理为2的\n\t\t\tif(prizeArray[1]){\n\t\t\t\tvar nextBigGameId1 = parseInt(prizeArray[1] / 10) - 1;\n\t\t\t\tvar nextSmallGameId1 = parseInt(prizeArray[1] % 10) - 1;\n\t\t\t\tcc.log('nextBigGameId1 = ' + nextBigGameId1 + ' nextSmallGameId1 = ' + nextSmallGameId1);\n\t\t\t\t// 设置下一关状态为1\n\t\t\t\tddz.breakthroughDataMgr.setStageStateOpen(nextBigGameId1, nextSmallGameId1);\n\t\t\t}\n\t\t}\n\t}\n\n\t// 获取过关后的星级\n\tvar getMaxStar = function(singleWorld) {\n\t\tvar starRangeNum1 = singleWorld[\"curStarRangeNum1\"];\n\t\tvar starRangeNum2 = singleWorld[\"curStarRangeNum2\"];\n        var gamecount = ddz.databaseDriver.getGameCount(singleWorld['bigGameId']+1, singleWorld['smallGameId']+1);\n        cc.log('getMaxStar:',\n        \t'chapter=',singleWorld['bigGameId']+1,\n        \t'level=', singleWorld['smallGameId']+1,\n        \t'starRangeNum1=', starRangeNum1,\n        \t'starRangeNum2=', starRangeNum2,\n        \t'gamecount=', gamecount,\n        \t'ddz.AIRobots.killBossRoundNum=', ddz.AIRobots.killBossRoundNum)\n\t\tif(gamecount < starRangeNum1){\n\t\t\treturn 3;\n\t\t}\n\t\tif(gamecount>=starRangeNum1 && gamecount<=starRangeNum2){\n\t\t\treturn 2;\n\t\t}\n\t\treturn 1;\n\t}\n\t// 更新星级\n\tvar updateMaxStar = function(singleWorld) {\n\t\tvar star = getMaxStar(singleWorld);\n\t\tcc.log('updateMaxStar:',\n        \t'chapter=',singleWorld['bigGameId']+1,\n        \t'level=', singleWorld['smallGameId']+1,\n        \t'star=', star,\n        \t'curMaxStar=', singleWorld['curMaxStar']);\n\t\tif (star > singleWorld['curMaxStar']) {\n\t\t\tsingleWorld['curMaxStar'] = star;\n\t\t}\n\t}\n\n\t// 没过关时的更新\n\tvar updateWhenNotPass = function(singleWorld) {\n\t\tsingleWorld[\"isEnterNextBoss\"] = false;\n\t\t// 更新local.json中bigGameId、smallGameId对应的关卡的coin值及自己的银币值\n\t\tvar writeWordArray = [\n\t\t\t\"bigGameId\",\n\t\t\t\"smallGameId\",\n\t\t\t\"curBossCoin\"\n\t\t];\n\n\t\t// 更新数据\n\t\tvar bigGameId = singleWorld['bigGameId'];\n\t\tvar smallGameId = singleWorld['smallGameId'];\n\t\tddz.breakthroughDataMgr.setCurBigGame(bigGameId);\n\t\tddz.breakthroughDataMgr.setCurSmallGame(smallGameId);\n\t\tddz.breakthroughDataMgr.setBossCurLife(bigGameId, smallGameId, singleWorld['curBossCoin'])\n\t}\n\n\tvar obj = {};\n\n\tobj.PetSkillAddSliverCnt = function() {\n\t\treturn petSkillAddSliverCnt;\n\t}\n\n\t// 游戏结束后的处理\n\tobj.offlineGameEndProcess = function(tableState, result, isSingleBreak, doubleGain, avoidLose) {\n\t\t// cc.log('obj.offlineGameEndProcess', tableState, result, isSingleBreak, doubleGain, avoidLose);\n\t\t// //上报单机游戏结束日志\n\t\t// ddz.reportHelper.reportGameData(ddz.reportKind.REPORT_GAME_END, isSingleBreak);\n\n\t\t//以下函数调用顺序不能变\n\t\t// 单机游戏结算逻辑\n\t\tupdateTableState(tableState);\n\t\t// 判断游戏结果\n\t\tjudgeEnding(result);\n\t\t// 统计结算银币\n\t\t// statisticsCoins(isSingleBreak, doubleGain, avoidLose);\n\t}\n\n\tobj.getWinstreak = function() {\n\t\treturn winStreak;\n\t}\n\t\n\t// 模仿网络场构造result\n\tobj.remouldResult = function(result,slamNum,winStreakNum,windoublesNum,base,dizhuPos,greatMasterScoreNum, tableState) {\n\t\tcc.log('obj.remouldResult', result,slamNum,winStreakNum,windoublesNum,greatMasterScoreNum, tableState);\n\t\t// 单机场春天结算需要满足的条件chuntian字段的值大于1\n\t\tresult[\"stat\"] = {};\n\t\t// 单机场大满贯胜利结算需要满足的条件:0不是1是\n\t\tresult[\"stat\"][\"slam\"] = slamNum;\n\t\tresult[\"stat\"][\"chuntian\"] = chuntianNum;\n\t\t// 底牌\n\t\tresult[\"stat\"][\"bcmulti\"] = 1;\n\t\t// 叫分\n\t\tresult[\"stat\"][\"call\"] = tableState.normalInfo.m_call;\n\n\t\t// 明牌\n\t\tresult[\"stat\"][\"show\"] = 1;\n\n\t\t// 底注\n\t\tresult[\"stat\"][\"base\"] = base;\n\t\t// 地主座位号\n\t\tresult[\"stat\"][\"dizhu\"] = dizhuPos;\n\t\t// 炸弹\n\t\tresult[\"stat\"][\"bomb\"] = tableState.normalInfo.m_bomb;\n\n\t\tchuntianNum = 1; //重置\n\t\t// 单机场连胜结算需要满足的条件，连胜数大于等于3\n\t\tresult[\"winStreak\"] = [];\n\t\tresult[\"winStreak\"][0] = winStreak;// 连胜的数量\n\t\t// 单机场大满贯、春天、连胜都需要的数据:金币变化数\n\t\tfor(var i = 1;i < 4;i++){\n\t\t\tresult[\"seat\" + i] = [];\n\t\t\tresult[\"seat\" + i][0] = coinNumArray[i];\n\t\t}\n\t\tresult[\"windoubles\"] = windoublesNum// 倍数\n\n\t\tresult[\"skillScoreInfos\"] = [];\n\t\tresult[\"skillScoreInfos\"][0] = {};\n\t\tresult[\"skillScoreInfos\"][0][\"score\"] = greatMasterScoreNum;// 大师分数\n\t}\n\n\t// 更新游戏数据\n\tobj.updateGameData = function(coinNode, isSingleBreak) {\n\t\tcurrentSilverCoinNum = parseInt(coinNode.getString()) + coinNumArray[1];\n\t\tif (currentSilverCoinNum <= 0) {// 如果银币输到0\n\t\t\tif(isSingleBreak){// 如果是单机闯关，则此处暂设为0，然后在银币label执行完放大缩小动画后利用timer调用addSilverNum方法每隔一定时间为用户增加一定数量银币\n\t\t\t\tcurrentSilverCoinNum = 0;\n\t\t\t}else{// 如果是普通的单机场，则直接给10000，然后提示用户\n\t\t\t\tcurrentSilverCoinNum = 10000;\n\t\t\t\tvar str = ddz.STRING.DDZ_OFFLINE_GAME_LOGIC_STRING_1003 + currentSilverCoinNum + ddz.STRING.DDZ_OFFLINE_GAME_LOGIC_STRING_1004;\n\t\t\t\tty.NotificationCenter.trigger(hall.EventType.HALL_POP_COMMON_MSG_BOX_SMALL, {text:str,duration:2});\n\t\t\t}\n\t\t}\n\t\tcoinNode.setString('' + currentSilverCoinNum);\n\t\tif (isSingleBreak) {\n\t\t\tupdateBreakThroughData();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tddz.breakthroughDataMgr.setMyCoin(currentSilverCoinNum);\n\t}\n\n\t// 结算后更新关卡数据\n\tobj.updateBreakThroughDataWhenStaticOver = function() {\n\t\tvar singleWorld = ddz.GameWorld.singleBreakWorld;\n\t\tcc.log('updateBreakThroughDataWhenStaticOver come in 000');\n\t\t// 开启新关卡\n\t\topenNewLevel(singleWorld);\n\n\t\t// 进入下一关卡的处理\n\t\ttoNextLevel(singleWorld);\n\t\t// 更新下一关boss数据\n\t\tupdateBossData(singleWorld);\n\t\tcc.log('updateBreakThroughDataWhenStaticOver come in 000');\n\t}\n\n\t// 游戏进行中的逻辑： 这段代码直接拷贝的ddz_play_controller.js中的_PlayInSingle相应逻辑，将this.修改为gameObj.\n\tobj.offlingGameMarch = function(gameObj, dizhuPos) {\n\t\tvar currentIndex = ddz.AIRobots.currentPlayPos;\n\t\tif (currentIndex == gameObj._mySeatIndex) \n\t\t{\n\t\t\tgameObj._resetTopCardType();\n\t\t\tgameObj._clearPlayedCards();\n\t\t\tddz.LOGD('test opr', 'showPlay come in 0000');\n\t\t\tgameObj._operateController.showPlay();\n\t\t\tgameObj._isUserInteractive = true;\n\t\t\tif (gameObj._isInTrust) {\n\t\t\t\t// 托管，替玩家出一手牌\n\t\t\t\t// gameObj.playCanrdsInTrust();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tvar cards = ddz.AIRobots.genOneStep();\n\t\tif (cards.length > 0) {\n\t\t\tgameObj._tableState.normalInfo.m_topseat = currentIndex;\n\t\t\tgameObj._tableState.objectInfo.m_topCard = cards;\n\t\t}\n\n\t\tif (currentIndex == ddz.GlobalFuncs.GetNextIndex(gameObj._mySeatIndex)) {\n\t\t\tgameObj._leftPlayerController.clearCards(); //因为联网模式下，是闹钟显示的时候清除掉原手牌，而单机模式下没有闹钟，所以在此显示清除\n\t\t\tgameObj._rightSeatinfo.playCards(cards);\n\t\t\tgameObj._rightPlayerController.playCards(cards, dizhuPos==currentIndex);\n\t\t\tgameObj.node.runAction(cc.sequence(cc.delayTime(2), cc.callFunc(gameObj._PlayInSingle, gameObj)));\n\t\t}\n\t\telse {\n\t\t\tgameObj._leftSeatinfo.playCards(cards);\n\t\t\tgameObj._leftPlayerController.playCards(cards, dizhuPos==currentIndex);\n\t\t\tgameObj._PlayInSingle();\n\t\t}\n\t}\n\t\n\tobj.setMultiNum = function(num) {\n\t\tmultiNum = num;\n\t}\n\tobj.getMultiNum = function() {\n\t\treturn multiNum;\n\t}\n\n\tobj.refreshWhenPassGate = function(gameObj) {\n\t\tvar singleWorld = ddz.GameWorld.singleBreakWorld;\n\t\tif(!singleWorld[\"isEnterNextBoss\"]){\n\t\t\treturn;\n\t\t}\n\n\t\t// // 如果过关了\n\t //    \tvar bigGameId = singleWorld[\"bigGameId\"];\n\t //    \tvar smallGameId = singleWorld[\"smallGameId\"];\n\t //    \tgameObj.singleBreakController.refreshUI(bigGameId,smallGameId);\n\t //    \tgameObj.singleBreakController.runPopWindowAction();\n\t    \t// 如果跳了一个大关卡，会有玩法的变化\n\t    \tif (gameObj._type == singleWorld.getPlayTypeOfEnums(singleWorld[\"curPlayType\"])) {\n\t    \t\t// do nothing\n\t    \t}\n\t    \telse{\n\t    \t\tgameObj._type = singleWorld.getPlayTypeOfEnums(singleWorld[\"curPlayType\"]);\n\t    \t\t// 单机模式中没有二斗\n\t    \t\tvar container = gameObj[\"extra_card\"];\n\t\t\t\tgameObj._extraCard.reAddIntoNode(container, gameObj._type);\n\t    \t}\n\t}\n\n\treturn obj;\n};\n"]}