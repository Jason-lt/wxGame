{"version":3,"sources":["ddz_tableView.js"],"names":["cc","Class","extends","Component","ctor","cellPool","properties","cellComponent","contentWidth","contentHeight","cellHeight","startIndex","allLong","scrollOffSet","scrollView","default","type","ScrollView","cell","Prefab","dataArray","onLoad","NodePool","content","width","height","node","on","scrollViewisScrolling","scrollViewisScrollToBottom","addDataArray","concat","length","setDataArray","parseInt","i","put","instantiate","makeCellWithIndex","scrollToOffset","index","ddz","LOGD","obj","ddz_cell","size","get","y","addChild","ddz_rewardCellS","getComponent","addDataWithObject","deleteCellWithCell","removeFromParent","scrolView","nowY","getScrollOffset","ty","NotificationCenter","trigger","EventType","SCROLLTOBOTTOM","starIn","getChildByTag","j","end"],"mappings":"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","file":"ddz_tableView.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n    ctor : function () {\n        this.cellPool = null;\n    },\n\n    properties: {\n\n        cellComponent : \"ddz_rewardCell\",\n        contentWidth:600,\n        contentHeight : 800,\n        cellHeight : 105,\n\n        startIndex : 0,\n        allLong : 0,\n        scrollOffSet : 0,\n\n        scrollView : {\n            default : null,\n            type : cc.ScrollView,\n        },\n\n        cell : {\n            default : null,\n            type : cc.Prefab\n        },\n        dataArray : [],\n\n    },\n\n    onLoad : function() {\n        this.cellPool = new cc.NodePool();\n\n        this.scrollView.content.width = this.contentWidth;\n        this.scrollView.content.height = this.contentHeight;\n        this.scrollView.node.on(\"scrolling\",this.scrollViewisScrolling,this);\n        this.scrollView.node.on(\"scroll-to-bottom\",this.scrollViewisScrollToBottom,this);\n        // var testA = [];\n        // for (var  i = 0;i < 5 ; i ++){\n        //     var obj = {\"data\" :[\"---\",\"----\",\"---\",i+\"\"]};\n        //     testA.push(obj);\n        // }\n        // this.setDataArray(testA);\n        // this.addDataArray([]);\n    },\n\n    addDataArray : function (dataArray) {\n\n        this.dataArray = this.dataArray.concat(dataArray);\n        // this.scrollOffSet = this.scrollView.getScrollOffset();\n        this.contentHeight = this.dataArray.length * this.cellHeight;\n        this.scrollView.content.height = this.contentHeight;\n        // this.scrollView.content.y = this.contentHeight/2;\n        // this.scrollViewisScrolling();\n        // this.scrollView.scrollToOffset(this.scrollOffSet,0);\n        // this.scrollViewisScrolling();\n    },\n    setDataArray: function (dataArray) {\n        // ddz.LOGD(null, \"file = [ddz_tableView] fun = [setDataArray] dataArray = \"+JSON.stringify(dataArray));\n        if (!dataArray || dataArray.length < 1){\n            return;\n        }\n        this.dataArray = dataArray;\n        this.contentHeight = this.dataArray.length * this.cellHeight;\n        this.scrollView.content.height = this.contentHeight;\n\n        this.startIndex = 0;\n        this.allLong = parseInt(this.scrollView.node.height/this.cellHeight + 2);\n\n        if (!this.cellPool){\n            this.cellPool = new cc.NodePool();\n        }\n        for (var i = 0; i <=  this.allLong; i++) {\n            this.cellPool.put(cc.instantiate(this.cell)); // 通过 putInPool 接口放入对象池\n        }\n        for (var  i = this.startIndex;i <= this.allLong; i ++){\n            this.makeCellWithIndex(i);\n        }\n        this.scrollView.scrollToOffset(0,0);\n        // ddz.LOGD(null, \"------this.scrollView.scrollToOffset-------\"+this.scrollView.getScrollOffset().y);\n        // this.scrollView.node.on(\"scrolling\",this.scrollViewisScrolling,this);\n    },\n\n    makeCellWithIndex : function (index) {\n        if(index > this.dataArray.length-1){\n            ddz.LOGD(null, \"没有这个cell了\");\n            return;\n        }\n        var obj = this.dataArray[index];\n        // ddz.LOGD(null, \"==========++++=======\"+JSON.stringify(obj));\n        var ddz_cell;\n        if (this.cellPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\n            ddz_cell = this.cellPool.get();\n        } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\n            ddz_cell = cc.instantiate(this.cell);\n            // this.cellPool.put(ddz_cell);\n        }\n        // ddz_cell.y = this.contentHeight/2 - (index+0.5) * this.cellHeight;\n        ddz_cell.y = - (index+0.5) * this.cellHeight;\n        this.scrollView.content.addChild(ddz_cell,1,index+500);\n        var ddz_rewardCellS = ddz_cell.getComponent(this.cellComponent);\n        if (obj) {\n            ddz_rewardCellS.index = index;\n            ddz_rewardCellS.addDataWithObject(obj);\n        }\n    },\n\n    deleteCellWithCell : function (cell) {\n        if(cell){\n            this.cellPool.put(cell);\n            cell.removeFromParent();\n        }\n    },\n    scrollViewisScrolling : function (scrolView) {\n        var nowY = this.scrollView.getScrollOffset().y;\n        if (nowY+1000 > this.contentHeight){\n            // ddz.LOGD(null, \"=============================================\"+nowY);\n            ty.NotificationCenter.trigger(ddz.EventType.SCROLLTOBOTTOM);\n        }\n        var starIn = parseInt(nowY/this.cellHeight  -1);\n\n        if (starIn <0){\n            return;\n        }\n        //上滑\n        if (starIn < this.startIndex){\n            if (starIn < this.startIndex - this.allLong ){\n                for (var i = this.startIndex ;i <= this.startIndex + this.allLong ;i ++){\n                    var cell = this.scrollView.content.getChildByTag(i+500);\n                    this.deleteCellWithCell(cell);\n                }\n                for (var j =starIn ;j <= starIn + this.allLong;j ++){\n                    this.makeCellWithIndex(j);\n                }\n                this.startIndex = starIn;\n                return;\n            }\n            for (var i = starIn + this.allLong + 1 ;i <= this.startIndex + this.allLong ;i ++){\n                var cell = this.scrollView.content.getChildByTag(i+500);\n                this.deleteCellWithCell(cell);\n            }\n            for (var j =starIn ;j < this.startIndex;j ++){\n                this.makeCellWithIndex(j);\n            }\n            this.startIndex = starIn;\n           return;\n        }\n        //下滑\n        if (starIn > this.startIndex){\n            if (starIn > this.startIndex + this.allLong){\n                for (var i = this.startIndex ;i <= this.startIndex + this.allLong ;i ++){\n                    var cell = this.scrollView.content.getChildByTag(i+500);\n                    this.deleteCellWithCell(cell);\n                }\n                for (var j =starIn ;j <= starIn + this.allLong;j ++){\n                    this.makeCellWithIndex(j);\n                }\n                this.startIndex = starIn;\n                return;\n            }\n            for (var i = this.startIndex ;i < starIn ;i ++){\n                var cell = this.scrollView.content.getChildByTag(i+500);\n                this.deleteCellWithCell(cell);\n            }\n            for (var end = parseInt(this.startIndex + this.allLong+1) ; end <= parseInt(starIn + this.allLong) ; end ++){\n                this.makeCellWithIndex(end);\n            }\n            this.startIndex = starIn;\n        }\n    },\n    scrollViewisScrollToBottom : function () {\n        ddz.LOGD(null, \"------scrollViewisScrollToBottom-------\");\n        // this.scrollOffSet = this.scrollView.getScrollOffset().y;\n        // ty.NotificationCenter.trigger(ddz.EventType.SCROLLTOBOTTOM);\n    },\n});\n"]}