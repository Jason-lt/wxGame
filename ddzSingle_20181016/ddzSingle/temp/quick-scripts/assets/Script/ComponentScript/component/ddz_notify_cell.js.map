{"version":3,"sources":["ddz_notify_cell.js"],"names":["cc","Class","extends","Component","properties","detailLabel","default","type","Label","timerLabel","bgBtn","Button","newNotify","Node","readNotify","resultMap","addDataWithObject","objc","setDetailInformation","string","versions","timer","msgid","get","setIsRead","readed","ty","NotificationCenter","listen","ddz","EventType","UPDATE_COMMON_CONFIG","changeState","readIndex","index","isRead","active","onClickBgBtn","that","hall","GlobalFuncs","showPopWinByPreFab","preFabNode","window","getComponent","setDetailTypeWithInfoMap","indexStr","ReadStringFromLocalStorage","matchModel","UPDATE_NOTIFY_INFO","JSON","stringify","indexList","parse","indexOf","push","setInLocalStorage","gameModel","notifyInfo","unReadCount","trigger","onDestroy","ignoreScope","messageRewardTitle"],"mappings":"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","file":"ddz_notify_cell.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["\n/*\n    通知公告cell\n */\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        detailLabel : {\n            default : null,\n            type : cc.Label\n        },\n\n        timerLabel : {\n            default : null,\n            type : cc.Label\n        },\n        bgBtn : {\n            default : null,\n            type : cc.Button\n        },\n\n        newNotify:cc.Node,\n        readNotify:cc.Node,\n\n        // noticeWindow : {\n        //     default : null,\n        //     type : cc.Prefab\n        // },\n        resultMap : {}\n        \n    },\n    addDataWithObject : function (objc) {\n        this.setDetailInformation(objc);\n    },\n    setDetailInformation:function (resultMap) {\n        this.detailLabel.string = resultMap.versions;\n        this.timerLabel.string = resultMap.timer;\n        // this.content = resultMap.content;\n\n\n        this.resultMap = resultMap;\n        // var indexStr = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.matchModel.UPDATE_NOTIFY_INFO, JSON.stringify([]));\n        //\n        // var indexList = JSON.parse(indexStr);\n        // // 缓存内容超过 60 条后清空通告本地缓存,删除最先30条缓存数据\n        // if (indexList.length > 60){\n        //     indexList.splice(0,indexList.length - 30);\n        //     hall.GlobalFuncs.setInLocalStorage(ddz.matchModel.UPDATE_NOTIFY_INFO, JSON.stringify(indexList));\n        // }\n        // this.setIsRead(!(indexList.indexOf(this.resultMap.index) == -1));\n\n        if (this.resultMap.msgid) {\n            if (this.resultMap.get == null) {\n                this.setIsRead(false);\n            }else {\n                this.setIsRead(this.resultMap.get == 1);\n            }\n        }else {\n            this.setIsRead(resultMap.readed);\n        }\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_COMMON_CONFIG,this.changeState,this);\n    },\n    changeState : function (readIndex) {\n        if(this.resultMap.index != null && this.resultMap.index == readIndex){\n            this.setIsRead(true);\n        }\n    },\n    setIsRead:function(isRead){\n        this.newNotify.active = !isRead;\n        this.readNotify.active = isRead;\n    },\n\n    onClickBgBtn:function(){\n        var that = this;\n        hall.GlobalFuncs.showPopWinByPreFab('prefabs/notifyWindow', function (preFabNode) {\n            var window = preFabNode.getComponent('ddz_notifyWindow');\n            window.setDetailTypeWithInfoMap(that.resultMap,\"cell\");\n        });\n\n        // if (this.resultMap.msgid) {\n        //     hall.MsgFactory.getMessageReward(this.resultMap.msgid);\n        //     ddz.gameModel.messageRewardTitle = this.resultMap.versions;\n        // }\n\n        var indexStr = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.matchModel.UPDATE_NOTIFY_INFO, JSON.stringify([]));\n        var indexList = JSON.parse(indexStr);\n        if (indexList.indexOf(this.resultMap.index) == -1) {\n            this.resultMap.readed = 1;\n            indexList.push(this.resultMap.index);\n            hall.GlobalFuncs.setInLocalStorage(ddz.matchModel.UPDATE_NOTIFY_INFO, JSON.stringify(indexList));\n            if (!this.resultMap.msgid) {\n                ddz.gameModel.notifyInfo.unReadCount --;\n                ty.NotificationCenter.trigger(ddz.EventType.UPDATE_COMMON_CONFIG);\n            }\n            this.setIsRead(true);\n        }\n        \n\n    },\n    onDestroy : function () {\n        ty.NotificationCenter.ignoreScope(this);\n        ddz.gameModel.messageRewardTitle = \"\";\n    }\n});"]}