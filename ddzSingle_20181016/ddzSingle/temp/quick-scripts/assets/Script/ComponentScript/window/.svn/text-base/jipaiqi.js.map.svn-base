{"version":3,"sources":["jipaiqi.js"],"names":["cc","Class","extends","Component","properties","poker_num_1","Label","poker_num_2","poker_num_3","poker_num_4","poker_num_5","poker_num_6","poker_num_7","poker_num_8","poker_num_9","poker_num_10","poker_num_11","poker_num_12","poker_num_13","poker_num_14","poker_num_15","jipaiqi_num","bg","Node","xiaopai","onLoad","active","ty","NotificationCenter","listen","ddz","EventType","OPEN_JIPAIJI","onOpenJipaiQi","CLOSE_JIPAIJI","onCloseJipaiQi","REMOVE_TABLE_ANI","onRemoveAni","UPDATE_CARD_NOTE","updateCardNote","UPDATE_JIPAIQI","updateGetReward","UPDATE_SHARE_STATE","updateShareState","string","hall","ME","udataInfo","jiPaiQiCount","shareType","Share","onShareType","clickStatShareTypeShareJiPaiQi","setPlayController","val","_playController","nums","refresh","cardNote","length","i","ani","node","getComponent","Animation","anim","getAnimationState","once","play","that","data","ignoreDipai","isStatus","Enums","PlayStatus","PLAY_STATUS_PREPARE","isErdou","top_cards","_topSeatinfo","model","m_card","p","GlobalFuncs","numberToPoint","left_cards","_leftSeatinfo","right_cards","_rightSeatinfo","_status","PLAY_STATUS_PLAYING","extra","_extraCards","_info","_point","LOGD","JSON","stringify","onClickButton","isClickJiPaiQi","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeButtonClick","MsgBoxManager","showToast","_config","gameConfig","getShareVideoConfigToCity","type","shareWithType","stop","onDestroy","ignoreScope"],"mappings":"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","file":"jipaiqi.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        poker_num_1:cc.Label,\n        poker_num_2:cc.Label,\n        poker_num_3:cc.Label,\n        poker_num_4:cc.Label,\n        poker_num_5:cc.Label,\n        poker_num_6:cc.Label,\n        poker_num_7:cc.Label,\n        poker_num_8:cc.Label,\n        poker_num_9:cc.Label,\n        poker_num_10:cc.Label,\n        poker_num_11:cc.Label,\n        poker_num_12:cc.Label,\n        poker_num_13:cc.Label,\n        poker_num_14:cc.Label,\n        poker_num_15:cc.Label,\n\n        jipaiqi_num:cc.Label,\n        bg:cc.Node,\n        xiaopai:cc.Node,\n    },\n\n    onLoad:function(){\n        this.bg.active = false;\n        this.xiaopai.active = false;\n\n        ty.NotificationCenter.listen(ddz.EventType.OPEN_JIPAIJI, this.onOpenJipaiQi, this);\n        ty.NotificationCenter.listen(ddz.EventType.CLOSE_JIPAIJI, this.onCloseJipaiQi, this);\n        ty.NotificationCenter.listen(ddz.EventType.REMOVE_TABLE_ANI, this.onRemoveAni, this);\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_CARD_NOTE, this.updateCardNote, this);\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_JIPAIQI,this.updateGetReward,this);\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_SHARE_STATE,this.updateShareState,this);\n        this.jipaiqi_num.string = hall.ME.udataInfo.jiPaiQiCount;\n    },\n\n    updateShareState:function(shareType){\n        if (shareType == ddz.Share.onShareType.clickStatShareTypeShareJiPaiQi){\n            this.onOpenJipaiQi();\n        }\n    },\n\n    setPlayController:function(val){\n        this._playController = val;\n    },\n\n    updateGetReward:function(){\n        this.jipaiqi_num.string = hall.ME.udataInfo.jiPaiQiCount;\n    },\n\n    onOpenJipaiQi:function(){\n        var nums = this.refresh();\n        var cardNote = nums;\n        if (cardNote.length && cardNote.length > 0) {\n            // for (var i = 0; i < cardNote.length; i++){\n            //     this['poker_num_' + (i+1)].string = cardNote[i] || 0;\n            // }\n            for (var i = 0; i < 15; i++){\n                this['poker_num_' + (i+1)].string = cardNote[i] || 0;\n            }\n        }else {\n            this.onCloseJipaiQi();\n            return;\n        }\n\n        if (!this.bg.active) {\n            this.bg.active = true;\n            this.xiaopai.active = true;\n            var ani = this.node.getComponent(cc.Animation);\n            var anim = ani.getAnimationState('jipaiqi');\n            anim.once(\"finished\", function () {\n\n            });\n            anim.play();\n            // if (hall.sxAdManager) {\n            //     hall.sxAdManager.hide();\n            // }\n\n        }\n\n        // hall.adManager.canShowTableBanner = false;\n        // hall.adManager.canShowTableTopBanner = false;\n        // // hall.adManager.destroyBannerAd();\n        // hall.adManager.destroyWidthBannerAd();\n    },\n\n    onCloseJipaiQi:function() {\n        var ani = this.node.getComponent(cc.Animation);\n        var anim = ani.getAnimationState('shouhui');\n        var that = this;\n        if  (that.bg.active) {\n            anim.once(\"finished\", function () {\n                that.bg.active = false;\n                that.xiaopai.active = false;\n                // ty.NotificationCenter.trigger(ddz.EventType.OPEN_DIVERSION);\n            });\n            anim.play();\n        }\n\n    },\n\n    updateCardNote:function(){\n        var data = this.refresh();\n        if (data.length && data.length > 0) {\n            // for (var i = 0; i < data.length; i++){\n            //     if (this['poker_num_' + (i+1)]) {\n            //         this['poker_num_' + (i+1)].string = data[i] || 0;\n            //     }\n            // }\n            for (var i = 0; i < 15; i++){\n                if (this['poker_num_' + (i+1)]) {\n                    this['poker_num_' + (i+1)].string = data[i] || 0;\n                }\n            }\n        }else {\n            this.onCloseJipaiQi();\n        }\n    },\n\n    refresh: function(ignoreDipai) {\n        if(this._playController.isStatus(ddz.Enums.PlayStatus.PLAY_STATUS_PREPARE)) {\n            return;\n        }\n\n        // 开始刷数据\n        var nums = [];\n        if(this._playController.isErdou()){// 二斗也显示记牌器\n            var top_cards = this._playController._topSeatinfo.model.m_card;\n            for(var i = 0;i < top_cards.length;i++){\n                var p = ddz.GlobalFuncs.numberToPoint(top_cards[i]);\n                if(nums[p]){\n                    nums[p] += 1;\n                }else {\n                    nums[p] = 1;\n                }\n            }\n\n            // var kickOut_cards = this._playController._erDouCardInfo.getKickOutCard();\n            // for(var i = 0;i < kickOut_cards.length;i++){\n            //     var p = ddz.GlobalFuncs.numberToValue(kickOut_cards[i]) - 1;\n            //     if (nums[p]) {\n            //         nums[p] += 1;\n            //     } else {\n            //         nums[p] = 1;\n            //     }\n            // }\n        }\n        else{\n            var left_cards = this._playController._leftSeatinfo.model.m_card;\n            for (var i = 0; i < left_cards.length; i++) {\n                var p = ddz.GlobalFuncs.numberToPoint(left_cards[i]);\n                if (nums[p]) {\n                    nums[p] += 1;\n                } else {\n                    nums[p] = 1;\n                }\n            }\n\n            var right_cards = this._playController._rightSeatinfo.model.m_card;\n\n            for (var i = 0; i < right_cards.length; i++) {\n                var p = ddz.GlobalFuncs.numberToPoint(right_cards[i]);\n                if (nums[p]) {\n                    nums[p] += 1;\n                } else {\n                    nums[p] = 1;\n                }\n            }\n\n        }\n        if (this._playController._status!=ddz.Enums.PlayStatus.PLAY_STATUS_PLAYING && !ignoreDipai) { //底牌还没加入玩家手牌的时候，需要算上。进入playing状态后，底牌已经加入玩家手牌，不需要计算\n            var extra = this._playController._extraCards;\n            for (var i = 0; i < extra.length; i++) {\n                var p = extra[i]._info._point;\n                if (nums[p]) {\n                    nums[p] += 1;\n                } else {\n                    nums[p] = 1;\n                }\n            }\n        }\n        ddz.LOGD(\"\",\"file = [jipaiqi] fun = [refresh] nums = \" + JSON.stringify(nums));\n        return nums;\n        // 开始刷界面\n        // this._setLabel(\"label0\", nums[14]);\n        // this._setLabel(\"label1\", nums[13]);\n        // this._setLabel(\"label2\", nums[1]);\n        // this._setLabel(\"label3\", nums[0]);\n        // for (var i = 4; i < 15; i++) { //i=14, nums[2] //i = 4, num[12]\n        // \tthis._setLabel(\"label\" + i, nums[16 - i]);\n        // }\n    },\n\n    onClickButton:function(){\n        ddz.isClickJiPaiQi = true;\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeButtonClick,\n            [\"jipaiqi\",\"click\"]);\n\n        if (this.bg.active) {\n            hall.MsgBoxManager.showToast({\"title\":\"当前已使用~\"});\n        }else {\n            var _config = ddz.gameConfig.getShareVideoConfigToCity();\n            if (_config && _config[\"jiPaiQi\"].type == \"share\") {\n                ddz.Share.shareWithType(ddz.Share.onShareType.clickStatShareTypeShareJiPaiQi);\n            }\n        }\n        // ty.NotificationCenter.trigger(ddz.EventType.USE_NEW_CARD_NOTE);\n    },\n\n    onRemoveAni:function(){\n        var ani = this.node.getComponent(cc.Animation);\n        ani.stop();\n    },\n\n    onDestroy:function () {\n        ty.NotificationCenter.ignoreScope(this);\n    }\n});\n"]}