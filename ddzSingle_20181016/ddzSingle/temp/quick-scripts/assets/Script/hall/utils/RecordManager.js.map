{"version":3,"sources":["RecordManager.js"],"names":["hall","AudioRecordManager","cc","Class","ctor","_recorder","_defaultTime","_cancel","initManager","wx","hasOwnProperty","getRecorderManager","onStart","ty","NotificationCenter","trigger","ddz","EventType","START_RECORD","that","onStop","res","LOGD","tempFilePath","STOP_RECORD","fs","getFileSystemManager","unlinkSync","onError","ERROR_RECORD","LOGE","errMsg","startRecord","time","start","duration","sampleRate","numberOfChannels","encodeBitRate","format","recordFileType","pauseRecord","pause","resumeRecord","resume","stop","cancel"],"mappings":";;;;;;AAAA;;;;AAIAA,KAAKC,kBAAL,GAA0BC,GAAGC,KAAH,CAAS;AAC/BC,UAAK,gBAAY;AACb,aAAKC,SAAL,GAAiB,IAAjB;AACA,aAAKC,YAAL,GAAoB,EAApB;AACA,aAAKC,OAAL,GAAe,KAAf;AACH,KAL8B;;AAO/BC,iBAAY,uBAAY;AACpB,YAAIC,GAAGC,cAAH,CAAkB,oBAAlB,CAAJ,EAA4C;AACxC,iBAAKL,SAAL,GAAiBI,GAAGE,kBAAH,EAAjB;AACA,iBAAKN,SAAL,CAAeO,OAAf,CAAuB,YAAY;AAC/BC,mBAAGC,kBAAH,CAAsBC,OAAtB,CAA8BC,IAAIC,SAAJ,CAAcC,YAA5C;AACH,aAFD;;AAIA,gBAAIC,OAAO,IAAX;AACA,iBAAKd,SAAL,CAAee,MAAf,CAAsB,UAAUC,GAAV,EAAe;AACjCrB,qBAAKsB,IAAL,CAAU,IAAV,EAAgB,mBAAmBD,IAAIE,YAAvC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAI,CAACJ,KAAKZ,OAAV,EAAkB;AACdM,uBAAGC,kBAAH,CAAsBC,OAAtB,CAA8BC,IAAIC,SAAJ,CAAcO,WAA5C,EAAyDH,IAAIE,YAA7D;AACH,iBAFD,MAGI;AACA,wBAAIE,KAAKhB,GAAGiB,oBAAH,EAAT;AACAD,uBAAGE,UAAH,CAAcN,IAAIE,YAAlB;AACH;AACJ,aAxBD;;AA0BA,iBAAKlB,SAAL,CAAeuB,OAAf,CAAuB,UAAUP,GAAV,EAAe;AAClC;AACAR,mBAAGC,kBAAH,CAAsBC,OAAtB,CAA8BC,IAAIC,SAAJ,CAAcY,YAA5C;AACA7B,qBAAK8B,IAAL,CAAU,IAAV,EAAgBT,IAAIU,MAApB;AACH,aAJD;AAKH,SAtCD,MAuCI;AACA/B,iBAAK8B,IAAL,CAAU,IAAV,EAAgB,iEAAhB;AACH;AACJ,KAlD8B;;AAoD/BE,iBAAY,qBAAUC,IAAV,EAAgB;;AAExBA,eAAOA,QAAQ,KAAK3B,YAApB;;AAEA,YAAI,CAAC,KAAKD,SAAV,EAAoB;AAChB;AACH;AACDL,aAAKsB,IAAL,CAAU,IAAV,EAAgB,iBAAiBW,IAAjC;AACA,aAAK1B,OAAL,GAAe,KAAf;AACA,aAAKF,SAAL,CAAe6B,KAAf,CAAqB;AACjBC,sBAAWF,OAAO,IADD;AAEjBG,wBAAa,KAFI;AAGjBC,8BAAmB,CAHF;AAIjBC,2BAAgB,KAJC;AAKjBC,oBAASvB,IAAIwB;AALI,SAArB;AAOH,KApE8B;;AAsE/BC,iBAAc,uBAAY;AACtB,aAAKpC,SAAL,CAAeqC,KAAf;AACH,KAxE8B;AAyE/BC,kBAAe,wBAAY;AACvB,aAAKtC,SAAL,CAAeuC,MAAf;AACH,KA3E8B;;AA6E/BC,UAAK,cAAUC,MAAV,EAAkB;AACnB,aAAKvC,OAAL,GAAeuC,MAAf;AACA,aAAKzC,SAAL,CAAewC,IAAf;AACH;AAhF8B,CAAT,CAA1B","file":"RecordManager.js","sourceRoot":"../../../../../../assets/Script/hall/utils","sourcesContent":["/**\n * 录音管理器\n * Created by xujing on 2018/4/26.\n */\nhall.AudioRecordManager = cc.Class({\n    ctor:function () {\n        this._recorder = null;\n        this._defaultTime = 15;\n        this._cancel = false;\n    },\n\n    initManager:function () {\n        if (wx.hasOwnProperty('getRecorderManager')){\n            this._recorder = wx.getRecorderManager();\n            this._recorder.onStart(function () {\n                ty.NotificationCenter.trigger(ddz.EventType.START_RECORD);\n            });\n\n            var that = this;\n            this._recorder.onStop(function (res) {\n                hall.LOGD(null, \"record file : \" + res.tempFilePath);\n\n                // var fs = wx.getFileSystemManager();\n                // var fileStr = fs.readFileSync(res.tempFilePath, 'base64');\n                // hall.LOGD(null, \"fs:\" + fileStr);\n                //\n                //\n                // var filePath = wx.env.USER_DATA_PATH + '/au.aac';\n                // fs.writeFileSync(filePath ,fileStr , 'base64');\n                //\n                // var musicPlayManager = wx.createInnerAudioContext();\n                // musicPlayManager.autoplay = true;\n                // musicPlayManager.loop = false;\n                // musicPlayManager.volume = 1;\n                // musicPlayManager.src = filePath;\n\n                if (!that._cancel){\n                    ty.NotificationCenter.trigger(ddz.EventType.STOP_RECORD, res.tempFilePath);\n                }\n                else{\n                    var fs = wx.getFileSystemManager();\n                    fs.unlinkSync(res.tempFilePath);\n                }\n            });\n\n            this._recorder.onError(function (res) {\n                //\n                ty.NotificationCenter.trigger(ddz.EventType.ERROR_RECORD);\n                hall.LOGE(null, res.errMsg);\n            });\n        }\n        else{\n            hall.LOGE(null, \"version is too old to suport record! please update your wechat!\");\n        }\n    },\n\n    startRecord:function (time) {\n\n        time = time || this._defaultTime;\n\n        if (!this._recorder){\n            return;\n        }\n        hall.LOGD(null, \"startRecord:\" + time);\n        this._cancel = false;\n        this._recorder.start({\n            duration : time * 1000,\n            sampleRate : 48000,\n            numberOfChannels : 2,\n            encodeBitRate : 64000,\n            format : ddz.recordFileType,\n        });\n    },\n\n    pauseRecord : function () {\n        this._recorder.pause();\n    },\n    resumeRecord : function () {\n        this._recorder.resume();\n    },\n\n    stop:function (cancel) {\n        this._cancel = cancel;\n        this._recorder.stop();\n    }\n});"]}