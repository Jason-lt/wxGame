{"version":3,"sources":["GlobalTimer.js"],"names":["hall","GlobalTimer","boot","MAX_COUNT","_curCounter","_curTime","Date","getTime","ty","NotificationCenter","listen","ddz","EventType","GET_TIMESTAMP","updateTime","that","MsgFactory","getTimeStamp","Timer","setTimer","cc","director","getCurTime","getCurDay","date","fullYear","getFullYear","month","getMonth","day","getDate","dataStr","LOGD","getCurDayList","dataList","getCurHours","hour","getHours","getCurLastSecond","toDaySecond","parseInt","timeObj","current_ts"],"mappings":";;;;;;AAAA;;;AAGAA,KAAKC,WAAL,GAAmB;;AAEfC,UAAK,gBAAY;AACb,aAAKC,SAAL,GAAiB,EAAjB,CADa,CACQ;AACrB,aAAKC,WAAL,GAAmB,CAAnB;AACA,aAAKC,QAAL,GAAgB,IAAIC,IAAJ,GAAWC,OAAX,KAAqB,IAArC;AACAC,WAAGC,kBAAH,CAAsBC,MAAtB,CAA6BC,IAAIC,SAAJ,CAAcC,aAA3C,EAA0D,KAAKC,UAA/D,EAA2E,IAA3E;AACA,YAAIC,OAAO,IAAX;AACAf,aAAKgB,UAAL,CAAgBC,YAAhB;AACAT,WAAGU,KAAH,CAASC,QAAT,CAAkBC,GAAGC,QAArB,EAA+B,YAAY;AACvCN,iBAAKX,WAAL;AACAW,iBAAKV,QAAL,IAAiB,CAAjB;AACA,gBAAIU,KAAKX,WAAL,IAAoBW,KAAKZ,SAA7B,EAAuC;AACnCY,qBAAKX,WAAL,GAAmB,CAAnB;AACAJ,qBAAKgB,UAAL,CAAgBC,YAAhB;AACH;AACJ,SAPD,EAOG,CAPH;AAQH,KAjBc;;AAmBfK,gBAAW,sBAAY;AACnB,eAAO,KAAKjB,QAAZ;AACH,KArBc;;AAuBf;;;;AAIAkB,eAAU,qBAAY;AAClB,YAAIC,OAAO,IAAIlB,IAAJ,CAAS,KAAKD,QAAL,GAAgB,IAAzB,CAAX;AACA,YAAIoB,WAAWD,KAAKE,WAAL,EAAf;AACA,YAAIC,QAAQH,KAAKI,QAAL,KAAkB,CAA9B;AACA,YAAIC,MAAML,KAAKM,OAAL,EAAV;;AAEA,YAAIC,UAAUN,WAAW,GAAX,GAAiBE,KAAjB,GAAyB,GAAzB,GAA+BE,GAA7C;;AAEAlB,YAAIqB,IAAJ,CAAShC,KAAKC,WAAd,EAA2B,SAAS8B,OAApC;AACA,eAAOA,OAAP;AACH,KArCc;;AAuCf;;;;AAIAE,mBAAc,yBAAY;AACtB,YAAIT,OAAO,IAAIlB,IAAJ,CAAS,KAAKD,QAAL,GAAgB,IAAzB,CAAX;AACA,YAAIoB,WAAWD,KAAKE,WAAL,EAAf;AACA,YAAIC,QAAQH,KAAKI,QAAL,KAAkB,CAA9B;AACA,YAAIC,MAAML,KAAKM,OAAL,EAAV;;AAEA,YAAII,WAAW,CAACT,QAAD,EAAUE,KAAV,EAAgBE,GAAhB,CAAf;;AAEA,eAAOK,QAAP;AACH,KApDc;;AAsDf;;;;AAIAC,iBAAY,uBAAY;AACpB,YAAIX,OAAO,IAAIlB,IAAJ,CAAS,KAAKD,QAAL,GAAgB,IAAzB,CAAX;AACA,YAAI+B,OAAOZ,KAAKa,QAAL,EAAX;AACA,YAAIN,UAAUK,OAAO,EAArB;AACAzB,YAAIqB,IAAJ,CAAShC,KAAKC,WAAd,EAA2B,SAAS8B,OAAT,GAAmB,GAA9C;AACA,eAAOA,OAAP;AACH,KAhEc;;AAkEfO,sBAAmB,4BAAY;AAC3B,YAAIC,cAAcC,SAAS,CAAC,KAAKnC,QAAL,GAAc,UAAf,KAA4B,KAAG,IAA/B,CAAT,CAAlB;AACA,eAAO,KAAG,IAAH,GAAUkC,WAAjB;AACH,KArEc;;AAuEfzB,gBAAW,oBAAU2B,OAAV,EAAmB;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA9B,YAAIqB,IAAJ,CAAShC,KAAKC,WAAd,EAA2B,SAA3B;AACA,aAAKI,QAAL,GAAgBoC,QAAQC,UAAxB;AACH;AAnFc,CAAnB","file":"GlobalTimer.js","sourceRoot":"../../../../../../assets/Script/hall/utils","sourcesContent":["/**\n * Created by xujing on 2018/4/20.\n */\nhall.GlobalTimer = {\n\n    boot:function () {\n        this.MAX_COUNT = 30; //每30秒修正一次时间\n        this._curCounter = 0;\n        this._curTime = new Date().getTime()/1000;\n        ty.NotificationCenter.listen(ddz.EventType.GET_TIMESTAMP, this.updateTime, this);\n        var that = this;\n        hall.MsgFactory.getTimeStamp();\n        ty.Timer.setTimer(cc.director, function () {\n            that._curCounter++;\n            that._curTime += 1;\n            if (that._curCounter >= that.MAX_COUNT){\n                that._curCounter = 0;\n                hall.MsgFactory.getTimeStamp();\n            }\n        }, 1);\n    },\n\n    getCurTime:function () {\n        return this._curTime;\n    },\n\n    /**\n     * 获取当前天\n     * @returns {string} 当前天,格式2018-4-21\n     */\n    getCurDay:function () {\n        var date = new Date(this._curTime * 1000);\n        var fullYear = date.getFullYear();\n        var month = date.getMonth() + 1;\n        var day = date.getDate();\n\n        var dataStr = fullYear + \"-\" + month + \"-\" + day;\n\n        ddz.LOGD(hall.GlobalTimer, \"今天是:\" + dataStr);\n        return dataStr;\n    },\n\n    /**\n     * 获取当前天\n     * @returns {string} 当前天,格式[2018,7,19]\n     */\n    getCurDayList:function () {\n        var date = new Date(this._curTime * 1000);\n        var fullYear = date.getFullYear();\n        var month = date.getMonth() + 1;\n        var day = date.getDate();\n        \n        var dataList = [fullYear,month,day];\n        \n        return dataList;\n    },\n\n    /**\n     * 获取当前时\n     * @returns {string} 当前时,格式2018-4-21\n     */\n    getCurHours:function () {\n        var date = new Date(this._curTime * 1000);\n        var hour = date.getHours();\n        var dataStr = hour + \"\";\n        ddz.LOGD(hall.GlobalTimer, \"现在是:\" + dataStr + \"点\");\n        return dataStr;\n    },\n\n    getCurLastSecond : function () {\n        var toDaySecond = parseInt((this._curTime-1523203200)%(24*3600));\n        return 24*3600 - toDaySecond;\n    },\n\n    updateTime:function (timeObj) {\n        // var timeObj = {\n        //     \"cmd\":\"user\",\n        //     \"result\":{\n        //         \"action\":\"sync_timestamp\",\n        //         \"gameId\":9999,\n        //         \"userId\":10197,\n        //         \"current_ts\":1524291824\n        //     }\n        // };\n        ddz.LOGD(hall.GlobalTimer, \"时间校准。。。\");\n        this._curTime = timeObj.current_ts;\n    }\n};"]}