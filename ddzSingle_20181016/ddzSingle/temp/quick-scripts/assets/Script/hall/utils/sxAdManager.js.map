{"version":3,"sources":["sxAdManager.js"],"names":["hall","sxAdManager","sxAdInfo","opDataWeight","iconWeight","iconIndex","preIconIndex","isSwitchIcon","callback","isLoadConfig","show","console","log","adIcon","active","cc","director","getScheduler","schedule","framesInterval","Node","initWeight","switchIcon","addComponent","Button","on","onClickAdIconBtn","game","addPersistRootNode","loadConfigFile","error","hide","unschedule","setPosition","dx","dy","position","v2","setScale","scale","setPositionById","id","index","i","length","widget","type","x","y","setWidgetPosition","setTimeout","winSize","height","width","ddz","gameModel","getDiversionConfig","self","loadConfig","getDiversionConfigJson","retryConfigFile","num","Math","floor","random","selectItemByWeight","icons","isClick","count","j","openData","isClickApp","imgurl","getComponent","Animation","removeComponent","Sprite","loadStaticImg","spriteFrame","loadDynamicImg","err","refreshIconsWeight","allWeight","clickHide","weight","arr","link","imgLink","loader","load","tex","SpriteFrame","split","adIconFrames","playFrames","animation","clip","AnimationClip","createWithSpriteFrames","name","wrapMode","WrapMode","Loop","addClip","play","results","splice","getContent","push","wx","openType","previewImage","urls","success","res","fail","bi_paramlist","biparam","ty","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeClickAdBtn","navigateToMiniProgram","appId","path","topath","envVersion","extraData","saveItem","clickStatEventTypeClickDirectToMiniGameSuccess","clickStatEventTypeClickDirectToMiniGameFail","complete","limit","appid","storedata","sys","localStorage","getItem","indexOf","setItem"],"mappings":"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","file":"sxAdManager.js","sourceRoot":"../../../../../../assets/Script/hall/utils","sourcesContent":["//三消交叉导流\nhall.sxAdManager = {\n    sxAdInfo: null,\n    opDataWeight: [],\n    iconWeight: null,\n    iconIndex: null,\n    preIconIndex: null,\n    isSwitchIcon: false,//true为换icon，false为不换icon\n    callback: null,\n    isLoadConfig: false,\n\n\n    show: function () {//, scale) {\n        try {\n            console.log(\"sxAdManager ad Show\");\n            if (this.adIcon) {\n                this.adIcon.active = true;\n                cc.director.getScheduler().schedule(\n                    this.callback, this.adIcon, this.sxAdInfo.framesInterval, !this.isSwitchIcon);\n            } else {\n\n                var callback = () => {\n                    this.adIcon = new cc.Node();\n\n                    // if (typeof wx !== 'undefined') {\n                    this.initWeight();\n                    this.iconIndex = 0;\n                    this.isSwitchIcon = true;\n                    this.callback = () => {\n                        this.switchIcon();\n                    }\n                    this.callback();\n                    cc.director.getScheduler().schedule(\n                        this.callback, this.adIcon, this.sxAdInfo.framesInterval, !this.isSwitchIcon);\n                    this.adIcon.addComponent(cc.Button);\n\n                    this.adIcon.on('click', this.onClickAdIconBtn, this);\n\n                    cc.game.addPersistRootNode(this.adIcon);\n\n                    // }\n                };\n                this.loadConfigFile(callback);\n            }\n        } catch (error) {\n            console.log(\"sxAdManager: \", error);\n\n        }\n    },\n\n    hide: function () {\n        if (this.adIcon) {\n            cc.director.getScheduler().unschedule(this.callback, this.adIcon);\n            console.log(\"sxAdManager ad hide\");\n            this.adIcon.active = false;\n        }\n\n    },\n\n    setPosition: function (dx, dy) {\n        if (this.adIcon) {\n            // this.adIcon.position = cc.v2(cc.winSize.width - dx, dy);\n            this.adIcon.position = cc.v2(dx, dy);\n        }\n    },\n\n    setScale: function (scale) {\n        if (this.adIcon) {\n            this.adIcon.scale = scale;\n        }\n    },\n\n    setPositionById: function (id) {\n        if (this.adIcon) {\n            let index = -1;\n            for (let i = 0; i < this.sxAdInfo.position.length; i++) {\n                if (this.sxAdInfo.position[i].id == id)\n                    index = i;\n            }\n            if (index != -1) {\n                let widget = this.sxAdInfo.position[index].type;\n                let dx = this.sxAdInfo.position[index].x;\n                let dy = this.sxAdInfo.position[index].y;\n                this.setWidgetPosition(widget, dx, dy);\n\n            }\n        }\n        else{\n            setTimeout(() => {\n                this.setPositionById(id);\n        }, 10);\n        }\n    },\n    setWidgetPosition: function (type, x, y) {\n        switch (type) {\n            case 1://top left\n                this.adIcon.position = cc.v2(x, cc.winSize.height - y);\n                break;\n            case 2://top right\n                this.adIcon.position = cc.v2(cc.winSize.width - x, cc.winSize.height - y);\n                break;\n            case 3://bottom left\n                this.adIcon.position = cc.v2(x, y);\n                break;\n            case 4://bottom right\n                this.adIcon.position = cc.v2(cc.winSize.width - x, y);\n                break;\n            case 5://top HorizontalCenter\n                this.adIcon.position = cc.v2(cc.winSize.width / 2 + x, cc.winSize.height - y);\n                break;\n            case 6://bottom HorizontalCenter\n                this.adIcon.position = cc.v2(cc.winSize.width / 2 + x, y);\n                break;\n            case 7://left VerticalCenter\n                this.adIcon.position = cc.v2(x, cc.winSize.height / 2 + y);\n                break;\n            case 8://right VerticalCenter\n                this.adIcon.position = cc.v2(cc.winSize.width - x, cc.winSize.height / 2 + y);\n                break;\n            case 9://HorizontalCenter VerticalCenter\n                this.adIcon.position = cc.v2(cc.winSize.width / 2 + x, cc.winSize.height / 2 + y);\n                break;\n            default:\n                break;\n        }\n\n    },\n    loadConfigFile: function (callback) {\n        ddz.gameModel.getDiversionConfig();\n        var self = this;\n\n        var loadConfig = function(){\n            try {\n                if (ddz.gameModel.getDiversionConfigJson()) {\n                    self.isLoadConfig = true;\n                    self.sxAdInfo = ddz.gameModel.getDiversionConfigJson();\n                    callback();\n                }else {\n                    // ddz.gameModel.getDiversionConfig();\n                    // if (ddz.gameModel.getDiversionConfigJson()) {\n                    //     self.sxAdInfo = ddz.gameModel.getDiversionConfigJson();\n                    //     callback();\n                    // }\n\n                    if (!self.isLoadConfig) {\n                        setTimeout(function() {\n                            loadConfig();\n                        }, 2000);\n                        // this.scheduleOnce(function () {\n                        //\n                        // }, 1);\n                    }\n                }\n\n            } catch (error) {\n                ddz.gameModel.getDiversionConfig();\n            }\n        };\n\n        loadConfig();\n    },\n    retryConfigFile: function () {\n        if (!this.isLoadConfig) {\n            setTimeout(() => {\n                this.loadConfigFile(false);\n        }, 20000);\n        }\n    },\n    switchIcon: function () {//刷新Icon\n        try {\n            let num = Math.floor(Math.random() * this.iconWeight);\n            this.iconIndex = this.selectItemByWeight(num, this.sxAdInfo.icons);\n\n            let isClick = 0;\n            let count = 0;\n            for (let i = 0; i < this.sxAdInfo.icons.length; i++) {\n                for (let j = 0; j < this.sxAdInfo.icons[i].openData.length; j++) {\n                    if (this.isClickApp(this.sxAdInfo.icons[i].openData[j].imgurl)){\n                        isClick++;\n                    }\n                    count++;\n                }\n\n            }\n\n            if (this.iconIndex == -1 || isClick == count) {\n                this.hide();\n                return;\n            }\n\n            if (this.iconIndex != this.preIconIndex) {\n                if (this.sxAdInfo.icons[this.iconIndex].type == 0) {\n                    if (this.adIcon.getComponent(cc.Animation)) {//除去动态icon的组件\n                        this.adIcon.removeComponent(cc.Animation);\n                        this.adIcon.removeComponent(cc.Sprite);\n                    }\n                    this.loadStaticImg(this.sxAdInfo.icons[this.iconIndex]);\n                } else if (this.sxAdInfo.icons[this.iconIndex].type == 1) {\n                    if (this.adIcon.getComponent(cc.Sprite)) {//除去静态icon的组件\n                        this.adIcon.getComponent(cc.Sprite).spriteFrame = null;\n                    }\n                    this.loadDynamicImg(this.sxAdInfo.icons[this.iconIndex]);\n                }\n                this.preIconIndex = this.iconIndex;\n            }\n\n\n        } catch (err) {\n            cc.director.getScheduler().unschedule(this.callback, this.adIcon);\n        }\n    },\n\n    //重新刷新\n    refreshIconsWeight: function () {\n        for (let i = 0; i < this.sxAdInfo.icons.length; i++) {\n            var allWeight = 0;\n            for (let j = 0; j < this.sxAdInfo.icons[i].openData.length; j++) {\n                if (this.sxAdInfo.icons[i].openData[j].clickHide && this.isClickApp(this.sxAdInfo.icons[i].openData[j].imgurl)) {\n                    this.sxAdInfo.icons[i].openData[j].weight = 0;\n                }\n                else {\n                    allWeight += this.sxAdInfo.icons[i].openData[j].weight;\n                }\n            }\n            if (allWeight == 0) {\n                this.sxAdInfo.icons[i].weight = 0;\n            }\n        }\n    },\n\n    initWeight: function () {\n        this.iconWeight = 0;\n        for (let i = 0; i < this.sxAdInfo.icons.length; i++) {\n            this.iconWeight += this.sxAdInfo.icons[i].weight;\n            this.opDataWeight[i] = 0;\n            var openData = this.sxAdInfo.icons[i].openData;\n            for (let j = 0; j < openData.length; j++) {\n                this.opDataWeight[i] += openData[j].weight;\n            }\n        }\n    },\n\n    //添加导流入口Icon静态图片\n    loadStaticImg: function (arr) {\n        let link = arr.imgLink;\n        let scale = arr.scale;\n        let self = this;\n        cc.loader.load(link, function (err, tex) {\n            try {\n                if (self.adIcon.getComponent(cc.Sprite)) {//重新调用时可能是同一个静态icon也可能适另一个静态icon\n                    self.adIcon.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(tex);\n                    self.adIcon.scale = scale;\n                }\n                else {\n                    self.adIcon.addComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(tex);\n                    self.adIcon.scale = scale;\n                }\n            } catch (err) {\n                console.log(err);\n                self.adIcon.addComponent(cc.Sprite).spriteFrame = null;\n            }\n        });\n    },\n\n    //添加导流入口Icon动画\n    loadDynamicImg: function (arr) {\n        let link = arr.imgLink.split(',');\n        let scale = arr.scale;\n        let self = this;\n        var adIconFrames = [];\n        var playFrames = () => {\n\n\n            if (self.adIcon.getComponent(cc.Animation)) {//重新调用时可能是同一个动态icon也可能适另一个动态icon\n\n                var animation = self.adIcon.getComponent(cc.Animation);\n\n                var clip = cc.AnimationClip.createWithSpriteFrames(adIconFrames, 10);\n                clip.name = 'anim_frame';\n                clip.wrapMode = cc.WrapMode.Loop;\n                animation.addClip(clip);\n                animation.play('anim_frame');\n            }\n            else {\n                var animation = self.adIcon.addComponent(cc.Animation);\n                if (!self.adIcon.getComponent(cc.Sprite))\n                    self.adIcon.addComponent(cc.Sprite);\n\n                var clip = cc.AnimationClip.createWithSpriteFrames(adIconFrames, 10);\n                clip.name = 'anim_frame';\n                clip.wrapMode = cc.WrapMode.Loop;\n                animation.addClip(clip);\n                animation.play('anim_frame');\n            }\n        };\n        cc.loader.load(link, function (err, results) {\n                // if (err) {\n                //     for (var i = 0; i < err.length; i++) {\n                //         console.log(\"sxAdManager: \", 'load Dynamic img failed' + err[i] + ']: ' + results.getError(err[i]));\n                //     }\n                // }\n                // else {\n                try {\n                    adIconFrames.splice(0, adIconFrames.length);\n\n                    for (let i = 0; i < link.length; i++) {\n                        var tex = results.getContent(link[i]);\n                        adIconFrames.push(new cc.SpriteFrame(tex));\n                    }\n                    if (scale != null){\n                        self.adIcon.scale = scale;\n                    }\n                    playFrames();\n                } catch (err) {\n                    console.log(err);\n                    adIconFrames.push(null);\n                }\n            }\n        );\n    },\n\n    onClickAdIconBtn: function () {\n        if (typeof wx !== 'undefined') {\n            try {\n                let iconIndex = this.iconIndex;\n                let num = Math.floor(Math.random() * this.opDataWeight[iconIndex]);\n                let index = this.selectItemByWeight(num, this.sxAdInfo.icons[iconIndex].openData);\n\n                if (index != -1) {\n                    if (this.sxAdInfo.icons[iconIndex].openType == 0) {\n                        wx.previewImage({\n                                // current: ''; // 当前要显示的图片url\n                                urls: [this.sxAdInfo.icons[iconIndex].openData[index].imgurl], // 需要预览的图片url列表\n                                success: (res) => {\n                            },\n                            fail: (res) => {\n                        },\n                        // complete: () => {\n\n                        // }\n                    });\n                    }\n                    else if (this.sxAdInfo.icons[iconIndex].openType == 1) {\n                        var bi_paramlist = this.sxAdInfo.icons[iconIndex].biparam;\n                        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeClickAdBtn, bi_paramlist);\n                        wx.navigateToMiniProgram({\n                            appId: this.sxAdInfo.icons[iconIndex].openData[index].imgurl,\n                            path: this.sxAdInfo.icons[iconIndex].topath,\n                            envVersion: 'release',\n                            extraData: null,\n                            success: function (res) {\n                                hall.sxAdManager.saveItem(hall.sxAdManager.sxAdInfo.icons[iconIndex].openData[index].imgurl);\n                                //刷新权重\n                                hall.sxAdManager.refreshIconsWeight();\n                                hall.sxAdManager.initWeight();\n                                //刷新icon\n                                hall.sxAdManager.switchIcon();\n                                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeClickDirectToMiniGameSuccess, bi_paramlist);\n                            },\n                            fail: function (res) {\n                                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeClickDirectToMiniGameFail, bi_paramlist);\n                                console.log('wx.navigateToMiniProgram fail');\n                                console.log(res);\n                            },\n                            complete: function (res) {\n                                console.log('navigateToMiniProgram ==== complete');\n                            }\n                        });\n                    }\n\n                }\n\n            } catch (error) {\n                console.log(\"sxAdManager: \", error);\n            }\n        }\n    },\n\n    //随机权重\n    selectItemByWeight(num, arr) {\n        let limit = 0;\n        for (let i = 0; i < arr.length; i++) {\n            let weight = arr[i].weight;\n            if (weight) {\n                if (num <= weight + limit && num >= limit) {\n                    return i;\n                }\n            }\n            limit += weight;\n        }\n        return -1;\n    },\n\n    //当前app是否被点击过\n    isClickApp: function (appid) {\n        let storedata = cc.sys.localStorage.getItem(\"sxad-data\");\n        if (storedata && storedata !== '' && storedata.indexOf(appid) >= 0) {\n            return true;\n        }\n        return false;\n    },\n\n    //app点击，保存appID到本地\n    saveItem: function (appid) {\n        let storedata = cc.sys.localStorage.getItem(\"sxad-data\");\n        if (storedata && storedata !== '') {\n            storedata += appid + ',';\n        } else {\n            storedata = appid + ',';\n        }\n        cc.sys.localStorage.setItem(\"sxad-data\", storedata);\n    }\n}\n"]}