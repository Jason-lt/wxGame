{"version":3,"sources":["../../../../../assets/Script/Framework/assets/Script/Framework/BiLog.js"],"names":["ty","BiLog","uploadLogTimely","logtxt","hall","netIsConnected","LOGD","header","postData","cloud_id","SystemInfo","cloudid","time","GlobalTimer","getCurTime","client_id","clientId","user_id","UserInfo","userId","sys_version","deviceInfo","system","mobile_models","brand","model","baseVersion","SDKVersion","wxVersion","version","clientVersion","Nettype","networkType","errMsg","ip","configObj","HttpUtil","httpPost","getSystemInfo","rec_type","rec_id","receive_time","game_id","gameId","device_id","GlobalFuncs","getLocalUuid","ip_addr","nettype","phone_maker","phone_model","phone_carrier","reserved","uploadClickStatLogTimely","callbackObj","undefined","m_server_ip","clickStat","eventId","ParamsList","debugMode","dyeparams","length","i","push","JSON","stringify","bilog","assemblelog","eventid","paramsarr","Date","getTime","_timetag","paramstr","join","logStr","str","trimTab0","txt","replace"],"mappings":"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","file":"BiLog.js","sourceRoot":"../../../../../assets/Script/Framework","sourcesContent":["/**\n * Created by xujing on 2018/4/8.\n */\nty.BiLog = {\n    /**\n     * 上传实时log\n     * @param logtxt:log内容\n     */\n    uploadLogTimely:function (logtxt) {\n        if(!hall.netIsConnected){//断网了,不能上传\n            hall.LOGD('ty.BiLog', 'net error!');\n            return;\n        }\n        if(logtxt) {\n            var header = ['Content-Type:text/plain'];\n\n            //UID,Time, baseVersion, wxVersion, clientVersion, errMsg\n            var postData = {\n                cloud_id : ty.SystemInfo.cloudid,\n                time: hall.GlobalTimer.getCurTime(),\n                client_id: ty.SystemInfo.clientId,\n                user_id: ty.UserInfo.userId,\n                sys_version: ty.SystemInfo.deviceInfo.system,\n                mobile_models: ty.SystemInfo.deviceInfo.brand + \" \" + ty.SystemInfo.deviceInfo.model,\n                baseVersion: ty.SystemInfo.deviceInfo.SDKVersion,\n                wxVersion: ty.SystemInfo.deviceInfo.version,\n                clientVersion : ty.SystemInfo.version,\n                Nettype : hall.networkType,\n                errMsg: logtxt,\n                ip : ty.UserInfo.ip\n            };\n\n            var configObj = {\n                'url': 'https://clienterr.touch4.me/api/bilog5/text/error',\n                'header': header,\n                'postData': postData,\n                'callback': null\n            };\n            // 测试post\n            ty.HttpUtil.httpPost(configObj,'POST');\n        }\n    },\n\n    getSystemInfo : function(){\n        this.cloud_id =ty.SystemInfo.cloudid;//this.getValue(json.cloud_id);   //独立服务id\n        this.rec_type = '1';   //日志类型\n        this.rec_id     = '0'; //日志记录id\n        this.receive_time  ='0'; // 日志接收时间  输出日志时统一填0，BI服务会在接收时添加\n        this.user_id = ty.UserInfo.userId;      //用户id\n        this.game_id = ty.SystemInfo.gameId;      //游戏id\n        this.client_id = ty.SystemInfo.clientId;\n        this.device_id = hall.GlobalFuncs.getLocalUuid();\t//device id\n        this.ip_addr='#IP';// ip地址\t占位--服务器处理\n        this.nettype= \"0\"; //网络状况\n        this.phone_maker= \"0\"; //手机制造商\n        this.phone_model= ty.UserInfo.model; //手机型号\n        this.phone_carrier= \"0\";//手机运营商\n        this.reserved ='0';\n    },\n    /*BI组打点\n     参数1是事件id，参数2是[],内含扩展参数\n     60001事件id\n     在查询工具，cloud id+game id+事件id即可找到,GDSS有前端日志查询工具\n     ty.BiLog.clickStat(ddz.StatEventInfo.DdzButtonClickInPlugin,\n     [ddz.PluginHall.Model.statInfoType[scope.index],ddz.GameId]);\n\n     // ty.BiLog.clickStat(hall5.BILogEvents.BILOG_EVENT_PLUGIN_UPDATE_SUCCESS,[hall5.BilogStatEvent.Plugin_Update_Success,gameid]);\n     */\n\n    uploadClickStatLogTimely:function (logtxt) {\n        // hall.LOGW(\"\",\"============clickStat====================\"+logtxt);\n        var callbackObj = this;\n        if(logtxt!=undefined && logtxt!='') {\n            var header = ['Content-Type:text/plain'];\n            var configObj = {\n                'url': ty.SystemInfo.m_server_ip,\n                'headers': header,\n                'postData': logtxt,\n                'obj': callbackObj,\n                'tag': null,\n                'callback': null\n            };\n        }\n        ty.HttpUtil.httpPost(configObj,'POST');\n    },\n\n    clickStat: function (eventId, ParamsList) {\n        if(debugMode){\n            return;\n        }\n        // hall.LOGW(\"\",\"============clickStat====================\"+eventId+\"====\"+ParamsList[0]);\n        if(ParamsList ==null) {ParamsList =[];}\n        var dyeparams = [];\n        if (ParamsList.length < 10) {\n            for (var i = 0; i < 9; i++) {\n                if (i < ParamsList.length) {\n                    dyeparams.push(ParamsList[i]);}\n                else {\n                    dyeparams.push(0);}}\n        }\n        else {dyeparams = ParamsList;}\n        hall.LOGD('实时日志', \"eventid= \" + eventId + \" 描述 = \" + JSON.stringify(dyeparams));\n        var bilog = this.assemblelog(eventId, dyeparams);\n        this.uploadClickStatLogTimely(bilog+ '\\n');\n    },\n    assemblelog:function (eventid, paramsarr) {\n        //获得1970到现在的秒数\n        var time = new Date().getTime();\n        //隔一分钟取网络状况\n        if(time-this._timetag>60000)\n        {\n            this._timetag = time;\n            this.nettype=0;\n        }\n        var paramstr = paramsarr.join('\\t');\n\n        this.getSystemInfo();\n        var logStr =this.cloud_id+'\\t'+this.rec_type+'\\t'+time+'\\t'+this.rec_id+'\\t'+this.receive_time+\n            '\\t'+eventid+'\\t'+this.user_id+'\\t'+this.game_id+'\\t'+this.client_id+'\\t'+this.device_id+'\\t'+\n            this.ip_addr +'\\t'+this.nettype+'\\t'+this.phone_maker +'\\t'+this.phone_model +'\\t'+this.phone_carrier+'\\t'+paramstr+'\\t'+ this.reserved ;\n\n        var str = this.trimTab0(logStr);\n        return str;\n    },\n    trimTab0:function (str) {\n        if(str==null || str==undefined)\n            return '';\n        var txt = str.replace(/(\\t0)*$/,'');\n        return txt;\n    },\n};"]}