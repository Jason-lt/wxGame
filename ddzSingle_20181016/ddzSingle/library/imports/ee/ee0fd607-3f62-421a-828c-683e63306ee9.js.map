{"version":3,"sources":["../../../../../assets/Script/Framework/assets/Script/Framework/Share.js"],"names":["crypto","require","ddz","Share","LAST_SHARE_TIME","LAST_LOGIN_TIME","SHARETICKETS_LIST","LAST_SHARE_TIMELIST","YESTERDAY_SHARE_NUMBER","shareQuery","unSensitivePersonage","sharePoint","shareType","isOnShare","isMatchShare","shareTicket","shareTime","resultType","shareWithType","type","successCallBackFun","failCallBackFun","testCfg","onShareType","clickStatShareTypeRevial","shareMap","gameModel","shareConfig","gameConfig","shareDetail","shareCfg","hall","GlobalFuncs","getShareRandomNumberWithShareList","shareTitle","replaceKeyWordInString","shareContent","query","ty","UserInfo","userId","shareSchemeId","userName","queryString","shareImage","sharePicUrl","extraAdd","length","callBackF","imageUrl","shareImformation","getShareImageWithShareMap","nowIndex","tempCavas","wx","createCanvas","width","height","context","getContext","image","createImage","src","onload","event","ima","target","drawImage","preTextWidth","preTextHeight","preX","preY","extraMap","textInformation","text","textformatString","font","fontSize","textColorRGB","indexOf","fillStyle","textAlign","replace","textX","parseInt","originPointX","textY","originPointY","fillText","measureText","imageInformation","sunImage","addImageUrl","userPic","sizeWidth","sizeHeight","shape","beginPath","arc","Math","PI","stroke","clip","img","tempFilePath","toTempFilePathSync","x","y","destWidth","destHeight","onerror","LOGW","titleString","Date","getTime","sharePointId","BiLog","clickStat","clickStatEventType","clickStatEventTypeShareAction","shareAppMessage","title","success","result","JSON","stringify","shareTickets","ShareState","isNotAGroupChat","fail","failToShare","LOGD","arguments","complete","playAnimationAfterShareWithType","_time","_interval","shareInterval","NotificationCenter","trigger","EventType","UPDATE_SHARE_STATE","getShareResultWithKey","shareKey","iv","encryptedData","reultString","decrypt","wxgame_session_key","informationMap","parse","openGId","toDay","GlobalTimer","getCurDay","lastShareTime","ReadStringFromLocalStorage","shareNumber","shareTicketsDic","setInLocalStorage","shareList","repetitionGroupChat","push","endWithSuccessShare","getOpenGid","_boxUserId","_openGid","encryFunc","isBringVersion","getBoxReward","SystemInfo","treasureID","getShareInfo","key","crypted","Buffer","decipher","createDecipheriv","decoded","update","final","sucessShare","clickStatShareTypeShareButton","clickStatShareTypeShareJiPaiQi","clickStatShareTypeRestart","clickStatShareTypeGoldDoubleHalve","clickStatShareTypeRankList","clickStatShareType","shareKeywordReplace","SharePointType","firstFail","userGroup","tongGuan","redPacket","arenaPoint1","arenaPoint2","arenaPoint3","arenaPoint4","gongZhongHaoCard","gongZhongHaoMenu","lottery","alms","firstWithDraw","withChip","getRedPacket","boxShare","shareFriend","customsSuccess","failSix","firstUseJiPaiQi","adGetJiPaiQi","getDayFirstLogin","failDiamond","skipCustom","addApplet","failWindw","mainRestart","exShare","failToGetShareTicket","onShareAppMessage","getRandomNumberBefore","groupMsgInfos"],"mappings":"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","file":"Share.js","sourceRoot":"../../../../../assets/Script/Framework","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nvar crypto = require('crypto');\n\nddz.Share = {\n    LAST_SHARE_TIME : \"LAST_SHARE_TIME\",//最后一次分享的时间\n    LAST_LOGIN_TIME : \"LAST_LOGIN_TIME\",//最后一次登录的时间\n    SHARETICKETS_LIST : \"SHARETICKETS_LIST\",//今天的分享群聊信息集合\n    LAST_SHARE_TIMELIST : \"LAST_SHARE_TIMELIST\",//分享日期数组\n    YESTERDAY_SHARE_NUMBER : \"YESTERDAY_SHARE_NUMBER\",//昨天分享次数\n    shareQuery : \"\",\n\n    unSensitivePersonage : 0,//0、验证不同群,1、什么都不验证,2、验证群\n    sharePoint : 0,\n    shareType : \"\",\n\n    isOnShare : false,\n    isMatchShare : false,\n    shareTicket:\"\",\n    shareTime:\"\",//点击分享时间\n    resultType : 0,//1、不是群,2、重复群,3、正常\n\n    shareWithType : function (type, successCallBackFun, failCallBackFun, testCfg) {\n        if(type == ddz.Share.onShareType.clickStatShareTypeRevial){\n            ddz.Share.isMatchShare = true;\n        }\n        var shareMap = ddz.gameModel.shareConfig;\n        if(!shareMap){\n            //TODO:取不到分享配置信息\n            shareMap = ddz.gameConfig.shareConfig;\n        }\n        if (!shareMap) {\n            return\n        }\n        var shareDetail = shareMap[type];\n\n        // var shareCfg = shareDetail[hall.GlobalFuncs.getRandomNumberBefore(shareDetail.length)];\n        var shareCfg = shareDetail[hall.GlobalFuncs.getShareRandomNumberWithShareList(shareDetail)];\n\n        if (testCfg){\n            //配置上线前测试准备\n            shareCfg = testCfg;\n        }\n\n        var shareTitle = hall.GlobalFuncs.replaceKeyWordInString(shareCfg.shareContent);\n\n        var query = \"inviteCode=\"+ty.UserInfo.userId+\"&sourceCode=\"+type +\"&imageType=\"+shareCfg.shareSchemeId+\"&inviteName=\"+ty.UserInfo.userName;\n        if(shareDetail.query){\n            ddz.Share.shareQuery = shareDetail.query;\n            var queryString = hall.GlobalFuncs.replaceKeyWordInString(shareDetail.query);\n            query = query+\"&\"+queryString;\n        }else {\n            ddz.Share.shareQuery = \"\";\n        }\n\n        if(shareDetail.unSensitivePersonage){\n            ddz.Share.unSensitivePersonage = shareDetail.unSensitivePersonage;\n        }else {\n            ddz.Share.unSensitivePersonage = 0;\n        }\n\n        var shareImage = shareCfg.sharePicUrl;\n        if(shareCfg.extraAdd && shareCfg.extraAdd.length && shareCfg.extraAdd.length > 0 ){\n            var callBackF = function(imageUrl) {\n                ddz.Share.shareImformation(type, shareCfg, shareTitle, imageUrl, query, shareDetail.sharePoint, successCallBackFun, failCallBackFun);\n            };\n            ddz.Share.getShareImageWithShareMap(0, shareCfg.extraAdd, shareImage, callBackF);\n        }else {\n            ddz.Share.shareImformation(type, shareCfg, shareTitle, shareImage, query, shareDetail.sharePoint, successCallBackFun, failCallBackFun);\n        }\n    },\n\n    getShareImageWithShareMap : function (nowIndex, extraAdd, imageUrl, callBackF) {\n\n        var tempCavas = wx.createCanvas();\n        tempCavas.width =  360;\n        tempCavas.height =  288;\n\n        var context = tempCavas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = imageUrl;\n\n        image.onload = function (event) {\n            var ima = event.target;\n            context.drawImage(ima,0,0);\n            var preTextWidth=0;\n            var preTextHeight=0;\n            var preX=0;\n            var preY=0;\n            while (nowIndex < extraAdd.length) {\n                var extraMap = extraAdd[nowIndex];\n                if (extraMap.type == \"text\") {\n                    var textInformation = extraMap.textInformation;\n                    var text = hall.GlobalFuncs.replaceKeyWordInString(textInformation.textformatString);\n                    context.font = textInformation.fontSize + \"px Arial\";\n                    if (textInformation.textColorRGB.indexOf('#') == -1){\n                        textInformation.textColorRGB = \"#\" + textInformation.textColorRGB;\n                    }\n                    context.fillStyle = textInformation.textColorRGB;\n                    context.textAlign = textInformation.textAlign.replace('middle','center');\n                    var textX = parseInt(textInformation.originPointX);\n                    if(textX < 0){\n                        if(textX == -1){\n                            textX = preX - preTextWidth/2;\n                        }else if(textX == -2){\n                            textX = preX + preTextWidth/2;\n                        }\n                    }\n                    var textY = parseInt(textInformation.originPointY);\n                    if (textY < 0){\n                        if(textY == -1){\n                            textY = preY - preTextHeight/2;\n                        }if(textY == -2){\n                            textY = preY + preTextHeight/2;\n                        }\n                    }\n                    context.fillText(text,textX,textY);\n                    preTextWidth = context.measureText(text).width;\n                    preTextHeight = context.measureText(text).height;\n                    preX = textX;\n                    preY = textY;\n                    nowIndex ++;\n                }else if(extraMap.type == \"image\") {\n                    var imageInformation = extraMap.imageInformation;\n                    var sunImage = wx.createImage();\n                    // sunImage.src = imageInformation.addImageUrl;\n                    if(imageInformation.addImageUrl == \"avatar\"){\n                        sunImage.src = ty.UserInfo.userPic;\n                    }else {\n                        sunImage.src = imageInformation.addImageUrl;\n                    }\n\n                    sunImage.originPointX = parseInt(imageInformation.originPointX);\n                    sunImage.originPointY = parseInt(imageInformation.originPointY);\n                    sunImage.sizeWidth = parseInt(imageInformation.sizeWidth);\n                    sunImage.sizeHeight = parseInt(imageInformation.sizeHeight);\n                    if(imageInformation.shape && imageInformation.shape == 2){\n                        context.beginPath();\n                        context.arc(sunImage.originPointX+sunImage.sizeWidth/2,sunImage.originPointY+sunImage.sizeHeight/2,sunImage.sizeWidth/2,0,2*Math.PI);\n                        context.stroke();\n                        context.clip();\n                    }\n                    sunImage.onload = function (event) {\n                        var img = event.target;\n                        context.drawImage(img,img.originPointX,img.originPointY,img.sizeWidth,img.sizeHeight);\n                        var tempFilePath = tempCavas.toTempFilePathSync({\n                            x: 0,\n                            y: 0,\n                            width: tempCavas.width,\n                            height: tempCavas.height,\n                            destWidth: tempCavas.width,\n                            destHeight: tempCavas.height\n                        });\n                        if(callBackF) {\n                            callBackF(tempFilePath);\n                        }\n                    };\n                    sunImage.onerror = function (event) {\n                        var img = event.target;\n                        hall.LOGW(\"==\",\"============加载头像失败===========\"+sunImage.src+\"====\"+imageInformation.addImageUrl+\"====\");\n                        var tempFilePath = tempCavas.toTempFilePathSync({\n                            x: 0,\n                            y: 0,\n                            width: tempCavas.width,\n                            height: tempCavas.height,\n                            destWidth: tempCavas.width,\n                            destHeight: tempCavas.height\n                        });\n                        if(callBackF) {\n                            callBackF(tempFilePath);\n                        }\n                    };\n                    return;\n                }\n            }\n            var tempFilePath = tempCavas.toTempFilePathSync({\n                x: 0,\n                y: 0,\n                width: tempCavas.width,\n                height: tempCavas.height,\n                destWidth: tempCavas.width,\n                destHeight: tempCavas.height\n            });\n            if(callBackF) {\n                callBackF(tempFilePath);\n            }\n        };\n        image.onerror = function (event) {\n            var img = event.target;\n            hall.LOGW(\"==\",\"============加载底图失败===========\"+img.src);\n        };\n    },\n\n    shareImformation : function (type, shareCfg, titleString, imageUrl, query, sharePoint, successCallBackFun, failCallBackFun) {\n        ddz.Share.shareType = type;\n        ddz.Share.sharePoint = sharePoint;\n        ddz.Share.isOnShare = true;\n        ddz.Share.resultType = 0;\n        ddz.Share.shareTicket = \"\";\n        ddz.Share.shareTime = new Date().getTime();\n        var sharePointId = shareCfg.sharePointId;\n        var shareSchemeId = shareCfg.shareSchemeId;\n\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 1, shareSchemeId]);\n\n\n        wx.shareAppMessage({\n            title: titleString,\n            imageUrl : imageUrl,//5:4\n            query : query,//'key1=val1&key2=val2',\n            success : function (result) {\n                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 2, shareSchemeId]);\n\n                if (successCallBackFun){\n                    successCallBackFun(result);\n                }\n                hall.LOGW(null, \"shareAppMessage+++++++++++++++++\"+JSON.stringify(result));\n                if(!result.shareTickets || !result.shareTickets[0]){\n                    ddz.Share.resultType = ddz.Share.ShareState.isNotAGroupChat;\n                    ddz.Share.shareTicket = \"\";\n                    return;\n                }\n                ddz.Share.shareTicket = result.shareTickets[0];\n            },\n            fail : function () {\n                if (failCallBackFun){\n                    failCallBackFun();\n                }\n                ddz.Share.isMatchShare = false;\n                ddz.Share.resultType = ddz.Share.ShareState.failToShare;\n                hall.LOGD(null, JSON.stringify(arguments));\n            },\n            complete : function () {\n            }\n        });\n    },\n\n    playAnimationAfterShareWithType : function () {\n        hall.LOGW(\"\",\"file = [Share] fun = [playAnimationAfterShareWithType]\");\n\n        if (ddz.Share.shareTime) {\n            var _time = new Date().getTime();\n            var _interval = ddz.gameConfig.shareInterval;\n            if (parseInt(_time/1000) - parseInt(ddz.Share.shareTime/1000) >= _interval) {\n                ty.NotificationCenter.trigger(ddz.EventType.UPDATE_SHARE_STATE,ddz.Share.shareType);\n                ddz.Share.shareType = \"\";\n                ddz.Share.resultType = 0;\n            }\n        }\n\n        // //要验证群的处理\n        // wx.getShareInfo(\n        //     {\n        //         shareTicket :ddz.Share.shareTicket,\n        //         success : function (result) {\n        //             var shareKey;\n        //             if(ddz.Share.shareType == ddz.Share.onShareType.clickStatShareTypeRevial){\n        //                 shareKey = ddz.matchModel.revivalShareKey;\n        //                 ddz.Share.getShareResultWithKey(result,shareKey);\n        //             }else {\n        //                 shareKey = ddz.Share.sharePoint +\"\";\n        //                 ddz.Share.getShareResultWithKey(result,shareKey);\n        //             }\n        //         },\n        //         fail : function () {\n        //             ddz.Share.resultType = ddz.Share.ShareState.failToGetShareTicket;\n        //             // ty.NotificationCenter.trigger(ddz.EventType.UPDATE_SHARE_STATE,ddz.Share.shareType);\n        //             hall.LOGE(\"\",\"====getShareInfo=fail=====\"+JSON.stringify(arguments));\n        //         },\n        //         complete : function () {\n        //         }\n        //     }\n        // );\n    },\n\n    getShareResultWithKey : function (result,shareKey) {\n        // var shareKey = ddz.Share.sharePoint +\"\";get_box_reward\n        var iv = result.iv ;\n        var encryptedData = result.encryptedData;\n        var reultString = ddz.Share.decrypt(ty.UserInfo.wxgame_session_key,iv,encryptedData);\n        // {\"openGId\":\"tGXVqG5IZmqkGArWBhZNJwn2NsqaQ\",\"watermark\":{\"timestamp\":1524292994,\"appid\":\"wxbfebdafc2fc60b54\"}}\n        var informationMap = JSON.parse(reultString);\n        var openGId = informationMap.openGId;\n        var toDay = hall.GlobalTimer.getCurDay();\n        var lastShareTime = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.Share.LAST_SHARE_TIME, \"\");\n        var shareNumber = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.Share.YESTERDAY_SHARE_NUMBER, 0);\n\n        var shareTicketsDic = {};\n        if(toDay != lastShareTime){\n            shareTicketsDic[shareKey] = [openGId];\n            hall.GlobalFuncs.setInLocalStorage(ddz.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            hall.GlobalFuncs.setInLocalStorage(ddz.Share.LAST_SHARE_TIME, toDay);\n            hall.GlobalFuncs.setInLocalStorage(ddz.Share.YESTERDAY_SHARE_NUMBER, 1);\n        }else {\n            shareNumber++;\n            hall.GlobalFuncs.setInLocalStorage(ddz.Share.YESTERDAY_SHARE_NUMBER, shareNumber);\n            var shareTickets = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.Share.SHARETICKETS_LIST, \"\");\n            shareTicketsDic = JSON.parse(shareTickets);\n            if(shareTicketsDic && shareTicketsDic[shareKey] && shareTicketsDic[shareKey].length){\n                var shareList = shareTicketsDic[shareKey];\n                if (shareList.indexOf(openGId) > -1){\n                    ddz.Share.resultType = ddz.Share.ShareState.repetitionGroupChat;\n                    ty.NotificationCenter.trigger(ddz.EventType.UPDATE_SHARE_STATE,ddz.Share.shareType);\n                    ddz.Share.shareTicket = \"\";\n                    return;\n                }\n                shareList.push(openGId);\n                hall.GlobalFuncs.setInLocalStorage(ddz.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            }else {\n                shareTicketsDic[shareKey] = [openGId];\n                hall.GlobalFuncs.setInLocalStorage(ddz.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            }\n        }\n        this.endWithSuccessShare();\n    },\n\n    getOpenGid:function(shareTicket,_boxUserId){\n\n        var _openGid = \"\";\n\n        var encryFunc = function(result){\n            var iv = result.iv ;\n            var encryptedData = result.encryptedData;\n            var reultString = ddz.Share.decrypt(ty.UserInfo.wxgame_session_key,iv,encryptedData);\n            // hall.LOGW(\"\",\"file = [Share] fun = [getShareResultWithKey] reultString = \"+JSON.stringify(reultString));\n            // {\"openGId\":\"tGXVqG5IZmqkGArWBhZNJwn2NsqaQ\",\"watermark\":{\"timestamp\":1524292994,\"appid\":\"wxbfebdafc2fc60b54\"}}\n            var informationMap = JSON.parse(reultString);\n            var openGId = informationMap.openGId;\n            _openGid = openGId;\n            if(!ddz.gameModel.isBringVersion){\n                ddz.gameModel.getBoxReward(parseInt(_boxUserId),ty.SystemInfo.treasureID,_openGid);\n            }\n\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] _openGid = \"+JSON.stringify(_openGid));\n        };\n\n        wx.getShareInfo(\n            {\n                shareTicket :shareTicket,\n                success : function (result) {\n                    encryFunc(result);\n                },\n                fail : function () {\n                    hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] fail \");\n                    if(!ddz.gameModel.isBringVersion){\n                        ddz.gameModel.getBoxReward(parseInt(_boxUserId),ty.SystemInfo.treasureID,_openGid);\n                    }\n                },\n                complete : function () {\n                }\n            }\n        );\n\n    },\n\n    decrypt :function(key, iv, crypted) {\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        var decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n        return decoded;\n    },\n\n    endWithSuccessShare : function () {\n        ddz.Share.resultType = ddz.Share.ShareState.sucessShare;\n        if(ddz.Share.shareType != ddz.Share.onShareType.clickStatShareTypeRevial){\n            // ddz.gameModel.shareToGetreward(ddz.Share.sharePoint);\n        }\n        // ty.NotificationCenter.trigger(ddz.EventType.UPDATE_SHARE_STATE,ddz.Share.shareType);\n    },\n\n    onShareType :{\n        clickStatShareTypeShareButton : \"100\",//微信分享按钮 转发\n        clickStatShareTypeShareJiPaiQi : \"101\",//记牌器分享\n        clickStatShareTypeRestart : \"102\",//重新发牌分享\n        clickStatShareTypeGoldDoubleHalve : \"103\",    //金币翻倍减半\n\n        clickStatShareTypeRankList : \"0000\",//查看群排行榜  预占位\n        clickStatShareTypeRevial : \"0000\",//每日首次失败分享复活\n\n    },\n\n    clickStatShareType :{\n        clickStatShareTypeShareButton : \"100\",//微信分享按钮 转发\n        clickStatShareTypeShareJiPaiQi : \"101\",//记牌器分享\n        clickStatShareTypeRestart : \"102\",//重新发牌分享\n        clickStatShareTypeGoldDoubleHalve : \"103\",    //金币翻倍减半\n\n        clickStatShareTypeRankList : \"0000\",//查看群排行榜  预占位\n        clickStatShareTypeRevial : \"0000\",//每日首次失败分享复活\n        \n    },\n\n    shareKeywordReplace :{\n        \"wechatName\":\"。\",//微信昵称\n        // 比赛场\n        \"withDrawMoney\":\"0\",//提现金额\n        \"curBonusOnlyChip\":\"0\", //自己本次获得奖励兑换金币\n        \"selfTotalBonus\":0,//个人所得总奖励\n        \"selfAllWinnerCount\": 0,//个人全部通关次数\n        //好友桌\n        \"inviteFriendID\":\"10001\",//好友桌邀请好友进桌房间ID\n        \"totalRound\":0, //总局数\n        \"displayName\":\"经典\",//玩法选择\n        \"goodCard\":\"标准\",//发牌模式\n        //金币场分享\n        \"goldWinReward\":\"0\",//金币场赢取奖励while\n        \"surpassPercent\":0, //超越比例\n        //arena比赛场分享\n        \"arenaWinRewardMoney\":\"0\",//arena比赛赢取奖励金钱\n        \"arenaWinRewardChip\":\"0\",//arena比赛赢取奖励金币\n        \"arenaRanking\":0, //arena比赛名次\n        //复活弹窗\n        \"repeatNumber\":1,\n        \"stageIndex\":1,\n        \"hadNumber\":0,\n        \"diamondPicture\":\"<img src='dda_button_diamond' height=34 width=42/>\",\n        \"redDiamondPicture\":\"<img src='ddz_diamond_red' height=34 width=42/>\",\n        \"coinPicture\":\"<img src='ddz_main_chip' height=48 width=48/>\",\n    },\n\n    SharePointType:{\n        firstFail : 67890001,  //首败\n        userGroup : 67890002,   //分享到三个群\n        tongGuan : 67890003,   //通关后分享\n        redPacket : 67890003,   //提现后分享\n        arenaPoint1 : 67890005,   //比赛1的分享点\n        arenaPoint2 : 67890006,   //比赛2的分享点\n        arenaPoint3 : 67890007,   //比赛3的分享点\n        arenaPoint4 : 67890008,   //比赛4的分享点\n        gongZhongHaoCard : 67890009,   //公众号会话卡片\n        gongZhongHaoMenu : 67890010,   //公众号自定义菜单\n        lottery : 67890003,   //发奖分享,\n        alms:67890013, //救济金\n        firstWithDraw : 67890012,  //首次提现\n        withChip : 67890003,  //发奖金币弹窗分享\n        getRedPacket : 67890015,  //分享领取红包\n        boxShare : 67890016,  //宝箱分享\n        shareFriend : 67890017, //首页邀请好友\n        customsSuccess : 67890018, //闯关成功分享\n        failSix : 67890003, //第六关闯关失败\n        firstUseJiPaiQi:67890020, //首次送记牌器match_back\n        adGetJiPaiQi:67890021, //看广告领取记牌器\n        getDayFirstLogin:67890022, //看广告领取记牌器\n        failDiamond:67890023, //闯关失败求助得钻石\n        skipCustom:67890024, //跳关\n        addApplet:67890025, //加入小程序\n        failWindw:67890026, //闯关失败重新闯关弹窗分享点\n        mainRestart:67890027, //首页重新闯关弹窗分享点\n    },\n\n    ShareState:{\n        isNotAGroupChat : 1,   //不是群聊\n        repetitionGroupChat : 2,  //重复群聊\n        sucessShare : 3, //正常分享\n        exShare : 4,\n        failToGetShareTicket : 5,\n        failToShare : 6\n    },\n};\n\nwx.onShareAppMessage(function (result) {\n    var type = ddz.Share.onShareType.clickStatShareTypeShareButton;\n    var shareMap = ddz.gameModel.shareConfig;\n    if(!shareMap){\n        //TODO:取不到分享配置信息\n        return;\n    }\n\n    var shareDetail = shareMap.clickStatShareTypeShareButton;\n\n    var shareCfg = shareDetail[hall.GlobalFuncs.getRandomNumberBefore(shareDetail.length)];\n    var shareTitle = hall.GlobalFuncs.replaceKeyWordInString(shareCfg.shareContent);\n\n    var imageUrl = shareCfg.sharePicUrl;\n    var sharePointId = shareCfg.sharePointId;\n    var shareSchemeId = shareCfg.shareSchemeId;\n\n    var query;\n    if(shareDetail.query){\n        var queryString = hall.GlobalFuncs.replaceKeyWordInString(shareDetail.query);\n        query = \"inviteCode=\" + ty.UserInfo.userId+\"&sourceCode=\" + type + \"&imageType=\" + shareSchemeId + \"&inviteName=\" + ty.UserInfo.userName + \"&\" + queryString;\n    }else {\n        query = \"inviteCode=\" + ty.UserInfo.userId+\"&sourceCode=\" + type + \"&imageType=\" + shareSchemeId + \"&inviteName=\" + ty.UserInfo.userName;\n    }\n\n    if(shareDetail.unSensitivePersonage){\n        ddz.Share.unSensitivePersonage = shareDetail.unSensitivePersonage;\n    }else {\n        ddz.Share.unSensitivePersonage = 0;\n    }\n\n    ddz.Share.shareType = type;\n    ddz.Share.sharePoint = shareDetail.sharePoint;\n    ddz.Share.isOnShare = true;\n    ddz.Share.resultType = 0;\n    ddz.Share.shareTicket = \"\";\n    ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 1, shareSchemeId]);\n\n    return {\n        title: shareTitle,\n        imageUrl:imageUrl,\n        query : query,//'key1=val1&key2=val2',\n        success : function (shareTickets, groupMsgInfos) {\n            ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId , 2, shareSchemeId]);\n            hall.LOGD(null, \"onShareAppMessage+++++++++++++++++\"+JSON.stringify(shareTickets));\n        },\n        fail : function () {\n            hall.LOGD(null, JSON.stringify(arguments));\n        },\n        complete : function () {\n        }\n    }\n});"]}