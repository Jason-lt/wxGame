{"version":3,"sources":["sxAdManager.js"],"names":["double","sxAdmanager","sxAdInfo","opDataWeight","iconWeight","iconIndex","preIconIndex","isSwitchIcon","callback","isLoadConfig","adIcon","show","dx","dy","scale","hall","LOGW","setPositionByScene","position","cc","v2","active","director","getScheduler","schedule","framesInterval","that","Node","wx","initWeight","switchIcon","addComponent","Button","on","onClickAdIconBtn","zIndex","game","addPersistRootNode","loadConfigFile","error","hide","unschedule","setPosition","winSize","width","setScale","index","x","y","self","xhr","loader","getXMLHttpRequest","timedOut","timer","setTimeout","abort","open","onreadystatechange","clearTimeout","readyState","status","responseText","length","ret","JSON","parse","e","retryConfigFile","onerror","send","num","Math","floor","random","selectItemByWeight","icons","type","getComponent","Animation","removeComponent","Sprite","loadStaticImg","spriteFrame","loadDynamicImg","err","i","weight","openData","j","arr","link","imgLink","load","tex","SpriteFrame","split","adIconFrames","playFrames","animation","clip","AnimationClip","createWithSpriteFrames","name","wrapMode","WrapMode","Loop","addClip","play","results","getError","splice","getContent","push","GlobalFuncs","setInLocalStorage","gameModel","OPEN_ADBTN_TYPE_TODAY","openType","previewImage","urls","imgurl","success","res","fail","bi_paramlist","biparam","topath","ty","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeClickAdBtn","navigateToMiniProgram","appId","path","envVersion","extraData","clickStatEventTypeClickDirectToMiniGameSuccess","clickStatEventTypeClickDirectToMiniGameFail","complete","limit"],"mappings":"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","file":"sxAdManager.js","sourceRoot":"../../../../../assets/Script/shot","sourcesContent":["//三消交叉导流\ndouble.sxAdmanager = {\n    // sxAdInfo: {\n    //     \"icons\": [\n    //         // {\n    //         //     \"weight\": 10,\n    //         //     \"type\": 0,//0为静图，1为动图\n    //         //     \"imgLink\": \"https://sanxqn.nalrer.cn/tysanxiao/common/Sbt_melon_1.png\",\n    //         //     \"openType\": 0,//0为静图，1为小程序\n    //         //     \"openData\":\n    //         //         [\n    //         //             { \"imgurl\": \"https://sanxqn.nalrer.cn/tysanxiao/box-worldCup/linkImages/WorldCup_Img_1.jpg\", \"weight\": 50 },\n    //         //             { \"imgurl\": \"https://sanxqn.nalrer.cn/tysanxiao/trialine/linkimage/link002.png\", \"weight\": 100 },\n    //         //             { \"imgurl\": \"https://sanxqn.nalrer.cn/tysanxiao/1010/linkImages/1010_link_image.png\", \"weight\": 37 },\n    //         //         ]\n    //         // },\n    //         {\n    //             \"weight\": 10,\n    //             \"type\": 1,\n    //             \"imgLink\": \"https://sanxqn.nalrer.cn/tysanxiao/box/Ad/1.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/2.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/3.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/4.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/5.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/6.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/7.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/8.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/9.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/10.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/11.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/12.png,https://sanxqn.nalrer.cn/tysanxiao/box/Ad/13.png\",\n    //             \"openType\": 0,\n    //             \"openData\":\n    //                 [\n    //                     { \"imgurl\": \"https://sanxqn.nalrer.cn/tysanxiao/box-worldCup/linkImages/WorldCup_Img_1.jpg\", \"weight\": 80 },\n    //                     { \"imgurl\": \"https://sanxqn.nalrer.cn/tysanxiao/1010/linkImages/1010_link_image.png\", \"weight\": 11 },\n    //                 ]\n    //         }\n    //     ],\n    //     \"framesInterval\": 3,\n    //     \"position\": [{ \"x\": 600, \"y\": 450 }, { \"x\": 50, \"y\": 760 }, { \"x\": 550, \"y\": 820 }]\n    // },\n    sxAdInfo: null,\n    opDataWeight: [],\n    iconWeight: null,\n    iconIndex: null,\n    preIconIndex: null,\n    isSwitchIcon: false,//true为换icon，false为不换icon\n    callback: null,\n    isLoadConfig: false,\n\n    adIcon : null,\n\n\n    show: function (dx, dy, scale) {\n        try {\n            if (this.adIcon) {\n                hall.LOGW(\"sxAdManager: \" + \"restart adIcon\");\n                if (dx == 0 && dy == 0) {\n                    this.setPositionByScene(0);\n                }else {\n                    this.adIcon.position = cc.v2(dx, dy);\n                }\n                this.adIcon.active = true;\n                cc.director.getScheduler().schedule(\n                    this.callback, this.adIcon, this.sxAdInfo.framesInterval, !this.isSwitchIcon);\n            } else {\n\n                var that = this;\n                var callback = () => {\n                    hall.LOGW(\"sxAdManager: \" + \"first adIcon\");\n                    that.adIcon = new cc.Node();\n\n                    // this.adIcon.position = cc.v2(cc.winSize.width - dx, dy);\n                    that.adIcon.position = cc.v2(dx, dy);\n\n                    if (dx == 0 && dy == 0)\n                        that.setPositionByScene(0);\n                    if (scale)\n                        that.adIcon.scale = scale;\n\n                    if (typeof wx !== 'undefined') {\n                        that.initWeight();\n                        that.iconIndex = 0;\n                        that.isSwitchIcon = true;\n                        that.callback = () => {\n                            that.switchIcon();\n                        }\n                        that.callback();\n                        cc.director.getScheduler().schedule(\n                            that.callback, that.adIcon, that.sxAdInfo.framesInterval, !that.isSwitchIcon);\n                        that.adIcon.addComponent(cc.Button);\n                        that.adIcon.on('click', that.onClickAdIconBtn, that);\n\n                        that.adIcon.zIndex = 999;\n                        cc.game.addPersistRootNode(that.adIcon);\n                    }\n                };\n                this.loadConfigFile(callback);\n            }\n        } catch (error) {\n            hall.LOGW(\"sxAdManager: \", error);\n\n        }\n    },\n\n    hide: function () {\n        if (this.adIcon) {\n            cc.director.getScheduler().unschedule(this.callback, this.adIcon);\n            this.adIcon.active = false;\n            hall.LOGW(\"sxAdManager: \" + \"Ad hide success\");\n        }\n\n    },\n\n    setPosition: function (dx, dy) {\n        if (this.adIcon) {\n            this.adIcon.position = cc.v2(cc.winSize.width - dx, dy);\n        }\n    },\n\n    setScale: function (scale) {\n        if (this.adIcon) {\n            this.adIcon.scale = scale;\n        }\n    },\n\n    setPositionByScene: function (index) {\n        if (this.adIcon) {\n            let dx = this.sxAdInfo.position[index].x;\n            let dy = this.sxAdInfo.position[index].y;\n\n            hall.LOGW(index, \"x: \", dx, \"y: \", dy);\n            this.adIcon.position = cc.v2(dx, dy);\n        }\n    },\n\n    loadConfigFile: function (callback) {\n        try {\n            hall.LOGW('getConfigFile');\n            let self = this;\n            let xhr = cc.loader.getXMLHttpRequest();\n            var timedOut = false;\n            var timer = setTimeout(function () {\n                timedOut = true;\n                xhr.abort();\n            }, 3000);\n            // xhr.open(\"GET\", \"https://sanxqn.nalrer.cn/tysanxiao/box/adconfig/configDaoLiu7.json\", true);\n            xhr.open(\"GET\",\"https://nslyqn.nalrer.cn/nsly/crazygun/growth/adConfigFile/configDaoLiu.json\",true);\n            xhr.onreadystatechange = function () {\n                if (timedOut) {\n                    return;\n                }\n                clearTimeout(timer);\n                if (xhr.readyState === 4) {\n                    if ((xhr.status >= 200 && xhr.status < 300)) {\n                        self.isLoadConfig = true;\n                        hall.LOGW(\"http res(\" + xhr.responseText.length + \"):\" + xhr.responseText);\n                        try {\n                            let ret = JSON.parse(xhr.responseText);\n                            hall.LOGW('get config', ret);\n\n                            // 游戏开关\n                            self.sxAdInfo = ret;\n                            hall.LOGW('sxAdInfo:', self.sxAdInfo);\n                            callback();\n\n                            //Global.Gameversion = true;\n                        } catch (e) {\n                            // if (param) {\n                            // self.loadIp();\n                            // }\n                            self.retryConfigFile();\n                            hall.LOGW(\"err:\" + e);\n                        }\n                    } else {\n                        // if (param) {\n                        //     self.loadIp();\n                        // }\n                        self.retryConfigFile();\n                        hall.LOGW('get config error', xhr);\n                    }\n                }\n                // self.loadIp();\n            };\n\n            xhr.onerror = function () {\n                clearTimeout(timer);\n                // if (param) {\n                //     // self.loadIp();\n                //     self.retryConfigFile();\n                // }\n            };\n\n            xhr.send();\n        } catch (error) {\n            // if (param) {\n            //     // self.loadIp();\n            //     self.retryConfigFile();\n            // }\n            hall.LOGW(' get config error', error);\n        }\n    },\n    retryConfigFile: function () {\n        if (!this.isLoadConfig) {\n            setTimeout(() => {\n                this.loadConfigFile(false);\n            }, 20000);\n        }\n    },\n    switchIcon: function () {//刷新Icon\n        try {\n            let num = Math.floor(Math.random() * this.iconWeight);\n            this.iconIndex = this.selectItemByWeight(num, this.sxAdInfo.icons);\n\n            if (this.iconIndex != -1) {\n                if (this.iconIndex != this.preIconIndex) {\n                    if (this.sxAdInfo.icons[this.iconIndex].type == 0) {\n                        hall.LOGW(\"sxAdManager: \" + \"load static Ad\");\n                        if (this.adIcon.getComponent(cc.Animation)) {//除去动态icon的组件\n                            this.adIcon.removeComponent(cc.Animation);\n                            this.adIcon.removeComponent(cc.Sprite);\n                        }\n                        this.loadStaticImg(this.sxAdInfo.icons[this.iconIndex]);\n                    } else if (this.sxAdInfo.icons[this.iconIndex].type == 1) {\n                        hall.LOGW(\"sxAdManager: \" + \"load dynamic Ad\");\n                        if (this.adIcon.getComponent(cc.Sprite)) {//除去静态icon的组件\n                            this.adIcon.getComponent(cc.Sprite).spriteFrame = null;\n                        }\n                        this.loadDynamicImg(this.sxAdInfo.icons[this.iconIndex]);\n                    }\n                    this.preIconIndex = this.iconIndex;\n                }\n\n            }\n        } catch (err) {\n            hall.LOGW(\"sxAdManager: \", err);\n            cc.director.getScheduler().unschedule(this.callback, this.adIcon);\n        }\n    },\n\n    initWeight: function () {\n        this.iconWeight = 0;\n        for (let i = 0; i < this.sxAdInfo.icons.length; i++) {\n            this.iconWeight += this.sxAdInfo.icons[i].weight;\n            this.opDataWeight[i] = 0;\n            var openData = this.sxAdInfo.icons[i].openData;\n            for (let j = 0; j < openData.length; j++) {\n                this.opDataWeight[i] += openData[j].weight;\n            }\n        }\n    },\n\n    //添加导流入口Icon静态图片\n    loadStaticImg: function (arr) {\n        let link = arr.imgLink;\n        let self = this;\n        cc.loader.load(link, function (err, tex) {\n            if (self.adIcon.getComponent(cc.Sprite)) {//重新调用时可能是同一个静态icon也可能适另一个静态icon\n                self.adIcon.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(tex);\n            }\n            else {\n                self.adIcon.addComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(tex);\n            }\n        });\n    },\n\n    //添加导流入口Icon动画\n    loadDynamicImg: function (arr) {\n        let link = arr.imgLink.split(',');\n        let self = this;\n        var adIconFrames = [];\n        var playFrames = () => {\n\n\n            if (self.adIcon.getComponent(cc.Animation)) {//重新调用时可能是同一个动态icon也可能适另一个动态icon\n\n                var animation = self.adIcon.getComponent(cc.Animation);\n\n                var clip = cc.AnimationClip.createWithSpriteFrames(adIconFrames, 10);\n                clip.name = 'anim_frame';\n                clip.wrapMode = cc.WrapMode.Loop;\n                animation.addClip(clip);\n                animation.play('anim_frame');\n            }\n            else {\n                var animation = self.adIcon.addComponent(cc.Animation);\n                if (!self.adIcon.getComponent(cc.Sprite))\n                    self.adIcon.addComponent(cc.Sprite);\n\n                var clip = cc.AnimationClip.createWithSpriteFrames(adIconFrames, 10);\n                clip.name = 'anim_frame';\n                clip.wrapMode = cc.WrapMode.Loop;\n                animation.addClip(clip);\n                animation.play('anim_frame');\n            }\n        };\n        cc.loader.load(link, function (err, results) {\n            if (err) {\n                for (var i = 0; i < err.length; i++) {\n                    hall.LOGW(\"sxAdManager: \", 'load Dynamic img failed' + err[i] + ']: ' + results.getError(err[i]));\n                }\n            }\n            else {\n                adIconFrames.splice(0, adIconFrames.length);\n\n                for (let i = 0; i < link.length; i++) {\n                    var tex = results.getContent(link[i]);\n                    adIconFrames.push(new cc.SpriteFrame(tex));\n                }\n                playFrames();\n            }\n        });\n    },\n\n    onClickAdIconBtn: function () {\n        hall.GlobalFuncs.setInLocalStorage(double.gameModel.OPEN_ADBTN_TYPE_TODAY,'STU');\n        if (typeof wx !== 'undefined') {\n            try {\n                let iconIndex = this.iconIndex;\n                let num = Math.floor(Math.random() * this.opDataWeight[iconIndex]);\n                let index = this.selectItemByWeight(num, this.sxAdInfo.icons[iconIndex].openData);\n\n                if (index != -1) {\n                    if (this.sxAdInfo.icons[iconIndex].openType == 0) {\n                        wx.previewImage({\n                            // current: ''; // 当前要显示的图片url\n                            urls: [this.sxAdInfo.icons[iconIndex].openData[index].imgurl], // 需要预览的图片url列表\n                            success: (res) => {\n                                hall.LOGW(\"sxAdManager: \" + 'preview success', res);\n                            },\n                            fail: (res) => {\n                                hall.LOGW(\"sxAdManager: \" + 'preview fail', res);\n                            },\n                            // complete: () => {\n\n                            // }\n                        });\n                    }\n                    else if (this.sxAdInfo.icons[iconIndex].openType == 1) {\n                        var bi_paramlist = this.sxAdInfo.icons[iconIndex].biparam;\n                        hall.LOGW(bi_paramlist);\n                        hall.LOGW(this.sxAdInfo.icons[iconIndex].topath);\n                        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeClickAdBtn, bi_paramlist);\n                        wx.navigateToMiniProgram({\n                            appId: this.sxAdInfo.icons[iconIndex].openData[index].imgurl,\n                            path: this.sxAdInfo.icons[iconIndex].topath,\n                            envVersion: 'release',\n                            extraData: null,\n                            success: function (res) {\n                                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeClickDirectToMiniGameSuccess, bi_paramlist);\n                                hall.LOGW('wx.navigateToMiniProgram success');\n                                hall.LOGW(res);\n                            },\n                            fail: function (res) {\n                                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeClickDirectToMiniGameFail, bi_paramlist);\n                                hall.LOGW('wx.navigateToMiniProgram fail');\n                                hall.LOGW(res);\n                            },\n                            complete: function (res) {\n                                hall.LOGW('navigateToMiniProgram ==== complete');\n                            }\n                        });\n                    }\n\n                }\n\n            } catch (error) {\n                hall.LOGW(\"sxAdManager: \", error);\n            }\n        }\n    },\n\n    selectItemByWeight(num, arr) {\n        let limit = 0;\n        for (let i = 0; i < arr.length; i++) {\n            let weight = arr[i].weight;\n            if (weight) {\n                if (num < weight + limit && num > limit) {\n                    return i;\n                }\n            }\n            limit += weight;\n        }\n        return -1;\n    }\n}\n"]}