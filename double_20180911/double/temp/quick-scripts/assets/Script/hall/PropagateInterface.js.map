{"version":3,"sources":["PropagateInterface.js"],"names":["ty","PropagateInterface","getShareConfigInfo","reqObj","timeStamp","Date","getTime","act","time","game_mark","SystemInfo","cloudid","gameId","signStr","getConfigSignStr","paramStrList","key","push","finalUrl","shareManagerUrlShare","join","successcb","ret","double","gameModel","saveShareConfigFromHttp","retmsg","NotificationCenter","trigger","EventType","GET_SHARE_CONFIG_SUCCESS","failcb","GET_SHARE_CONFIG_FAIL","HttpUtil","httpGet","getSingleShareConfigInfo","debugMode","ext_type","shareObj","getUserFeatureInfo","cloud_id","game_id","user_id","UserInfo","userId","shareManagerUrl","GET_USER_FEATURE_SUCCESS","GET_USER_FEATURE_FAIL","sortedKeys","Object","keys","sort","i","length","finalSign","hall","hex_md5"],"mappings":"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","file":"PropagateInterface.js","sourceRoot":"../../../../../assets/Script/hall","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/25.\n * 营销传播智能管理系统对应数据获取接口\n */\n\n\nty.PropagateInterface = {\n    /**\n     * 通过http获取分享相关信息\n     * http://market.touch4.me/?act=api.getShareConfig&time=1421755384&game_mark=richddz&sign=a30ab1292aa5929e7f913ceed795f78c\n     test demo\n     var param = {\n                 share_type:\"hyyq2\",      //获取分享点相关参数,可不传,传则代表获取单个分享点,不传表示获取all\n                 config_id:\"002003003\"    //获取方案对应数据,不论该方案是否已发布,内部测试接口参数,代码发布上线时请删除\n             };\n     tywx.PropagateInterface.getShareConfigInfo(param);\n     */\n    getShareConfigInfo: function(reqObj) {\n        if(typeof(reqObj) != 'object') {\n            reqObj = {};\n        }\n\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getShareConfig';\n        reqObj.time = timeStamp;\n        reqObj.game_mark = ty.SystemInfo.cloudid + \"-\" + ty.SystemInfo.gameId;\n\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = ty.SystemInfo.shareManagerUrlShare + '?' + paramStrList.join('&');\n        var successcb = function(ret) {\n            double.gameModel.saveShareConfigFromHttp(ret.retmsg);\n            ty.NotificationCenter.trigger(double.EventType.GET_SHARE_CONFIG_SUCCESS, ret);\n        };\n\n        var failcb = function(ret) {\n            ty.NotificationCenter.trigger(double.EventType.GET_SHARE_CONFIG_FAIL, ret);\n        };\n        ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n    getSingleShareConfigInfo: function(reqObj) {\n        if(typeof(reqObj) != 'object') {\n            reqObj = {};\n        }\n\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getShareConfig';\n        reqObj.time = timeStamp;\n        reqObj.game_mark = ty.SystemInfo.cloudid + \"-\" + ty.SystemInfo.gameId;\n        if (debugMode){\n            reqObj.ext_type = 'test';\n        }\n\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = ty.SystemInfo.shareManagerUrlShare + '?' + paramStrList.join('&');\n\n        var successcb = function(ret) {\n            var shareObj = ret.retmsg;\n            delete shareObj['shareExt'];\n            // ty.NotificationCenter.trigger(ty.EventType.GET_SHARE_SINGLE_CONFIG_SUCCESS, shareObj);\n        };\n\n        var failcb = function(ret) {\n            // ty.NotificationCenter.trigger(ty.EventType.GET_SHARE_SINGLE_CONFIG_FAIL, ret);\n        };\n        ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n    /**\n     * 获取用户特征值接口\n     * http://market.touch4.me/?act=api.getUserFeature&cloud_id=24&game_id=6&time=1527235026&user_id=1404248&sign=a2b6938904ac3759fe6404ea8ed49267\n     */\n    getUserFeatureInfo: function() {\n        var reqObj = {};\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getUserFeature';\n        reqObj.cloud_id = ty.SystemInfo.cloudid;\n        reqObj.game_id = ty.SystemInfo.gameId;\n        reqObj.user_id = ty.UserInfo.userId;\n        reqObj.time = timeStamp;\n\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = ty.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n        var successcb = function(ret) {\n            ty.NotificationCenter.trigger(double.EventType.GET_USER_FEATURE_SUCCESS, ret);\n        };\n\n        var failcb = function(ret) {\n            ty.NotificationCenter.trigger(double.EventType.GET_USER_FEATURE_FAIL, ret);\n        };\n\n        ty.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n    /**\n     * 计算签名字符串\n     * @param reqObj\n     * @returns {string}\n     */\n    getConfigSignStr: function(reqObj) {\n        var sortedKeys = Object.keys(reqObj).sort();\n        var signStr = '';\n        for(var i=0;i<sortedKeys.length;i++){\n            var key = sortedKeys[i];\n            if(key == 'act' || key == 'sign') {\n                continue;\n            } else {\n                signStr += key + '=' + reqObj[key];\n            }\n        }\n        var finalSign = hall.hex_md5('market.tuyoo.com-api-' + signStr + '-market.tuyoo-api') || '';\n        return finalSign;\n    }\n};"]}