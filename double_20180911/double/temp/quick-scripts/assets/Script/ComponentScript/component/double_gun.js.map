{"version":3,"sources":["double_gun.js"],"names":["cc","Class","extends","Component","properties","gunNode","default","type","Node","gunSprite","Sprite","gunSpriteFrameList","SpriteFrame","bowNode","bowSprite","bowstringSprite","bowSpriteFrameList","bowstringSpriteFrameList","parentScene","serializable","locationX","locationY","rotationNow","scaleXMirror","gunAnimation","AnimationState","bowAnimation","onLoad","ty","NotificationCenter","listen","double","EventType","CHANGE_GUN_TYPE","changeGunType","getComponent","Animation","getAnimationState","index","GameWorld","weaponType","active","spriteFrame","sendArrow","AudioHelper","playEffect","EffectPath_mp3","gunHits","stop","play","getGunAngle","Math","PI","changeGunRotation","atan","objectNowLocationY","objectNowLocationX","node","rotation","update","dt"],"mappings":"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","file":"double_gun.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        gunNode : {\n            default : null,\n            type : cc.Node\n        },\n        gunSprite : {\n            default : null,\n            type : cc.Sprite\n        },\n        gunSpriteFrameList : [cc.SpriteFrame],\n\n        bowNode : {\n            default : null,\n            type : cc.Node\n        },\n        bowSprite : {\n            default : null,\n            type : cc.Sprite\n        },\n        bowstringSprite : {\n            default : null,\n            type : cc.Sprite\n        },\n        bowSpriteFrameList : [cc.SpriteFrame],\n        bowstringSpriteFrameList : [cc.SpriteFrame],\n\n        // arrowNode : {\n        //     default : null,\n        //     type : cc.Node\n        // },\n\n        parentScene: {\n            default: null,\n            serializable: false\n        },\n\n        locationX : 0,\n        locationY : 0,\n\n        rotationNow : 0,\n        // elevation : 0,\n        scaleXMirror : false,\n\n        gunAnimation : {\n            default : null,\n            type : cc.AnimationState\n        },\n        bowAnimation : {\n            default : null,\n            type : cc.AnimationState\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad : function() {\n        ty.NotificationCenter.listen(double.EventType.CHANGE_GUN_TYPE,this.changeGunType,this);\n\n        this.gunAnimation = this.gunNode.getComponent(cc.Animation).getAnimationState(\"qiang_01\");\n        // this.gunAnimation.on(\"finished\", function () {\n        // });\n        this.bowAnimation = this.bowNode.getComponent(cc.Animation).getAnimationState(\"gongjian_02\");\n        // this.bowAnimation.on(\"finished\", function () {\n        // });\n    },\n    changeGunType : function (index) {\n        if(double.GameWorld.weaponType == 0){//枪\n            this.gunNode.active = true;\n            this.bowNode.active = false;\n            this.gunSprite.spriteFrame = this.gunSpriteFrameList[index];\n        }else { //弓箭\n            // this.bowstringSprite.\n            this.gunNode.active = false;\n            this.bowNode.active = true;\n            this.bowSprite.spriteFrame = this.bowSpriteFrameList[index];\n            this.bowstringSprite.spriteFrame = this.bowstringSpriteFrameList[index];\n        }\n    },\n\n    sendArrow : function () {\n        double.AudioHelper.playEffect(double.EffectPath_mp3.gunHits,false);\n        if(double.GameWorld.weaponType == 0){//枪\n            this.gunAnimation.stop();\n            this.gunAnimation.play();\n        }else { //弓箭\n            this.bowAnimation.stop();\n            this.bowAnimation.play();\n        }\n    },\n\n    getGunAngle : function () {\n        if(this.scaleXMirror){\n            return (Math.PI-this.rotationNow);\n        }else {\n            return (Math.PI*2-this.rotationNow);\n        }\n    },\n\n    changeGunRotation : function () {\n        this.rotationNow = Math.atan((double.GameWorld.objectNowLocationY-this.locationY)/(double.GameWorld.objectNowLocationX-this.locationX));\n        if(this.scaleXMirror){\n            if(this.rotationNow < 0){\n                this.rotationNow = -this.rotationNow;\n            }else {\n                this.rotationNow = Math.PI -this.rotationNow;\n            }\n            if(double.GameWorld.objectNowLocationY < this.locationY){\n                this.rotationNow += Math.PI;\n            }\n        }else {\n            if(this.rotationNow < 0){\n                this.rotationNow = -this.rotationNow;\n                if(double.GameWorld.objectNowLocationY > this.locationY){\n                    this.rotationNow += Math.PI;\n                }\n            }else {\n                this.rotationNow = 2*Math.PI -this.rotationNow;\n                if(double.GameWorld.objectNowLocationY < this.locationY){\n                    this.rotationNow -= Math.PI;\n                }\n            }\n        }\n        this.node.rotation = this.rotationNow/(Math.PI*2)*360;\n    },\n\n    update : function (dt) {\n        this.changeGunRotation();\n    }\n});\n"]}