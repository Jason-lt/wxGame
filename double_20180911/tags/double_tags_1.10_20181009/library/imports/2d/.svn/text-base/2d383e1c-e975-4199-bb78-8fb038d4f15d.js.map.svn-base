{"version":3,"sources":["../../../../../assets/Script/Framework/assets/Script/Framework/Share.js"],"names":["crypto","require","double","Share","LAST_SHARE_TIME","SHARETICKETS_LIST","shareQuery","unSensitivePersonage","sharePoint","shareType","isOnShare","shareTicket","resultType","shareWithType","type","successCallBackFun","failCallBackFun","testCfg","shareMap","GameWorld","shareConfig","hall","LoginToyoo","shareDetail","shareCfg","list","GlobalFuncs","getShareRandomNumberWithShareList","shareTitle","replaceKeyWordInString","shareContent","query","ty","UserInfo","userId","shareSchemeId","userName","queryString","shareImage","sharePicUrl","extraAdd","length","callBackF","imageUrl","shareImformation","getShareImageWithShareMap","nowIndex","tempCavas","wx","createCanvas","width","height","context","getContext","image","createImage","src","onload","event","ima","target","drawImage","preTextWidth","preTextHeight","preX","preY","extraMap","textInformation","text","textformatString","font","fontSize","textColorRGB","indexOf","fillStyle","textAlign","replace","textX","parseInt","originPointX","textY","originPointY","fillText","measureText","imageInformation","sunImage","addImageUrl","userPic","sizeWidth","sizeHeight","shape","beginPath","arc","Math","PI","stroke","clip","img","tempFilePath","toTempFilePathSync","x","y","destWidth","destHeight","onerror","titleString","sharePointId","clickStatShareType","BiLog","clickStat","clickStatEventType","clickStatEventTypeShareAction","shareAppMessage","title","success","result","LOGE","JSON","stringify","arguments","shareTickets","ShareState","isNotAGroupChat","fail","isMatchShare","failToShare","LOGD","complete","playAnimationAfterShareWithType","NotificationCenter","trigger","EventType","UPDATE_SHARE_STATE","onShareType","clickStatShareTypeRankList","showRankList","endWithSuccessShare","gunnerShareSchemeConfig","shareError","getShareInfo","shareKey","clickStatShareTypeRevial","getShareResultWithKey","failToGetShareTicket","err","LOGW","toString","iv","encryptedData","reultString","decrypt","wxgame_session_key","informationMap","parse","openGId","toDay","GlobalTimer","getCurDay","lastShareTime","ReadStringFromLocalStorage","shareTicketsDic","setInLocalStorage","shareList","repetitionGroupChat","push","suscessShare","getOpenGid","_boxUserId","_openGid","encryFunc","_boxID","SystemInfo","boxId","mysteryGiftBagBoxId","key","crypted","Buffer","decipher","createDecipheriv","decoded","update","final","clickStatShareTypeMysteryGiftBag","clickStatShareTypeScore","clickStatShareTypeLight","clickStatShareTypeBullet","clickStatShareTypeGrenade","clickStatShareTypeShareButton","clickStatShareTypeDiamond","clickStatShareTypeBulletGetReward","clickStatShareTypeLightGetReward","clickStatShareTypeGrenadeGetReward","clickStatShareTypeMysteryGiftBagGetReward","clickStatShareTypeAddBullet","clickStatShareTypeOpenSecretBoxB","clickStatShareTypeOpenSecretBoxN","clickStatShareTypeComboContinue","SharePointType","getBullet","getLaser","getDiamond","shareResurgence","getGrenade","getFreeTool","shareKeywordReplace","theScoreForNow","bestRank","bestScoreForSelf","nickName","exShare","userInfoError","onShareAppMessage","groupMsgInfos","showShareMenu","withShareTicket"],"mappings":"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","file":"Share.js","sourceRoot":"../../../../../assets/Script/Framework","sourcesContent":["\nvar crypto = require('crypto');\n\ndouble.Share = {\n    LAST_SHARE_TIME : \"LAST_SHARE_TIME\",//最后一次分享的时间\n    // LAST_LOGIN_TIME : \"LAST_LOGIN_TIME\",//最后一次登录的时间\n    SHARETICKETS_LIST : \"SHARETICKETS_LIST\",//今天的分享群聊信息集合\n    shareQuery : \"\",\n\n    unSensitivePersonage : 0,//0、验证不同群,1、什么都不验证,2、验证群\n    sharePoint : 0,\n    shareType : \"\",\n\n    isOnShare : false,\n    shareTicket:\"\",\n    resultType : 0,//1、不是群,2、重复群,3、正常\n\n    shareWithType : function (type, successCallBackFun, failCallBackFun, testCfg) {\n        // var shareMap = double.GameWorld.shareConfig;\n        // if(!shareMap){\n        //     return;\n        // }\n        var shareMap = double.GameWorld.shareConfig;\n        if(!shareMap){\n            hall.LoginToyoo();\n            return;\n        }\n        var shareDetail = shareMap[type];\n\n        var shareCfg = shareDetail.list[hall.GlobalFuncs.getShareRandomNumberWithShareList(shareDetail.list)];\n        if (testCfg){\n            //配置上线前测试准备\n            shareCfg = testCfg;\n        }\n\n        var shareTitle = hall.GlobalFuncs.replaceKeyWordInString(shareCfg.shareContent);\n\n        var query = \"inviteCode=\"+ty.UserInfo.userId+\"&sourceCode=\"+type +\"&imageType=\"+shareCfg.shareSchemeId+\"&inviteName=\"+ty.UserInfo.userName;\n        if(shareDetail.query){\n            double.Share.shareQuery = shareDetail.query;\n            var queryString = hall.GlobalFuncs.replaceKeyWordInString(shareDetail.query);\n            query = query+\"&\"+queryString;\n        }else {\n            double.Share.shareQuery = \"\";\n        }\n\n        if(shareDetail.unSensitivePersonage){\n            double.Share.unSensitivePersonage = shareDetail.unSensitivePersonage;\n        }else {\n            double.Share.unSensitivePersonage = 0;\n        }\n\n        var shareImage = shareCfg.sharePicUrl;\n        if(shareCfg.extraAdd && shareCfg.extraAdd.length && shareCfg.extraAdd.length > 0 ){\n            var callBackF = function(imageUrl) {\n                double.Share.shareImformation(type, shareCfg, shareTitle, imageUrl, query, shareDetail.sharePoint, successCallBackFun, failCallBackFun);\n            };\n            double.Share.getShareImageWithShareMap(0, shareCfg.extraAdd, shareImage, callBackF);\n        }else {\n            double.Share.shareImformation(type, shareCfg, shareTitle, shareImage, query, shareDetail.sharePoint, successCallBackFun, failCallBackFun);\n        }\n    },\n\n    getShareImageWithShareMap : function (nowIndex, extraAdd, imageUrl, callBackF) {\n        double.Share.isOnShare = true;\n        var tempCavas = wx.createCanvas();\n        tempCavas.width =  360;\n        tempCavas.height =  288;\n\n        var context = tempCavas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = imageUrl;\n\n        image.onload = function (event) {\n            var ima = event.target;\n            context.drawImage(ima,0,0);\n            var preTextWidth=0;\n            var preTextHeight=0;\n            var preX=0;\n            var preY=0;\n            while (nowIndex < extraAdd.length) {\n                var extraMap = extraAdd[nowIndex];\n                if (extraMap.type == \"text\") {\n                    var textInformation = extraMap.textInformation;\n                    var text = hall.GlobalFuncs.replaceKeyWordInString(textInformation.textformatString);\n                    context.font = textInformation.fontSize + \"px Arial\";\n                    if (textInformation.textColorRGB.indexOf('#') == -1){\n                        textInformation.textColorRGB = \"#\" + textInformation.textColorRGB;\n                    }\n                    context.fillStyle = textInformation.textColorRGB;\n                    context.textAlign = textInformation.textAlign.replace('middle','center');\n                    var textX = parseInt(textInformation.originPointX);\n                    if(textX < 0){\n                        if(textX == -1){\n                            textX = preX - preTextWidth/2;\n                        }else if(textX == -2){\n                            textX = preX + preTextWidth/2;\n                        }\n                    }\n                    var textY = parseInt(textInformation.originPointY);\n                    if (textY < 0){\n                        if(textY == -1){\n                            textY = preY - preTextHeight/2;\n                        }if(textY == -2){\n                            textY = preY + preTextHeight/2;\n                        }\n                    }\n                    context.fillText(text,textX,textY);\n                    preTextWidth = context.measureText(text).width;\n                    preTextHeight = context.measureText(text).height;\n                    preX = textX;\n                    preY = textY;\n                    nowIndex ++;\n                }else if(extraMap.type == \"image\") {\n                    var imageInformation = extraMap.imageInformation;\n                    var sunImage = wx.createImage();\n                    // sunImage.src = imageInformation.addImageUrl;\n                    if(imageInformation.addImageUrl == \"avatar\"){\n                        sunImage.src = ty.UserInfo.userPic;\n                    }else {\n                        sunImage.src = imageInformation.addImageUrl;\n                    }\n\n                    sunImage.originPointX = parseInt(imageInformation.originPointX);\n                    sunImage.originPointY = parseInt(imageInformation.originPointY);\n                    sunImage.sizeWidth = parseInt(imageInformation.sizeWidth);\n                    sunImage.sizeHeight = parseInt(imageInformation.sizeHeight);\n                    if(imageInformation.shape && imageInformation.shape == 2){\n                        context.beginPath();\n                        context.arc(sunImage.originPointX+sunImage.sizeWidth/2,sunImage.originPointY+sunImage.sizeHeight/2,sunImage.sizeWidth/2,0,2*Math.PI);\n                        context.stroke();\n                        context.clip();\n                    }\n                    sunImage.onload = function (event) {\n                        var img = event.target;\n                        context.drawImage(img,img.originPointX,img.originPointY,img.sizeWidth,img.sizeHeight);\n                        var tempFilePath = tempCavas.toTempFilePathSync({\n                            x: 0,\n                            y: 0,\n                            width: tempCavas.width,\n                            height: tempCavas.height,\n                            destWidth: tempCavas.width,\n                            destHeight: tempCavas.height\n                        });\n                        if(callBackF) {\n                            callBackF(tempFilePath);\n                        }\n                    };\n                    sunImage.onerror = function (event) {\n                        var img = event.target;\n                        // hall.LOGW(\"==\",\"============加载头像失败===========\"+sunImage.src+\"====\"+imageInformation.addImageUrl+\"====\");\n                        var tempFilePath = tempCavas.toTempFilePathSync({\n                            x: 0,\n                            y: 0,\n                            width: tempCavas.width,\n                            height: tempCavas.height,\n                            destWidth: tempCavas.width,\n                            destHeight: tempCavas.height\n                        });\n                        if(callBackF) {\n                            callBackF(tempFilePath);\n                        }\n                    };\n                    return;\n                }\n            }\n            var tempFilePath = tempCavas.toTempFilePathSync({\n                x: 0,\n                y: 0,\n                width: tempCavas.width,\n                height: tempCavas.height,\n                destWidth: tempCavas.width,\n                destHeight: tempCavas.height\n            });\n            if(callBackF) {\n                callBackF(tempFilePath);\n            }\n        };\n        image.onerror = function (event) {\n            var img = event.target;\n            // hall.LOGW(\"==\",\"============加载底图失败===========\"+img.src);\n        };\n    },\n\n    shareImformation : function (type, shareCfg, titleString, imageUrl, query, sharePoint, successCallBackFun, failCallBackFun) {\n        double.Share.shareType = type;\n        double.Share.sharePoint = sharePoint;\n        double.Share.isOnShare = true;\n        double.Share.resultType = 0;\n        double.Share.shareTicket = \"\";\n\n        // var sharePointId = shareCfg.sharePointId;\n        var sharePointId = double.Share.clickStatShareType[type];\n        var shareSchemeId = shareCfg.shareSchemeId;\n\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 1, shareSchemeId]);\n\n        wx.shareAppMessage({\n            title: titleString,\n            imageUrl : imageUrl,//5:4\n            query : query,//'key1=val1&key2=val2',\n            success : function (result) {\n                hall.LOGE(\"shareAppMessage\",\"===shareAppMessage==success==\"+JSON.stringify(arguments)+\"===\"+query);\n                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 2, shareSchemeId]);\n                if (successCallBackFun){\n                    successCallBackFun(result);\n                }\n                if(!result.shareTickets || !result.shareTickets[0]){\n                    double.Share.resultType = double.Share.ShareState.isNotAGroupChat;\n                    double.Share.shareTicket = \"\";\n                    return;\n                }\n                double.Share.shareTicket = result.shareTickets[0];\n            },\n            fail : function () {\n                hall.LOGE(\"shareAppMessage\",\"===shareAppMessage==fail==\"+JSON.stringify(arguments)+\"===\"+query);\n                if (failCallBackFun){\n                    failCallBackFun();\n                }\n                double.Share.isMatchShare = false;\n                double.Share.resultType = double.Share.ShareState.failToShare;\n                hall.LOGD(null, JSON.stringify(arguments));\n            },\n            complete : function () {\n                // hall.LOGE(\"shareAppMessage\",\"===shareAppMessage==complete==\"+JSON.stringify(arguments));\n            }\n        });\n    },\n\n    playAnimationAfterShareWithType:function() {\n        hall.LOGE(\"===\",\"playAnimationAfterShareWithType==\"+double.Share.sharePoint);\n        // hall.LOGW(\"\",\"file = [Share] fun = [playAnimationAfterShareWithType] 111 \");\n        if(double.Share.resultType == double.Share.ShareState.failToShare){\n            ty.NotificationCenter.trigger(double.EventType.UPDATE_SHARE_STATE,double.Share.shareType);\n            return;\n        }\n\n        //直接跳转排行榜\n        if(double.Share.shareType == double.Share.onShareType.clickStatShareTypeRankList){\n            if(double.Share.shareTicket && double.Share.shareTicket != \"\"){\n                double.GlobalFuncs.showRankList(double.Share.shareTicket);\n                double.Share.shareType = \"\";\n                double.Share.resultType = 0;\n                return;\n            }\n        }\n\n        if(!double.Share.unSensitivePersonage || double.Share.unSensitivePersonage == 1){\n            this.endWithSuccessShare();\n            return;\n        }\n\n        if (!double.GameWorld.gunnerShareSchemeConfig) {\n            double.Share.shareType = double.Share.ShareState.shareError;\n            // this.endWithSuccessShare();\n            ty.NotificationCenter.trigger(double.EventType.UPDATE_SHARE_STATE,double.Share.shareType);\n            return\n        }\n\n        //没有分享到群,发送通知结果类型和分享类型通知(没有分享到微信群)\n        if (!double.Share.shareTicket || double.Share.shareTicket == \"\"){\n            double.Share.resultType = double.Share.ShareState.isNotAGroupChat;\n            ty.NotificationCenter.trigger(double.EventType.UPDATE_SHARE_STATE,double.Share.shareType);\n            return;\n        }\n\n        //分享点只验证群,好友\n        if(double.Share.unSensitivePersonage == 2){\n            //要验证群的处理\n            try {\n                wx.getShareInfo(\n                    {\n                        shareTicket :double.Share.shareTicket,\n                        success : function (result) {\n                            var shareKey;\n                            if(double.Share.shareType == double.Share.onShareType.clickStatShareTypeRevial){\n                                shareKey = \"resurgence\";\n                                double.Share.getShareResultWithKey(result,shareKey);\n                            }else {\n                                shareKey = double.Share.sharePoint +\"\";\n                                double.Share.getShareResultWithKey(result,shareKey);\n                            }\n                        },\n                        fail : function () {\n                            double.Share.resultType = double.Share.ShareState.failToGetShareTicket;\n                            ty.NotificationCenter.trigger(double.EventType.UPDATE_SHARE_STATE,double.Share.shareType);\n                        },\n                        complete : function () {\n                        }\n                    }\n                );\n            }catch (err){\n                hall.LOGE(\"error:\", \"double.Share.unSensitivePersonage——\" + JSON.stringify(err));\n            }\n\n        }\n    },\n\n    getShareResultWithKey : function (result,shareKey) {\n        hall.LOGW(\"\",\"file = [Share] fun = [getShareResultWithKey]  \"+result.toString()+\"===\"+shareKey);\n        var iv = result.iv ;\n        var encryptedData = result.encryptedData;\n        var reultString = double.Share.decrypt(ty.UserInfo.wxgame_session_key,iv,encryptedData);\n        // {\"openGId\":\"tGXVqG5IZmqkGArWBhZNJwn2NsqaQ\",\"watermark\":{\"timestamp\":1524292994,\"appid\":\"wxbfebdafc2fc60b54\"}}\n        var informationMap = JSON.parse(reultString);\n        var openGId = informationMap.openGId;\n        var toDay = hall.GlobalTimer.getCurDay();\n        var lastShareTime = hall.GlobalFuncs.ReadStringFromLocalStorage(double.Share.LAST_SHARE_TIME, \"\");\n\n        var shareTicketsDic = {};\n        if(toDay != lastShareTime){\n            shareTicketsDic[shareKey] = [openGId];\n            hall.GlobalFuncs.setInLocalStorage(double.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            hall.GlobalFuncs.setInLocalStorage(double.Share.LAST_SHARE_TIME, toDay);\n        }else {\n            var shareTickets = hall.GlobalFuncs.ReadStringFromLocalStorage(double.Share.SHARETICKETS_LIST, \"\");\n            shareTicketsDic = JSON.parse(shareTickets);\n            if(shareTicketsDic && shareTicketsDic[shareKey] && shareTicketsDic[shareKey].length){\n                var shareList = shareTicketsDic[shareKey];\n                if (shareList.indexOf(openGId) > -1){\n                    double.Share.resultType = double.Share.ShareState.repetitionGroupChat;\n                    ty.NotificationCenter.trigger(double.EventType.UPDATE_SHARE_STATE,double.Share.shareType);\n                    hall.LOGW(\"getShareResultWithKey\",\"UPDATE_SHARE_STATE  ===\"+double.Share.shareType);\n                    double.Share.shareTicket = \"\";\n                    return;\n                }\n                shareList.push(openGId);\n                hall.GlobalFuncs.setInLocalStorage(double.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            }else {\n                shareTicketsDic[shareKey] = [openGId];\n                hall.GlobalFuncs.setInLocalStorage(double.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            }\n        }\n        this.endWithSuccessShare();\n    },\n\n    endWithSuccessShare : function () {\n        hall.LOGW(\"\",\"file = [Share] fun = [endWithSuccessShare] double.Share.sharePoint = \" + double.Share.sharePoint);\n        double.Share.resultType = double.Share.ShareState.suscessShare;\n        if(double.Share.shareType != double.Share.onShareType.clickStatShareTypeRevial &&\n            double.Share.sharePoint > 10000){\n            // double.gameModel.shareToGetreward(double.Share.sharePoint);\n        }\n        ty.NotificationCenter.trigger(double.EventType.UPDATE_SHARE_STATE,double.Share.shareType);\n    },\n\n    getOpenGid:function(shareTicket,_boxUserId){\n        var _openGid = \"\";\n        var encryFunc = function(result){\n            var iv = result.iv ;\n            var encryptedData = result.encryptedData;\n            var reultString = double.Share.decrypt(ty.UserInfo.wxgame_session_key,iv,encryptedData);\n            // hall.LOGW(\"\",\"file = [Share] fun = [getShareResultWithKey] reultString = \"+JSON.stringify(reultString));\n            // {\"openGId\":\"tGXVqG5IZmqkGArWBhZNJwn2NsqaQ\",\"watermark\":{\"timestamp\":1524292994,\"appid\":\"wxbfebdafc2fc60b54\"}}\n            var informationMap = JSON.parse(reultString);\n            var openGId = informationMap.openGId;\n            _openGid = openGId;\n            var _boxID = \"\";\n            if (ty.SystemInfo.boxId && ty.SystemInfo.boxId != \"\") {\n                _boxID = ty.SystemInfo.boxId;\n            }else if (ty.SystemInfo.mysteryGiftBagBoxId && ty.SystemInfo.mysteryGiftBagBoxId != \"\") {\n                _boxID = ty.SystemInfo.mysteryGiftBagBoxId;\n            }\n\n            // double.gameModel.getBoxReward(parseInt(_boxUserId),_boxID,_openGid);\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] ty.SystemInfo.boxId = \"+JSON.stringify(ty.SystemInfo.boxId));\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] _openGid = \"+JSON.stringify(_openGid));\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] _boxID = \" + JSON.stringify(_boxID));\n        };\n\n        wx.getShareInfo(\n            {\n                shareTicket :shareTicket,\n                success : function (result) {\n                    encryFunc(result);\n                },\n                fail : function () {\n\n                    var _boxID = \"\";\n                    if (ty.SystemInfo.boxId && ty.SystemInfo.boxId != \"\") {\n                        _boxID = ty.SystemInfo.boxId;\n                    }else if (ty.SystemInfo.mysteryGiftBagBoxId && ty.SystemInfo.mysteryGiftBagBoxId != \"\") {\n                        _boxID = ty.SystemInfo.mysteryGiftBagBoxId;\n                    }\n                    // double.gameModel.getBoxReward(parseInt(_boxUserId),_boxID,_openGid);\n                    hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] fail  _boxID = \" + _boxID);\n                },\n                complete : function () {\n                }\n            }\n        );\n\n    },\n\n    decrypt :function(key, iv, crypted) {\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        var decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n        return decoded;\n    },\n\n    onShareType :{\n\n        clickStatShareTypeMysteryGiftBag:\"clickStatShareTypeMysteryGiftBag\",//神秘礼包\n        clickStatShareTypeScore : \"clickStatShareTypeScore\",//炫耀最佳成绩\n        clickStatShareTypeLight : \"clickStatShareTypeLight\",//激光瞄准器\n        clickStatShareTypeBullet : \"clickStatShareTypeBullet\",//无限子弹\n        clickStatShareTypeGrenade : \"clickStatShareTypeGrenade\",//手榴弹\n        clickStatShareTypeShareButton : \"clickStatShareTypeShareButton\",//微信分享按钮\n        clickStatShareTypeDiamond : \"clickStatShareTypeDiamond\",//互助礼邀请群友复活卡\n        clickStatShareTypeRankList : \"clickStatShareTypeRankList\",//查看群排行\n        clickStatShareTypeRevial : \"clickStatShareTypeRevial\",//复活\n        clickStatShareTypeBulletGetReward : \"clickStatShareTypeBulletGetReward\", //分享无限子弹道具\n        clickStatShareTypeLightGetReward : \"clickStatShareTypeLightGetReward\", //分享激光道具\n        clickStatShareTypeGrenadeGetReward : \"clickStatShareTypeGrenadeGetReward\", //分享手榴弹\n        clickStatShareTypeMysteryGiftBagGetReward : \"clickStatShareTypeMysteryGiftBagGetReward\", //分享的钻石\n\n        clickStatShareTypeAddBullet : \"clickStatShareTypeAddBullet\", //游戏内分享得子弹\n        clickStatShareTypeOpenSecretBoxB : \"clickStatShareTypeOpenSecretBoxB\", //开启神秘宝箱北上广深\n        clickStatShareTypeOpenSecretBoxN : \"clickStatShareTypeOpenSecretBoxN\", //开启神秘宝箱北上广深\n\n        clickStatShareTypeComboContinue : \"clickStatShareTypeComboContinue\" //分享续连击\n\n    },\n    clickStatShareType :{\n        clickStatShareTypeMysteryGiftBag:\"214\",//神秘礼包北上广深\n        clickStatShareTypeScore : \"213\",//炫耀最佳成绩\n        clickStatShareTypeLight : \"212\",//激光瞄准器\n        clickStatShareTypeBullet : \"211\",//无限子弹\n        clickStatShareTypeGrenade : \"217\", //手榴弹\n        clickStatShareTypeShareButton : \"208\",//微信分享按钮\n        clickStatShareTypeDiamond : \"210\",//互助礼邀请群友复活卡\n        clickStatShareTypeRankList : \"209\",//查看群排行\n        clickStatShareTypeRevial : \"207\",//复活\n        clickStatShareTypeBulletGetReward : \"206\",//分享无限子弹道具\n        clickStatShareTypeLightGetReward : \"205\",//分享激光道具\n        clickStatShareTypeGrenadeGetReward : \"216\", //分享手榴弹\n        clickStatShareTypeMysteryGiftBagGetReward : \"204\",//神秘礼包非北上广深\n\n        clickStatShareTypeAddBullet : \"203\", //游戏内分享得子弹\n        clickStatShareTypeOpenSecretBoxB : \"202\", //开启神秘宝箱北上广深\n        clickStatShareTypeOpenSecretBoxN : \"201\", //开启神秘宝箱非北上广深\n\n        clickStatShareTypeComboContinue : \"215\" //分享续连击\n    },\n\n    SharePointType:{\n        getBullet: 10600001,  //获取无限子弹道具\n        getLaser: 10600002,  //获取激光道具\n        getDiamond: 10600003,  //获取钻石\n        shareResurgence: 10600004,  //复活\n        getGrenade: 10600005,  //获取手榴弹\n\n        getFreeTool : 10600006\n    },\n    \n    shareKeywordReplace :{\n        boxId :\"\",\n        mysteryGiftBagBoxId :\"\",\n        theScoreForNow : \"\",\n        bestRank : \"\",\n        bestScoreForSelf : 0,\n        nickName :\"\"\n    },\n    ShareState:{\n        isNotAGroupChat : 1,   //不是群聊\n        repetitionGroupChat : 2,  //重复群聊\n        suscessShare : 3, //正常分享\n        exShare : 4,\n        failToGetShareTicket : 5,\n        failToShare : 6,\n        userInfoError : 7,\n        shareError : 8\n    }\n};\n\nwx.onShareAppMessage(function (result) {\n    var type = double.Share.onShareType.clickStatShareTypeShareButton;\n    var shareMap = double.GameWorld.shareConfig;\n    if(!shareMap){\n        return;\n    }\n    var shareDetail = shareMap[type];\n\n    var shareCfg = shareDetail.list[hall.GlobalFuncs.getShareRandomNumberWithShareList(shareDetail.list)];\n    var shareTitle = hall.GlobalFuncs.replaceKeyWordInString(shareCfg.shareContent);\n\n    var imageUrl = shareCfg.sharePicUrl;\n    var sharePointId = shareCfg.sharePointId;\n    var shareSchemeId = shareCfg.shareSchemeId;\n\n    var query;\n    if(shareDetail.query){\n        var queryString = hall.GlobalFuncs.replaceKeyWordInString(shareDetail.query);\n        query = \"inviteCode=\" + ty.UserInfo.userId+\"&sourceCode=\" + type + \"&imageType=\" + shareSchemeId + \"&inviteName=\" + ty.UserInfo.userName + \"&\" + queryString;\n    }else {\n        query = \"inviteCode=\" + ty.UserInfo.userId+\"&sourceCode=\" + type + \"&imageType=\" + shareSchemeId + \"&inviteName=\" + ty.UserInfo.userName;\n    }\n\n    double.Share.shareType = type;\n    double.Share.sharePoint = shareDetail.sharePoint;\n    double.Share.isOnShare = true;\n    double.Share.resultType = 0;\n    double.Share.shareTicket = \"\";\n    ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 1, shareSchemeId]);\n\n    return {\n        title: shareTitle,\n        imageUrl:imageUrl,\n        query : query,//'key1=val1&key2=val2',\n        success : function (shareTickets,groupMsgInfos) {\n            hall.LOGE(\"onShareAppMessage\",\"===onShareAppMessage==success==\"+JSON.stringify(arguments)+\"===\"+query);\n            ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId , 2, shareSchemeId]);\n        },\n        fail : function () {\n            hall.LOGE(\"onShareAppMessage\",\"===onShareAppMessage==fail==\"+JSON.stringify(arguments)+\"===\"+query);\n        },\n        complete : function () {\n            // hall.LOGE(\"onShareAppMessage\",\"===onShareAppMessage==complete==\"+JSON.stringify(arguments)+\"===\"+query);\n        }\n    }\n});\n\nwx.showShareMenu({\n    withShareTicket: true\n});\n\n"]}