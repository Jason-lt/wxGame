{"version":3,"sources":["../../../../../assets/Script/Framework/assets/Script/Framework/TuyooSDK.js"],"names":["console","log","ty","TuyooSDK","SESSION_KEY","wechatLoginNormal","code","with_fail_guide","wx","getUserInfo","withCredentials","success","res","loginTuyooWithCode","userInfo","iv","encryptedData","fail","showModal","title","content","showCancel","cancelText","confirmText","confirm","openSetting","shot","needReLogin","wechatLoginDirect","loginCode","ServerStateManager","checkServerState","login","params","hall","LOGD","JSON","stringify","complete","gender","local_uuid","GlobalFuncs","getLocalUuid","sdkPath","SystemInfo","loginUrl","debugMode","ReadBoolFromLocalStorage","gameModel","DEBUG_MODE","ReadStringFromLocalStorage","DEBUG_SER_KEY","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeLoginSDKStart","avatarUrl","postData","appId","wxAppId","clientId","snsId","uuid","scene_id","scene_param","invite_id","nickName","LOGW","request","url","header","data","method","checkData","error","result","userId","userName","Share","shareKeywordReplace","sliceStringToLength","userPic","purl","authorCode","wxgame_session_key","PropagateInterface","getUserFeatureInfo","adManager","init","token","setStorage","key","clickStatEventTypeLoginSDKSuccess","ip","tcpsrv","port","wsport","webSocketUrl","indexOf","toString","TCP","connect","clickStatEventTypeLoginSDKFailed","err","LOGE","getSystemType","fun","getSystemInfo","deviceInfo","model","isiPhone","windowHeight","resultType","SYSTEMTYPE","iPhoneXType","iPhone7P8PType","iphoneOtherType","isvivo85","ANDROIDVIVO85","ANDROIDOther","systemType","wechatType","version","system","onShow","onHide","onShowParam","isFirstOpen","boxId","mysteryGiftBagBoxId","scene","query","from","inviteCode","hasUUID","checkLocalUUID","newUserFlag","gdt_vid","weixinadinfo","clickStatEventTypeUserFrom","sourceCode","clickStatShareType","imageType","appid","onShareType","clickStatShareTypeRankList","shareTicket","showRankList","propBoxID","giftBagBoxId","LoginToyoo","NotificationCenter","trigger","EventType","REPLAY_BG_MUSIC","onForeGround","close","getNetSuccess","hasOwnProperty","netIsConnected","isConnected","errMsg","networkType","getNetworkType","onNetworkStatusChange","onError","d","Date","message","uploadLogTimely"],"mappings":"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","file":"TuyooSDK.js","sourceRoot":"../../../../../assets/Script/Framework","sourcesContent":["/**\n * @author zhaoliang\n * @date 1.28\n * \n * 全局对象\n * 系统信息\n * 包括clientId，loginUrl等\n */\nconsole.log(\"TuyooSDK loaded\");\nty.TuyooSDK = {\n    SESSION_KEY: 'TU_SESSION_STORAGE',\n\n    // login: function() {\n    //\n    //     ty.ServerStateManager.checkServerState(function () {\n    //         ty.TuyooSDK.wechatLogin();\n    //     });\n    // },\n    //\n    // // 微信登录\n    // wechatLogin: function() {\n    //\n    //     ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeWxLoginStart, []);\n    //     wx.login({\n    //         success: function(params) {\n    //             hall.LOGD(null, 'wx login success, params:' + JSON.stringify(params));\n    //             ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeWxLoginSuccess, [params.code]);\n    //             if (params.code) {\n    //                 var code = params.code;\n    //                 var loginByCodeAndInfo = function (code) {\n    //                     wx.getUserInfo({\n    //                         withCredentials:true,\n    //                         success: function(res) {\n    //                             ty.TuyooSDK.loginTuyooWithCode(code, res.userInfo, res.iv, res.encryptedData);\n    //                         }\n    //                     });\n    //                 };\n    //                 wx.getSetting({\n    //                     success:function(res) {\n    //                         if (!res.authSetting['scope.userInfo']) {\n    //                             ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeAuthorizationStart, [code]);\n    //                             wx.authorize({\n    //                                 scope : \"scope.userInfo\",\n    //                                 success : function () {\n    //                                     ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeAuthorizationSuccess, [code]);\n    //                                     loginByCodeAndInfo(code);\n    //                                 },\n    //                                 fail:function () {\n    //                                     ty.NotificationCenter.trigger(shot.EventType.START_AUTHORIZATION_FAILED);\n    //                                     shot.needReLogin = true;\n    //                                     // hall.MsgBoxManager.showToast({title : \"授权失败,请手动进行授权!\"});\n    //                                     ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeAuthorizationFailed, [code]);\n    //                                 },\n    //                                 complete:function () {\n    //                                 }\n    //                             });\n    //                         }\n    //                         else{\n    //                             loginByCodeAndInfo(code);\n    //                         }\n    //                     }\n    //                 })\n    //             }\n    //         },\n    //\n    //         fail: function(params) {\n    //             ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeWxLoginFailed, []);\n    //             hall.LOGD(null, 'wx login fail, params:' + JSON.stringify(params));\n    //         },\n    //\n    //         complete: function(params) {\n    //\n    //         }\n    //     });\n    // },\n\n    wechatLoginNormal: function(code, with_fail_guide) {\n        wx.getUserInfo({\n            withCredentials:true,\n            success: function(res) {\n                ty.TuyooSDK.loginTuyooWithCode(code, res.userInfo, res.iv, res.encryptedData);\n            },\n            fail:function () {\n                if (with_fail_guide){\n                    //弹出失败的引导\n                    wx.showModal({\n                        title:'提示',\n                        content:'授权失败,点击确定手动进行授权!',\n                        showCancel:true,\n                        cancelText:'取消',\n                        confirmText:'确定',\n                        success:function (res) {\n                            if (res.confirm) {\n                                wx.openSetting();\n                            }\n                        }\n                    });\n                    shot.needReLogin = true;\n                }\n            }\n        });\n    },\n\n    wechatLoginDirect: function(loginCode) {\n        ty.ServerStateManager.checkServerState(function () {\n\n            // var doGetInfoAndLogin = function (code_par) {\n            //     hall.LOGD(null, 'doGetInfoAndLogin');\n            //     shot.GlobalFuncs.getUserInfo();\n            //     var checkUserInfo = function () {\n            //         ty.Timer.cancelTimer(cc.director, checkUserInfo);\n            //         ty.TuyooSDK.loginTuyooWithCode(code_par);\n            //\n            //         hall.LOGD(null, 'checkUserInfo');\n            //         var openDataContext = wx.getOpenDataContext();\n            //         var sharedCanvas = openDataContext.canvas;\n            //         var context = sharedCanvas.getContext(\"2d\");\n            //         if(!context){\n            //             hall.LOGD(null, '!context');\n            //             ty.Timer.cancelTimer(cc.director, checkUserInfo);\n            //             ty.TuyooSDK.loginTuyooWithCode(code_par);\n            //             return;\n            //         }\n            //         // hall.LOGD(null, 'context');\n            //         // if (context.hasOwnProperty('game_getUserInfo')) {\n            //         //     ty.Timer.cancelTimer(cc.director, checkUserInfo);\n            //         //     var userInfo = context['game_getUserInfo'];\n            //         //     // ty.TuyooSDK.loginTuyooWithCode(code, {nickName:null,avatarUrl:null,gender:0});\n            //         //     ty.TuyooSDK.loginTuyooWithCode(code_par, userInfo);\n            //         // }\n            //     };\n            //\n            //     ty.Timer.setTimer(cc.director, checkUserInfo, 1 / 60);\n            // };\n\n            if (loginCode){\n                ty.TuyooSDK.loginTuyooWithCode(loginCode);\n                // doGetInfoAndLogin(loginCode);\n            }\n            else{\n                wx.login({\n                    success: function (params) {\n                        hall.LOGD(null, 'wx login success, params:' + JSON.stringify(params));\n                        if (params.code) {\n                            ty.TuyooSDK.loginTuyooWithCode(params.code);\n                            // doGetInfoAndLogin(params.code);\n                        }\n                    },\n                    fail: function (params) {\n                        hall.LOGD(null, 'wx login fail, params:' + JSON.stringify(params));\n                    },\n                    complete: function (params) {\n\n                    }\n                });\n            }\n        });\n    },\n\n    loginTuyooWithCode: function(code, userInfo, iv, encryptedData) {\n\n        hall.LOGD(\"loginTuyooWithCode:\",code);\n        // 微信授权成功后使用code登录途游服务器\n\n        // wx.updateShareMenu({\n        //     withShareTicket: true\n        // });\n\n        // var nickName = userInfo.nickName\n        // var avatarUrl = userInfo.avatarUrl\n        // var gender = userInfo.gender //性别 0：未知、1：男、2：女\n        // var province = userInfo.province\n        // var city = userInfo.city\n        // var country = userInfo.country\n\n        //咱们后端 0 是男 1 是女,要转换\n        var gender = 0;\n        if(userInfo){\n            gender = userInfo.gender;\n        }\n        // var gender = 0;\n        // if (userInfo.gender == 1){\n        //     gender = 0;\n        // }\n        // else if (userInfo.gender == 2){\n        //     gender = 1;\n        // }\n\n        var local_uuid = hall.GlobalFuncs.getLocalUuid();\n        hall.LOGD(\"local_uuid:\",local_uuid);\n        var sdkPath = ty.SystemInfo.loginUrl;\n\n        debugMode = hall.GlobalFuncs.ReadBoolFromLocalStorage(shot.gameModel.DEBUG_MODE,debugMode);\n        if (debugMode){\n            sdkPath = hall.GlobalFuncs.ReadStringFromLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, ty.SystemInfo.loginUrl);\n        }\n\n        // var sdkPath = 'http://140.143.201.170:8000/';\n        // shot.Share.shareKeywordReplace.wechatName = userInfo.nickName;\n\n        // ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeLoginSDKStart, [code, local_uuid, userInfo.nickName]);\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeLoginSDKStart, [code, local_uuid]);\n        // var tempData = {\n        //     appId: ty.SystemInfo.appId,\n        //     wxAppId: ty.SystemInfo.wxAppId,\n        //     clientId: ty.SystemInfo.clientId,\n        //     snsId: 'wxapp:' + code,\n        //     uuid : local_uuid,\n        //     //以下为上传玩家的微信用户信息\n        //     nickName: userInfo.nickName,\n        //     avatarUrl: userInfo.avatarUrl,\n        //     gender: gender,\n        //     login_channel : ty.UserInfo.login_channel,\n        //     login_invite_id : ty.UserInfo.login_invite_id || 0\n        // };\n        // hall.LOGW(\"==Login===\",\"====tempData=====\"+JSON.stringify(tempData));\n\n        var avatarUrl = \"\";\n        if(userInfo){\n            avatarUrl = userInfo.avatarUrl;\n        }\n        var postData = {\n            appId: ty.SystemInfo.appId,\n            wxAppId: ty.SystemInfo.wxAppId,\n            clientId: ty.SystemInfo.clientId,\n            snsId: 'wxapp:' + code,\n            uuid : local_uuid,\n            //以下为上传玩家的微信用户信息\n            avatarUrl: avatarUrl,\n            gender: gender,\n            scene_id : ty.UserInfo.scene_id || 0,\n            scene_param : ty.UserInfo.scene_param || \"\",\n            invite_id : ty.UserInfo.invite_id || 0\n        };\n\n        if (userInfo && userInfo.avatarUrl){\n            postData.avatarUrl = userInfo.avatarUrl;\n        }\n\n        if (userInfo && userInfo.nickName){\n            postData.nickName = userInfo.nickName;\n        }\n\n        if (iv){\n            postData.iv = iv;\n        }\n\n        if (encryptedData){\n            postData.encryptedData = encryptedData;\n        }\n\n        hall.LOGW(\"==Login===\",\"====tempData===== URL = \"+JSON.stringify(sdkPath + 'open/v6/user/LoginBySnsIdNoVerify'));\n\n        try {\n            wx.request({\n                url: sdkPath + 'open/v6/user/LoginBySnsIdNoVerify',\n                header: {\n                    'content-type': 'application/x-www-form-urlencoded'\n                },\n                data: postData,\n\n                method:'POST',\n\n                success: function(params) {\n                    hall.LOGD(null, 'tuyoo login success, params:' + JSON.stringify(params));\n\n                    var checkData = params.data;\n                    if (checkData.error && checkData.error.code == 1){\n                        console.log('tuyoo login fail...');\n                        return;\n                    }\n                    // 保存用户名/用户ID/用户头像\n                    var result = checkData.result;\n                    ty.UserInfo.userId = result.userId;\n                    ty.UserInfo.userName = result.userName;\n                    shot.Share.shareKeywordReplace.nickName = hall.GlobalFuncs.sliceStringToLength(ty.UserInfo.userName,10);\n                    ty.UserInfo.userPic = result.purl;\n                    ty.UserInfo.authorCode = result.authorCode;\n                    ty.UserInfo.wxgame_session_key = result.wxgame_session_key;\n                    hall.LOGD(null, 'userId:' + ty.UserInfo.userId + ' userName:' + ty.UserInfo.userName + ' userPic:' + ty.UserInfo.userPic);\n\n                    ty.PropagateInterface.getUserFeatureInfo();//获取用户特征\n                    // ty.PropagateInterface.getShareConfigInfo();//获取分享配置\n                    hall.adManager.init();\n\n                    var token = result.token;\n                    hall.LOGD(null, 'token:' + token);\n                    wx.setStorage({\n                        key: ty.TuyooSDK.SESSION_KEY,\n                        data: token\n                    });\n\n                    // 发送登录成功事件\n                    // ty.NotificationCenter.trigger(ty.EventType.MSG_LOGIN_SUCCESS);\n\n                    // ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeLoginSDKSuccess, [code, local_uuid, userInfo.nickName, result.userId]);\n                    ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeLoginSDKSuccess, [code, local_uuid, \"name\", result.userId]);\n\n                    var ip = result.tcpsrv.ip;\n                    var port = result.tcpsrv.wsport || result.tcpsrv.port; //优先使用wsport\n                    // hall.LOGD(null, 'ip:' + ip + ' port:' + port);\n                    var webSocketUrl;\n                    // if (sdkPath.indexOf(\"https://\") > -1){\n                    //     webSocketUrl = 'wss://' + ip + '/';\n                    // }\n                    // else{\n                    //     webSocketUrl = 'ws://' + ip + ':' + port.toString() + '/';\n                    // }\n                    if (sdkPath.indexOf(\"170\") > -1 || sdkPath.indexOf(\"https://\") > -1){\n                        webSocketUrl = 'wss://' + ip + '/';\n                    }\n                    else{\n                        webSocketUrl = 'ws://' + ip + ':' + port.toString() + '/';\n                    }\n                    hall.LOGD(null, 'webSocketUrl:' + webSocketUrl);\n                    ty.SystemInfo.webSocketUrl = webSocketUrl;\n\n                    // 解析SDK登录返回，userId/tcpsrv信息，根据tcpsrv信息初始化长连接模块\n                    ty.TCP.connect(ty.SystemInfo.webSocketUrl);\n                    // ty.TuyooSDK.getShareImage();\n                },\n\n                fail: function(params) {\n                    // ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeLoginSDKFailed, [code, local_uuid, userInfo.nickName]);\n                    ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeLoginSDKFailed, [code, local_uuid, \"name\"]);\n                    hall.LOGD(null, 'tuyoo login fail, params:' + JSON.stringify(params));\n                },\n\n                complete: function(params) {\n\n                }\n            });\n        }\n        catch (err){\n            hall.LOGE(\"error:\", \"tywx.TuyooSDK.wechatLogin——\" + JSON.stringify(err));\n        }\n\n\n        // this.initUserBaseInfo(userInfo);\n    },\n    //\n    // initUserBaseInfo : function (userInfo) {\n    //     //请求头像\n    //\n    //     var _index = 0;\n    //     var loadImage = function(){\n    //         var txImage = wx.createImage();\n    //         txImage.src = userInfo.avatarUrl;\n    //         txImage.onload = function (event) {\n    //             hall.LOGW(\"\",\"file = [SystemInfo] fun = [loadImage] 加载成功\");\n    //             ty.UserInfo.avatarImg = txImage;\n    //         };\n    //\n    //         txImage.onerror = function (event) {\n    //             hall.LOGW(\"\",\"file = [SystemInfo] fun = [loadImage] 加载失败\");\n    //             _index++;\n    //             if(_index < 4) {\n    //                 loadImage();\n    //             }\n    //         };\n    //     };\n    //\n    //     loadImage();\n    //\n    //     var initMyQrCode = function () {\n    //         var sdkPath = ty.SystemInfo.loginUrl;\n    //         var local_uuid = hall.GlobalFuncs.getLocalUuid();\n    //\n    //         var pars = {\n    //             appId: ty.SystemInfo.appId,\n    //             wxAppId: ty.SystemInfo.wxAppId,\n    //             clientId: ty.SystemInfo.clientId,\n    //             imei: 'null',\n    //             uuid : local_uuid,\n    //             width : 280,\n    //             b64 : true,\n    //             scene : '1,' + ty.UserInfo.userId\n    //         };\n    //\n    //         var serPath = sdkPath + 'open/v6/user/Getwxacodeunlimit';\n    //\n    //         wx.request({\n    //             url: serPath,\n    //             header: {\n    //                 'content-type': 'application/x-www-form-urlencoded'\n    //             },\n    //             data: pars,\n    //             method:'POST',\n    //             success: function(params) {\n    //                 // hall.LOGD(null, 'qrcode success, params:' + JSON.stringify(params));\n    //                 hall.LOGD(null, 'qrcode success');\n    //                 var b64Str =  params.data.result.img;\n    //                 var fs = wx.getFileSystemManager();\n    //                 ty.UserInfo.myQrCodeFilePath = wx.env.USER_DATA_PATH + '/myQr.png';\n    //                 fs.writeFileSync(ty.UserInfo.myQrCodeFilePath ,b64Str , 'base64');\n    //             },\n    //             fail: function(params) {\n    //             },\n    //             complete: function(params) {\n    //             }\n    //         });\n    //     };\n    //\n    //     initMyQrCode();\n    // },\n\n    getSystemType : function (fun) {\n        // {\n        // \t\"0\":{\n        // \t\"errMsg\":\"getSystemInfo:ok\",\n        // \t\t\"model\":\"iPhone X\",\n        // \t\t\"pixelRatio\":3,\n        // \t\t\"windowWidth\":375,\n        // \t\t\"windowHeight\":812,\n        // \t\t\"system\":\"iOS 10.0.1\",\n        // \t\t\"language\":\"zh_CN\",\n        // \t\t\"version\":\"6.6.3\",\n        // \t\t\"batteryLevel\":100,\n        // \t\t\"screenWidth\":375,\n        // \t\t\"screenHeight\":812,\n        // \t\t\"SDKVersion\":\"1.8.0\",\n        // \t\t\"brand\":\"devtools\",\n        // \t\t\"fontSizeSetting\":16,\n        // \t\t\"statusbarHeight\":44,\n        // \t\t\"platform\":\"devtools\"\n        // }\n        // }\n        wx.getSystemInfo({\n            success : function (result) {\n                ty.SystemInfo.deviceInfo = result;\n                var model = result.model;\n                var isiPhone = model.indexOf(\"iPhone\") >= 0;\n                var windowHeight = result.windowHeight;\n                var resultType = 0;\n                if (isiPhone){\n                    if(windowHeight == 812){   //iPhoneX\n                        resultType = ty.UserInfo.SYSTEMTYPE.iPhoneXType;\n                    }else if (windowHeight == 736){ // 7p 8p\n                        resultType = ty.UserInfo.SYSTEMTYPE.iPhone7P8PType;\n                    }else {  //其他iPhone\n                        resultType = ty.UserInfo.SYSTEMTYPE.iphoneOtherType;\n                    }\n                }else { //cc.sys.OS_ANDROID\n                    var isvivo85 = model.indexOf(\"vivo Y85A\") >= 0;\n                    if(isvivo85){\n                        resultType = ty.UserInfo.SYSTEMTYPE.ANDROIDVIVO85;\n                    }else {\n                        resultType = ty.UserInfo.SYSTEMTYPE.ANDROIDOther;\n                    }\n                }\n                ty.UserInfo.systemType = resultType;\n                ty.UserInfo.wechatType = result.version;\n                ty.UserInfo.model = result.model;\n                ty.UserInfo.system = result.system;\n\n                if (fun){\n                    fun(result);\n                }\n            },\n            fail : function () {\n            },\n            complete : function () {\n            }\n        });\n    }\n\n    // wechatGetFriendDataDebug: function() {\n    //     var openDataContext = shot.GlobalFuncs.getOpenData();\n    //     if(!openDataContext){\n    //         return;\n    //     }\n    //     var sharedCanvas = openDataContext.canvas;\n    //     var context = sharedCanvas.getContext(\"2d\");\n    //     if(!context){\n    //         return;\n    //     }\n    //     context['game_friendData_success'] = false;\n    //     shot.GlobalFuncs.getFriendInfo();\n    //     var checkUserInfo = function () {\n    //         if(!context){\n    //             return;\n    //         }\n    //         // var openDataContext = wx.getOpenDataContext();\n    //         // var sharedCanvas = openDataContext.canvas;\n    //         // var context = sharedCanvas.getContext(\"2d\");\n    //         if (context.hasOwnProperty('game_friendData') &&\n    //             context.hasOwnProperty('game_friendData_success') &&\n    //             context['game_friendData_success'] == true) {\n    //             ty.Timer.cancelTimer(cc.director, checkUserInfo);\n    //             shot.GameWorld.game_friendData = context['game_friendData'];\n    //\n    //         }\n    //     };\n    //     ty.Timer.setTimer(cc.director, checkUserInfo, 1 / 60);\n    // }\n};\n\nwx.onShow(function (result) {\n    // {\"0\":{\"scene\":1044,\"shareTicket\":\"beecdf9e-e881-492c-8a3f-a7d8c54dfcdb\",\"query\":{}}}  (从后台切到前台才有shareTicket,启动时没有)\n    hall.LOGW('', \"+++++++++++++++++onShow+++++++++++++++++\"+JSON.stringify(result));\n    hall.onHide = false;\n    ty.UserInfo.onShowParam = result;\n    ty.UserInfo.onShowParam.isFirstOpen = true;\n\n    ty.SystemInfo.boxId = \"\";\n    ty.SystemInfo.mysteryGiftBagBoxId = \"\";\n\n    //取相关参数\n    var scene = result.scene;\n    var query = result.query;\n    //来源处理\n    ty.UserInfo.scene_id = scene || 0;\n    ty.UserInfo.scene_param = query.from || \"\";\n    ty.UserInfo.invite_id = query.inviteCode || 0;\n\n    var hasUUID = hall.GlobalFuncs.checkLocalUUID();\n    var newUserFlag = hasUUID ? 1 : 0;\n\n    if (query && query.gdt_vid && query.weixinadinfo) {\n        //从广点通广告跳过来的，from的开头加入gdt标识区分\n        var from = \"gdt.\" + query.weixinadinfo;\n        ty.UserInfo.scene_param = from;\n        ty.BiLog.clickStat(ty.clickStatEventType.clickStatEventTypeUserFrom,[scene, from, newUserFlag]);\n    } else if(query && query.sourceCode){//从小程序消息卡片中点入\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeUserFrom,[scene,query.inviteCode,shot.Share.clickStatShareType[query.sourceCode],\n            query.imageType,\"CardActive\",JSON.stringify(result)]);\n    }else {\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeUserFrom,[scene,query.from,query.appid,\n            \"CardActive\",JSON.stringify(result)]);\n    }\n\n    if(query && query.sourceCode){ //从小程序消息卡片中点入\n        if(query.sourceCode == shot.Share.onShareType.clickStatShareTypeRankList && scene == 1044){ //群排行榜\n            var shareTicket = result.shareTicket;\n            if(shareTicket){\n                shot.GlobalFuncs.showRankList(shareTicket);\n            }\n        }\n        if (query && query.propBoxID) {\n            shot.Share.shareKeywordReplace.boxId = query.propBoxID;\n            ty.SystemInfo.boxId = query.propBoxID;\n        }\n\n        if (query && query.giftBagBoxId) {\n            shot.Share.shareKeywordReplace.mysteryGiftBagBoxId = query.giftBagBoxId;\n            ty.SystemInfo.mysteryGiftBagBoxId = query.giftBagBoxId;\n        }\n    }\n\n    if (shot.needReLogin){\n        hall.LoginToyoo();\n        shot.needReLogin = null;\n    }\n\n    // if(shot.Share.isOnShare && ty.UserInfo.userId){\n    //     shot.Share.playAnimationAfterShareWithType();\n    //     shot.Share.isOnShare = false;\n    // }\n\n    // wx.requestAnimationFrame(function () {\n    //     ty.NotificationCenter.trigger(shot.EventType.REPLAY_BG_MUSIC);\n    // });\n\n    ty.NotificationCenter.trigger(shot.EventType.REPLAY_BG_MUSIC);\n\n    hall.adManager && hall.adManager.onForeGround && hall.adManager.onForeGround();\n});\n\nwx.onHide(function () {\n    ty.UserInfo.scene_id = 0;\n    ty.UserInfo.onShowParam = null;\n    hall.onHide = true;\n    hall.LOGW('',\"+++++++++++++++++onHide+++++++++++++++++\");\n    ty.TCP.close();\n});\n\nvar getNetSuccess = function (res) {\n    if (res.hasOwnProperty('isConnected')){\n        hall.netIsConnected = res.isConnected;\n    }\n    else if (res.hasOwnProperty('errMsg')){\n        hall.netIsConnected = res.errMsg == 'getNetworkType:ok'\n    }\n    else{\n        hall.netIsConnected = res.networkType != 'none';\n    }\n\n    hall.networkType = res.networkType;//wifi,2g,3g,4g,none,unknown\n    hall.LOGD('onNetworkStatusChange', 'hall.netIsConnected:' + hall.netIsConnected + ';hall.networkType:'+hall.networkType);\n};\n\nwx.getNetworkType({\n    success:getNetSuccess\n});\n\nwx.onNetworkStatusChange(getNetSuccess);\n\nwx.onError(function (res) {\n    var d = new Date();\n    var errMsg = res.message;\n    ty.BiLog.uploadLogTimely(errMsg);\n});\n\n"]}