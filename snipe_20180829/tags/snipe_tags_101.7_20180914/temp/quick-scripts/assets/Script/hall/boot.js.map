{"version":3,"sources":["boot.js"],"names":["ToDoTasks","require","HallGameWorld","UserInfo","hall","ME","gameWorld","staticSystemInfo","version","ToDoTask","GlobalTimer","boot","LOCAL_UUID_KEY","LoginToyoo","wx","hasOwnProperty","updateManager","getUpdateManager","onCheckForUpdate","res","shot","LOGD","hasUpdate","onUpdateReady","applyUpdate","onUpdateFailed","login","success","params","JSON","stringify","ty","BiLog","clickStat","clickStatEventType","clickStatEventTypeWxLoginSuccess","code","wxLoginCode","getSetting","authSetting","clickStatEventTypeAuthorizationStart","openData","GlobalFuncs","getOpenData","TuyooSDK","wechatLoginDirect","wechatLoginNormal","fail","clickStatEventTypeWxLoginFailed","complete","err","LOGE","showShareMenu","withShareTicket"],"mappings":"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","file":"boot.js","sourceRoot":"../../../../../assets/Script/hall","sourcesContent":["\nvar ToDoTasks = require('ToDoTasks');\nvar HallGameWorld = require('HallGameWorld');\nvar UserInfo = require('HallUserInfo');\nrequire('shotAudioHelper');\nrequire('GlobalTimer');\nrequire('JumpEventType');\nhall.ME = new UserInfo();\nhall.gameWorld = new HallGameWorld();\n\n// 系统信息，获取一次即可\nhall.staticSystemInfo = {\n    version: 1\n};\n\nhall.ToDoTask = new ToDoTasks();\nhall.GlobalTimer.boot();\n\n//\n// //如果文件里存了音量信息，则进行设置\n// var mute = hall.GlobalFuncs.ReadBoolFromLocalStorage(shot.SETTING_MUTE_KEY, false);\n// if (mute) {\n//     shot.AudioHelper.setMusicVolume(0);\n//     shot.AudioHelper.setEffectsVolume(0);\n// } else {\n//     var music_vol = hall.GlobalFuncs.ReadNumFromLocalStorage(shot.SETTING_MUSIC_KEY, 0.5); //如果没有存储，初始默认值0.5\n//     shot.AudioHelper.setMusicVolume(music_vol);\n//     var effect_vol = hall.GlobalFuncs.ReadNumFromLocalStorage(shot.SETTING_EFFECT_KEY, 1); //如果没有存储，初始默认值1\n//     shot.AudioHelper.setEffectsVolume(effect_vol);\n// }\n\n\nhall.LOCAL_UUID_KEY = \"LOCAL_UUID_KEY\";\n\nhall.LoginToyoo = function () {\n    if (wx.hasOwnProperty(\"getUpdateManager\")){\n        var updateManager = wx.getUpdateManager();\n\n        updateManager.onCheckForUpdate(function (res) {\n            // 请求完新版本信息的回调\n            shot.LOGD(null, res.hasUpdate)\n        });\n\n        updateManager.onUpdateReady(function () {\n\n            updateManager.applyUpdate();\n\n            // wx.showModal({\n            //     title: '更新提示',\n            //     content: '新版本已经准备好，是否重启应用？',\n            //     success: function (res) {\n            //         if (res.confirm) {\n            //             // fs.unlinkSync(filePath); //删除本地资源文件\n            //             // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启\n            //             updateManager.applyUpdate();\n            //         }\n            //     }\n            // })\n\n        });\n\n        updateManager.onUpdateFailed(function () {\n            // 新的版本下载失败\n        });\n    }\n    //\n    try {\n        wx.login({\n            success: function(params) {\n                hall.LOGD(null, 'wx login success, params:' + JSON.stringify(params));\n                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeWxLoginSuccess, [params.code]);\n                if (params.code) {\n                    ty.wxLoginCode = params.code;\n\n                    wx.getSetting({\n                        success:function(res) {\n                            if (!res.authSetting['scope.userInfo']) {\n                                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeAuthorizationStart, [params.code]);\n                                //未授权,检查版本,如果支持开放数据域,从开放数据域获取玩家信息,进行登录,如果不支持开放数据域,弹出授权窗口\n                                var openData = shot.GlobalFuncs.getOpenData();\n                                if (openData){\n                                    ty.TuyooSDK.wechatLoginDirect(params.code);\n                                    hall.LOGD(null, 'wechatLoginDirect' + JSON.stringify(params));\n                                }\n                                else{\n                                    //弹窗,请求授权\n                                    ty.TuyooSDK.wechatLoginNormal(params.code, true);\n                                    hall.LOGD(null, '弹窗,请求授权' + JSON.stringify(params));\n                                }\n                            }\n                            else{\n                                //已授权,正常登录\n                                ty.TuyooSDK.wechatLoginNormal(params.code);\n                                hall.LOGD(null, '已授权,正常登录' + JSON.stringify(params));\n                            }\n                        }\n                    })\n                }\n            },\n            fail: function(params) {\n                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeWxLoginFailed, []);\n                hall.LOGD(null, 'wx login fail, params:' + JSON.stringify(params));\n            },\n            complete: function(params) {\n            }\n        });\n    }catch (err){\n        hall.LOGE(\"error:\", \"wx.login——\" + JSON.stringify(err));\n    }\n\n};\n\nhall.LoginToyoo();\n// hall.adManager.requestADInfo();\n\nwx.showShareMenu({\n    withShareTicket: true\n});"]}