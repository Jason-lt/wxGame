{"version":3,"sources":["ServerManager.js"],"names":["cc","Class","extends","Component","properties","txtServer","EditBox","btnChange","Button","btnReset","txtFTID","default","type","userIdlabel","Label","onLaunchParamsLabel","onShowParamsLabel","qrSprite","Sprite","onLoad","that","serPath","hall","GlobalFuncs","ReadStringFromLocalStorage","ty","SystemInfo","DEBUG_SER_KEY","node","on","evet","setInLocalStorage","string","TuyooSDK","wechatLogin","MsgBoxManager","showToast","title","shot","LOGD","testWithString","UserInfo","userId","sceneInfo","wx","getLaunchOptionsSync","JSON","stringify","onShowString","gameModel","ONSHOW_PARAMS","onBtnQRCode","sdkPath","loginUrl","debugMode","local_uuid","getLocalUuid","val","parsArr","split","pars","appId","wxAppId","clientId","imei","uuid","width","parseInt","b64","path","request","url","header","data","method","success","params","b64Str","result","img","fs","getFileSystemManager","filePath","env","USER_DATA_PATH","writeFileSync","loader","load","err","texture","spriteFrame","SpriteFrame","fail","complete"],"mappings":"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","file":"ServerManager.js","sourceRoot":"../../../../../assets/Script/shot","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        txtServer : cc.EditBox,\n        btnChange : cc.Button,\n        btnReset : cc.Button,\n        txtFTID : {\n            default : null,\n            type : cc.EditBox\n        },\n\n        userIdlabel:cc.Label,\n        onLaunchParamsLabel : cc.Label,\n        onShowParamsLabel : cc.Label,\n        qrSprite: cc.Sprite\n    },\n\n    onLoad:function () {\n        var that = this;\n        var serPath = hall.GlobalFuncs.ReadStringFromLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, \"\");\n        this.btnChange.node.on('click', function (evet) {\n            hall.GlobalFuncs.setInLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, that.txtServer.string);\n            // hall.MsgBoxManager.showToast({title:'服务器地址已更新,请退出重新登录!'});\n            ty.TuyooSDK.wechatLogin();\n        });\n\n        this.btnReset.node.on('click', function (evet) {\n            that.txtServer.string = \"\";\n            hall.GlobalFuncs.setInLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, \"\");\n\n            hall.MsgBoxManager.showToast({title:'服务器地址已重置'});\n        });\n\n        shot.LOGD(null, \"当前的SDK地址:\" + serPath);\n\n        this.txtServer.string = serPath;\n    },\n\n    testWithString : function () {\n        // this.mainScene\n        this.userIdlabel.string = \"userId  :   \"+ ty.UserInfo.userId;\n\n        var sceneInfo = wx.getLaunchOptionsSync();\n        this.onLaunchParamsLabel.string = \"Launch：  \"+JSON.stringify(sceneInfo);\n\n        var onShowString = hall.GlobalFuncs.ReadStringFromLocalStorage(shot.gameModel.ONSHOW_PARAMS,\"\");\n        this.onShowParamsLabel.string = \"onShow :  \" + onShowString;\n    },\n    onBtnQRCode:function () {\n\n        // hall.recorder.startRecord(8);\n\n        // var fs = wx.getFileSystemManager();\n        // var filePath = wx.env.USER_DATA_PATH + '/au.aac';\n        // var filePath =  'res/raw-assets/2.aac';\n        // fs.writeFileSync(filePath ,fss , 'base64');\n        // // shot.AudioHelper.playEffect(filePath);\n        // var musicPlayManager = wx.createInnerAudioContext();\n        // musicPlayManager.autoplay = true;\n        // musicPlayManager.loop = false;\n        // musicPlayManager.volume = 1;\n        // musicPlayManager.src = filePath;\n\n        // var fileStr = fs.readFileSync(\"res/2.aac\", 'base64');\n        // hall.LOGD(null, \"fs:\" + fileStr);\n\n        // return;\n\n        var sdkPath = ty.SystemInfo.loginUrl;\n        if (debugMode){\n            sdkPath = hall.GlobalFuncs.ReadStringFromLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, ty.SystemInfo.loginUrl);\n        }\n        var local_uuid = hall.GlobalFuncs.getLocalUuid();\n\n        // var pars = {\n        //     appId: ty.SystemInfo.appId,\n        //     wxAppId: ty.SystemInfo.wxAppId,\n        //     clientId: ty.SystemInfo.clientId,\n        //     imei: 'null',\n        //     uuid : local_uuid,\n        //     width : 280,\n        //     b64 : true,\n        //     scene : '1,' + ty.UserInfo.userId\n        // };\n\n        var val = this.txtFTID.string;\n        var parsArr = val.split(\"|\");\n\n        var pars = {\n            appId: ty.SystemInfo.appId,\n            wxAppId: ty.SystemInfo.wxAppId,\n            clientId: ty.SystemInfo.clientId,\n            imei: 'null',\n            uuid : local_uuid,\n            width : parseInt(parsArr[0]),\n            b64 : 'true',\n            path : parsArr[1]\n        };\n\n        var serPath = sdkPath + 'open/v6/user/Getwxacode';\n\n        hall.LOGD(null, 'qrcode,params:' + JSON.stringify(pars));\n        hall.LOGD(null, 'qrcode,serverPath:' + serPath);\n\n\n        var that = this;\n        wx.request({\n            // url: sdkPath + 'open/v6/user/Getwxacodeunlimit',\n            url: serPath,\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: pars,\n            method:'POST',\n            success: function(params) {\n                hall.LOGD(null, 'qrcode success, params:' + JSON.stringify(params));\n                // var imgPath = params.data.result.path;\n                var b64Str =  params.data.result.img;\n                var fs = wx.getFileSystemManager();\n                var filePath = wx.env.USER_DATA_PATH + '/qr.png';\n                // var filePath =  'res/raw-assets/2.aac';\n                fs.writeFileSync(filePath ,b64Str , 'base64');\n\n                cc.loader.load({url: filePath, type: 'png'}, function (err, texture) {\n                    // hall.LOGD(null, \"请求图片请求图片请求图片请求图片请求图片请求图片\");\n                    if (!err) {\n                        that.qrSprite.spriteFrame =  new cc.SpriteFrame(texture);\n                    }\n                    else {\n                        //加载失败\n                    }\n                });\n            },\n            fail: function(params) {\n\n            },\n            complete: function(params) {\n\n            }\n        });\n    }\n});"]}