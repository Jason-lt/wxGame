{"version":3,"sources":["../../../../../../assets/Script/shot/msg_handler/assets/Script/shot/msg_handler/ShotNetWorkCenter.js"],"names":["console","log","require","shot","NetWorkCenter","canNotLeave","boot","_TAG","LOGD","cmdMap","EventType","MSG_GAME","onGame","MSG_USER_INFO","onReceiveUserInfo","MSG_DATA_CHANGED","onUpdateChangedData","HALL_SHARE2","onShare2","ty","NotificationCenter","listen","TCP_RECEIVE","onReceiveTCP_Msg","value","hall","ME","parseUserInfo","argument","result","gameId","i","length","curValue","MsgFactory","getGameData","getBagInfo","getUserInfo","shut","ignoreScope","onTodoTask","msg","LOGW","JSON","stringify","action","GET_REWARD","waitGetRevial","type","rewards","gameModel","consumeAssets","_count","count","itemId","GlobalFuncs","playGetPropBoxAni","checkRewardWithSharePoint","Share","SharePointType","getFreeTool","MsgBoxManager","showToast","title","CHECK_REWARD","trigger","GET_CHECK_REWARD","msgCmd","cmd","SystemInfo","func","call","parseGame"],"mappings":";;;;;;AAAA;;;AAGAA,QAAQC,GAAR,CAAY,0BAAZ;AACAC,QAAQ,eAAR;AACAC,KAAKC,aAAL,GAAqB;AACjBC,iBAAc,KADG;;AAGjBC,UAAO,gBAAY;AACf,aAAKC,IAAL,GAAY,oBAAZ;AACAJ,aAAKK,IAAL,CAAU,KAAKD,IAAf,EAAqB,MAArB;;AAEA,aAAKE,MAAL,GAAc,EAAd;;AAEA,aAAKA,MAAL,CAAYN,KAAKO,SAAL,CAAeC,QAA3B,IAAuC,KAAKC,MAA5C;AACA,aAAKH,MAAL,CAAYN,KAAKO,SAAL,CAAeG,aAA3B,IAA4C,KAAKC,iBAAjD;AACA,aAAKL,MAAL,CAAYN,KAAKO,SAAL,CAAeK,gBAA3B,IAA+C,KAAKC,mBAApD;AACA,aAAKP,MAAL,CAAYN,KAAKO,SAAL,CAAeO,WAA3B,IAA0C,KAAKC,QAA/C;AACAC,WAAGC,kBAAH,CAAsBC,MAAtB,CAA6BF,GAAGT,SAAH,CAAaY,WAA1C,EAAuD,KAAKC,gBAA5D,EAA8E,IAA9E;AACH,KAdgB;AAejBT,uBAAoB,2BAASU,KAAT,EAAe;AAC/B,YAAI,OAAOA,KAAP,IAAiB,WAArB,EAAkC;AAC9B;AACH;AACDC,aAAKC,EAAL,CAAQC,aAAR,CAAsBH,KAAtB;AACA;AACH,KArBgB;;AAuBjBR,yBAAsB,6BAASY,QAAT,EAAkB;AACpC;AACA,YAAI,OAAOA,QAAP,IAAoB,WAAxB,EAAqC;AACjC;AACA,gBAAIC,SAASD,SAAS,QAAT,CAAb;AACA,gBAAI,OAAOC,MAAP,IAAkB,WAAlB,IAAiC,OAAOA,OAAO,SAAP,CAAP,IAA6B,WAAlE,EAA+E;AAC3E,oBAAIC,SAASD,OAAOC,MAApB;AACAL,qBAAKjB,IAAL,CAAU,KAAKD,IAAf,EAAqB,cAAcuB,MAAnC;AACA,qBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,OAAO,SAAP,EAAkBG,MAAtC,EAA8CD,GAA9C,EAAmD;AAC/C,wBAAIE,WAAWJ,OAAO,SAAP,EAAkBE,CAAlB,CAAf;AACA,wBAAI,OAAOE,QAAP,IAAoB,WAAxB,EAAqC;AACjC;AACH;;AAED,wBAAIA,YAAY,OAAhB,EAAyB;AACrBR,6BAAKjB,IAAL,CAAU,KAAKD,IAAf,EAAqB,uBAArB;AACAkB,6BAAKS,UAAL,CAAgBC,WAAhB,CAA4BL,MAA5B;AACH,qBAHD,MAGO,IAAIG,YAAY,MAAhB,EAAwB;AAC3BR,6BAAKjB,IAAL,CAAU,KAAKD,IAAf,EAAqB,oBAArB;AACAkB,6BAAKS,UAAL,CAAgBE,UAAhB;AACH;AACD;AAJO,yBAKF,IAAIH,YAAY,OAAhB,EAAyB;AAC1BR,iCAAKjB,IAAL,CAAU,KAAKD,IAAf,EAAqB,sBAArB;AACAkB,iCAAKS,UAAL,CAAgBG,WAAhB,CAA4BP,MAA5B;AACH;AACJ;AACJ;AACJ;AACJ,KApDgB;;AAsDjBQ,UAAK,gBAAY;AACb,aAAK7B,MAAL,GAAc,EAAd;AACAU,WAAGC,kBAAH,CAAsBmB,WAAtB,CAAkC,IAAlC;AACH,KAzDgB;;AA2DjBC,gBAAY,oBAAShB,KAAT,EAAgB;AACxB,YAAIA,SAASA,MAAM,QAAN,CAAb,EAA8B;AAC1B;AACH;AACJ,KA/DgB;;AAiEjBN,cAAS,kBAAUuB,GAAV,EAAe;AACpBhB,aAAKiB,IAAL,CAAU,EAAV,EAAa,uDAAuDC,KAAKC,SAAL,CAAeH,GAAf,CAApE;AACA,YAAIA,IAAIZ,MAAJ,CAAWgB,MAAX,IAAqB1C,KAAKO,SAAL,CAAeoC,UAAxC,EAAmD;AAC/C;AACA;AACA,gBAAI3C,KAAK4C,aAAL,IAAsB5C,KAAK4C,aAAL,CAAmBC,IAAnB,IAA2B,YAAjD,IAAiEP,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmBjB,MAAnB,GAA4B,CAAjG,EAAmG;AAC/F7B,qBAAK+C,SAAL,CAAeC,aAAf,CAA6B,CAA7B,EAA+B,WAA/B;AACAhD,qBAAK4C,aAAL,GAAqB,IAArB;AACH,aAHD,MAGM,IAAGN,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmBjB,MAAnB,GAA4B,CAA/B,EAAkC;AACpC,oBAAIoB,SAAS,CAAb;AACA,oBAAIX,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmB,CAAnB,EAAsBI,KAA1B,EAAiC;AAC7BD,6BAASX,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmB,CAAnB,EAAsBI,KAA/B;AACA,wBAAIZ,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmB,CAAnB,EAAsBK,MAAtB,IAAgC,WAApC,EAAiD;AAC7CnD,6BAAKoD,WAAL,CAAiBC,iBAAjB,CAAmC,CAAnC,EAAqCJ,MAArC;AACH,qBAFD,MAEM,IAAIX,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmB,CAAnB,EAAsBK,MAAtB,IAAgC,WAApC,EAAiD;AACnDnD,6BAAKoD,WAAL,CAAiBC,iBAAjB,CAAmC,CAAnC,EAAqCJ,MAArC;AACH,qBAFK,MAEA,IAAIX,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmB,CAAnB,EAAsBK,MAAtB,IAAgC,WAApC,EAAiD;AACnDnD,6BAAKoD,WAAL,CAAiBC,iBAAjB,CAAmC,CAAnC,EAAqCJ,MAArC;AACAjD,6BAAK+C,SAAL,CAAeO,yBAAf,CAAyCtD,KAAKuD,KAAL,CAAWC,cAAX,CAA0BC,WAAnE;AACH,qBAHK,MAGA,IAAInB,IAAIZ,MAAJ,CAAWoB,OAAX,CAAmB,CAAnB,EAAsBK,MAAtB,IAAgC,WAApC,EAAiD;AACnD7B,6BAAKoC,aAAL,CAAmBC,SAAnB,CAA6B,EAACC,OAAM,UAAP,EAA7B;AACH;AACJ;AACJ;AACJ,SAtBD,MAuBK,IAAItB,IAAIZ,MAAJ,CAAWgB,MAAX,IAAqB1C,KAAKO,SAAL,CAAesD,YAAxC,EAAqD;AACtD7C,eAAGC,kBAAH,CAAsB6C,OAAtB,CAA8B9D,KAAKO,SAAL,CAAewD,gBAA7C,EAA8DzB,IAAIZ,MAAlE;AACA;AACA;AACH;AACJ,KA/FgB;;AAiGjB;;;AAGAN,sBAAmB,0BAASC,KAAT,EAAe;AAC9B,YAAI2C,SAAS3C,MAAM4C,GAAnB;AACA,YAAIvC,SAASL,MAAMK,MAAnB;AACA,YAAIA,MAAJ,EAAW;AACP,gBAAIC,SAASD,OAAOC,MAApB;AACA,gBAAIA,WAAWX,GAAGkD,UAAH,CAAcvC,MAA7B,EAAoC;AAChC;AACA,oBAAIwC,OAAO,KAAK7D,MAAL,CAAY0D,MAAZ,CAAX;AACA,oBAAIG,IAAJ,EAAS;AACLA,yBAAKC,IAAL,CAAU,IAAV,EAAgB/C,KAAhB;AACH,iBAFD,MAGI;AACAL,uBAAGC,kBAAH,CAAsB6C,OAAtB,CAA8BE,MAA9B,EAAsC3C,KAAtC;AACArB,yBAAKK,IAAL,CAAU,KAAKD,IAAf,EAAqB,eAAe4D,MAAf,GAAwB,OAA7C;AACH;AACJ;AACJ;AACJ,KArHgB;;AAuHjBvD,YAAQ,gBAASgB,QAAT,EAAmB;AACvBH,aAAKjB,IAAL,CAAU,OAAV,EAAkB,WAAlB;AACAL,aAAK+C,SAAL,CAAesB,SAAf,CAAyB5C,QAAzB;AACH;AA1HgB,CAArB;;AA6HAzB,KAAKC,aAAL,CAAmBE,IAAnB","file":"ShotNetWorkCenter.js","sourceRoot":"../../../../../../assets/Script/shot/msg_handler","sourcesContent":["/**\n * Created by zhangman on 2018/6/6.\n */\nconsole.log('JumpMsgFactory.js loaded');\nrequire('JumpEventType');\nshot.NetWorkCenter = {\n    canNotLeave : false,\n\n    boot : function () {\n        this._TAG = 'shot_NetWorkCenter';\n        shot.LOGD(this._TAG, 'boot');\n\n        this.cmdMap = {};\n\n        this.cmdMap[shot.EventType.MSG_GAME] = this.onGame;\n        this.cmdMap[shot.EventType.MSG_USER_INFO] = this.onReceiveUserInfo;\n        this.cmdMap[shot.EventType.MSG_DATA_CHANGED] = this.onUpdateChangedData;\n        this.cmdMap[shot.EventType.HALL_SHARE2] = this.onShare2;\n        ty.NotificationCenter.listen(ty.EventType.TCP_RECEIVE, this.onReceiveTCP_Msg, this);\n    },\n    onReceiveUserInfo : function(value){\n        if (typeof(value) == 'undefined') {\n            return;\n        }\n        hall.ME.parseUserInfo(value);\n        // ty.NotificationCenter.trigger(ty.EventType.UPDATE_UER_INFO, hall.ME);\n    },\n\n    onUpdateChangedData : function(argument){\n        //解析数据\n        if (typeof(argument) != 'undefined') {\n            //hall.ME.parseUserInfo(argument[0]);\n            var result = argument[\"result\"];\n            if (typeof(result) != 'undefined' && typeof(result['changes']) != 'undefined') {\n                var gameId = result.gameId;\n                hall.LOGD(this._TAG, 'gameid = ' + gameId);\n                for (var i = 0; i < result['changes'].length; i++) {\n                    var curValue = result[\"changes\"][i];\n                    if (typeof(curValue) == 'undefined') {\n                        continue;\n                    }\n\n                    if (curValue == 'gdata') {\n                        hall.LOGD(this._TAG, \"update_notify,更新gdata\");\n                        hall.MsgFactory.getGameData(gameId);\n                    } else if (curValue == 'item') {\n                        hall.LOGD(this._TAG, \"update_notify,更新道具\");\n                        hall.MsgFactory.getBagInfo();\n                    }\n                    //金币，钻石\n                    else if (curValue == \"udata\") {\n                        hall.LOGD(this._TAG, \"update_notify,更新钻石金币\");\n                        hall.MsgFactory.getUserInfo(gameId);\n                    }\n                }\n            }\n        }\n    },\n\n    shut:function () {\n        this.cmdMap = {};\n        ty.NotificationCenter.ignoreScope(this);\n    },\n\n    onTodoTask: function(value) {\n        if (value && value[\"result\"]) {\n            // hall.gameWorld.model.m_todoTask.parseTodoTask(value[\"result\"]);\n        }\n    },\n\n    onShare2:function (msg) {\n        hall.LOGW(\"\",\"file = [shotNetWrokCenter] fun = [onShare2] msg = \" + JSON.stringify(msg));\n        if (msg.result.action == shot.EventType.GET_REWARD){\n            // {\"cmd\":\"hall_share2\",\"result\":{\"action\":\"get_reward\",\"gameId\":6,\"userId\":10008,\"rewards\":[]}}\n            //获得奖励回调\n            if (shot.waitGetRevial && shot.waitGetRevial.type == 'waitRecive' && msg.result.rewards.length > 0){\n                shot.gameModel.consumeAssets(1,\"item:1373\");\n                shot.waitGetRevial = null;\n            }else if(msg.result.rewards.length > 0) {\n                var _count = 1;\n                if (msg.result.rewards[0].count) {\n                    _count = msg.result.rewards[0].count;\n                    if (msg.result.rewards[0].itemId == \"item:1371\") {\n                        shot.GlobalFuncs.playGetPropBoxAni(0,_count);\n                    }else if (msg.result.rewards[0].itemId == \"item:1372\") {\n                        shot.GlobalFuncs.playGetPropBoxAni(1,_count);\n                    }else if (msg.result.rewards[0].itemId == \"item:1390\") {\n                        shot.GlobalFuncs.playGetPropBoxAni(2,_count);\n                        shot.gameModel.checkRewardWithSharePoint(shot.Share.SharePointType.getFreeTool);\n                    }else if (msg.result.rewards[0].itemId == \"item:1373\") {\n                        hall.MsgBoxManager.showToast({title:'成功获得1颗钻石'});\n                    }\n                }\n            }\n        }\n        else if (msg.result.action == shot.EventType.CHECK_REWARD){\n            ty.NotificationCenter.trigger(shot.EventType.GET_CHECK_REWARD,msg.result);\n            //检查当前分享点是否还有奖励\n            //{\"cmd\":\"hall_share2\",\"result\":{\"action\":\"check_reward\",\"gameId\":6,\"userId\":10042,\"pointId\":67890009,\"leftCount\":0}}\n        }\n    },\n\n    /**\n     * 收到TCP消息\n     */\n    onReceiveTCP_Msg : function(value){\n        var msgCmd = value.cmd;\n        var result = value.result;\n        if (result){\n            var gameId = result.gameId;\n            if (gameId === ty.SystemInfo.gameId){\n                //游戏消息在这里处理\n                var func = this.cmdMap[msgCmd];\n                if (func){\n                    func.call(this, value);\n                }\n                else{\n                    ty.NotificationCenter.trigger(msgCmd, value);\n                    shot.LOGD(this._TAG, \"未注册关于消息 ： \" + msgCmd + \" 的监听！\");\n                }\n            }\n        }\n    },\n\n    onGame: function(argument) {\n        hall.LOGD(\"hello\",\"parseGame\");\n        shot.gameModel.parseGame(argument);\n    }\n};\n\nshot.NetWorkCenter.boot();"]}