{"version":3,"sources":["../../../../../assets/Script/Framework/assets/Script/Framework/Share.js"],"names":["crypto","require","shot","Share","LAST_SHARE_TIME","SHARETICKETS_LIST","shareQuery","unSensitivePersonage","sharePoint","shareType","isOnShare","shareTicket","resultType","shareWithType","type","successCallBackFun","failCallBackFun","testCfg","shareMap","GameWorld","shareConfig","hall","LoginToyoo","shareDetail","shareCfg","list","GlobalFuncs","getShareRandomNumberWithShareList","shareTitle","replaceKeyWordInString","shareContent","query","ty","UserInfo","userId","shareSchemeId","userName","queryString","shareImage","sharePicUrl","extraAdd","length","callBackF","imageUrl","shareImformation","getShareImageWithShareMap","nowIndex","tempCavas","wx","createCanvas","width","height","context","getContext","image","createImage","src","onload","event","ima","target","drawImage","preTextWidth","preTextHeight","preX","preY","extraMap","textInformation","text","textformatString","font","fontSize","textColorRGB","indexOf","fillStyle","textAlign","replace","textX","parseInt","originPointX","textY","originPointY","fillText","measureText","imageInformation","sunImage","addImageUrl","userPic","sizeWidth","sizeHeight","shape","beginPath","arc","Math","PI","stroke","clip","img","tempFilePath","toTempFilePathSync","x","y","destWidth","destHeight","onerror","titleString","sharePointId","clickStatShareType","BiLog","clickStat","clickStatEventType","clickStatEventTypeShareAction","shareAppMessage","title","success","result","LOGE","JSON","stringify","arguments","shareTickets","ShareState","isNotAGroupChat","fail","isMatchShare","failToShare","LOGD","complete","playAnimationAfterShareWithType","NotificationCenter","trigger","EventType","UPDATE_SHARE_STATE","onShareType","clickStatShareTypeRankList","showRankList","endWithSuccessShare","gunnerShareSchemeConfig","shareError","getShareInfo","shareKey","clickStatShareTypeRevial","getShareResultWithKey","failToGetShareTicket","err","LOGW","toString","iv","encryptedData","reultString","decrypt","wxgame_session_key","informationMap","parse","openGId","toDay","GlobalTimer","getCurDay","lastShareTime","ReadStringFromLocalStorage","shareTicketsDic","setInLocalStorage","shareList","repetitionGroupChat","push","suscessShare","gameModel","shareToGetreward","getOpenGid","_boxUserId","_openGid","encryFunc","_boxID","SystemInfo","boxId","mysteryGiftBagBoxId","getBoxReward","key","crypted","Buffer","decipher","createDecipheriv","decoded","update","final","clickStatShareTypeMysteryGiftBag","clickStatShareTypeScore","clickStatShareTypeLight","clickStatShareTypeBullet","clickStatShareTypeGrenade","clickStatShareTypeShareButton","clickStatShareTypeDiamond","clickStatShareTypeBulletGetReward","clickStatShareTypeLightGetReward","clickStatShareTypeGrenadeGetReward","clickStatShareTypeMysteryGiftBagGetReward","clickStatShareTypeAddBullet","clickStatShareTypeOpenSecretBoxB","clickStatShareTypeOpenSecretBoxN","clickStatShareTypeComboContinue","SharePointType","getBullet","getLaser","getDiamond","shareResurgence","getGrenade","getFreeTool","shareKeywordReplace","theScoreForNow","bestRank","bestScoreForSelf","nickName","exShare","userInfoError","onShareAppMessage","groupMsgInfos","showShareMenu","withShareTicket"],"mappings":";;;;;;AACA,IAAIA,SAASC,QAAQ,QAAR,CAAb;;AAEAC,KAAKC,KAAL,GAAa;AACTC,qBAAkB,iBADT,EAC2B;AACpC;AACAC,uBAAoB,mBAHX,EAG+B;AACxCC,gBAAa,EAJJ;;AAMTC,0BAAuB,CANd,EAMgB;AACzBC,gBAAa,CAPJ;AAQTC,eAAY,EARH;;AAUTC,eAAY,KAVH;AAWTC,iBAAY,EAXH;AAYTC,gBAAa,CAZJ,EAYM;;AAEfC,mBAAgB,uBAAUC,IAAV,EAAgBC,kBAAhB,EAAoCC,eAApC,EAAqDC,OAArD,EAA8D;AAC1E;AACA;AACA;AACA;AACA,YAAIC,WAAWhB,KAAKiB,SAAL,CAAeC,WAA9B;AACA,YAAG,CAACF,QAAJ,EAAa;AACTG,iBAAKC,UAAL;AACA;AACH;AACD,YAAIC,cAAcL,SAASJ,IAAT,CAAlB;;AAEA,YAAIU,WAAWD,YAAYE,IAAZ,CAAiBJ,KAAKK,WAAL,CAAiBC,iCAAjB,CAAmDJ,YAAYE,IAA/D,CAAjB,CAAf;AACA,YAAIR,OAAJ,EAAY;AACR;AACAO,uBAAWP,OAAX;AACH;;AAED,YAAIW,aAAaP,KAAKK,WAAL,CAAiBG,sBAAjB,CAAwCL,SAASM,YAAjD,CAAjB;;AAEA,YAAIC,QAAQ,gBAAcC,GAAGC,QAAH,CAAYC,MAA1B,GAAiC,cAAjC,GAAgDpB,IAAhD,GAAsD,aAAtD,GAAoEU,SAASW,aAA7E,GAA2F,cAA3F,GAA0GH,GAAGC,QAAH,CAAYG,QAAlI;AACA,YAAGb,YAAYQ,KAAf,EAAqB;AACjB7B,iBAAKC,KAAL,CAAWG,UAAX,GAAwBiB,YAAYQ,KAApC;AACA,gBAAIM,cAAchB,KAAKK,WAAL,CAAiBG,sBAAjB,CAAwCN,YAAYQ,KAApD,CAAlB;AACAA,oBAAQA,QAAM,GAAN,GAAUM,WAAlB;AACH,SAJD,MAIM;AACFnC,iBAAKC,KAAL,CAAWG,UAAX,GAAwB,EAAxB;AACH;;AAED,YAAGiB,YAAYhB,oBAAf,EAAoC;AAChCL,iBAAKC,KAAL,CAAWI,oBAAX,GAAkCgB,YAAYhB,oBAA9C;AACH,SAFD,MAEM;AACFL,iBAAKC,KAAL,CAAWI,oBAAX,GAAkC,CAAlC;AACH;;AAED,YAAI+B,aAAad,SAASe,WAA1B;AACA,YAAGf,SAASgB,QAAT,IAAqBhB,SAASgB,QAAT,CAAkBC,MAAvC,IAAiDjB,SAASgB,QAAT,CAAkBC,MAAlB,GAA2B,CAA/E,EAAkF;AAC9E,gBAAIC,YAAY,SAAZA,SAAY,CAASC,QAAT,EAAmB;AAC/BzC,qBAAKC,KAAL,CAAWyC,gBAAX,CAA4B9B,IAA5B,EAAkCU,QAAlC,EAA4CI,UAA5C,EAAwDe,QAAxD,EAAkEZ,KAAlE,EAAyER,YAAYf,UAArF,EAAiGO,kBAAjG,EAAqHC,eAArH;AACH,aAFD;AAGAd,iBAAKC,KAAL,CAAW0C,yBAAX,CAAqC,CAArC,EAAwCrB,SAASgB,QAAjD,EAA2DF,UAA3D,EAAuEI,SAAvE;AACH,SALD,MAKM;AACFxC,iBAAKC,KAAL,CAAWyC,gBAAX,CAA4B9B,IAA5B,EAAkCU,QAAlC,EAA4CI,UAA5C,EAAwDU,UAAxD,EAAoEP,KAApE,EAA2ER,YAAYf,UAAvF,EAAmGO,kBAAnG,EAAuHC,eAAvH;AACH;AACJ,KA1DQ;;AA4DT6B,+BAA4B,mCAAUC,QAAV,EAAoBN,QAApB,EAA8BG,QAA9B,EAAwCD,SAAxC,EAAmD;AAC3ExC,aAAKC,KAAL,CAAWO,SAAX,GAAuB,IAAvB;AACA,YAAIqC,YAAYC,GAAGC,YAAH,EAAhB;AACAF,kBAAUG,KAAV,GAAmB,GAAnB;AACAH,kBAAUI,MAAV,GAAoB,GAApB;;AAEA,YAAIC,UAAUL,UAAUM,UAAV,CAAqB,IAArB,CAAd;AACA,YAAIC,QAAQN,GAAGO,WAAH,EAAZ;AACAD,cAAME,GAAN,GAAYb,QAAZ;;AAEAW,cAAMG,MAAN,GAAe,UAAUC,KAAV,EAAiB;AAC5B,gBAAIC,MAAMD,MAAME,MAAhB;AACAR,oBAAQS,SAAR,CAAkBF,GAAlB,EAAsB,CAAtB,EAAwB,CAAxB;AACA,gBAAIG,eAAa,CAAjB;AACA,gBAAIC,gBAAc,CAAlB;AACA,gBAAIC,OAAK,CAAT;AACA,gBAAIC,OAAK,CAAT;AACA,mBAAOnB,WAAWN,SAASC,MAA3B,EAAmC;AAC/B,oBAAIyB,WAAW1B,SAASM,QAAT,CAAf;AACA,oBAAIoB,SAASpD,IAAT,IAAiB,MAArB,EAA6B;AACzB,wBAAIqD,kBAAkBD,SAASC,eAA/B;AACA,wBAAIC,OAAO/C,KAAKK,WAAL,CAAiBG,sBAAjB,CAAwCsC,gBAAgBE,gBAAxD,CAAX;AACAjB,4BAAQkB,IAAR,GAAeH,gBAAgBI,QAAhB,GAA2B,UAA1C;AACA,wBAAIJ,gBAAgBK,YAAhB,CAA6BC,OAA7B,CAAqC,GAArC,KAA6C,CAAC,CAAlD,EAAoD;AAChDN,wCAAgBK,YAAhB,GAA+B,MAAML,gBAAgBK,YAArD;AACH;AACDpB,4BAAQsB,SAAR,GAAoBP,gBAAgBK,YAApC;AACApB,4BAAQuB,SAAR,GAAoBR,gBAAgBQ,SAAhB,CAA0BC,OAA1B,CAAkC,QAAlC,EAA2C,QAA3C,CAApB;AACA,wBAAIC,QAAQC,SAASX,gBAAgBY,YAAzB,CAAZ;AACA,wBAAGF,QAAQ,CAAX,EAAa;AACT,4BAAGA,SAAS,CAAC,CAAb,EAAe;AACXA,oCAAQb,OAAOF,eAAa,CAA5B;AACH,yBAFD,MAEM,IAAGe,SAAS,CAAC,CAAb,EAAe;AACjBA,oCAAQb,OAAOF,eAAa,CAA5B;AACH;AACJ;AACD,wBAAIkB,QAAQF,SAASX,gBAAgBc,YAAzB,CAAZ;AACA,wBAAID,QAAQ,CAAZ,EAAc;AACV,4BAAGA,SAAS,CAAC,CAAb,EAAe;AACXA,oCAAQf,OAAOF,gBAAc,CAA7B;AACH,6BAAGiB,SAAS,CAAC,CAAb,EAAe;AACZA,oCAAQf,OAAOF,gBAAc,CAA7B;AACH;AACJ;AACDX,4BAAQ8B,QAAR,CAAiBd,IAAjB,EAAsBS,KAAtB,EAA4BG,KAA5B;AACAlB,mCAAeV,QAAQ+B,WAAR,CAAoBf,IAApB,EAA0BlB,KAAzC;AACAa,oCAAgBX,QAAQ+B,WAAR,CAAoBf,IAApB,EAA0BjB,MAA1C;AACAa,2BAAOa,KAAP;AACAZ,2BAAOe,KAAP;AACAlC;AACH,iBA/BD,MA+BM,IAAGoB,SAASpD,IAAT,IAAiB,OAApB,EAA6B;AAC/B,wBAAIsE,mBAAmBlB,SAASkB,gBAAhC;AACA,wBAAIC,WAAWrC,GAAGO,WAAH,EAAf;AACA;AACA,wBAAG6B,iBAAiBE,WAAjB,IAAgC,QAAnC,EAA4C;AACxCD,iCAAS7B,GAAT,GAAexB,GAAGC,QAAH,CAAYsD,OAA3B;AACH,qBAFD,MAEM;AACFF,iCAAS7B,GAAT,GAAe4B,iBAAiBE,WAAhC;AACH;;AAEDD,6BAASN,YAAT,GAAwBD,SAASM,iBAAiBL,YAA1B,CAAxB;AACAM,6BAASJ,YAAT,GAAwBH,SAASM,iBAAiBH,YAA1B,CAAxB;AACAI,6BAASG,SAAT,GAAqBV,SAASM,iBAAiBI,SAA1B,CAArB;AACAH,6BAASI,UAAT,GAAsBX,SAASM,iBAAiBK,UAA1B,CAAtB;AACA,wBAAGL,iBAAiBM,KAAjB,IAA0BN,iBAAiBM,KAAjB,IAA0B,CAAvD,EAAyD;AACrDtC,gCAAQuC,SAAR;AACAvC,gCAAQwC,GAAR,CAAYP,SAASN,YAAT,GAAsBM,SAASG,SAAT,GAAmB,CAArD,EAAuDH,SAASJ,YAAT,GAAsBI,SAASI,UAAT,GAAoB,CAAjG,EAAmGJ,SAASG,SAAT,GAAmB,CAAtH,EAAwH,CAAxH,EAA0H,IAAEK,KAAKC,EAAjI;AACA1C,gCAAQ2C,MAAR;AACA3C,gCAAQ4C,IAAR;AACH;AACDX,6BAAS5B,MAAT,GAAkB,UAAUC,KAAV,EAAiB;AAC/B,4BAAIuC,MAAMvC,MAAME,MAAhB;AACAR,gCAAQS,SAAR,CAAkBoC,GAAlB,EAAsBA,IAAIlB,YAA1B,EAAuCkB,IAAIhB,YAA3C,EAAwDgB,IAAIT,SAA5D,EAAsES,IAAIR,UAA1E;AACA,4BAAIS,eAAenD,UAAUoD,kBAAV,CAA6B;AAC5CC,+BAAG,CADyC;AAE5CC,+BAAG,CAFyC;AAG5CnD,mCAAOH,UAAUG,KAH2B;AAI5CC,oCAAQJ,UAAUI,MAJ0B;AAK5CmD,uCAAWvD,UAAUG,KALuB;AAM5CqD,wCAAYxD,UAAUI;AANsB,yBAA7B,CAAnB;AAQA,4BAAGT,SAAH,EAAc;AACVA,sCAAUwD,YAAV;AACH;AACJ,qBAdD;AAeAb,6BAASmB,OAAT,GAAmB,UAAU9C,KAAV,EAAiB;AAChC,4BAAIuC,MAAMvC,MAAME,MAAhB;AACA;AACA,4BAAIsC,eAAenD,UAAUoD,kBAAV,CAA6B;AAC5CC,+BAAG,CADyC;AAE5CC,+BAAG,CAFyC;AAG5CnD,mCAAOH,UAAUG,KAH2B;AAI5CC,oCAAQJ,UAAUI,MAJ0B;AAK5CmD,uCAAWvD,UAAUG,KALuB;AAM5CqD,wCAAYxD,UAAUI;AANsB,yBAA7B,CAAnB;AAQA,4BAAGT,SAAH,EAAc;AACVA,sCAAUwD,YAAV;AACH;AACJ,qBAdD;AAeA;AACH;AACJ;AACD,gBAAIA,eAAenD,UAAUoD,kBAAV,CAA6B;AAC5CC,mBAAG,CADyC;AAE5CC,mBAAG,CAFyC;AAG5CnD,uBAAOH,UAAUG,KAH2B;AAI5CC,wBAAQJ,UAAUI,MAJ0B;AAK5CmD,2BAAWvD,UAAUG,KALuB;AAM5CqD,4BAAYxD,UAAUI;AANsB,aAA7B,CAAnB;AAQA,gBAAGT,SAAH,EAAc;AACVA,0BAAUwD,YAAV;AACH;AACJ,SAxGD;AAyGA5C,cAAMkD,OAAN,GAAgB,UAAU9C,KAAV,EAAiB;AAC7B,gBAAIuC,MAAMvC,MAAME,MAAhB;AACA;AACH,SAHD;AAIH,KAnLQ;;AAqLThB,sBAAmB,0BAAU9B,IAAV,EAAgBU,QAAhB,EAA0BiF,WAA1B,EAAuC9D,QAAvC,EAAiDZ,KAAjD,EAAwDvB,UAAxD,EAAoEO,kBAApE,EAAwFC,eAAxF,EAAyG;AACxHd,aAAKC,KAAL,CAAWM,SAAX,GAAuBK,IAAvB;AACAZ,aAAKC,KAAL,CAAWK,UAAX,GAAwBA,UAAxB;AACAN,aAAKC,KAAL,CAAWO,SAAX,GAAuB,IAAvB;AACAR,aAAKC,KAAL,CAAWS,UAAX,GAAwB,CAAxB;AACAV,aAAKC,KAAL,CAAWQ,WAAX,GAAyB,EAAzB;;AAEA;AACA,YAAI+F,eAAexG,KAAKC,KAAL,CAAWwG,kBAAX,CAA8B7F,IAA9B,CAAnB;AACA,YAAIqB,gBAAgBX,SAASW,aAA7B;;AAEAH,WAAG4E,KAAH,CAASC,SAAT,CAAmB7E,GAAGC,QAAH,CAAY6E,kBAAZ,CAA+BC,6BAAlD,EAAgF,CAACL,YAAD,EAAe,CAAf,EAAkBvE,aAAlB,CAAhF;;AAEAa,WAAGgE,eAAH,CAAmB;AACfC,mBAAOR,WADQ;AAEf9D,sBAAWA,QAFI,EAEK;AACpBZ,mBAAQA,KAHO,EAGD;AACdmF,qBAAU,iBAAUC,MAAV,EAAkB;AACxB9F,qBAAK+F,IAAL,CAAU,iBAAV,EAA4B,kCAAgCC,KAAKC,SAAL,CAAeC,SAAf,CAAhC,GAA0D,KAA1D,GAAgExF,KAA5F;AACAC,mBAAG4E,KAAH,CAASC,SAAT,CAAmB7E,GAAGC,QAAH,CAAY6E,kBAAZ,CAA+BC,6BAAlD,EAAgF,CAACL,YAAD,EAAe,CAAf,EAAkBvE,aAAlB,CAAhF;AACA,oBAAIpB,kBAAJ,EAAuB;AACnBA,uCAAmBoG,MAAnB;AACH;AACD,oBAAG,CAACA,OAAOK,YAAR,IAAwB,CAACL,OAAOK,YAAP,CAAoB,CAApB,CAA5B,EAAmD;AAC/CtH,yBAAKC,KAAL,CAAWS,UAAX,GAAwBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsBC,eAA9C;AACAxH,yBAAKC,KAAL,CAAWQ,WAAX,GAAyB,EAAzB;AACA;AACH;AACDT,qBAAKC,KAAL,CAAWQ,WAAX,GAAyBwG,OAAOK,YAAP,CAAoB,CAApB,CAAzB;AACH,aAhBc;AAiBfG,kBAAO,gBAAY;AACftG,qBAAK+F,IAAL,CAAU,iBAAV,EAA4B,+BAA6BC,KAAKC,SAAL,CAAeC,SAAf,CAA7B,GAAuD,KAAvD,GAA6DxF,KAAzF;AACA,oBAAIf,eAAJ,EAAoB;AAChBA;AACH;AACDd,qBAAKC,KAAL,CAAWyH,YAAX,GAA0B,KAA1B;AACA1H,qBAAKC,KAAL,CAAWS,UAAX,GAAwBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsBI,WAA9C;AACAxG,qBAAKyG,IAAL,CAAU,IAAV,EAAgBT,KAAKC,SAAL,CAAeC,SAAf,CAAhB;AACH,aAzBc;AA0BfQ,sBAAW,oBAAY;AACnB;AACH;AA5Bc,SAAnB;AA8BH,KAhOQ;;AAkOTC,qCAAgC,2CAAW;AACvC3G,aAAK+F,IAAL,CAAU,KAAV,EAAgB,sCAAoClH,KAAKC,KAAL,CAAWK,UAA/D;AACA;AACA,YAAGN,KAAKC,KAAL,CAAWS,UAAX,IAAyBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsBI,WAAlD,EAA8D;AAC1D7F,eAAGiG,kBAAH,CAAsBC,OAAtB,CAA8BhI,KAAKiI,SAAL,CAAeC,kBAA7C,EAAgElI,KAAKC,KAAL,CAAWM,SAA3E;AACA;AACH;;AAED;AACA,YAAGP,KAAKC,KAAL,CAAWM,SAAX,IAAwBP,KAAKC,KAAL,CAAWkI,WAAX,CAAuBC,0BAAlD,EAA6E;AACzE,gBAAGpI,KAAKC,KAAL,CAAWQ,WAAX,IAA0BT,KAAKC,KAAL,CAAWQ,WAAX,IAA0B,EAAvD,EAA0D;AACtDT,qBAAKwB,WAAL,CAAiB6G,YAAjB,CAA8BrI,KAAKC,KAAL,CAAWQ,WAAzC;AACAT,qBAAKC,KAAL,CAAWM,SAAX,GAAuB,EAAvB;AACAP,qBAAKC,KAAL,CAAWS,UAAX,GAAwB,CAAxB;AACA;AACH;AACJ;;AAED,YAAG,CAACV,KAAKC,KAAL,CAAWI,oBAAZ,IAAoCL,KAAKC,KAAL,CAAWI,oBAAX,IAAmC,CAA1E,EAA4E;AACxE,iBAAKiI,mBAAL;AACA;AACH;;AAED,YAAI,CAACtI,KAAKiB,SAAL,CAAesH,uBAApB,EAA6C;AACzCvI,iBAAKC,KAAL,CAAWM,SAAX,GAAuBP,KAAKC,KAAL,CAAWsH,UAAX,CAAsBiB,UAA7C;AACA;AACA1G,eAAGiG,kBAAH,CAAsBC,OAAtB,CAA8BhI,KAAKiI,SAAL,CAAeC,kBAA7C,EAAgElI,KAAKC,KAAL,CAAWM,SAA3E;AACA;AACH;;AAED;AACA,YAAI,CAACP,KAAKC,KAAL,CAAWQ,WAAZ,IAA2BT,KAAKC,KAAL,CAAWQ,WAAX,IAA0B,EAAzD,EAA4D;AACxDT,iBAAKC,KAAL,CAAWS,UAAX,GAAwBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsBC,eAA9C;AACA1F,eAAGiG,kBAAH,CAAsBC,OAAtB,CAA8BhI,KAAKiI,SAAL,CAAeC,kBAA7C,EAAgElI,KAAKC,KAAL,CAAWM,SAA3E;AACA;AACH;;AAED;AACA,YAAGP,KAAKC,KAAL,CAAWI,oBAAX,IAAmC,CAAtC,EAAwC;AACpC;AACA,gBAAI;AACAyC,mBAAG2F,YAAH,CACI;AACIhI,iCAAaT,KAAKC,KAAL,CAAWQ,WAD5B;AAEIuG,6BAAU,iBAAUC,MAAV,EAAkB;AACxB,4BAAIyB,QAAJ;AACA,4BAAG1I,KAAKC,KAAL,CAAWM,SAAX,IAAwBP,KAAKC,KAAL,CAAWkI,WAAX,CAAuBQ,wBAAlD,EAA2E;AACvED,uCAAW,YAAX;AACA1I,iCAAKC,KAAL,CAAW2I,qBAAX,CAAiC3B,MAAjC,EAAwCyB,QAAxC;AACH,yBAHD,MAGM;AACFA,uCAAW1I,KAAKC,KAAL,CAAWK,UAAX,GAAuB,EAAlC;AACAN,iCAAKC,KAAL,CAAW2I,qBAAX,CAAiC3B,MAAjC,EAAwCyB,QAAxC;AACH;AACJ,qBAXL;AAYIjB,0BAAO,gBAAY;AACfzH,6BAAKC,KAAL,CAAWS,UAAX,GAAwBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsBsB,oBAA9C;AACA/G,2BAAGiG,kBAAH,CAAsBC,OAAtB,CAA8BhI,KAAKiI,SAAL,CAAeC,kBAA7C,EAAgElI,KAAKC,KAAL,CAAWM,SAA3E;AACH,qBAfL;AAgBIsH,8BAAW,oBAAY,CACtB;AAjBL,iBADJ;AAqBH,aAtBD,CAsBC,OAAOiB,GAAP,EAAW;AACR3H,qBAAK+F,IAAL,CAAU,QAAV,EAAoB,sCAAsCC,KAAKC,SAAL,CAAe0B,GAAf,CAA1D;AACH;AAEJ;AACJ,KArSQ;;AAuSTF,2BAAwB,+BAAU3B,MAAV,EAAiByB,QAAjB,EAA2B;AAC/CvH,aAAK4H,IAAL,CAAU,EAAV,EAAa,mDAAiD9B,OAAO+B,QAAP,EAAjD,GAAmE,KAAnE,GAAyEN,QAAtF;AACA,YAAIO,KAAKhC,OAAOgC,EAAhB;AACA,YAAIC,gBAAgBjC,OAAOiC,aAA3B;AACA,YAAIC,cAAcnJ,KAAKC,KAAL,CAAWmJ,OAAX,CAAmBtH,GAAGC,QAAH,CAAYsH,kBAA/B,EAAkDJ,EAAlD,EAAqDC,aAArD,CAAlB;AACA;AACA,YAAII,iBAAiBnC,KAAKoC,KAAL,CAAWJ,WAAX,CAArB;AACA,YAAIK,UAAUF,eAAeE,OAA7B;AACA,YAAIC,QAAQtI,KAAKuI,WAAL,CAAiBC,SAAjB,EAAZ;AACA,YAAIC,gBAAgBzI,KAAKK,WAAL,CAAiBqI,0BAAjB,CAA4C7J,KAAKC,KAAL,CAAWC,eAAvD,EAAwE,EAAxE,CAApB;;AAEA,YAAI4J,kBAAkB,EAAtB;AACA,YAAGL,SAASG,aAAZ,EAA0B;AACtBE,4BAAgBpB,QAAhB,IAA4B,CAACc,OAAD,CAA5B;AACArI,iBAAKK,WAAL,CAAiBuI,iBAAjB,CAAmC/J,KAAKC,KAAL,CAAWE,iBAA9C,EAAiEgH,KAAKC,SAAL,CAAe0C,eAAf,CAAjE;AACA3I,iBAAKK,WAAL,CAAiBuI,iBAAjB,CAAmC/J,KAAKC,KAAL,CAAWC,eAA9C,EAA+DuJ,KAA/D;AACH,SAJD,MAIM;AACF,gBAAInC,eAAenG,KAAKK,WAAL,CAAiBqI,0BAAjB,CAA4C7J,KAAKC,KAAL,CAAWE,iBAAvD,EAA0E,EAA1E,CAAnB;AACA2J,8BAAkB3C,KAAKoC,KAAL,CAAWjC,YAAX,CAAlB;AACA,gBAAGwC,mBAAmBA,gBAAgBpB,QAAhB,CAAnB,IAAgDoB,gBAAgBpB,QAAhB,EAA0BnG,MAA7E,EAAoF;AAChF,oBAAIyH,YAAYF,gBAAgBpB,QAAhB,CAAhB;AACA,oBAAIsB,UAAUzF,OAAV,CAAkBiF,OAAlB,IAA6B,CAAC,CAAlC,EAAoC;AAChCxJ,yBAAKC,KAAL,CAAWS,UAAX,GAAwBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsB0C,mBAA9C;AACAnI,uBAAGiG,kBAAH,CAAsBC,OAAtB,CAA8BhI,KAAKiI,SAAL,CAAeC,kBAA7C,EAAgElI,KAAKC,KAAL,CAAWM,SAA3E;AACAY,yBAAK4H,IAAL,CAAU,uBAAV,EAAkC,4BAA0B/I,KAAKC,KAAL,CAAWM,SAAvE;AACAP,yBAAKC,KAAL,CAAWQ,WAAX,GAAyB,EAAzB;AACA;AACH;AACDuJ,0BAAUE,IAAV,CAAeV,OAAf;AACArI,qBAAKK,WAAL,CAAiBuI,iBAAjB,CAAmC/J,KAAKC,KAAL,CAAWE,iBAA9C,EAAiEgH,KAAKC,SAAL,CAAe0C,eAAf,CAAjE;AACH,aAXD,MAWM;AACFA,gCAAgBpB,QAAhB,IAA4B,CAACc,OAAD,CAA5B;AACArI,qBAAKK,WAAL,CAAiBuI,iBAAjB,CAAmC/J,KAAKC,KAAL,CAAWE,iBAA9C,EAAiEgH,KAAKC,SAAL,CAAe0C,eAAf,CAAjE;AACH;AACJ;AACD,aAAKxB,mBAAL;AACH,KA3UQ;;AA6UTA,yBAAsB,+BAAY;AAC9BnH,aAAK4H,IAAL,CAAU,EAAV,EAAa,wEAAwE/I,KAAKC,KAAL,CAAWK,UAAhG;AACAN,aAAKC,KAAL,CAAWS,UAAX,GAAwBV,KAAKC,KAAL,CAAWsH,UAAX,CAAsB4C,YAA9C;AACA,YAAGnK,KAAKC,KAAL,CAAWM,SAAX,IAAwBP,KAAKC,KAAL,CAAWkI,WAAX,CAAuBQ,wBAA/C,IACC3I,KAAKC,KAAL,CAAWK,UAAX,GAAwB,KAD5B,EACkC;AAC9BN,iBAAKoK,SAAL,CAAeC,gBAAf,CAAgCrK,KAAKC,KAAL,CAAWK,UAA3C;AACH;AACDwB,WAAGiG,kBAAH,CAAsBC,OAAtB,CAA8BhI,KAAKiI,SAAL,CAAeC,kBAA7C,EAAgElI,KAAKC,KAAL,CAAWM,SAA3E;AACH,KArVQ;;AAuVT+J,gBAAW,oBAAS7J,WAAT,EAAqB8J,UAArB,EAAgC;AACvC,YAAIC,WAAW,EAAf;AACA,YAAIC,YAAY,SAAZA,SAAY,CAASxD,MAAT,EAAgB;AAC5B,gBAAIgC,KAAKhC,OAAOgC,EAAhB;AACA,gBAAIC,gBAAgBjC,OAAOiC,aAA3B;AACA,gBAAIC,cAAcnJ,KAAKC,KAAL,CAAWmJ,OAAX,CAAmBtH,GAAGC,QAAH,CAAYsH,kBAA/B,EAAkDJ,EAAlD,EAAqDC,aAArD,CAAlB;AACA;AACA;AACA,gBAAII,iBAAiBnC,KAAKoC,KAAL,CAAWJ,WAAX,CAArB;AACA,gBAAIK,UAAUF,eAAeE,OAA7B;AACAgB,uBAAWhB,OAAX;AACA,gBAAIkB,SAAS,EAAb;AACA,gBAAI5I,GAAG6I,UAAH,CAAcC,KAAd,IAAuB9I,GAAG6I,UAAH,CAAcC,KAAd,IAAuB,EAAlD,EAAsD;AAClDF,yBAAS5I,GAAG6I,UAAH,CAAcC,KAAvB;AACH,aAFD,MAEM,IAAI9I,GAAG6I,UAAH,CAAcE,mBAAd,IAAqC/I,GAAG6I,UAAH,CAAcE,mBAAd,IAAqC,EAA9E,EAAkF;AACpFH,yBAAS5I,GAAG6I,UAAH,CAAcE,mBAAvB;AACH;;AAED7K,iBAAKoK,SAAL,CAAeU,YAAf,CAA4BlG,SAAS2F,UAAT,CAA5B,EAAiDG,MAAjD,EAAwDF,QAAxD;AACArJ,iBAAK4H,IAAL,CAAU,EAAV,EAAa,6DAA2D5B,KAAKC,SAAL,CAAetF,GAAG6I,UAAH,CAAcC,KAA7B,CAAxE;AACAzJ,iBAAK4H,IAAL,CAAU,EAAV,EAAa,kDAAgD5B,KAAKC,SAAL,CAAeoD,QAAf,CAA7D;AACArJ,iBAAK4H,IAAL,CAAU,EAAV,EAAa,gDAAgD5B,KAAKC,SAAL,CAAesD,MAAf,CAA7D;AACH,SApBD;;AAsBA5H,WAAG2F,YAAH,CACI;AACIhI,yBAAaA,WADjB;AAEIuG,qBAAU,iBAAUC,MAAV,EAAkB;AACxBwD,0BAAUxD,MAAV;AACH,aAJL;AAKIQ,kBAAO,gBAAY;;AAEf,oBAAIiD,SAAS,EAAb;AACA,oBAAI5I,GAAG6I,UAAH,CAAcC,KAAd,IAAuB9I,GAAG6I,UAAH,CAAcC,KAAd,IAAuB,EAAlD,EAAsD;AAClDF,6BAAS5I,GAAG6I,UAAH,CAAcC,KAAvB;AACH,iBAFD,MAEM,IAAI9I,GAAG6I,UAAH,CAAcE,mBAAd,IAAqC/I,GAAG6I,UAAH,CAAcE,mBAAd,IAAqC,EAA9E,EAAkF;AACpFH,6BAAS5I,GAAG6I,UAAH,CAAcE,mBAAvB;AACH;AACD7K,qBAAKoK,SAAL,CAAeU,YAAf,CAA4BlG,SAAS2F,UAAT,CAA5B,EAAiDG,MAAjD,EAAwDF,QAAxD;AACArJ,qBAAK4H,IAAL,CAAU,EAAV,EAAa,sDAAsD2B,MAAnE;AACH,aAfL;AAgBI7C,sBAAW,oBAAY,CACtB;AAjBL,SADJ;AAsBH,KArYQ;;AAuYTuB,aAAS,iBAAS2B,GAAT,EAAc9B,EAAd,EAAkB+B,OAAlB,EAA2B;AAChCA,kBAAU,IAAIC,MAAJ,CAAWD,OAAX,EAAoB,QAApB,CAAV;AACA/B,aAAK,IAAIgC,MAAJ,CAAWhC,EAAX,EAAe,QAAf,CAAL;AACA8B,cAAM,IAAIE,MAAJ,CAAWF,GAAX,EAAgB,QAAhB,CAAN;AACA,YAAIG,WAAWpL,OAAOqL,gBAAP,CAAwB,aAAxB,EAAuCJ,GAAvC,EAA4C9B,EAA5C,CAAf;AACA,YAAImC,UAAUF,SAASG,MAAT,CAAgBL,OAAhB,EAAyB,QAAzB,EAAmC,MAAnC,CAAd;AACAI,mBAAWF,SAASI,KAAT,CAAe,MAAf,CAAX;AACA,eAAOF,OAAP;AACH,KA/YQ;;AAiZTjD,iBAAa;;AAEToD,0CAAiC,kCAFxB,EAE2D;AACpEC,iCAA0B,yBAHjB,EAG2C;AACpDC,iCAA0B,yBAJjB,EAI2C;AACpDC,kCAA2B,0BALlB,EAK6C;AACtDC,mCAA4B,2BANnB,EAM+C;AACxDC,uCAAgC,+BAPvB,EAOuD;AAChEC,mCAA4B,2BARnB,EAQ+C;AACxDzD,oCAA6B,4BATpB,EASiD;AAC1DO,kCAA2B,0BAVlB,EAU6C;AACtDmD,2CAAoC,mCAX3B,EAWgE;AACzEC,0CAAmC,kCAZ1B,EAY8D;AACvEC,4CAAqC,oCAb5B,EAakE;AAC3EC,mDAA4C,2CAdnC,EAcgF;;AAEzFC,qCAA8B,6BAhBrB,EAgBoD;AAC7DC,0CAAmC,kCAjB1B,EAiB8D;AACvEC,0CAAmC,kCAlB1B,EAkB8D;;AAEvEC,yCAAkC,iCApBzB,CAoB2D;;AApB3D,KAjZJ;AAwaT5F,wBAAoB;AAChB8E,0CAAiC,KADjB,EACuB;AACvCC,iCAA0B,KAFV,EAEgB;AAChCC,iCAA0B,KAHV,EAGgB;AAChCC,kCAA2B,KAJX,EAIiB;AACjCC,mCAA4B,KALZ,EAKmB;AACnCC,uCAAgC,KANhB,EAMsB;AACtCC,mCAA4B,KAPZ,EAOkB;AAClCzD,oCAA6B,KARb,EAQmB;AACnCO,kCAA2B,KATX,EASiB;AACjCmD,2CAAoC,KAVpB,EAU0B;AAC1CC,0CAAmC,KAXnB,EAWyB;AACzCC,4CAAqC,KAZrB,EAY4B;AAC5CC,mDAA4C,KAb5B,EAakC;;AAElDC,qCAA8B,KAfd,EAeqB;AACrCC,0CAAmC,KAhBnB,EAgB0B;AAC1CC,0CAAmC,KAjBnB,EAiB0B;;AAE1CC,yCAAkC,KAnBlB,CAmBwB;AAnBxB,KAxaX;;AA8bTC,oBAAe;AACXC,mBAAW,QADA,EACW;AACtBC,kBAAU,QAFC,EAEU;AACrBC,oBAAY,QAHD,EAGY;AACvBC,yBAAiB,QAJN,EAIiB;AAC5BC,oBAAY,QALD,EAKY;;AAEvBC,qBAAc;AAPH,KA9bN;;AAwcTC,yBAAqB;AACjBjC,eAAO,EADU;AAEjBC,6BAAqB,EAFJ;AAGjBiC,wBAAiB,EAHA;AAIjBC,kBAAW,EAJM;AAKjBC,0BAAmB,CALF;AAMjBC,kBAAU;AANO,KAxcZ;AAgdT1F,gBAAW;AACPC,yBAAkB,CADX,EACgB;AACvByC,6BAAsB,CAFf,EAEmB;AAC1BE,sBAAe,CAHR,EAGW;AAClB+C,iBAAU,CAJH;AAKPrE,8BAAuB,CALhB;AAMPlB,qBAAc,CANP;AAOPwF,uBAAgB,CAPT;AAQP3E,oBAAa;AARN;AAhdF,CAAb;;AA4dA1F,GAAGsK,iBAAH,CAAqB,UAAUnG,MAAV,EAAkB;AACnC,QAAIrG,OAAOZ,KAAKC,KAAL,CAAWkI,WAAX,CAAuByD,6BAAlC;AACA,QAAI5K,WAAWhB,KAAKiB,SAAL,CAAeC,WAA9B;AACA,QAAG,CAACF,QAAJ,EAAa;AACT;AACH;AACD,QAAIK,cAAcL,SAASJ,IAAT,CAAlB;;AAEA,QAAIU,WAAWD,YAAYE,IAAZ,CAAiBJ,KAAKK,WAAL,CAAiBC,iCAAjB,CAAmDJ,YAAYE,IAA/D,CAAjB,CAAf;AACA,QAAIG,aAAaP,KAAKK,WAAL,CAAiBG,sBAAjB,CAAwCL,SAASM,YAAjD,CAAjB;;AAEA,QAAIa,WAAWnB,SAASe,WAAxB;AACA,QAAImE,eAAelF,SAASkF,YAA5B;AACA,QAAIvE,gBAAgBX,SAASW,aAA7B;;AAEA,QAAIJ,KAAJ;AACA,QAAGR,YAAYQ,KAAf,EAAqB;AACjB,YAAIM,cAAchB,KAAKK,WAAL,CAAiBG,sBAAjB,CAAwCN,YAAYQ,KAApD,CAAlB;AACAA,gBAAQ,gBAAgBC,GAAGC,QAAH,CAAYC,MAA5B,GAAmC,cAAnC,GAAoDpB,IAApD,GAA2D,aAA3D,GAA2EqB,aAA3E,GAA2F,cAA3F,GAA4GH,GAAGC,QAAH,CAAYG,QAAxH,GAAmI,GAAnI,GAAyIC,WAAjJ;AACH,KAHD,MAGM;AACFN,gBAAQ,gBAAgBC,GAAGC,QAAH,CAAYC,MAA5B,GAAmC,cAAnC,GAAoDpB,IAApD,GAA2D,aAA3D,GAA2EqB,aAA3E,GAA2F,cAA3F,GAA4GH,GAAGC,QAAH,CAAYG,QAAhI;AACH;;AAEDlC,SAAKC,KAAL,CAAWM,SAAX,GAAuBK,IAAvB;AACAZ,SAAKC,KAAL,CAAWK,UAAX,GAAwBe,YAAYf,UAApC;AACAN,SAAKC,KAAL,CAAWO,SAAX,GAAuB,IAAvB;AACAR,SAAKC,KAAL,CAAWS,UAAX,GAAwB,CAAxB;AACAV,SAAKC,KAAL,CAAWQ,WAAX,GAAyB,EAAzB;AACAqB,OAAG4E,KAAH,CAASC,SAAT,CAAmB7E,GAAGC,QAAH,CAAY6E,kBAAZ,CAA+BC,6BAAlD,EAAgF,CAACL,YAAD,EAAe,CAAf,EAAkBvE,aAAlB,CAAhF;;AAEA,WAAO;AACH8E,eAAOrF,UADJ;AAEHe,kBAASA,QAFN;AAGHZ,eAAQA,KAHL,EAGW;AACdmF,iBAAU,iBAAUM,YAAV,EAAuB+F,aAAvB,EAAsC;AAC5ClM,iBAAK+F,IAAL,CAAU,mBAAV,EAA8B,oCAAkCC,KAAKC,SAAL,CAAeC,SAAf,CAAlC,GAA4D,KAA5D,GAAkExF,KAAhG;AACAC,eAAG4E,KAAH,CAASC,SAAT,CAAmB7E,GAAGC,QAAH,CAAY6E,kBAAZ,CAA+BC,6BAAlD,EAAgF,CAACL,YAAD,EAAgB,CAAhB,EAAmBvE,aAAnB,CAAhF;AACH,SAPE;AAQHwF,cAAO,gBAAY;AACftG,iBAAK+F,IAAL,CAAU,mBAAV,EAA8B,iCAA+BC,KAAKC,SAAL,CAAeC,SAAf,CAA/B,GAAyD,KAAzD,GAA+DxF,KAA7F;AACH,SAVE;AAWHgG,kBAAW,oBAAY;AACnB;AACH;AAbE,KAAP;AAeH,CA7CD;;AA+CA/E,GAAGwK,aAAH,CAAiB;AACbC,qBAAiB;AADJ,CAAjB","file":"Share.js","sourceRoot":"../../../../../assets/Script/Framework","sourcesContent":["\nvar crypto = require('crypto');\n\nshot.Share = {\n    LAST_SHARE_TIME : \"LAST_SHARE_TIME\",//最后一次分享的时间\n    // LAST_LOGIN_TIME : \"LAST_LOGIN_TIME\",//最后一次登录的时间\n    SHARETICKETS_LIST : \"SHARETICKETS_LIST\",//今天的分享群聊信息集合\n    shareQuery : \"\",\n\n    unSensitivePersonage : 0,//0、验证不同群,1、什么都不验证,2、验证群\n    sharePoint : 0,\n    shareType : \"\",\n\n    isOnShare : false,\n    shareTicket:\"\",\n    resultType : 0,//1、不是群,2、重复群,3、正常\n\n    shareWithType : function (type, successCallBackFun, failCallBackFun, testCfg) {\n        // var shareMap = shot.GameWorld.shareConfig;\n        // if(!shareMap){\n        //     return;\n        // }\n        var shareMap = shot.GameWorld.shareConfig;\n        if(!shareMap){\n            hall.LoginToyoo();\n            return;\n        }\n        var shareDetail = shareMap[type];\n\n        var shareCfg = shareDetail.list[hall.GlobalFuncs.getShareRandomNumberWithShareList(shareDetail.list)];\n        if (testCfg){\n            //配置上线前测试准备\n            shareCfg = testCfg;\n        }\n\n        var shareTitle = hall.GlobalFuncs.replaceKeyWordInString(shareCfg.shareContent);\n\n        var query = \"inviteCode=\"+ty.UserInfo.userId+\"&sourceCode=\"+type +\"&imageType=\"+shareCfg.shareSchemeId+\"&inviteName=\"+ty.UserInfo.userName;\n        if(shareDetail.query){\n            shot.Share.shareQuery = shareDetail.query;\n            var queryString = hall.GlobalFuncs.replaceKeyWordInString(shareDetail.query);\n            query = query+\"&\"+queryString;\n        }else {\n            shot.Share.shareQuery = \"\";\n        }\n\n        if(shareDetail.unSensitivePersonage){\n            shot.Share.unSensitivePersonage = shareDetail.unSensitivePersonage;\n        }else {\n            shot.Share.unSensitivePersonage = 0;\n        }\n\n        var shareImage = shareCfg.sharePicUrl;\n        if(shareCfg.extraAdd && shareCfg.extraAdd.length && shareCfg.extraAdd.length > 0 ){\n            var callBackF = function(imageUrl) {\n                shot.Share.shareImformation(type, shareCfg, shareTitle, imageUrl, query, shareDetail.sharePoint, successCallBackFun, failCallBackFun);\n            };\n            shot.Share.getShareImageWithShareMap(0, shareCfg.extraAdd, shareImage, callBackF);\n        }else {\n            shot.Share.shareImformation(type, shareCfg, shareTitle, shareImage, query, shareDetail.sharePoint, successCallBackFun, failCallBackFun);\n        }\n    },\n\n    getShareImageWithShareMap : function (nowIndex, extraAdd, imageUrl, callBackF) {\n        shot.Share.isOnShare = true;\n        var tempCavas = wx.createCanvas();\n        tempCavas.width =  360;\n        tempCavas.height =  288;\n\n        var context = tempCavas.getContext(\"2d\");\n        var image = wx.createImage();\n        image.src = imageUrl;\n\n        image.onload = function (event) {\n            var ima = event.target;\n            context.drawImage(ima,0,0);\n            var preTextWidth=0;\n            var preTextHeight=0;\n            var preX=0;\n            var preY=0;\n            while (nowIndex < extraAdd.length) {\n                var extraMap = extraAdd[nowIndex];\n                if (extraMap.type == \"text\") {\n                    var textInformation = extraMap.textInformation;\n                    var text = hall.GlobalFuncs.replaceKeyWordInString(textInformation.textformatString);\n                    context.font = textInformation.fontSize + \"px Arial\";\n                    if (textInformation.textColorRGB.indexOf('#') == -1){\n                        textInformation.textColorRGB = \"#\" + textInformation.textColorRGB;\n                    }\n                    context.fillStyle = textInformation.textColorRGB;\n                    context.textAlign = textInformation.textAlign.replace('middle','center');\n                    var textX = parseInt(textInformation.originPointX);\n                    if(textX < 0){\n                        if(textX == -1){\n                            textX = preX - preTextWidth/2;\n                        }else if(textX == -2){\n                            textX = preX + preTextWidth/2;\n                        }\n                    }\n                    var textY = parseInt(textInformation.originPointY);\n                    if (textY < 0){\n                        if(textY == -1){\n                            textY = preY - preTextHeight/2;\n                        }if(textY == -2){\n                            textY = preY + preTextHeight/2;\n                        }\n                    }\n                    context.fillText(text,textX,textY);\n                    preTextWidth = context.measureText(text).width;\n                    preTextHeight = context.measureText(text).height;\n                    preX = textX;\n                    preY = textY;\n                    nowIndex ++;\n                }else if(extraMap.type == \"image\") {\n                    var imageInformation = extraMap.imageInformation;\n                    var sunImage = wx.createImage();\n                    // sunImage.src = imageInformation.addImageUrl;\n                    if(imageInformation.addImageUrl == \"avatar\"){\n                        sunImage.src = ty.UserInfo.userPic;\n                    }else {\n                        sunImage.src = imageInformation.addImageUrl;\n                    }\n\n                    sunImage.originPointX = parseInt(imageInformation.originPointX);\n                    sunImage.originPointY = parseInt(imageInformation.originPointY);\n                    sunImage.sizeWidth = parseInt(imageInformation.sizeWidth);\n                    sunImage.sizeHeight = parseInt(imageInformation.sizeHeight);\n                    if(imageInformation.shape && imageInformation.shape == 2){\n                        context.beginPath();\n                        context.arc(sunImage.originPointX+sunImage.sizeWidth/2,sunImage.originPointY+sunImage.sizeHeight/2,sunImage.sizeWidth/2,0,2*Math.PI);\n                        context.stroke();\n                        context.clip();\n                    }\n                    sunImage.onload = function (event) {\n                        var img = event.target;\n                        context.drawImage(img,img.originPointX,img.originPointY,img.sizeWidth,img.sizeHeight);\n                        var tempFilePath = tempCavas.toTempFilePathSync({\n                            x: 0,\n                            y: 0,\n                            width: tempCavas.width,\n                            height: tempCavas.height,\n                            destWidth: tempCavas.width,\n                            destHeight: tempCavas.height\n                        });\n                        if(callBackF) {\n                            callBackF(tempFilePath);\n                        }\n                    };\n                    sunImage.onerror = function (event) {\n                        var img = event.target;\n                        // hall.LOGW(\"==\",\"============加载头像失败===========\"+sunImage.src+\"====\"+imageInformation.addImageUrl+\"====\");\n                        var tempFilePath = tempCavas.toTempFilePathSync({\n                            x: 0,\n                            y: 0,\n                            width: tempCavas.width,\n                            height: tempCavas.height,\n                            destWidth: tempCavas.width,\n                            destHeight: tempCavas.height\n                        });\n                        if(callBackF) {\n                            callBackF(tempFilePath);\n                        }\n                    };\n                    return;\n                }\n            }\n            var tempFilePath = tempCavas.toTempFilePathSync({\n                x: 0,\n                y: 0,\n                width: tempCavas.width,\n                height: tempCavas.height,\n                destWidth: tempCavas.width,\n                destHeight: tempCavas.height\n            });\n            if(callBackF) {\n                callBackF(tempFilePath);\n            }\n        };\n        image.onerror = function (event) {\n            var img = event.target;\n            // hall.LOGW(\"==\",\"============加载底图失败===========\"+img.src);\n        };\n    },\n\n    shareImformation : function (type, shareCfg, titleString, imageUrl, query, sharePoint, successCallBackFun, failCallBackFun) {\n        shot.Share.shareType = type;\n        shot.Share.sharePoint = sharePoint;\n        shot.Share.isOnShare = true;\n        shot.Share.resultType = 0;\n        shot.Share.shareTicket = \"\";\n\n        // var sharePointId = shareCfg.sharePointId;\n        var sharePointId = shot.Share.clickStatShareType[type];\n        var shareSchemeId = shareCfg.shareSchemeId;\n\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 1, shareSchemeId]);\n\n        wx.shareAppMessage({\n            title: titleString,\n            imageUrl : imageUrl,//5:4\n            query : query,//'key1=val1&key2=val2',\n            success : function (result) {\n                hall.LOGE(\"shareAppMessage\",\"===shareAppMessage==success==\"+JSON.stringify(arguments)+\"===\"+query);\n                ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 2, shareSchemeId]);\n                if (successCallBackFun){\n                    successCallBackFun(result);\n                }\n                if(!result.shareTickets || !result.shareTickets[0]){\n                    shot.Share.resultType = shot.Share.ShareState.isNotAGroupChat;\n                    shot.Share.shareTicket = \"\";\n                    return;\n                }\n                shot.Share.shareTicket = result.shareTickets[0];\n            },\n            fail : function () {\n                hall.LOGE(\"shareAppMessage\",\"===shareAppMessage==fail==\"+JSON.stringify(arguments)+\"===\"+query);\n                if (failCallBackFun){\n                    failCallBackFun();\n                }\n                shot.Share.isMatchShare = false;\n                shot.Share.resultType = shot.Share.ShareState.failToShare;\n                hall.LOGD(null, JSON.stringify(arguments));\n            },\n            complete : function () {\n                // hall.LOGE(\"shareAppMessage\",\"===shareAppMessage==complete==\"+JSON.stringify(arguments));\n            }\n        });\n    },\n\n    playAnimationAfterShareWithType:function() {\n        hall.LOGE(\"===\",\"playAnimationAfterShareWithType==\"+shot.Share.sharePoint);\n        // hall.LOGW(\"\",\"file = [Share] fun = [playAnimationAfterShareWithType] 111 \");\n        if(shot.Share.resultType == shot.Share.ShareState.failToShare){\n            ty.NotificationCenter.trigger(shot.EventType.UPDATE_SHARE_STATE,shot.Share.shareType);\n            return;\n        }\n\n        //直接跳转排行榜\n        if(shot.Share.shareType == shot.Share.onShareType.clickStatShareTypeRankList){\n            if(shot.Share.shareTicket && shot.Share.shareTicket != \"\"){\n                shot.GlobalFuncs.showRankList(shot.Share.shareTicket);\n                shot.Share.shareType = \"\";\n                shot.Share.resultType = 0;\n                return;\n            }\n        }\n\n        if(!shot.Share.unSensitivePersonage || shot.Share.unSensitivePersonage == 1){\n            this.endWithSuccessShare();\n            return;\n        }\n\n        if (!shot.GameWorld.gunnerShareSchemeConfig) {\n            shot.Share.shareType = shot.Share.ShareState.shareError;\n            // this.endWithSuccessShare();\n            ty.NotificationCenter.trigger(shot.EventType.UPDATE_SHARE_STATE,shot.Share.shareType);\n            return\n        }\n\n        //没有分享到群,发送通知结果类型和分享类型通知(没有分享到微信群)\n        if (!shot.Share.shareTicket || shot.Share.shareTicket == \"\"){\n            shot.Share.resultType = shot.Share.ShareState.isNotAGroupChat;\n            ty.NotificationCenter.trigger(shot.EventType.UPDATE_SHARE_STATE,shot.Share.shareType);\n            return;\n        }\n\n        //分享点只验证群,好友\n        if(shot.Share.unSensitivePersonage == 2){\n            //要验证群的处理\n            try {\n                wx.getShareInfo(\n                    {\n                        shareTicket :shot.Share.shareTicket,\n                        success : function (result) {\n                            var shareKey;\n                            if(shot.Share.shareType == shot.Share.onShareType.clickStatShareTypeRevial){\n                                shareKey = \"resurgence\";\n                                shot.Share.getShareResultWithKey(result,shareKey);\n                            }else {\n                                shareKey = shot.Share.sharePoint +\"\";\n                                shot.Share.getShareResultWithKey(result,shareKey);\n                            }\n                        },\n                        fail : function () {\n                            shot.Share.resultType = shot.Share.ShareState.failToGetShareTicket;\n                            ty.NotificationCenter.trigger(shot.EventType.UPDATE_SHARE_STATE,shot.Share.shareType);\n                        },\n                        complete : function () {\n                        }\n                    }\n                );\n            }catch (err){\n                hall.LOGE(\"error:\", \"shot.Share.unSensitivePersonage——\" + JSON.stringify(err));\n            }\n\n        }\n    },\n\n    getShareResultWithKey : function (result,shareKey) {\n        hall.LOGW(\"\",\"file = [Share] fun = [getShareResultWithKey]  \"+result.toString()+\"===\"+shareKey);\n        var iv = result.iv ;\n        var encryptedData = result.encryptedData;\n        var reultString = shot.Share.decrypt(ty.UserInfo.wxgame_session_key,iv,encryptedData);\n        // {\"openGId\":\"tGXVqG5IZmqkGArWBhZNJwn2NsqaQ\",\"watermark\":{\"timestamp\":1524292994,\"appid\":\"wxbfebdafc2fc60b54\"}}\n        var informationMap = JSON.parse(reultString);\n        var openGId = informationMap.openGId;\n        var toDay = hall.GlobalTimer.getCurDay();\n        var lastShareTime = hall.GlobalFuncs.ReadStringFromLocalStorage(shot.Share.LAST_SHARE_TIME, \"\");\n\n        var shareTicketsDic = {};\n        if(toDay != lastShareTime){\n            shareTicketsDic[shareKey] = [openGId];\n            hall.GlobalFuncs.setInLocalStorage(shot.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            hall.GlobalFuncs.setInLocalStorage(shot.Share.LAST_SHARE_TIME, toDay);\n        }else {\n            var shareTickets = hall.GlobalFuncs.ReadStringFromLocalStorage(shot.Share.SHARETICKETS_LIST, \"\");\n            shareTicketsDic = JSON.parse(shareTickets);\n            if(shareTicketsDic && shareTicketsDic[shareKey] && shareTicketsDic[shareKey].length){\n                var shareList = shareTicketsDic[shareKey];\n                if (shareList.indexOf(openGId) > -1){\n                    shot.Share.resultType = shot.Share.ShareState.repetitionGroupChat;\n                    ty.NotificationCenter.trigger(shot.EventType.UPDATE_SHARE_STATE,shot.Share.shareType);\n                    hall.LOGW(\"getShareResultWithKey\",\"UPDATE_SHARE_STATE  ===\"+shot.Share.shareType);\n                    shot.Share.shareTicket = \"\";\n                    return;\n                }\n                shareList.push(openGId);\n                hall.GlobalFuncs.setInLocalStorage(shot.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            }else {\n                shareTicketsDic[shareKey] = [openGId];\n                hall.GlobalFuncs.setInLocalStorage(shot.Share.SHARETICKETS_LIST, JSON.stringify(shareTicketsDic));\n            }\n        }\n        this.endWithSuccessShare();\n    },\n\n    endWithSuccessShare : function () {\n        hall.LOGW(\"\",\"file = [Share] fun = [endWithSuccessShare] shot.Share.sharePoint = \" + shot.Share.sharePoint);\n        shot.Share.resultType = shot.Share.ShareState.suscessShare;\n        if(shot.Share.shareType != shot.Share.onShareType.clickStatShareTypeRevial &&\n            shot.Share.sharePoint > 10000){\n            shot.gameModel.shareToGetreward(shot.Share.sharePoint);\n        }\n        ty.NotificationCenter.trigger(shot.EventType.UPDATE_SHARE_STATE,shot.Share.shareType);\n    },\n\n    getOpenGid:function(shareTicket,_boxUserId){\n        var _openGid = \"\";\n        var encryFunc = function(result){\n            var iv = result.iv ;\n            var encryptedData = result.encryptedData;\n            var reultString = shot.Share.decrypt(ty.UserInfo.wxgame_session_key,iv,encryptedData);\n            // hall.LOGW(\"\",\"file = [Share] fun = [getShareResultWithKey] reultString = \"+JSON.stringify(reultString));\n            // {\"openGId\":\"tGXVqG5IZmqkGArWBhZNJwn2NsqaQ\",\"watermark\":{\"timestamp\":1524292994,\"appid\":\"wxbfebdafc2fc60b54\"}}\n            var informationMap = JSON.parse(reultString);\n            var openGId = informationMap.openGId;\n            _openGid = openGId;\n            var _boxID = \"\";\n            if (ty.SystemInfo.boxId && ty.SystemInfo.boxId != \"\") {\n                _boxID = ty.SystemInfo.boxId;\n            }else if (ty.SystemInfo.mysteryGiftBagBoxId && ty.SystemInfo.mysteryGiftBagBoxId != \"\") {\n                _boxID = ty.SystemInfo.mysteryGiftBagBoxId;\n            }\n\n            shot.gameModel.getBoxReward(parseInt(_boxUserId),_boxID,_openGid);\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] ty.SystemInfo.boxId = \"+JSON.stringify(ty.SystemInfo.boxId));\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] _openGid = \"+JSON.stringify(_openGid));\n            hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] _boxID = \" + JSON.stringify(_boxID));\n        };\n\n        wx.getShareInfo(\n            {\n                shareTicket :shareTicket,\n                success : function (result) {\n                    encryFunc(result);\n                },\n                fail : function () {\n\n                    var _boxID = \"\";\n                    if (ty.SystemInfo.boxId && ty.SystemInfo.boxId != \"\") {\n                        _boxID = ty.SystemInfo.boxId;\n                    }else if (ty.SystemInfo.mysteryGiftBagBoxId && ty.SystemInfo.mysteryGiftBagBoxId != \"\") {\n                        _boxID = ty.SystemInfo.mysteryGiftBagBoxId;\n                    }\n                    shot.gameModel.getBoxReward(parseInt(_boxUserId),_boxID,_openGid);\n                    hall.LOGW(\"\",\"file = [Share] fun = [getOpenGid] fail  _boxID = \" + _boxID);\n                },\n                complete : function () {\n                }\n            }\n        );\n\n    },\n\n    decrypt :function(key, iv, crypted) {\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        var decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n        return decoded;\n    },\n\n    onShareType :{\n\n        clickStatShareTypeMysteryGiftBag:\"clickStatShareTypeMysteryGiftBag\",//神秘礼包\n        clickStatShareTypeScore : \"clickStatShareTypeScore\",//炫耀最佳成绩\n        clickStatShareTypeLight : \"clickStatShareTypeLight\",//激光瞄准器\n        clickStatShareTypeBullet : \"clickStatShareTypeBullet\",//无限子弹\n        clickStatShareTypeGrenade : \"clickStatShareTypeGrenade\",//手榴弹\n        clickStatShareTypeShareButton : \"clickStatShareTypeShareButton\",//微信分享按钮\n        clickStatShareTypeDiamond : \"clickStatShareTypeDiamond\",//互助礼邀请群友复活卡\n        clickStatShareTypeRankList : \"clickStatShareTypeRankList\",//查看群排行\n        clickStatShareTypeRevial : \"clickStatShareTypeRevial\",//复活\n        clickStatShareTypeBulletGetReward : \"clickStatShareTypeBulletGetReward\", //分享无限子弹道具\n        clickStatShareTypeLightGetReward : \"clickStatShareTypeLightGetReward\", //分享激光道具\n        clickStatShareTypeGrenadeGetReward : \"clickStatShareTypeGrenadeGetReward\", //分享手榴弹\n        clickStatShareTypeMysteryGiftBagGetReward : \"clickStatShareTypeMysteryGiftBagGetReward\", //分享的钻石\n\n        clickStatShareTypeAddBullet : \"clickStatShareTypeAddBullet\", //游戏内分享得子弹\n        clickStatShareTypeOpenSecretBoxB : \"clickStatShareTypeOpenSecretBoxB\", //开启神秘宝箱北上广深\n        clickStatShareTypeOpenSecretBoxN : \"clickStatShareTypeOpenSecretBoxN\", //开启神秘宝箱北上广深\n\n        clickStatShareTypeComboContinue : \"clickStatShareTypeComboContinue\" //分享续连击\n\n    },\n    clickStatShareType :{\n        clickStatShareTypeMysteryGiftBag:\"214\",//神秘礼包北上广深\n        clickStatShareTypeScore : \"213\",//炫耀最佳成绩\n        clickStatShareTypeLight : \"212\",//激光瞄准器\n        clickStatShareTypeBullet : \"211\",//无限子弹\n        clickStatShareTypeGrenade : \"217\", //手榴弹\n        clickStatShareTypeShareButton : \"208\",//微信分享按钮\n        clickStatShareTypeDiamond : \"210\",//互助礼邀请群友复活卡\n        clickStatShareTypeRankList : \"209\",//查看群排行\n        clickStatShareTypeRevial : \"207\",//复活\n        clickStatShareTypeBulletGetReward : \"206\",//分享无限子弹道具\n        clickStatShareTypeLightGetReward : \"205\",//分享激光道具\n        clickStatShareTypeGrenadeGetReward : \"216\", //分享手榴弹\n        clickStatShareTypeMysteryGiftBagGetReward : \"204\",//神秘礼包非北上广深\n\n        clickStatShareTypeAddBullet : \"203\", //游戏内分享得子弹\n        clickStatShareTypeOpenSecretBoxB : \"202\", //开启神秘宝箱北上广深\n        clickStatShareTypeOpenSecretBoxN : \"201\", //开启神秘宝箱非北上广深\n\n        clickStatShareTypeComboContinue : \"215\" //分享续连击\n    },\n\n    SharePointType:{\n        getBullet: 10600001,  //获取无限子弹道具\n        getLaser: 10600002,  //获取激光道具\n        getDiamond: 10600003,  //获取钻石\n        shareResurgence: 10600004,  //复活\n        getGrenade: 10600005,  //获取手榴弹\n\n        getFreeTool : 10600006\n    },\n    \n    shareKeywordReplace :{\n        boxId :\"\",\n        mysteryGiftBagBoxId :\"\",\n        theScoreForNow : \"\",\n        bestRank : \"\",\n        bestScoreForSelf : 0,\n        nickName :\"\"\n    },\n    ShareState:{\n        isNotAGroupChat : 1,   //不是群聊\n        repetitionGroupChat : 2,  //重复群聊\n        suscessShare : 3, //正常分享\n        exShare : 4,\n        failToGetShareTicket : 5,\n        failToShare : 6,\n        userInfoError : 7,\n        shareError : 8\n    }\n};\n\nwx.onShareAppMessage(function (result) {\n    var type = shot.Share.onShareType.clickStatShareTypeShareButton;\n    var shareMap = shot.GameWorld.shareConfig;\n    if(!shareMap){\n        return;\n    }\n    var shareDetail = shareMap[type];\n\n    var shareCfg = shareDetail.list[hall.GlobalFuncs.getShareRandomNumberWithShareList(shareDetail.list)];\n    var shareTitle = hall.GlobalFuncs.replaceKeyWordInString(shareCfg.shareContent);\n\n    var imageUrl = shareCfg.sharePicUrl;\n    var sharePointId = shareCfg.sharePointId;\n    var shareSchemeId = shareCfg.shareSchemeId;\n\n    var query;\n    if(shareDetail.query){\n        var queryString = hall.GlobalFuncs.replaceKeyWordInString(shareDetail.query);\n        query = \"inviteCode=\" + ty.UserInfo.userId+\"&sourceCode=\" + type + \"&imageType=\" + shareSchemeId + \"&inviteName=\" + ty.UserInfo.userName + \"&\" + queryString;\n    }else {\n        query = \"inviteCode=\" + ty.UserInfo.userId+\"&sourceCode=\" + type + \"&imageType=\" + shareSchemeId + \"&inviteName=\" + ty.UserInfo.userName;\n    }\n\n    shot.Share.shareType = type;\n    shot.Share.sharePoint = shareDetail.sharePoint;\n    shot.Share.isOnShare = true;\n    shot.Share.resultType = 0;\n    shot.Share.shareTicket = \"\";\n    ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId, 1, shareSchemeId]);\n\n    return {\n        title: shareTitle,\n        imageUrl:imageUrl,\n        query : query,//'key1=val1&key2=val2',\n        success : function (shareTickets,groupMsgInfos) {\n            hall.LOGE(\"onShareAppMessage\",\"===onShareAppMessage==success==\"+JSON.stringify(arguments)+\"===\"+query);\n            ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeShareAction,[sharePointId , 2, shareSchemeId]);\n        },\n        fail : function () {\n            hall.LOGE(\"onShareAppMessage\",\"===onShareAppMessage==fail==\"+JSON.stringify(arguments)+\"===\"+query);\n        },\n        complete : function () {\n            // hall.LOGE(\"onShareAppMessage\",\"===onShareAppMessage==complete==\"+JSON.stringify(arguments)+\"===\"+query);\n        }\n    }\n});\n\nwx.showShareMenu({\n    withShareTicket: true\n});\n\n"]}