{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/component/assets/Script/ComponentScript/component/shot_rank.js"],"names":["cc","Class","extends","Component","properties","backButton","default","type","Button","seeHolkButton","startGameButton","titleLabel","RichText","rankSprite","Sprite","texture","Texture2D","spriteFrame","SpriteFrame","shareTicket","backAction","ty","NotificationCenter","trigger","shot","EventType","UPDATE_RESULT_RANK","LOGD","node","destroy","onBlack","useModel","ctor","onLoad","GlobalFuncs","drawGameCanvas","backButtonH","getBackButtonPositionY","y","openDataContext","getOpenData","sharedCanvas","canvas","width","height","showOrigin","sprite","main","initWithElement","handleLoadedTexture","_refreshTexture","Timer","setTimer","listen","UPDATE_SHARE_STATE","playAnimationAfterShareWithType","shareType","Share","onShareType","clickStatShareTypeRankList","_config","GameWorld","gunnerShareSchemeConfig","reultType","resultType","hall","MsgBoxManager","showToast","title","showRankListForShare","unscheduleAllCallbacks","showFriendRank","showGroupRank","changeButtonToRank","string","active","onRankButton","BiLog","clickStat","UserInfo","clickStatEventType","clickStatEventTypeButtonClick","shareWithType","onStartButton","hideBackButton","curScene","director","getScene","name","GAME_START","sceneName","onLaunched","loadScene","start","onDestroy","gameModel","rankWindow","ignoreScope","showBackButton"],"mappings":"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","file":"shot_rank.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        backButton : {\n            default : null,\n            type : cc.Button\n        },\n        seeHolkButton : {\n            default : null,\n            type : cc.Button\n        },\n        startGameButton : {\n            default : null,\n            type : cc.Button\n        },\n        titleLabel : cc.RichText,\n\n        rankSprite : cc.Sprite,\n\n        texture:cc.Texture2D,\n        spriteFrame:{\n            default : null,\n            type : cc.SpriteFrame\n        },\n\n        shareTicket : \"\"\n    },\n    backAction : function () {\n        ty.NotificationCenter.trigger(shot.EventType.UPDATE_RESULT_RANK);\n        shot.LOGD(null, \"backAction\");\n        this.node.destroy();\n    },\n    onBlack : function () {\n\n    },\n    useModel : function () {\n    },\n    // LIFE-CYCLE CALLBACKS:\n    ctor : function () {\n    },\n    onLoad : function () {\n        shot.GlobalFuncs.drawGameCanvas();\n        var backButtonH = shot.GlobalFuncs.getBackButtonPositionY();\n        if (backButtonH){\n            this.backButton.node.y = backButtonH;\n        }\n\n        var openDataContext = shot.GlobalFuncs.getOpenData();\n        if(!openDataContext){\n            return;\n        }\n        var sharedCanvas = openDataContext.canvas;\n        sharedCanvas.width  = 566;\n        sharedCanvas.height = 1890;\n\n        shot.GlobalFuncs.showOrigin();\n        this.texture = new cc.Texture2D();\n        this.spriteFrame = new cc.SpriteFrame(this.texture);\n        var texture = this.texture;\n        var spriteFrame = this.spriteFrame;\n        var sprite = this.rankSprite;\n        var main = function () {\n            texture.initWithElement(sharedCanvas);\n            texture.handleLoadedTexture();\n            sprite.spriteFrame = spriteFrame;\n            sprite.spriteFrame._refreshTexture(texture);\n        };\n        main();\n        ty.Timer.setTimer(this, main, 1/10,1000);\n        // ddz.matchModel.getRankList();\n        ty.NotificationCenter.listen(shot.EventType.UPDATE_SHARE_STATE, this.playAnimationAfterShareWithType, this);\n    },\n\n    playAnimationAfterShareWithType : function (shareType) {\n        if (shareType && shareType != shot.Share.onShareType.clickStatShareTypeRankList) {\n            return;\n        }\n        var _config = shot.GameWorld.gunnerShareSchemeConfig;\n        if (_config){\n            var reultType = shot.Share.resultType;\n            switch (reultType) {\n                case 1:\n                    hall.MsgBoxManager.showToast({title : '分享到群才有效哦~'});\n                    break;\n                default:\n                    break;\n            }\n        }else {\n            hall.MsgBoxManager.showToast({title : \"可入群查看自己的排行哦~\"});\n        }\n\n        shot.Share.resultType = 0;\n    },\n    showRankListForShare : function () {\n        // hall.LOGD(\"==\",\"file = [ddz_rank] fun = [showRankListForShare] data = \" + JSON.stringify(this.shareTicket));\n        this.unscheduleAllCallbacks();\n        var openDataContext = shot.GlobalFuncs.getOpenData();\n        if(!openDataContext){\n            return;\n        }\n        var sharedCanvas = openDataContext.canvas;\n        if(!this.shareTicket || this.shareTicket == \"\"){\n            shot.GlobalFuncs.showFriendRank();\n        }else {\n            shot.GlobalFuncs.showGroupRank(this.shareTicket);\n        }\n        // shot.GlobalFuncs.showGroupRank(this.shareTicket,this.rankType);\n        var texture = this.texture;\n        var spriteFrame = this.spriteFrame;\n        var sprite = this.rankSprite;\n        var main = function () {\n            texture.initWithElement(sharedCanvas);\n            texture.handleLoadedTexture();\n            sprite.spriteFrame = spriteFrame;\n            sprite.spriteFrame._refreshTexture(texture);\n        };\n        ty.Timer.setTimer(this, main, 1/10,1000);\n    },\n    changeButtonToRank : function (shareTicket) {\n        this.shareTicket = shareTicket;\n        this.showRankListForShare();\n        if(shareTicket && shareTicket != \"\"){\n            this.titleLabel.string = \"<color=#F1A955><b>群排行</b></c>\";\n            this.seeHolkButton.node.active = false;\n            this.startGameButton.node.active = true;\n        }else {\n            this.titleLabel.string = \"<color=#F1A955><b>好友排行</b></c>\";\n            this.seeHolkButton.node.active = true;\n            this.startGameButton.node.active = false;\n        }\n    },\n    onRankButton : function () {\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeButtonClick,[\"groupRankAtRank\"]);\n        var shareType = shot.Share.onShareType.clickStatShareTypeRankList;\n        shot.Share.shareWithType(shareType);\n    },\n    onStartButton : function () {\n        ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeButtonClick,[\"startGameAtRank\"]);\n        this.hideBackButton();\n        var curScene = cc.director.getScene();\n        if (curScene.name == 'shot_main'){\n            ty.NotificationCenter.trigger(shot.EventType.GAME_START,\"start\");\n        }else {\n            var sceneName = 'shot_main';\n            var onLaunched = function () {\n            };\n            cc.director.loadScene(sceneName,onLaunched);\n        }\n        this.node.destroy();\n    },\n    start :function() {\n    },\n    onDestroy : function () {\n        shot.gameModel.rankWindow = null;\n        ty.NotificationCenter.ignoreScope(this);\n        this.unscheduleAllCallbacks();\n    },\n    hideBackButton : function () {\n        this.backButton.node.active = false;\n    },\n\n    showBackButton : function () {\n        this.backButton.node.active = true;\n    }\n});\n"]}