{"version":3,"sources":["SeatInfo.js"],"names":["require","ddz","SeatInfo","cc","Class","ctor","model","m_state","Enums","SeatState","SEATDZSTAT_WAIT","m_bIsTuoguan","m_call","m_show","m_tbc","m_tbt","m_mscore","m_buyinChip","m_mrank","m_robot","m_card","user_info","hall","HallUserInfo","m_ownroom_data","m_cardNote","m_playinfo_chip","hasData","LOGD","isUserId","userId","normalInfo","sex","udataInfo","m_sex","_dumpCards","s","cards","i","length","resetCardsWithLaizi","lz_point","lz_number","point","GlobalFuncs","numberToPoint","playCards","my_cards","c1","index","j","c2","splice","playCardsInFriend","LOGW","len","destroy","parseSeatInfo","seat","seatIndex","clean","parseAsPlayer","m_playinfo","m_playinfo_type","fuhao_user_info","hasOwnProperty","ty","NotificationCenter","trigger","EventType","BUY_CHIP_CHANEG","roomdata","m_tbtotal","m_tbplayed","m_iMatchScore","m_iMatchRank","setShowCards","setNotShowCards","isShowCard","starHeadId","gdataInfo"],"mappings":"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","file":"SeatInfo.js","sourceRoot":"../../../../../../assets/Script/ddz/models","sourcesContent":["require('HallUserInfo');\n\n// 一个座位的数据结构\nddz.SeatInfo = cc.Class({\n\n    ctor: function() {\n        this.model = {\n            // 普通变量\n            m_state: ddz.Enums.SeatState.SEATDZSTAT_WAIT, // 座位状态\n            m_bIsTuoguan: 0, // 服务器托管,0为no,1为yes\n            m_call: -1, // 叫的分数。-1还没叫，0不叫。1-3表示分数\n            m_show: 0, // 是否显示明牌,0为no,大于0为yes\n            m_tbc: 0, // 宝箱总局数\n            m_tbt: 0, // 宝箱已玩局数\n            m_mscore: 0, // 比赛积分\n            m_buyinChip: 0, // 带入金币\n            m_mrank: 0, // 比赛排名\n            m_robot: 0,\n            // 对象或存放对象的数组\n            m_card: [], // 存放本座位的手牌\n            user_info: new hall.HallUserInfo(), // 存放本座位的用户信息\n            m_ownroom_data :{\"plays\":0,\"wins\":0,\"bombs\":0,\"lords\":0},    //初始值\n            m_cardNote : 0,\n            m_playinfo_chip : {} //个人信息\n        };\n        this.hasData = false;\n        ddz.LOGD(null, \"ctor in new ddz.SeatInfo\");\n    },\n\n    //判断是否某个userid\n    isUserId: function(userId){\n        return this.model.user_info.normalInfo.userId == userId;\n    },\n\n    sex: function() {\n        return this.model.user_info.udataInfo.m_sex;\n    },\n\n    _dumpCards: function() {\n        var s = \"\";\n        var cards = this.model.m_card;\n        for (var i = 0; i < cards.length; i++) {\n            s += cards[i];\n            s += \" \";\n        }\n        ddz.LOGD(null, s);\n    },\n\n    resetCardsWithLaizi: function(lz_point, lz_number) {\n        var cards = this.model.m_card;\n        var point;\n        for (var i = 0; i < cards.length; i++) {\n            point = ddz.GlobalFuncs.numberToPoint(cards[i]);\n            if (point == lz_point) {\n                cards[i] = lz_number;\n            }\n        }\n    },\n\n    //如果出的牌不在手牌里，也不会崩溃或者报错，只是不进行删除，实际中应该不允许出现打出不存在的手牌\n    playCards: function(cards) {\n        // ddz.LOGD(null, \"before play cards....\");\n        // this._dumpCards();\n        // ddz.LOGD(null, \"play cards....\");\n        // hall.GlobalFuncs.PrintArray(cards);\n        var my_cards = this.model.m_card;\n        for (var i = 0; i < cards.length; i++) {\n            var c1 = cards[i];\n            var index = -1;\n            for (var j = 0; j < my_cards.length; j++) {\n                var c2 = my_cards[j];\n                if (c1 == c2 || (c1 > 53 && c2 > 53)) { //cards里面会是癞子实际值，my_cards里面会是癞子原本值，但都是>53，所以只要都是癞子就符合\n                    index = j;\n                    break;\n                }\n            }\n            if (index >= 0) {\n                my_cards.splice(index, 1);\n            }\n        }\n        // ddz.LOGD(null, \"after play cards.....\");\n        // this._dumpCards();\n    },\n\n    /**\n     * 其它两家,在好友场里出牌,好友场里,其它家手牌全部为-1,无法判断,直接减就行。\n     * @param cards\n     */\n    playCardsInFriend:function (cards) {\n        ddz.LOGW('playCardsInFriend', 'cards.length:' + cards.length + \";this.model.m_card.length:\" + this.model.m_card.length);\n        if (cards && cards.length && this.model && this.model.m_card) {\n            var len = this.model.m_card.length - cards.length;\n            if (len < 0){\n                len = 0;\n            }\n            this.model.m_card.length = len;\n        }\n    },\n\n    // 默认的析构函数\n    destroy: function() {\n        this.model = null;\n        ddz.LOGD(null, \"destroy in ddz.SeatInfo\");\n    },\n\n    // \n    parseSeatInfo: function(seat, seatIndex) {\n        if(!seat) {\n            return;\n        }\n        if (seat['uid'] == 0){\n            //玩家离开,后端发给前端的uid是0,清空数据\n            this.clean();\n            this.hasData = false;\n            return;\n        }\n        var model = this.model;\n        model.user_info.parseAsPlayer(seat);\n        if (typeof(seat[\"state\"]) != 'undefined') {\n            model.m_state = seat[\"state\"];\n        }\n        if (typeof(seat[\"seatState\"]) != 'undefined') {\n            model.m_state = seat[\"seatState\"];\n        }\n        if (typeof(seat[\"robot\"]) != 'undefined') {\n            model.m_bIsTuoguan = seat[\"robot\"];\n        }\n\n        // 金币场个人信息\n        if (typeof(seat[\"playinfo_chip\"]) != 'undefined') {\n            model.m_playinfo = seat[\"playinfo_chip\"];\n            model.m_playinfo_type = \"chip\";\n        }\n\n        // 好友场个人信息 {\"playcount\":0,\"winrate\":0,\"windoubles\":0,\"winchip\":0},\n        if (typeof(seat[\"playinfo_friend\"]) != 'undefined') {\n            model.m_playinfo = seat[\"playinfo_friend\"];\n            model.m_playinfo_type = \"friend\";\n        }\n\n        // 闯关场个人信息 {\"playcount\":0,\"winrate\":0,\"throughcount\":0,\"wincoupon\":0}\n        if (typeof(seat[\"playinfo_chuangguan\"]) != 'undefined') {\n            model.m_playinfo = seat[\"playinfo_chuangguan\"];\n            model.m_playinfo_type = \"chuangguan\";\n        }\n\n        // 比赛场个人信息 {\"signcount\":0,\"rewardrate\":0,\"riserate\":0,\"get1st\":0},\n        if (typeof(seat[\"playinfo_match\"]) != 'undefined') {\n            model.m_playinfo = seat[\"playinfo_match\"];\n            model.m_playinfo_type = \"match\";\n        }\n\n        // 个人信息 {\"micro_signal\":\"sre\",\"isVisible\":true,\"signature\":\"456\",\"constellation\":\"金牛座\",\"province\":\"北京\",\"district\":\"东城区\",\"sex\":0}\n        if (typeof(seat[\"fuhao_user_info\"]) != 'undefined') {\n            model.fuhao_user_info = seat[\"fuhao_user_info\"];\n        }\n        \n        model.m_call = seat[\"call\"];\n        model.m_show = seat[\"show\"];\n        model.m_tbc = seat[\"tbc\"];\n        model.m_tbt = seat[\"tbt\"];\n        model.m_mscore = seat[\"mscore\"];\n        if (seat.hasOwnProperty('buyinChip')){\n            model.m_buyinChip = seat[\"buyinChip\"];\n            ty.NotificationCenter.trigger(ddz.EventType.BUY_CHIP_CHANEG, seatIndex);\n        }\n\n        model.m_mrank = seat[\"mrank\"];\n        model.m_robot = seat[\"robot\"];\n\n        if (typeof(seat[\"card\"]) != 'undefined') {\n            model.m_card = seat[\"card\"];\n        }\n        var roomdata = seat[\"ownroom_data\"];\n        if(roomdata) {\n            model.m_ownroom_data = roomdata;\n        }\n        model.m_cardNote = seat[\"cardNote\"];\n        this.hasData = true;\n    },\n\n    //设置变量为初始状态\n    clean: function() {\n        var model = this.model;\n        model.m_state = ddz.Enums.SeatState.SEATDZSTAT_WAIT;\n        model.m_bIsTuoguan = 0;\n        model.m_call = -1;\n        model.m_show = 0;\n        model.m_tbtotal = 0;\n        model.m_tbplayed = 0;\n        model.m_iMatchScore = 0;\n        model.m_iMatchRank = 0;\n        model.m_robot = 0;\n        model.m_card = [];\n        model.user_info = new hall.HallUserInfo();\n        this.hasData = false;\n        ddz.LOGD(null, \"clean in ddz.SeatInfo\");\n    },\n\n    //设置为明牌\n    setShowCards: function() {\n        //这是在地主发出明牌信息后，收到服务器的回应后，由客户端手动设置为显示明牌，show的值设置为2\n        this.model[\"m_show\"] = 2;\n    },\n\n    //设置为非明牌，在一局游戏结束后进行\n    setNotShowCards: function() {\n        this.model[\"m_show\"] = 0;\n    },\n    \n    //当前座位是否显示为明牌\n    isShowCard: function() {\n        return this.model[\"m_show\"] > 0;\n    },\n\n    // 获取明星头像ID\n    starHeadId:function(){\n        return this.model.user_info.gdataInfo.starHeadId();\n    }\n});\n"]}