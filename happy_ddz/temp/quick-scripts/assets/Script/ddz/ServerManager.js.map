{"version":3,"sources":["ServerManager.js"],"names":["cc","Class","extends","Component","properties","txtServer","EditBox","btnChange","Button","btnReset","txtFTID","default","type","userIdlabel","Label","onLaunchParamsLabel","onShowParamsLabel","qrSprite","Sprite","txtShareType","txtShareSchemeId","onLoad","that","serPath","hall","GlobalFuncs","ReadStringFromLocalStorage","ty","SystemInfo","DEBUG_SER_KEY","node","on","evet","setInLocalStorage","string","TuyooSDK","wechatLogin","MsgBoxManager","showToast","title","ddz","LOGD","NotificationCenter","listen","EventType","GET_SHARE_SINGLE_CONFIG_SUCCESS","onShowShareWin","onEnterTable","ftid","trigger","CHANGE_DEBUG_MODE","friendModel","enterFriendTable","testWithString","UserInfo","userId","sceneInfo","wx","getLaunchOptionsSync","JSON","stringify","onShowString","gameModel","ONSHOW_PARAMS","onBtnQRCode","sdkPath","loginUrl","debugMode","local_uuid","getLocalUuid","val","parsArr","split","pars","appId","wxAppId","clientId","imei","uuid","width","parseInt","b64","path","request","url","header","data","method","success","params","b64Str","result","img","fs","getFileSystemManager","filePath","env","USER_DATA_PATH","writeFileSync","loader","load","err","texture","spriteFrame","SpriteFrame","fail","complete","onTestSingleShare","shareType","shareSchemeId","obj","PropagateInterface","getSingleShareConfigInfo","shareCfg","Share","shareWithType","resetFailCount","setTempDataWithArenaFailTime","setTempDataWithMatchFailTime","onDestroy","ignoreScope"],"mappings":"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","file":"ServerManager.js","sourceRoot":"../../../../../assets/Script/ddz","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        txtServer : cc.EditBox,\n        btnChange : cc.Button,\n        btnReset : cc.Button,\n        txtFTID : {\n            default : null,\n            type : cc.EditBox\n        },\n\n        userIdlabel:cc.Label,\n        onLaunchParamsLabel : cc.Label,\n        onShowParamsLabel : cc.Label,\n        qrSprite: cc.Sprite,\n\n        txtShareType : cc.EditBox,\n        txtShareSchemeId : cc.EditBox,\n    },\n\n    onLoad:function () {\n        var that = this;\n        var serPath = hall.GlobalFuncs.ReadStringFromLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, \"\");\n        this.btnChange.node.on('click', function (evet) {\n            hall.GlobalFuncs.setInLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, that.txtServer.string);\n            // hall.MsgBoxManager.showToast({title:'服务器地址已更新,请退出重新登录!'});\n            ty.TuyooSDK.wechatLogin();\n        });\n\n        this.btnReset.node.on('click', function (evet) {\n            that.txtServer.string = \"\";\n            hall.GlobalFuncs.setInLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, \"\");\n\n            hall.MsgBoxManager.showToast({title:'服务器地址已重置'});\n        });\n\n        ddz.LOGD(null, \"当前的SDK地址:\" + serPath);\n\n        this.txtServer.string = serPath;\n\n        ty.NotificationCenter.listen(ty.EventType.GET_SHARE_SINGLE_CONFIG_SUCCESS, this.onShowShareWin, this);\n    },\n    //TODO:加入好友房的处理\n    onEnterTable:function () {\n        var ftid = this.txtFTID.string;\n        if(ftid == '20180407'){\n            ty.NotificationCenter.trigger(ddz.EventType.CHANGE_DEBUG_MODE,false);\n        }else {\n            ddz.friendModel.enterFriendTable(ftid);\n        }\n        // ddz.MsgFactory.resumeMatch();\n\n        //牌弄测试,上手牌33344497,本家KKKKQQQQ\n\n        // var topCards = [2,15,28, 3, 16, 29, 8 ,7];\n        // var myCards = [12, 25, 38, 51, 11, 24, 37, 50];\n        // var myCards = [\n        //     0, 13, 26, 39,\n        //     12, 25, 38, 51,\n        //     11, 24, 37, 50,\n        //     10, 23, 36, 49,\n        //     9, 22, 35, 48\n        // ];\n\n        // var types = ddz.RobotGlobal.judgeType(topCards);\n        // var types2 = ddz.RobotGlobal.judgeType(myCards);\n        // ddz.LOGD(this._TAG, types2.length);\n\n        // types2.isLargerThan(types)\n        // 计算被动提示牌\n        // var playTips = ddz.RobotGlobal.findWinCardsFromArray(types[0], myCards);\n        //管不上\n        // if (playTips.length == 0) {\n        //     ddz.LOGD(this._TAG, \"no cards larger than top card\");\n        //     return true;\n        // }\n    },\n    testWithString : function () {\n        // this.mainScene\n        this.userIdlabel.string = \"userId  :   \"+ ty.UserInfo.userId;\n\n        var sceneInfo = wx.getLaunchOptionsSync();\n        this.onLaunchParamsLabel.string = \"Launch：  \"+JSON.stringify(sceneInfo);\n\n        var onShowString = hall.GlobalFuncs.ReadStringFromLocalStorage(ddz.gameModel.ONSHOW_PARAMS,\"\");\n        this.onShowParamsLabel.string = \"onShow :  \" + onShowString;\n    },\n    onBtnQRCode:function () {\n\n        // 公众号内发送客服消息接口：\n        // http://gdss.touch4.me/?act=wxRichApi.sendCsMsgFromGame\n        //\n        //     userId：小游戏的玩家ID\n        // wxgameappid：小游戏微信appId\n        // msg：要发送到公众号的消息内容\n\n        // var pars = {\n        //     userId : ty.UserInfo.userId,\n        //     wxgameappid : ty.SystemInfo.wxAppId,\n        //     msg : '这是测试'\n        // };\n        //\n        // hall.LOGD(null, '=======公众号测试 发送参数:' + JSON.stringify(pars));\n        //\n        // wx.request({\n        //     url: 'http://gdss.touch4.me/?act=wxRichApi.sendCsMsgFromGame',\n        //     header: {\n        //         'content-type': 'application/x-www-form-urlencoded'\n        //     },\n        //     data: pars,\n        //     method:'POST',\n        //     success: function(params) {\n        //         hall.LOGD(null, '公众号测试 success, params:' + JSON.stringify(params));\n        //\n        //     },\n        //     fail: function(params) {\n        //         hall.LOGD(null, '公众号测试 fail, params:' + JSON.stringify(params));\n        //     },\n        //     complete: function(params) {\n        //\n        //     }\n        // });\n        // return;\n\n        // hall.recorder.startRecord(8);\n\n        // var fs = wx.getFileSystemManager();\n        // var filePath = wx.env.USER_DATA_PATH + '/au.aac';\n        // var filePath =  'res/raw-assets/2.aac';\n        // fs.writeFileSync(filePath ,fss , 'base64');\n        // // ddz.AudioHelper.playEffect(filePath);\n        // var musicPlayManager = wx.createInnerAudioContext();\n        // musicPlayManager.autoplay = true;\n        // musicPlayManager.loop = false;\n        // musicPlayManager.volume = 1;\n        // musicPlayManager.src = filePath;\n\n        // var fileStr = fs.readFileSync(\"res/2.aac\", 'base64');\n        // hall.LOGD(null, \"fs:\" + fileStr);\n\n        // return;\n\n        var sdkPath = ty.SystemInfo.loginUrl;\n        if (debugMode){\n            sdkPath = hall.GlobalFuncs.ReadStringFromLocalStorage(ty.SystemInfo.DEBUG_SER_KEY, ty.SystemInfo.loginUrl);\n        }\n        var local_uuid = hall.GlobalFuncs.getLocalUuid();\n\n        // var pars = {\n        //     appId: ty.SystemInfo.appId,\n        //     wxAppId: ty.SystemInfo.wxAppId,\n        //     clientId: ty.SystemInfo.clientId,\n        //     imei: 'null',\n        //     uuid : local_uuid,\n        //     width : 280,\n        //     b64 : true,\n        //     scene : '1,' + ty.UserInfo.userId\n        // };\n\n        var val = this.txtFTID.string;\n        var parsArr = val.split(\"|\");\n\n        var pars = {\n            appId: ty.SystemInfo.appId,\n            wxAppId: ty.SystemInfo.wxAppId,\n            clientId: ty.SystemInfo.clientId,\n            imei: 'null',\n            uuid : local_uuid,\n            width : parseInt(parsArr[0]),\n            b64 : 'true',\n            path : parsArr[1]\n        };\n\n        var serPath = sdkPath + 'open/v6/user/Getwxacode';\n\n        hall.LOGD(null, 'qrcode,params:' + JSON.stringify(pars));\n        hall.LOGD(null, 'qrcode,serverPath:' + serPath);\n\n\n        var that = this;\n        wx.request({\n            // url: sdkPath + 'open/v6/user/Getwxacodeunlimit',\n            url: serPath,\n            header: {\n                'content-type': 'application/x-www-form-urlencoded'\n            },\n            data: pars,\n            method:'POST',\n            success: function(params) {\n                hall.LOGD(null, 'qrcode success, params:' + JSON.stringify(params));\n                // var imgPath = params.data.result.path;\n                var b64Str =  params.data.result.img;\n                var fs = wx.getFileSystemManager();\n                var filePath = wx.env.USER_DATA_PATH + '/qr.png';\n                // var filePath =  'res/raw-assets/2.aac';\n                fs.writeFileSync(filePath ,b64Str , 'base64');\n\n                cc.loader.load({url: filePath, type: 'png'}, function (err, texture) {\n                    // hall.LOGD(null, \"请求图片请求图片请求图片请求图片请求图片请求图片\");\n                    if (!err) {\n                        that.qrSprite.spriteFrame =  new cc.SpriteFrame(texture);\n                    }\n                    else {\n                        //加载失败\n                    }\n                });\n            },\n            fail: function(params) {\n\n            },\n            complete: function(params) {\n\n            }\n        });\n    },\n    onTestSingleShare:function () {\n        //测试单个未上线的配置信息\n        var shareType = this.txtShareType.string;\n        var shareSchemeId = this.txtShareSchemeId.string;\n\n        var obj = {\n            \"share_type\" : shareType,\n            \"config_id\" : shareSchemeId,\n        };\n\n        ty.PropagateInterface.getSingleShareConfigInfo(obj);\n    },\n\n    onShowShareWin:function (obj) {\n        this.onLaunchParamsLabel.string = JSON.stringify(obj);\n        var shareCfg = obj[this.txtShareType.string][0];\n        ddz.Share.shareWithType(this.txtShareType.string, null, null, shareCfg);\n    },\n\n    resetFailCount : function () {\n        ddz.gameModel.setTempDataWithArenaFailTime(0);\n        ddz.gameModel.setTempDataWithMatchFailTime(0);\n    },\n    \n    onDestroy : function () {\n        ty.NotificationCenter.ignoreScope(this);\n    }\n\n});"]}