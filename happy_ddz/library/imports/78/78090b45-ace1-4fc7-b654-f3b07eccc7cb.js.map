{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/window/assets/Script/ComponentScript/window/AlmsWindow.js"],"names":["cc","Class","extends","Component","properties","txtTitle","Label","txtDesc","RichText","txtOkBtn","btnOk","Button","txtCancel","initWithPar","par","condition","resurgenceCondition","string","title","content","buttonText1","buttonText2","that","scheduleOnce","ani","node","getComponent","Animation","play","onLoad","ty","NotificationCenter","listen","ddz","EventType","REMOVE_TABLE_ANI","removeLoopAni","REWARD_VIDEO_COMPLETE","onAdComplete","isEnded","getReward","shut","gameModel","shareToGetreward","sharePointId","stop","onClose","onCancel","onOk","conditionType","aidx","adIds","length","Math","floor","random","adid","hall","adManager","showRewardedVideo","Share","shareWithType","almsWindow","destroy","onDestroy","ignoreScope"],"mappings":"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","file":"AlmsWindow.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/window","sourcesContent":["/**\n * 救济金窗口\n */\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        txtTitle : cc.Label,\n        txtDesc : cc.RichText,\n        txtOkBtn : cc.RichText,\n        btnOk : cc.Button,\n        txtCancel : cc.RichText,\n    },\n\n    initWithPar:function (par) {\n\n        // par = {\n        //     \"buttonText1\":\"观看广告\",\n        //     \"buttonText2\":\"点击放弃>\",\n        //     \"content\":\"金币不够啦，\\n看广告可以领1000金币哦~\",\n        //     \"failCountMax\":100,\n        //     \"failCountMin\":6,\n        //     \"resurgenceCondition\":{\n        //         \"adIds\":[\n        //             \"adunit-8bde7ac62d379503\"\n        //         ],\n        //         \"conditionType\":\"ad\",\n        //         \"requestCount\":1,\n        //         \"sharePointId\":67890013\n        //     },\n        //     \"title\":\"提示\"\n        // };\n\n        this.condition = par.resurgenceCondition;\n\n        this.txtTitle.string = par.title;\n        this.txtDesc.string = par.content;\n        this.txtOkBtn.string = par.buttonText1;\n        this.txtCancel.string = par.buttonText2;\n        var that = this;\n        this.scheduleOnce(function () {\n            var ani = that.node.getComponent(cc.Animation);\n            ani.play('btnTick');\n        }, 1);\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad :function () {\n\n        ty.NotificationCenter.listen(ddz.EventType.REMOVE_TABLE_ANI, this.removeLoopAni, this);\n        ty.NotificationCenter.listen(ddz.EventType.REWARD_VIDEO_COMPLETE, this.onAdComplete, this);\n\n        // var that = this;\n        // this.scheduleOnce(function () {\n        //     var ani = that.node.getComponent(cc.Animation);\n        //     ani.play('btnTick');\n        // }, 1);\n    },\n\n    onAdComplete:function (isEnded) {\n        if (isEnded){\n            //中了,发金币\n            this.getReward();\n        }\n        this.shut();\n    },\n\n    getReward:function () {\n        ddz.gameModel.shareToGetreward(this.condition.sharePointId);\n        // ddz.gameModel.shareToGetreward(ddz.Share.SharePointType.alms)\n    },\n\n    removeLoopAni:function () {\n        var ani = this.node.getComponent(cc.Animation);\n        ani.stop();\n    },\n\n    onClose :function () {\n        this.shut();\n    },\n\n    onCancel : function () {\n        this.shut();\n    },\n\n    onOk:function () {\n        if (this.condition.conditionType == \"ad\"){\n            var aidx;\n            if (this.condition.adIds.length == 1){\n                aidx = 0;\n            }\n            else{\n                aidx = Math.floor(this.condition.adIds.length * Math.random());\n            }\n            var adid = this.condition.adIds[aidx];\n            hall.adManager.showRewardedVideo(adid, 'alms')\n        }\n        else{\n            ddz.Share.shareWithType(this.condition['shareConfigId']);\n            this.shut();\n        }\n    },\n    \n    shut:function () {\n        ddz.almsWindow = null;\n        this.removeLoopAni();\n        this.node.destroy();\n    },\n    \n    \n    onDestroy:function () {\n        ty.NotificationCenter.ignoreScope(this);\n    }\n\n    // update (dt) {},\n});"]}