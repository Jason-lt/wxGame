{"version":3,"sources":["../../../../../../assets/Script/ComponentScript/component/assets/Script/ComponentScript/component/videoIcon.js"],"names":["cc","Class","extends","Component","properties","timerText","Label","redDot","Node","guanggao","videoBtn","Button","onLoad","ty","NotificationCenter","listen","ddz","EventType","UPDATE_WATCH_VIDEO_STATUS","updateWatchVideoState","REWARD_VIDEO_COMPLETE","finishShowRewardVideo","REWARD_VIDEO_COMPLETE_ERROR","errorShowRewardVideo","UPDATE_VIDEO_REWARD","finishGetRewardVideo","adId","gameModel","queryWatchVideoReward","that","scheduleOnce","playLoopAni","result","hall","LOGW","JSON","stringify","node","active","videoId","leftSecond","seconds","status","Timer","cancelTimer","timerAction","interactable","setTimerText","setTimer","macro","REPEAT_FOREVER","_leftSecond","_minute","parseInt","_second","string","stopLoopAni","seeReardedVideo","MsgBoxManager","showToast","title","isEnded","getWatchVideoReward","parArr","rewards","itemId","GlobalFuncs","playZuanShi","count","onDestroy","ignoreScope"],"mappings":"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","file":"videoIcon.js","sourceRoot":"../../../../../../assets/Script/ComponentScript/component","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        timerText:cc.Label,\n        redDot:cc.Node,\n        guanggao:cc.Node,\n        videoBtn:cc.Button,\n    },\n\n    onLoad:function () {\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_WATCH_VIDEO_STATUS, this.updateWatchVideoState,this);\n        ty.NotificationCenter.listen(ddz.EventType.REWARD_VIDEO_COMPLETE,this.finishShowRewardVideo,this);\n        ty.NotificationCenter.listen(ddz.EventType.REWARD_VIDEO_COMPLETE_ERROR,this.errorShowRewardVideo,this);\n        ty.NotificationCenter.listen(ddz.EventType.UPDATE_VIDEO_REWARD,this.finishGetRewardVideo,this);\n        \n        this.adId = \"adunit-8bde7ac62d379503\";\n        ddz.gameModel.queryWatchVideoReward();\n        var that = this;\n        this.scheduleOnce(function () {\n            that.playLoopAni();\n        }, 1);\n    },\n\n    //\n    updateWatchVideoState : function (result) {\n        hall.LOGW(\"\",\"file = [videoIcon] fun = [updateWatchVideoState] result = \" + JSON.stringify(result));\n        this.timerText.node.active = false;\n        this.adId = result.videoId;\n        this.leftSecond = result.seconds;\n        if(result.status == 0){\n            if (this.leftSecond == 0) {\n                ty.Timer.cancelTimer(this,this.timerAction);\n                this.playLoopAni();\n                this.videoBtn.interactable = true;\n                // this.timerText.string = \"看广告领奖\";\n            }else {\n                this.setTimerText(this.leftSecond);\n                ty.Timer.setTimer(this,this.timerAction,1,cc.macro.REPEAT_FOREVER,0);\n            }\n        }else if(result.status == 1){\n            this.playLoopAni();\n            this.videoBtn.interactable = true;\n            // this.timerText.string = \"看广告领奖\";\n            // this.redDot.active = true;\n        }\n    },\n\n    setTimerText:function(_leftSecond){\n        var _minute = parseInt(_leftSecond/60);\n        if (_minute < 10) {\n            _minute = \"0\" + _minute;\n        }\n        var _second = _leftSecond%60;\n        if (_second < 10) {\n            _second = \"0\" + _second;\n        }\n        this.timerText.node.active = true;\n        // this.redDot.active = false;\n        this.timerText.string = _minute+\":\"+_second;\n\n    },\n\n    timerAction : function () {\n        this.leftSecond --;\n        if(this.leftSecond > 0){\n            // this.timerText.node.active = true;\n            this.stopLoopAni();\n            this.setTimerText(this.leftSecond);\n            this.videoBtn.interactable = false;\n        }else {\n            ty.Timer.cancelTimer(this,this.timerAction);\n            this.playLoopAni();\n            this.timerText.node.active = false;\n            this.videoBtn.interactable = true;\n            // this.\n            // this.redDot.active = true;\n            ddz.gameModel.queryWatchVideoReward();\n        }\n    },\n\n    /*\n     看广告领取奖励\n     */\n    seeReardedVideo:function(){\n\n        hall.MsgBoxManager.showToast({title : \"该功能暂未开启,敬请期待!\"});\n\n        // if (ty.TCP.connectStatus != ty.TCP.CONNECT_STATUS_OK){\n        //     hall.MsgBoxManager.showToast({title : \"正在登录，请稍候\"});\n        //     ddz.LOGD(null, \"TCP is not ok! Please wait!\");\n        //     return;\n        // }\n        //\n        // ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeButtonClick,\n        //     [\"watchVideo\",\"diamond\"]);\n        //\n        // hall.LOGW(\"====\",\"file = [videoIcon] fun = [seeReardedVideo]this.adId = \"+this.adId);\n        // if (this.leftSecond > 0) {\n        //     var tipsString = \"倒计时结束才能再次领奖哦~\";\n        //     var preFabPath = \"prefabs/ddz_window_normal\";\n        //     var  comName = \"ddz_window_normal\";\n        //     hall.GlobalFuncs.showPopWinByPreFab(preFabPath, function (preFabNode) {\n        //         var window = preFabNode.getComponent(comName);\n        //         var tiString = \"确定\";\n        //         window.setTitleContentAndButtonsString(\"提示\",\"<color=#1A6951>\" + tipsString + \"</c>\",[{title:tiString,callFunc:function () {\n        //         }}]);\n        //     });\n        // }else {\n        //     hall.adManager.checkVideoAd();\n        //     if (hall.adManager.canPlay) {\n        //         hall.adManager.showRewardedVideo(this.adId,\"diamond\");\n        //     }else {\n        //         hall.MsgBoxManager.showToast({title : \"今日已达上限,明天继续哦~\"});\n        //     }\n        // }\n    },\n\n    finishShowRewardVideo : function (isEnded) {\n        hall.LOGW(\"finishShowRewardVideo\",\"收到广告播放完毕消息!\");\n        // ddz.gameModel.queryWatchVideoReward();\n        if(isEnded){\n            ddz.gameModel.getWatchVideoReward();\n        }\n\n\n    },\n    errorShowRewardVideo : function (parArr) {\n        // var errMsg = '广告播放失败,但您仍可获得奖励!';\n        // hall.MsgBoxManager.showToast({title:errMsg});\n        hall.LOGW(\"\",\"file = [videoIcon] fun = [errorShowRewardVideo] parArr = \" + JSON.stringify(parArr));\n        this.finishShowRewardVideo(parseInt(parArr[1]))\n    },\n\n    finishGetRewardVideo : function (result) {\n        if(result.rewards){\n            var rewards = result.rewards;\n            if(rewards.itemId == \"item:1311\"){\n                ddz.GlobalFuncs.playZuanShi(false,this,rewards.count,false);\n            }else if (rewards.itemId == \"item:1363\"){\n\n                ddz.GlobalFuncs.playZuanShi(false,this,rewards.count,true,false,true);\n\n                // if (ddz.gameModel.firstUseJiPaiQiPoint > 0) {\n                //     ddz.gameModel.shareToGetreward(ddz.Share.SharePointType.firstUseJiPaiQi);\n                // }else {\n                //     ddz.gameModel.shareToGetreward(ddz.Share.SharePointType.adGetJiPaiQi);\n                // }\n            }else {\n                ddz.GlobalFuncs.playZuanShi(false,this,rewards.count,true);\n            }\n            this.leftSecond = result.seconds;\n            if (this.leftSecond > 0) {\n                //\n                this.setTimerText(this.leftSecond);\n                ty.Timer.setTimer(this,this.timerAction,1,cc.macro.REPEAT_FOREVER,0);\n            }else {\n                // this.timerText.string = \"看广告领奖\";\n                this.videoBtn.interactable = true;\n                this.timerText.node.active = false;\n                // this.redDot.active = true;\n                ty.Timer.setTimer(this,this.timerAction,1,cc.macro.REPEAT_FOREVER,0);\n            }\n        }\n    },\n\n    stopLoopAni:function () {\n        // var animationCom = this.guanggao.getComponent(cc.Animation);\n        // var ani = animationCom.getAnimationState('shipin');\n        // ani.stop();\n    },\n\n    playLoopAni:function () {\n        // var ani = this.guanggao.getComponent(cc.Animation);\n        // ani.play('shipin');\n    },\n\n    onDestroy:function(){\n        ty.NotificationCenter.ignoreScope(this);\n    },\n\n});\n"]}